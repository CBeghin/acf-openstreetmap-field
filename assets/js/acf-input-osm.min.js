!function(e,t){var i=t.options,a={};a.MarkerList=Backbone.View.extend({}),a.MarkerEntry=Backbone.View.extend({tagName:"div",className:"osm-marker",default_state:!0,events:{'click [data-name="locate-marker"]':"locate_marker",'click [data-name="remove-marker"]':"remove_marker",'change [type="text"]':"set_default_state"},is_default_label:function(){var e=this.$el.find('[id$="-marker-default-label"]').val();return!e||this.$el.find('[id$="-marker-label"]').val()===e},initialize:function(e){return this.template=e.template,this.marker=e.marker,this},render:function(){return this.$el.html(this.template(this)),this},update_marker:function(t,i){return this.is_default_label()&&(this.marker.unbindTooltip(),this.marker.bindTooltip(i),this.marker.options.title=i,e(this.marker._icon).attr("title",i),this.$el.find('[id$="-marker-label"]').val(this.marker.options.title)),this.$el.find('[id$="-marker-lat"]').val(t.lat),this.$el.find('[id$="-marker-lng"]').val(t.lng),this.$el.find('[id$="-marker-default-label"]').val(i),this},locate_marker:function(){return this.marker._map.flyTo(this.marker.getLatLng()),e(this.marker._icon).focus(),this},remove_marker:function(e){return e.preventDefault(),this.marker.remove(),this}}),a.field=Backbone.View.extend({map:null,geocoder:null,visible:null,events:{},$parent:function(){return this.$el.closest(".acf-field-settings,.acf-field-open-street-map")},$zoom:function(){return this.$parent().find('input[id$="-zoom"]')},$lat:function(){return this.$parent().find('input[id$="-center_lat"]')},$lng:function(){return this.$parent().find('input[id$="-center_lng"]')},$layerStore:function(){return this.$parent().find('input[id$="-leaflet_layers"]')},$results:function(){return this.$parent().find(".osm-results")},$markers:function(){return this.$parent().find(".osm-markers")},initialize:function(e){return this.map=e.map,this.update_map(),this.init_layers(),this.init_markers(),this.init_acf(),this.update_visible(),this},_get_geocoder_result_label:function(t,i){var a=!1;return t.length?e.each(t,function(e,t){return a=t.html?t.html:t.name,!1}):a=i.lat.toString()+", "+i.lng.toString(),e(a).text().replace(/^(\s+)/g,"").replace(/(\s+)$/g,"")},init_markers:function(){var e=this;this.icon=new L.DivIcon({html:"",className:"osm-marker-icon"}),this.init_geocode(),this.map.on("click",function(t){var i=t.latlng;e.geocoder.options.geocoder.reverse(t.latlng,e.map.getZoom(),function(t){var a=e._get_geocoder_result_label(t,i);e.add_marker(i,a)},e)}),this.map.on("layeradd",function(t){if(t.layer.constructor===L.Marker){var i=e.$markers().find('[data-id="__osm_marker_template__"]').html().split("__osm_marker_template__").join("<%= id %>"),n=new a.MarkerEntry({controller:this,marker:t.layer,id:acf.uniqid(),template:_.template(i)});n.render().$el.prependTo(e.$markers()),t.layer.setIcon(e.icon).on("click",function(e){this.remove()}).on("remove",function(e){n.$el.remove()}).on("dragend",function(t){parseInt(n.default_state)&&e.geocoder.options.geocoder.reverse(this.getLatLng(),e.map.getZoom(),function(t){var i=this.getLatLng(),a=e._get_geocoder_result_label(t,i);console.log(a),n.update_marker(i,a)},this)}).dragging.enable()}})},add_marker:function(e,t){L.marker(e,{title:t,icon:this.icon}).bindTooltip(t).addTo(this.map)},layer_is_overlay:function(e,t){var i;return!!(t.options.opacity&&t.options.opacity<1)||(i=["^(OpenWeatherMap|OpenSeaMap)","OpenMapSurfer.AdminBounds","Stamen.Toner(Hybrid|Lines|Labels)","Acetate.(foreground|labels|roads)","HillShading","Hydda.RoadsAndLabels","^JusticeMap","OpenInfraMap.(Power|Telecom|Petroleum|Water)","OpenPtMap","OpenRailwayMap","OpenFireMap","SafeCast","CartoDB.DarkMatterOnlyLabels","CartoDB.PositronOnlyLabels"],null!==e.match("("+i.join("|")+")"))},init_layers:function(){var t=this,a=[],n={},r={},o=function(e){return null===e},l=function(s,d){var c,m;if(_.isObject(d))return e.each(d,l);o(s)||(m=i.layer_config[s.split(".")[0]]||{options:{}},c=L.tileLayer.provider(s,m.options),c.providerKey=s,t.layer_is_overlay(s,c)?r[s]=c:n[s]=c,-1!==a.indexOf(s)&&t.map.addLayer(c))};a=this.$el.data().mapLayers,e.each(i.providers,l),this.$layerStore().length&&(this.layersControl=L.control.layers(n,r,{collapsed:!0,hideSingleBase:!0}).addTo(this.map))},init_geocode:function(){var t=this;this.map._controlCorners.above=e('<div class="acf-osm-above"></div>').insertBefore(this.$el).get(0),this.geocoder=L.Control.geocoder({collapsed:!1,position:"above",placeholder:"Search...",errorMessage:"Nothing found...",showResultIcons:!0,suggestMinLength:3,suggestTimeout:250,queryMinLength:3,defaultMarkGeocode:!1}).on("markgeocode",function(e){var i=t._get_geocoder_result_label([e.geocode],e.geocode.center);t.add_marker(e.geocode.center,i),t.map.fitBounds(e.geocode.bbox)}).addTo(this.map),L.DomEvent.addListener(this.geocoder._input,"keydown",function(e){13===e.keyCode&&e.preventDefault()},this.geocoder)},update_visible:function(){return this.visible===this.$el.is(":visible")?this:(this.visible=this.$el.is(":visible"),this.visible?(this.map.invalidateSize(),this.bind_events(),this):(this.unbind_events(),this))},init_acf:function(){var t=this,i=function(){t.update_visible()};acf.addAction("show",i),acf.addAction("hide",i),e(document).on("postbox-toggled",i),this.map.on("zoomend",function(e){t.map_zoomed.apply(t,[e])}),this.map.on("moveend",function(e){t.map_moved.apply(t,[e])}),this.map.on("baselayerchange overlayadd overlayremove layeradd layerremove",function(e){var i=[];t.map.eachLayer(function(e){e.providerKey&&(t.layer_is_overlay(e.providerKey,e)?i.push(e.providerKey):i.unshift(e.providerKey))}),t.$layerStore().val(JSON.stringify(i))})},unbind_events:function(){var e=this;e.$lat().off("blur"),e.$lng().off("blur"),e.$zoom().off("blur"),e.$zoom().off("keyup focus")},bind_events:function(){var e=this;e.$lat().on("blur",function(t){e.update_map()}),e.$lng().on("blur",function(t){e.update_map()}),e.$zoom().on("blur",function(t){e.update_map()})},update_map:function(){if(this.$lat().val()&&this.$lng().val()){var e=L.latLng(this.$lat().val(),this.$lng().val());this.map.setView(e,this.$zoom().val())}},map_moved:function(e){var t=this.map.getCenter();this.$lat().val(t.lat),this.$lng().val(t.lng)},map_zoomed:function(e){this.$zoom().val(this.map.getZoom())}}),e(document).on("acf-osm-map-init",function(e,t){new a.field({el:e.target,map:t})})}(jQuery,acf_osm_admin);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1pbnB1dC1vc20uanMiXSwibmFtZXMiOlsiJCIsImFyZyIsIm9wdGlvbnMiLCJvc20iLCJNYXJrZXJMaXN0IiwiQmFja2JvbmUiLCJWaWV3IiwiZXh0ZW5kIiwiTWFya2VyRW50cnkiLCJ0YWdOYW1lIiwiY2xhc3NOYW1lIiwiZGVmYXVsdF9zdGF0ZSIsImV2ZW50cyIsImNsaWNrIFtkYXRhLW5hbWU9XCJsb2NhdGUtbWFya2VyXCJdIiwiY2xpY2sgW2RhdGEtbmFtZT1cInJlbW92ZS1tYXJrZXJcIl0iLCJjaGFuZ2UgW3R5cGU9XCJ0ZXh0XCJdIiwiaXNfZGVmYXVsdF9sYWJlbCIsImRlZmF1bHRfdmFsIiwidGhpcyIsIiRlbCIsImZpbmQiLCJ2YWwiLCJpbml0aWFsaXplIiwib3B0IiwidGVtcGxhdGUiLCJtYXJrZXIiLCJyZW5kZXIiLCJodG1sIiwidXBkYXRlX21hcmtlciIsImxhdGxuZyIsImxhYmVsIiwidW5iaW5kVG9vbHRpcCIsImJpbmRUb29sdGlwIiwidGl0bGUiLCJfaWNvbiIsImF0dHIiLCJsYXQiLCJsbmciLCJsb2NhdGVfbWFya2VyIiwiX21hcCIsImZseVRvIiwiZ2V0TGF0TG5nIiwiZm9jdXMiLCJyZW1vdmVfbWFya2VyIiwiZSIsInByZXZlbnREZWZhdWx0IiwicmVtb3ZlIiwiZmllbGQiLCJtYXAiLCJnZW9jb2RlciIsInZpc2libGUiLCIkcGFyZW50IiwiY2xvc2VzdCIsIiR6b29tIiwiJGxhdCIsIiRsbmciLCIkbGF5ZXJTdG9yZSIsIiRyZXN1bHRzIiwiJG1hcmtlcnMiLCJjb25mIiwidXBkYXRlX21hcCIsImluaXRfbGF5ZXJzIiwiaW5pdF9tYXJrZXJzIiwiaW5pdF9hY2YiLCJ1cGRhdGVfdmlzaWJsZSIsIl9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsIiwibGVuZ3RoIiwiZWFjaCIsImkiLCJyZXN1bHQiLCJuYW1lIiwidG9TdHJpbmciLCJ0ZXh0IiwicmVwbGFjZSIsInNlbGYiLCJpY29uIiwiTCIsIkRpdkljb24iLCJpbml0X2dlb2NvZGUiLCJvbiIsInJldmVyc2UiLCJnZXRab29tIiwiYWRkX21hcmtlciIsImxheWVyIiwiY29uc3RydWN0b3IiLCJNYXJrZXIiLCJzcGxpdCIsImpvaW4iLCJlbnRyeSIsImNvbnRyb2xsZXIiLCJpZCIsImFjZiIsInVuaXFpZCIsIl8iLCJwcmVwZW5kVG8iLCJzZXRJY29uIiwicGFyc2VJbnQiLCJjb25zb2xlIiwibG9nIiwiZHJhZ2dpbmciLCJlbmFibGUiLCJsbmdsYXQiLCJhZGRUbyIsImxheWVyX2lzX292ZXJsYXkiLCJrZXkiLCJwYXR0ZXJucyIsIm9wYWNpdHkiLCJtYXRjaCIsInNlbGVjdGVkTGF5ZXJzIiwiYmFzZUxheWVycyIsIm92ZXJsYXlzIiwiaXNfb21pdHRlZCIsInNldHVwTWFwIiwibGF5ZXJfY29uZmlnIiwiaXNPYmplY3QiLCJ0aWxlTGF5ZXIiLCJwcm92aWRlciIsInByb3ZpZGVyS2V5IiwiaW5kZXhPZiIsImFkZExheWVyIiwiZGF0YSIsIm1hcExheWVycyIsInByb3ZpZGVycyIsImxheWVyc0NvbnRyb2wiLCJjb250cm9sIiwibGF5ZXJzIiwiY29sbGFwc2VkIiwiaGlkZVNpbmdsZUJhc2UiLCJfY29udHJvbENvcm5lcnMiLCJpbnNlcnRCZWZvcmUiLCJnZXQiLCJDb250cm9sIiwicG9zaXRpb24iLCJwbGFjZWhvbGRlciIsImVycm9yTWVzc2FnZSIsInNob3dSZXN1bHRJY29ucyIsInN1Z2dlc3RNaW5MZW5ndGgiLCJzdWdnZXN0VGltZW91dCIsInF1ZXJ5TWluTGVuZ3RoIiwiZGVmYXVsdE1hcmtHZW9jb2RlIiwiZ2VvY29kZSIsImNlbnRlciIsImZpdEJvdW5kcyIsImJib3giLCJEb21FdmVudCIsImFkZExpc3RlbmVyIiwiX2lucHV0Iiwia2V5Q29kZSIsImlzIiwiaW52YWxpZGF0ZVNpemUiLCJiaW5kX2V2ZW50cyIsInVuYmluZF9ldmVudHMiLCJ0b2dnbGVfY2IiLCJhZGRBY3Rpb24iLCJkb2N1bWVudCIsIm1hcF96b29tZWQiLCJhcHBseSIsIm1hcF9tb3ZlZCIsImVhY2hMYXllciIsInB1c2giLCJ1bnNoaWZ0IiwiSlNPTiIsInN0cmluZ2lmeSIsIm9mZiIsImxhdExuZyIsInNldFZpZXciLCJnZXRDZW50ZXIiLCJlbCIsInRhcmdldCIsImpRdWVyeSIsImFjZl9vc21fYWRtaW4iXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBQ0EsR0FBQUMsR0FBQUQsRUFBQUMsUUFNQUMsSUFHQUEsR0FBQUMsV0FBQUMsU0FBQUMsS0FBQUMsV0FFQUosRUFBQUssWUFBQUgsU0FBQUMsS0FBQUMsUUFDQUUsUUFBQSxNQUNBQyxVQUFBLGFBQ0FDLGVBQUEsRUFDQUMsUUFDQUMsb0NBQUEsZ0JBQ0FDLG9DQUFBLGdCQUNBQyx1QkFBQSxxQkFFQUMsaUJBQUEsV0FDQSxHQUFBQyxHQUFBQyxLQUFBQyxJQUFBQyxLQUFBLGlDQUFBQyxLQUNBLFFBQUFKLEdBQUFDLEtBQUFDLElBQUFDLEtBQUEseUJBQUFDLFFBQUFKLEdBRUFLLFdBQUEsU0FBQUMsR0FLQSxNQUhBTCxNQUFBTSxTQUFBRCxFQUFBQyxTQUNBTixLQUFBTyxPQUFBRixFQUFBRSxPQUVBUCxNQUVBUSxPQUFBLFdBRUEsTUFEQVIsTUFBQUMsSUFBQVEsS0FBQVQsS0FBQU0sU0FBQU4sT0FDQUEsTUFFQVUsY0FBQSxTQUFBQyxFQUFBQyxHQWtCQSxNQWhCQVosTUFBQUYscUJBRUFFLEtBQUFPLE9BQUFNLGdCQUNBYixLQUFBTyxPQUFBTyxZQUFBRixHQUVBWixLQUFBTyxPQUFBdkIsUUFBQStCLE1BQUFILEVBQ0E5QixFQUFBa0IsS0FBQU8sT0FBQVMsT0FBQUMsS0FBQSxRQUFBTCxHQUdBWixLQUFBQyxJQUFBQyxLQUFBLHlCQUFBQyxJQUFBSCxLQUFBTyxPQUFBdkIsUUFBQStCLFFBR0FmLEtBQUFDLElBQUFDLEtBQUEsdUJBQUFDLElBQUFRLEVBQUFPLEtBQ0FsQixLQUFBQyxJQUFBQyxLQUFBLHVCQUFBQyxJQUFBUSxFQUFBUSxLQUNBbkIsS0FBQUMsSUFBQUMsS0FBQSxpQ0FBQUMs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TUFBQUgsS0FBQXFDLE9BQUFsQyxNQUNBSCxNQUFBOEIsSUFBQXFILFFBQUF4SSxFQUFBWCxLQUFBbUMsUUFBQWhDLFNBRUF3SSxVQUFBLFNBQUFqSCxHQUNBLEdBQUFpRyxHQUFBM0gsS0FBQThCLElBQUFzSCxXQUNBcEosTUFBQW9DLE9BQUFqQyxJQUFBd0gsRUFBQXpHLEtBQ0FsQixLQUFBcUMsT0FBQWxDLElBQUF3SCxFQUFBeEcsTUFFQXNILFdBQUEsU0FBQS9HLEdBQ0ExQixLQUFBbUMsUUFBQWhDLElBQUFILEtBQUE4QixJQUFBaUMsY0FpQkFqRixFQUFBMEosVUFBQTNFLEdBQUEsbUJBQUEsU0FBQW5DLEVBQUFJLEdBQ0EsR0FBQTdDLEdBQUE0QyxPQUFBd0gsR0FBQTNILEVBQUE0SCxPQUFBeEgsSUFBQUEsT0FJQXlILE9BQUFDIiwiZmlsZSI6ImFjZi1pbnB1dC1vc20ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCAkLCBhcmcgKXtcblx0dmFyIG9wdGlvbnMgPSBhcmcub3B0aW9ucyxcblx0XHRyZXN1bHRfdHBsID0gJzxkaXYgdGFiaW5kZXg9XCI8JT0gZGF0YS5pICU+XCIgY2xhc3M9XCJvc20tcmVzdWx0XCI+J1xuXHRcdFx0KyAnPCU9IGRhdGEucmVzdWx0X3RleHQgJT4nXG5cdFx0XHQrICc8YnIgLz48c21hbGw+PCU9IGRhdGEucHJvcGVydGllcy5vc21fdmFsdWUgJT48L3NtYWxsPidcblx0XHRcdCsgJzwvZGl2Pic7XG5cblx0dmFyIG9zbSA9IHtcblx0fTtcblxuXHRvc20uTWFya2VyTGlzdCA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcblx0fSlcblx0b3NtLk1hcmtlckVudHJ5ID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXHRcdHRhZ05hbWU6ICdkaXYnLFxuXHRcdGNsYXNzTmFtZTonb3NtLW1hcmtlcicsXG5cdFx0ZGVmYXVsdF9zdGF0ZTogdHJ1ZSxcblx0XHRldmVudHM6IHtcblx0XHRcdCdjbGljayBbZGF0YS1uYW1lPVwibG9jYXRlLW1hcmtlclwiXScgOiAnbG9jYXRlX21hcmtlcicsXG5cdFx0XHQnY2xpY2sgW2RhdGEtbmFtZT1cInJlbW92ZS1tYXJrZXJcIl0nIDogJ3JlbW92ZV9tYXJrZXInLFxuXHRcdFx0J2NoYW5nZSBbdHlwZT1cInRleHRcIl0nIFx0XHRcdFx0OiAnc2V0X2RlZmF1bHRfc3RhdGUnLFxuXHRcdH0sXG5cdFx0aXNfZGVmYXVsdF9sYWJlbDogZnVuY3Rpb24oKXtcblx0XHRcdHZhciBkZWZhdWx0X3ZhbCA9IHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWRlZmF1bHQtbGFiZWxcIl0nKS52YWwoKTtcblx0XHRcdHJldHVybiAoICEgZGVmYXVsdF92YWwgKSB8fCAoIHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWxhYmVsXCJdJykudmFsKCkgPT09IGRlZmF1bHRfdmFsICk7XG5cdFx0fSxcblx0XHRpbml0aWFsaXplOmZ1bmN0aW9uKG9wdCl7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cdFx0XHR0aGlzLnRlbXBsYXRlID0gb3B0LnRlbXBsYXRlO1xuXHRcdFx0dGhpcy5tYXJrZXIgPSBvcHQubWFya2VyO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHJlbmRlcjpmdW5jdGlvbigpe1xuXHRcdFx0dGhpcy4kZWwuaHRtbCggdGhpcy50ZW1wbGF0ZSggdGhpcyApICk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHVwZGF0ZV9tYXJrZXI6ZnVuY3Rpb24oIGxhdGxuZywgbGFiZWwgKSB7XG5cblx0XHRcdGlmICggdGhpcy5pc19kZWZhdWx0X2xhYmVsKCkgKSB7XG5cdFx0XHRcdC8vIHVwZGF0ZSBtYXJrZXIgbGFiZWxzXG5cdFx0XHRcdHRoaXMubWFya2VyLnVuYmluZFRvb2x0aXAoKTtcblx0XHRcdFx0dGhpcy5tYXJrZXIuYmluZFRvb2x0aXAobGFiZWwpO1xuXG5cdFx0XHRcdHRoaXMubWFya2VyLm9wdGlvbnMudGl0bGUgPSBsYWJlbDtcblx0XHRcdFx0JCggdGhpcy5tYXJrZXIuX2ljb24gKS5hdHRyKCAndGl0bGUnLCBsYWJlbCApO1xuXG5cdFx0XHRcdC8vIHVwZGF0ZSBtYXJrZXIgbGFiZWwgaW5wdXRcblx0XHRcdFx0dGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItbGFiZWxcIl0nKS52YWwoIHRoaXMubWFya2VyLm9wdGlvbnMudGl0bGUgKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItbGF0XCJdJykudmFsKCBsYXRsbmcubGF0ICk7XG5cdFx0XHR0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1sbmdcIl0nKS52YWwoIGxhdGxuZy5sbmcgKTtcblx0XHRcdHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWRlZmF1bHQtbGFiZWxcIl0nKS52YWwoIGxhYmVsICk7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0bG9jYXRlX21hcmtlcjpmdW5jdGlvbigpe1xuXHRcdFx0dGhpcy5tYXJrZXIuX21hcC5mbHlUbyggdGhpcy5tYXJrZXIuZ2V0TGF0TG5nKCkgKTtcblx0XHRcdCQodGhpcy5tYXJrZXIuX2ljb24pLmZvY3VzKClcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0cmVtb3ZlX21hcmtlcjpmdW5jdGlvbihlKSB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KClcblx0XHRcdHRoaXMubWFya2VyLnJlbW92ZSgpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXHR9KTtcblxuXHRvc20uZmllbGQgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG5cdFx0Lypcblx0XHR0b2RvOlxuXHRcdC0gTWFwIExheWVyIHNlbGVjdG9yXG5cdFx0LSBzZXQgLyB1bnNldCBtYXJrZXJcblx0XHQqL1xuXG5cdFx0bWFwOiBudWxsLFxuXHRcdGdlb2NvZGVyOiBudWxsLFxuXHRcdHZpc2libGU6IG51bGwsXG5cdFx0ZXZlbnRzOntcblx0XHR9LFxuXG5cdFx0JHBhcmVudDpmdW5jdGlvbigpe1xuXHRcdFx0cmV0dXJuIHRoaXMuJGVsLmNsb3Nlc3QoJy5hY2YtZmllbGQtc2V0dGluZ3MsLmFjZi1maWVsZC1vcGVuLXN0cmVldC1tYXAnKVxuXHRcdH0sXG5cdFx0JHpvb20gOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCdpbnB1dFtpZCQ9XCItem9vbVwiXScpO1xuXHRcdH0sXG5cdFx0JGxhdCA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJ2lucHV0W2lkJD1cIi1jZW50ZXJfbGF0XCJdJyk7XG5cdFx0fSxcblx0XHQkbG5nIDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnaW5wdXRbaWQkPVwiLWNlbnRlcl9sbmdcIl0nKTtcblx0XHR9LFxuXHRcdCRsYXllclN0b3JlOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCdpbnB1dFtpZCQ9XCItbGVhZmxldF9sYXllcnNcIl0nKTtcblx0XHR9LFxuXHRcdCRyZXN1bHRzIDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnLm9zbS1yZXN1bHRzJyk7XG5cdFx0fSxcblx0XHQkbWFya2VyczpmdW5jdGlvbigpe1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJy5vc20tbWFya2VycycpO1xuXHRcdH0sXG5cdFx0aW5pdGlhbGl6ZTpmdW5jdGlvbihjb25mKSB7XG5cblx0XHRcdHRoaXMubWFwXHRcdD0gY29uZi5tYXA7XG5cblx0XHRcdHRoaXMudXBkYXRlX21hcCgpOyAvLyBzZXQgbWFwIHRvIGlucHV0IHZhbHVlc1xuXG5cdFx0XHR0aGlzLmluaXRfbGF5ZXJzKCk7XG5cblx0XHRcdHRoaXMuaW5pdF9tYXJrZXJzKCk7XG5cblx0XHRcdHRoaXMuaW5pdF9hY2YoKTtcblxuXHRcdFx0dGhpcy51cGRhdGVfdmlzaWJsZSgpO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdF9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsOmZ1bmN0aW9uKCBlLCBsYXRsbmcgKSB7XG5cdFx0XHR2YXIgbGFiZWwgPSBmYWxzZTtcblxuXHRcdFx0aWYgKCAhIGUubGVuZ3RoICkge1xuXHRcdFx0XHRsYWJlbCA9IGxhdGxuZy5sYXQudG9TdHJpbmcoKSArICcsICcgKyBsYXRsbmcubG5nLnRvU3RyaW5nKCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQkLmVhY2goIGUsIGZ1bmN0aW9uKCBpLCByZXN1bHQgKSB7XG5cdFx0XHRcdFx0aWYgKCAhISByZXN1bHQuaHRtbCApIHtcblx0XHRcdFx0XHRcdGxhYmVsID0gcmVzdWx0Lmh0bWw7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGxhYmVsID0gcmVzdWx0Lm5hbWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gJChsYWJlbCkudGV4dCgpLnJlcGxhY2UoL14oXFxzKykvZywnJykucmVwbGFjZSgvKFxccyspJC9nLCcnKTtcblx0XHR9LFxuXHRcdGluaXRfbWFya2VyczpmdW5jdGlvbigpe1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHRoaXMuaWNvbiA9IG5ldyBMLkRpdkljb24oe1xuXHRcdFx0XHRodG1sOiAnJyxcblx0XHRcdFx0Y2xhc3NOYW1lOidvc20tbWFya2VyLWljb24nXG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5pbml0X2dlb2NvZGUoKTtcblxuXHRcdFx0dGhpcy5tYXAub24oJ2NsaWNrJywgZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHZhciBsYXRsbmcgPSBlLmxhdGxuZztcblx0XHRcdFx0c2VsZi5nZW9jb2Rlci5vcHRpb25zLmdlb2NvZGVyLnJldmVyc2UoZS5sYXRsbmcsc2VsZi5tYXAuZ2V0Wm9vbSgpLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdHZhciBsYWJlbCA9IHNlbGYuX2dldF9nZW9jb2Rlcl9yZXN1bHRfbGFiZWwoIGUsIGxhdGxuZyApO1xuXHRcdFx0XHRcdHNlbGYuYWRkX21hcmtlciggbGF0bG5nLCBsYWJlbCApO1xuXHRcdFx0XHR9LHNlbGYpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMubWFwLm9uKCAnbGF5ZXJhZGQnLCBmdW5jdGlvbihlKXtcblx0XHRcdFx0aWYgKCBlLmxheWVyLmNvbnN0cnVjdG9yICE9PSBMLk1hcmtlciApIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdFx0dmFyIHRlbXBsYXRlID0gc2VsZi4kbWFya2VycygpLmZpbmQoJ1tkYXRhLWlkPVwiX19vc21fbWFya2VyX3RlbXBsYXRlX19cIl0nKS5odG1sKCkuc3BsaXQoJ19fb3NtX21hcmtlcl90ZW1wbGF0ZV9fJykuam9pbiggJzwlPSBpZCAlPicgKSxcblx0XHRcdFx0XHRlbnRyeSA9IG5ldyBvc20uTWFya2VyRW50cnkoe1xuXHRcdFx0XHRcdFx0Y29udHJvbGxlcjogdGhpcyxcblx0XHRcdFx0XHRcdG1hcmtlcjogZS5sYXllcixcblx0XHRcdFx0XHRcdGlkOiBhY2YudW5pcWlkKCksIC8vc2VsZi4kbWFya2VycygpLmNoaWxkcmVuKCkubGVuZ3RoLFxuXHRcdFx0XHRcdFx0dGVtcGxhdGU6IF8udGVtcGxhdGUoIHRlbXBsYXRlICksXG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0ZW50cnkucmVuZGVyKCkuJGVsLnByZXBlbmRUbyggc2VsZi4kbWFya2VycygpICk7XG5cblx0XHRcdFx0ZS5sYXllclxuXHRcdFx0XHRcdC5zZXRJY29uKCBzZWxmLmljb24gKVxuXHRcdFx0XHRcdC5vbignY2xpY2snLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdFx0dGhpcy5yZW1vdmUoKTtcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5vbigncmVtb3ZlJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRcdGVudHJ5LiRlbC5yZW1vdmUoKTtcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5vbignZHJhZ2VuZCcsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0XHRpZiAoICEgcGFyc2VJbnQoIGVudHJ5LmRlZmF1bHRfc3RhdGUgKSApIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0c2VsZi5nZW9jb2Rlci5vcHRpb25zLmdlb2NvZGVyLnJldmVyc2UodGhpcy5nZXRMYXRMbmcoKSxzZWxmLm1hcC5nZXRab29tKCksZnVuY3Rpb24oZSl7XG5cblx0XHRcdFx0XHRcdFx0dmFyIGxhdGxuZyA9IHRoaXMuZ2V0TGF0TG5nKCksXG5cdFx0XHRcdFx0XHRcdFx0bGFiZWwgPSBzZWxmLl9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsKCBlLCBsYXRsbmcgKTtcbmNvbnNvbGUubG9nKGxhYmVsKVxuXHRcdFx0XHRcdFx0XHRlbnRyeS51cGRhdGVfbWFya2VyKCBsYXRsbmcsIGxhYmVsICk7XG5cblx0XHRcdFx0XHRcdH0sIHRoaXMgKTtcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5kcmFnZ2luZy5lbmFibGUoKTtcblx0XHRcdH0gKTtcblx0XHR9LFxuXHRcdGFkZF9tYXJrZXI6ZnVuY3Rpb24oIGxuZ2xhdCwgbGFiZWwgKXtcblx0XHRcdEwubWFya2VyKGxuZ2xhdCx7XG5cdFx0XHRcdHRpdGxlOiBsYWJlbCxcblx0XHRcdFx0aWNvbjogdGhpcy5pY29uLFxuXHRcdFx0fSlcblx0XHRcdFx0LmJpbmRUb29sdGlwKCBsYWJlbCApXG5cdFx0XHRcdC5hZGRUbyggdGhpcy5tYXAgKTtcblx0XHR9LFxuXHRcdGxheWVyX2lzX292ZXJsYXk6IGZ1bmN0aW9uKCAga2V5LCBsYXllciApIHtcblx0XHRcdHZhciBwYXR0ZXJucztcblxuXHRcdFx0aWYgKCBsYXllci5vcHRpb25zLm9wYWNpdHkgJiYgbGF5ZXIub3B0aW9ucy5vcGFjaXR5IDwgMSApIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0XHRwYXR0ZXJucyA9IFsnXihPcGVuV2VhdGhlck1hcHxPcGVuU2VhTWFwKScsXG5cdFx0XHRcdCdPcGVuTWFwU3VyZmVyLkFkbWluQm91bmRzJyxcblx0XHRcdFx0J1N0YW1lbi5Ub25lcihIeWJyaWR8TGluZXN8TGFiZWxzKScsXG5cdFx0XHRcdCdBY2V0YXRlLihmb3JlZ3JvdW5kfGxhYmVsc3xyb2FkcyknLFxuXHRcdFx0XHQnSGlsbFNoYWRpbmcnLFxuXHRcdFx0XHQnSHlkZGEuUm9hZHNBbmRMYWJlbHMnLFxuXHRcdFx0XHQnXkp1c3RpY2VNYXAnLFxuXHRcdFx0XHQnT3BlbkluZnJhTWFwLihQb3dlcnxUZWxlY29tfFBldHJvbGV1bXxXYXRlciknLFxuXHRcdFx0XHQnT3BlblB0TWFwJyxcblx0XHRcdFx0J09wZW5SYWlsd2F5TWFwJyxcblx0XHRcdFx0J09wZW5GaXJlTWFwJyxcblx0XHRcdFx0J1NhZmVDYXN0Jyxcblx0XHRcdFx0J0NhcnRvREIuRGFya01hdHRlck9ubHlMYWJlbHMnLFxuXHRcdFx0XHQnQ2FydG9EQi5Qb3NpdHJvbk9ubHlMYWJlbHMnXG5cdFx0XHRdO1xuXHRcdFx0cmV0dXJuIGtleS5tYXRjaCgnKCcgKyBwYXR0ZXJucy5qb2luKCd8JykgKyAnKScpICE9PSBudWxsO1xuXHRcdH0sXG5cdFx0aW5pdF9sYXllcnM6ZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdHNlbGVjdGVkTGF5ZXJzID0gW10sXG5cdFx0XHRcdGJhc2VMYXllcnMgPSB7fSxcblx0XHRcdFx0b3ZlcmxheXMgPSB7fSxcblx0XHRcdFx0aXNfb21pdHRlZCA9IGZ1bmN0aW9uKGtleSkge1xuXG5cdFx0XHRcdFx0cmV0dXJuIGtleSA9PT0gbnVsbDtcblx0XHRcdFx0fSxcblx0XHRcdFx0c2V0dXBNYXAgPSBmdW5jdGlvbigga2V5LCB2YWwgKXtcblx0XHRcdFx0XHR2YXIgbGF5ZXIsIGxheWVyX2NvbmZpZztcblx0XHRcdFx0XHRpZiAoIF8uaXNPYmplY3QodmFsKSApIHtcblx0XHRcdFx0XHRcdHJldHVybiAkLmVhY2goIHZhbCwgc2V0dXBNYXAgKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIGlzX29taXR0ZWQoa2V5KSApIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRsYXllcl9jb25maWcgPSBvcHRpb25zLmxheWVyX2NvbmZpZ1sga2V5LnNwbGl0KCcuJylbMF0gXSB8fCB7b3B0aW9uczp7fX07XG5cdFx0XHRcdFx0bGF5ZXIgPSBMLnRpbGVMYXllci5wcm92aWRlcigga2V5LCBsYXllcl9jb25maWcub3B0aW9ucyApO1xuXHRcdFx0XHRcdGxheWVyLnByb3ZpZGVyS2V5ID0ga2V5O1xuXG5cdFx0XHRcdFx0aWYgKCBzZWxmLmxheWVyX2lzX292ZXJsYXkoIGtleSwgbGF5ZXIgKSApIHtcblx0XHRcdFx0XHRcdG92ZXJsYXlzW2tleV0gPSBsYXllcjtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0YmFzZUxheWVyc1trZXldID0gbGF5ZXI7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICggc2VsZWN0ZWRMYXllcnMuaW5kZXhPZigga2V5ICkgIT09IC0xICl7XG5cblx0XHRcdFx0XHRcdHNlbGYubWFwLmFkZExheWVyKGxheWVyKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH07XG5cblx0XHRcdHNlbGVjdGVkTGF5ZXJzID0gdGhpcy4kZWwuZGF0YSgpLm1hcExheWVycztcblxuXHRcdFx0JC5lYWNoKCBvcHRpb25zLnByb3ZpZGVycywgc2V0dXBNYXAgKTtcblxuXHRcdFx0Ly8gLi4uIG5vIGxheWVyIGVkaXRpbmcgYWxsb3dlZFxuXHRcdFx0aWYgKCAhIHRoaXMuJGxheWVyU3RvcmUoKS5sZW5ndGggKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5sYXllcnNDb250cm9sID0gTC5jb250cm9sLmxheWVycyggYmFzZUxheWVycywgb3ZlcmxheXMsIHtcblx0XHRcdFx0Y29sbGFwc2VkOiB0cnVlLFxuXHRcdFx0XHRoaWRlU2luZ2xlQmFzZTogdHJ1ZSxcblx0XHRcdH0pLmFkZFRvKHRoaXMubWFwKTtcblxuXHRcdH0sXG5cdFx0aW5pdF9nZW9jb2RlOmZ1bmN0aW9uKCkge1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHRoaXMubWFwLl9jb250cm9sQ29ybmVyc1snYWJvdmUnXSA9ICQoJzxkaXYgY2xhc3M9XCJhY2Ytb3NtLWFib3ZlXCI+PC9kaXY+JykuaW5zZXJ0QmVmb3JlKCB0aGlzLiRlbCApLmdldCgwKTtcblxuXHRcdFx0dGhpcy5nZW9jb2RlciA9IEwuQ29udHJvbC5nZW9jb2Rlcih7XG5cdFx0XHRcdGNvbGxhcHNlZDogZmFsc2UsXG5cdFx0XHRcdHBvc2l0aW9uOidhYm92ZScsXG5cdFx0XHRcdHBsYWNlaG9sZGVyOidTZWFyY2guLi4nLFxuXHRcdFx0XHRlcnJvck1lc3NhZ2U6J05vdGhpbmcgZm91bmQuLi4nLFxuXHRcdFx0XHRzaG93UmVzdWx0SWNvbnM6dHJ1ZSxcblx0XHRcdFx0c3VnZ2VzdE1pbkxlbmd0aDozLFxuXHRcdFx0XHRzdWdnZXN0VGltZW91dDoyNTAsXG5cdFx0XHRcdHF1ZXJ5TWluTGVuZ3RoOjMsXG5cdFx0XHRcdGRlZmF1bHRNYXJrR2VvY29kZTpmYWxzZSxcblx0XHRcdH0pXG5cdFx0XHQub24oJ21hcmtnZW9jb2RlJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0Ly9jb25zb2xlLmxvZyhlLmdlb2NvZGUuY25ldGVyKTtyZXR1cm47XG5cdFx0XHRcdHZhciBsYWJlbCA9IHNlbGYuX2dldF9nZW9jb2Rlcl9yZXN1bHRfbGFiZWwoIFtlLmdlb2NvZGVdLCBlLmdlb2NvZGUuY2VudGVyICk7XG5cdFx0XHRcdHNlbGYuYWRkX21hcmtlciggZS5nZW9jb2RlLmNlbnRlciwgbGFiZWwgKTtcblx0XHRcdFx0Lypcblx0XHRcdFx0c2VsZi5tYXAuZmx5VG9Cb3VuZHMoZS5nZW9jb2RlLmJib3gpO1xuXHRcdFx0XHQvKi9cblx0XHRcdFx0c2VsZi5tYXAuZml0Qm91bmRzKGUuZ2VvY29kZS5iYm94KTtcblx0XHRcdFx0Ly8qL1xuXG4vL1x0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0fSlcblx0XHRcdC5hZGRUbyggdGhpcy5tYXAgKTtcblxuXHRcdFx0Ly8gcHJldmVudCB3cCBwb3N0IGZvcm0gZnJvbSBiZWluZyBzdWJtaXR0ZWRcblx0XHRcdEwuRG9tRXZlbnQuYWRkTGlzdGVuZXIodGhpcy5nZW9jb2Rlci5faW5wdXQsICdrZXlkb3duJywgZnVuY3Rpb24oZSl7XG5cdFx0XHRcdGlmICggZS5rZXlDb2RlID09PSAxMyApIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdH1cblx0XHRcdH0sIHRoaXMuZ2VvY29kZXIgKTtcblx0XHR9LFxuXHRcdHVwZGF0ZV92aXNpYmxlOiBmdW5jdGlvbigpIHtcblxuXHRcdFx0aWYgKCB0aGlzLnZpc2libGUgPT09IHRoaXMuJGVsLmlzKCc6dmlzaWJsZScpICkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH1cblxuXHRcdFx0dGhpcy52aXNpYmxlID0gdGhpcy4kZWwuaXMoJzp2aXNpYmxlJyk7XG5cblx0XHRcdGlmICggdGhpcy52aXNpYmxlICkge1xuXHRcdFx0XHR0aGlzLm1hcC5pbnZhbGlkYXRlU2l6ZSgpO1xuXHRcdFx0XHR0aGlzLmJpbmRfZXZlbnRzKCk7XG5cdFx0XHRcdHJldHVybiB0aGlzO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy51bmJpbmRfZXZlbnRzKCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdGluaXRfYWNmOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0dG9nZ2xlX2NiID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0Ly8gbm8gY2hhbmdlXG5cdFx0XHRcdFx0c2VsZi51cGRhdGVfdmlzaWJsZSgpO1xuXHRcdFx0XHR9O1xuXG5cdFx0XHQvLyBleHBhbmQvY29sbGFwc2UgYWNmIHNldHRpbmdcblx0XHRcdGFjZi5hZGRBY3Rpb24oICdzaG93JywgdG9nZ2xlX2NiICk7XG5cdFx0XHRhY2YuYWRkQWN0aW9uKCAnaGlkZScsIHRvZ2dsZV9jYiApO1xuXG5cblxuXHRcdFx0Ly8gZXhwYW5kIGFjZiByZXBlYXRlclxuXHRcdFx0Ly8gLi4uXG5cblx0XHRcdC8vIGV4cGFuZCBhY2YgbGF5b3V0XG5cdFx0XHQvLyAuLi5cblxuXHRcdFx0Ly8gZXhwYW5kIHdwIG1ldGFib3hcblx0XHRcdCQoZG9jdW1lbnQpLm9uKCdwb3N0Ym94LXRvZ2dsZWQnLHRvZ2dsZV9jYilcblxuXG5cdFx0XHR0aGlzLm1hcC5vbignem9vbWVuZCcsIGZ1bmN0aW9uKGUpeyBzZWxmLm1hcF96b29tZWQuYXBwbHkoIHNlbGYsIFtlXSApOyB9ICk7XG5cdFx0XHR0aGlzLm1hcC5vbignbW92ZWVuZCcsIGZ1bmN0aW9uKGUpeyBzZWxmLm1hcF9tb3ZlZC5hcHBseSggc2VsZiwgW2VdICk7IH0gKTtcblxuXHRcdFx0dGhpcy5tYXAub24oICdiYXNlbGF5ZXJjaGFuZ2Ugb3ZlcmxheWFkZCBvdmVybGF5cmVtb3ZlIGxheWVyYWRkIGxheWVycmVtb3ZlJywgZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHZhciBsYXllcnMgPSBbXTtcblx0XHRcdFx0c2VsZi5tYXAuZWFjaExheWVyKGZ1bmN0aW9uKGxheWVyKSB7XG5cdFx0XHRcdFx0aWYgKCAhIGxheWVyLnByb3ZpZGVyS2V5ICkge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAoIHNlbGYubGF5ZXJfaXNfb3ZlcmxheSggbGF5ZXIucHJvdmlkZXJLZXksIGxheWVyICkgKSB7XG5cdFx0XHRcdFx0XHRsYXllcnMucHVzaChsYXllci5wcm92aWRlcktleSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGxheWVycy51bnNoaWZ0KGxheWVyLnByb3ZpZGVyS2V5KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRzZWxmLiRsYXllclN0b3JlKCkudmFsKCBKU09OLnN0cmluZ2lmeSggbGF5ZXJzICkgKTtcblx0XHRcdH0gKTtcblx0XHR9LFxuXHRcdHVuYmluZF9ldmVudHM6ZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cdFx0XHRzZWxmLiRsYXQoKS5vZmYoJ2JsdXInKTtcblx0XHRcdHNlbGYuJGxuZygpLm9mZignYmx1cicpO1xuXHRcdFx0c2VsZi4kem9vbSgpLm9mZignYmx1cicpO1xuXHRcdFx0c2VsZi4kem9vbSgpLm9mZigna2V5dXAgZm9jdXMnKTtcblxuXHRcdH0sXG5cdFx0YmluZF9ldmVudHM6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLiRsYXQoKS5vbignYmx1cicsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHNlbGYudXBkYXRlX21hcCgpO1xuXHRcdFx0fSk7XG5cdFx0XHRzZWxmLiRsbmcoKS5vbignYmx1cicsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHNlbGYudXBkYXRlX21hcCgpO1xuXHRcdFx0fSk7XG5cdFx0XHRzZWxmLiR6b29tKCkub24oJ2JsdXInLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRzZWxmLnVwZGF0ZV9tYXAoKTtcblx0XHRcdH0pO1xuXHRcdFx0Ly8gc2VsZi4kYWRkcmVzcygpLm9uKCdrZXl1cCBmb2N1cycsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0Ly8gXHRzZWxmLnNlYXJjaChlKTtcblx0XHRcdC8vIH0gKTtcblxuXG4vL1x0XHRcdHRoaXMubGlzdGVuVG8oIHRoaXMuJGFkZHJlc3MsICdrZXl1cCBmb2N1cycsIHRoaXMuc2VhcmNoICk7XG5cblx0XHRcdC8vIHRoaXMuJHRpbGVzLm9uKCdjaGFuZ2UnLCBkb19sYXllcnMgKVxuXHRcdFx0Ly8gXHQucHJldignaW5wdXQnKS5vbignY2hhbmdlJywgZG9fbGF5ZXJzICk7XG5cblx0XHR9LFxuXHRcdHVwZGF0ZV9tYXA6ZnVuY3Rpb24oKSB7XG5cdFx0XHRpZiAoICEgdGhpcy4kbGF0KCkudmFsKCkgfHwgISB0aGlzLiRsbmcoKS52YWwoKSApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0dmFyIGxhdGxuZyA9IEwubGF0TG5nKCB0aGlzLiRsYXQoKS52YWwoKSwgdGhpcy4kbG5nKCkudmFsKCkgKTtcblx0XHRcdHRoaXMubWFwLnNldFZpZXcoIGxhdGxuZywgIHRoaXMuJHpvb20oKS52YWwoKSApO1xuXHRcdH0sXG5cdFx0bWFwX21vdmVkOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dmFyIGNlbnRlciA9IHRoaXMubWFwLmdldENlbnRlcigpO1xuXHRcdFx0dGhpcy4kbGF0KCkudmFsKGNlbnRlci5sYXQpO1xuXHRcdFx0dGhpcy4kbG5nKCkudmFsKGNlbnRlci5sbmcpO1xuXHRcdH0sXG5cdFx0bWFwX3pvb21lZDpmdW5jdGlvbihlKXtcblx0XHRcdHRoaXMuJHpvb20oKS52YWwoIHRoaXMubWFwLmdldFpvb20oKSApO1xuXHRcdH0sXG5cdH0pO1xuXG5cdC8qXG5cdCAqICByZWFkeSBhcHBlbmQgKEFDRjUpXG5cdCAqXG5cdCAqICBUaGVzZSBhcmUgMiBldmVudHMgd2hpY2ggYXJlIGZpcmVkIGR1cmluZyB0aGUgcGFnZSBsb2FkXG5cdCAqICByZWFkeSA9IG9uIHBhZ2UgbG9hZCBzaW1pbGFyIHRvICQoZG9jdW1lbnQpLnJlYWR5KClcblx0ICogIGFwcGVuZCA9IG9uIG5ldyBET00gZWxlbWVudHMgYXBwZW5kZWQgdmlhIHJlcGVhdGVyIGZpZWxkXG5cdCAqXG5cdCAqICBAdHlwZVx0ZXZlbnRcblx0ICogIEBkYXRlXHQyMC8wNy8xM1xuXHQgKlxuXHQgKiAgQHBhcmFtXHQkZWwgKGpRdWVyeSBzZWxlY3Rpb24pIHRoZSBqUXVlcnkgZWxlbWVudCB3aGljaCBjb250YWlucyB0aGUgQUNGIGZpZWxkc1xuXHQgKiAgQHJldHVyblx0bi9hXG5cdCAqL1xuXHQkKGRvY3VtZW50KS5vbignYWNmLW9zbS1tYXAtaW5pdCcsZnVuY3Rpb24oIGUsIG1hcCApIHtcblx0XHRuZXcgb3NtLmZpZWxkKCB7IGVsOiBlLnRhcmdldCwgbWFwOiBtYXAgfSApO1xuXHR9KTtcblxuXG59KSggalF1ZXJ5LCBhY2Zfb3NtX2FkbWluICk7XG4iXX0=
