!function(t,e){var i=e.options,n={};n.field=Backbone.View.extend({map:null,geocoder:null,visible:null,events:{},$parent:function(){return this.$el.closest(".acf-field-settings,.acf-field-open-street-map")},$zoom:function(){return this.$parent().find('input[id$="-zoom"]')},$lat:function(){return this.$parent().find('input[id$="-center_lat"]')},$lng:function(){return this.$parent().find('input[id$="-center_lng"]')},$layerStore:function(){return this.$parent().find('input[id$="-leaflet_layers"]')},$address:function(){return this.$parent().find('input[id$="-address"]')},$mlat:function(){return this.$parent().find('input[id$="-marker_lat"]')},$mlng:function(){return this.$parent().find('input[id$="-marker_lng"]')},$results:function(){return this.$parent().find(".osm-results")},initialize:function(t){this.map=t.map,this.update_map(),this.init_layers(),this.$mlat().length&&this.$mlng().length&&this.init_marker(),this.init_geocode(),this.init_acf(),this.update_visible()},init_marker:function(){var t=this,e=this.$mlat().val()||this.$lat().val(),i=this.$mlng().val()||this.$lng().val();this.icon=L.divIcon({className:"osm-marker",html:"",iconSize:0}),this.marker=L.marker([e,i],{icon:this.icon,draggable:!0,title:this.$address().val()||""}).addTo(this.map),this.map.on("click",function(e){t.map_clicked.apply(t,[e])})},map_clicked:function(t){t.latlng;this.set_marker(t.latlng)},set_marker:function(e){t(this.marker._icon).attr("title",this.marker.title),this.marker.setLatLng(e),this.$mlat().val(e.lat),this.$mlng().val(e.lng)},init_layers:function(){var e,n=this,a={},s={},r=function(t,e){var i;return!!(e.options.opacity&&e.options.opacity<1)||(i=["^(OpenWeatherMap|OpenSeaMap)","OpenMapSurfer.AdminBounds","Stamen.Toner(Hybrid|Lines|Labels)","Acetate.(foreground|labels|roads)","HillShading","Hydda.RoadsAndLabels","^JusticeMap","OpenInfraMap.(Power|Telecom|Petroleum|Water)","OpenPtMap","OpenRailwayMap","OpenFireMap","SafeCast","CartoDB.DarkMatterOnlyLabels","CartoDB.PositronOnlyLabels"],null!==t.match("("+i.join("|")+")"))},o=function(t){return null===t},l=function(u,d){var c,h;if(_.isObject(d))return t.each(d,l);o(u)||(h=i.layer_config[u.split(".")[0]]||{options:{}},c=L.tileLayer.provider(u,h.options),c.providerKey=u,r(u,c)?s[u]=c:a[u]=c,-1!==e.indexOf(u)&&n.map.addLayer(c))};e=this.$el.data().mapLayers,this.map.eachLayer(function(t){n.map.removeLayer(t)}),t.each(i.providers,l),this.$layerStore().length&&(this.layersControl=L.control.layers(a,s,{collapsed:!0,hideSingleBase:!0}).addTo(this.map))},init_geocode:function(){this.geocoder=L.Control.geocoder({collapsed:!1,position:"topleft",placeholder:"Search...",errorMessage:"Nothing found...",showResultIcons:!0,suggestMinLength:3,suggestTimeout:250,queryMinLength:3}).addTo(this.map)},update_visible:function(){return this.visible===this.$el.is(":visible")?this:(this.visible=this.$el.is(":visible"),this.visible?(this.map.invalidateSize(),this.bind_events(),this):(this.unbind_events(),this))},init_acf:function(){var e=this,i=function(){e.update_visible()};acf.addAction("show",i),acf.addAction("hide",i),t(document).on("postbox-toggled",i),this.map.on("zoomend",function(t){e.map_zoomed.apply(e,[t])}),this.map.on("moveend",function(t){e.map_moved.apply(e,[t])}),this.map.on("baselayerchange overlayadd overlayremove layeradd layerremove",function(t){var i=[];e.map.eachLayer(function(t){i.push(t.providerKey)}),e.$layerStore().val(JSON.stringify(i))})},unbind_events:function(){var t=this;t.$lat().off("blur"),t.$lng().off("blur"),t.$zoom().off("blur"),t.$zoom().off("keyup focus")},bind_events:function(){var t=this;t.$lat().on("blur",function(e){t.update_map()}),t.$lng().on("blur",function(e){t.update_map()}),t.$zoom().on("blur",function(e){t.update_map()})},update_map:function(){if(this.$lat().val()&&this.$lng().val()){var t=L.latLng(this.$lat().val(),this.$lng().val());this.map.setView(t,this.$zoom().val())}},map_moved:function(t){var e=this.map.getCenter();this.$lat().val(e.lat),this.$lng().val(e.lng)},map_zoomed:function(t){this.$zoom().val(this.map.getZoom())},search:function(t){var e=this,i={};return void 0!==this._wait_address&&(clearTimeout(this._wait_address),delete this._wait_address),this.clear_results(),"keyup"==t.type&&27==t.originalEvent.keyCode?(t.preventDefault(),this.$results().html(""),this.$address().blur(),!1):""===this.$address().val()?void(this.marker.title=""):void(this._wait_address=setTimeout(function(){i={q:e.$address().val(),limit:5,lon:e.$lng().val(),lat:e.$lat().val()},e.ajax_get("https://photon.komoot.de/api/",i,function(t){e.build_results(t),delete this._wait_address})},666))},select_result:function(t){var e=L.latLng(t.coord[1],t.coord[0]);t.ext?this.map.fitBounds(L.latLngBounds(L.latLng(t.ext[1],t.ext[0]),L.latLng(t.ext[3],t.ext[2]))):this.map.setView(e,this.map.getZoom()),this.$address().val(t.text),this.clear_results(),this.marker.title=t.text,this.set_marker(e)},build_results:function(e){var i=this,n=e.features.length,a=this.$address().val(),s=e.features;this.clear_results(),n&&t.each(s,function(e,n){var s=i.format_result(n),r=s.replace(new RegExp("("+a.split(/[^a-z0-9]/).join("|")+")","gi"),"<strong>$1</strong>");r+="<br /><small>("+i.nice_words(n.properties.osm_value)+")</small>",t('<div tabindex="'+e+'" class="osm-result"></div>').html(r).appendTo(i.$results()).on("click",function(t){i.select_result({text:s,bounds:n.properties.extent,coord:n.geometry.coordinates})})})},clear_results:function(){this.$results().html("")},format_result:function(t){return this.get_result_words(t).join(", ")},get_result_words:function(e){var i=[],n=["name","street","housenumber","city","postcode","state","country"];return t.each(n,function(t,n){try{e.properties[n]&&i.push(e.properties[n])}catch(t){}}),Array.from(new Set(i))},nice_words:function(t){return t.split(/[\s_]/).map(function(t){return t[0].toUpperCase()+t.substring(1)}).join(" ")},ajax_get:function(e,i,n){var a=this;t.ajax({url:e,method:"get",data:i,success:function(t){"function"==typeof n&&n.apply(a,[t])}})}}),t(document).on("render-map",function(t,e){new n.field({el:t.target,map:e})})}(jQuery,acf_osm_admin);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1pbnB1dC1vc20uanMiXSwibmFtZXMiOlsiJCIsImFyZyIsIm9wdGlvbnMiLCJvc20iLCJmaWVsZCIsIkJhY2tib25lIiwiVmlldyIsImV4dGVuZCIsIm1hcCIsImdlb2NvZGVyIiwidmlzaWJsZSIsImV2ZW50cyIsIiRwYXJlbnQiLCJ0aGlzIiwiJGVsIiwiY2xvc2VzdCIsIiR6b29tIiwiZmluZCIsIiRsYXQiLCIkbG5nIiwiJGxheWVyU3RvcmUiLCIkYWRkcmVzcyIsIiRtbGF0IiwiJG1sbmciLCIkcmVzdWx0cyIsImluaXRpYWxpemUiLCJjb25mIiwidXBkYXRlX21hcCIsImluaXRfbGF5ZXJzIiwibGVuZ3RoIiwiaW5pdF9tYXJrZXIiLCJpbml0X2dlb2NvZGUiLCJpbml0X2FjZiIsInVwZGF0ZV92aXNpYmxlIiwic2VsZiIsIm1sYXQiLCJ2YWwiLCJtbG5nIiwiaWNvbiIsIkwiLCJkaXZJY29uIiwiY2xhc3NOYW1lIiwiaHRtbCIsImljb25TaXplIiwibWFya2VyIiwiZHJhZ2dhYmxlIiwidGl0bGUiLCJhZGRUbyIsIm9uIiwiZSIsIm1hcF9jbGlja2VkIiwiYXBwbHkiLCJsYXRsbmciLCJzZXRfbWFya2VyIiwiY29vcmQiLCJfaWNvbiIsImF0dHIiLCJzZXRMYXRMbmciLCJsYXQiLCJsbmciLCJzZWxlY3RlZExheWVycyIsImJhc2VMYXllcnMiLCJvdmVybGF5cyIsImlzX292ZXJsYXkiLCJrZXkiLCJsYXllciIsInBhdHRlcm5zIiwib3BhY2l0eSIsIm1hdGNoIiwiam9pbiIsImlzX29taXR0ZWQiLCJzZXR1cE1hcCIsImxheWVyX2NvbmZpZyIsIl8iLCJpc09iamVjdCIsImVhY2giLCJzcGxpdCIsInRpbGVMYXllciIsInByb3ZpZGVyIiwicHJvdmlkZXJLZXkiLCJpbmRleE9mIiwiYWRkTGF5ZXIiLCJkYXRhIiwibWFwTGF5ZXJzIiwiZWFjaExheWVyIiwicmVtb3ZlTGF5ZXIiLCJwcm92aWRlcnMiLCJsYXllcnNDb250cm9sIiwiY29udHJvbCIsImxheWVycyIsImNvbGxhcHNlZCIsImhpZGVTaW5nbGVCYXNlIiwiQ29udHJvbCIsInBvc2l0aW9uIiwicGxhY2Vob2xkZXIiLCJlcnJvck1lc3NhZ2UiLCJzaG93UmVzdWx0SWNvbnMiLCJzdWdnZXN0TWluTGVuZ3RoIiwic3VnZ2VzdFRpbWVvdXQiLCJxdWVyeU1pbkxlbmd0aCIsImlzIiwiaW52YWxpZGF0ZVNpemUiLCJiaW5kX2V2ZW50cyIsInVuYmluZF9ldmVudHMiLCJ0b2dnbGVfY2IiLCJhY2YiLCJhZGRBY3Rpb24iLCJkb2N1bWVudCIsIm1hcF96b29tZWQiLCJtYXBfbW92ZWQiLCJwdXNoIiwiSlNPTiIsInN0cmluZ2lmeSIsIm9mZiIsImxhdExuZyIsInNldFZpZXciLCJjZW50ZXIiLCJnZXRDZW50ZXIiLCJnZXRab29tIiwic2VhcmNoIiwiX3dhaXRfYWRkcmVzcyIsImNsZWFyVGltZW91dCIsImNsZWFyX3Jlc3VsdHMiLCJ0eXBlIiwib3JpZ2luYWxFdmVudCIsImtleUNvZGUiLCJwcmV2ZW50RGVmYXVsdCIsImJsdXIiLCJzZXRUaW1lb3V0IiwicSIsImxpbWl0IiwibG9uIiwiYWpheF9nZXQiLCJyZXNwb25zZSIsImJ1aWxkX3Jlc3VsdHMiLCJzZWxlY3RfcmVzdWx0IiwiZXh0IiwiZml0Qm91bmRzIiwibGF0TG5nQm91bmRzIiwidGV4dCIsImxlbiIsImZlYXR1cmVzIiwiZmVhdCIsImkiLCJlbCIsImZtdCIsImZvcm1hdF9yZXN1bHQiLCJyZXBsYWNlIiwiUmVnRXhwIiwibmljZV93b3JkcyIsInByb3BlcnRpZXMiLCJvc21fdmFsdWUiLCJhcHBlbmRUbyIsImJvdW5kcyIsImV4dGVudCIsImdlb21ldHJ5IiwiY29vcmRpbmF0ZXMiLCJoaXQiLCJnZXRfcmVzdWx0X3dvcmRzIiwiaCIsInByb3BzIiwicHJvcCIsImVyciIsIkFycmF5IiwiZnJvbSIsIlNldCIsInN0ciIsInMiLCJ0b1VwcGVyQ2FzZSIsInN1YnN0cmluZyIsInVybCIsImNhbGxiYWNrIiwiYWpheCIs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QUFBLEVBQ0FHLE9BQUEsTUFDQTNGLEtBQUFBLEVBQ0E0RixRQUFBLFNBQUF6QyxHQUNBLGtCQUFBc0MsSUFBQUEsRUFBQXhILE1BQUFqQixHQUFBbUcsVUFxQkFySSxFQUFBMkcsVUFBQTNELEdBQUEsYUFBQSxTQUFBQyxFQUFBekMsR0FDQSxHQUFBTCxHQUFBQyxPQUFBNEksR0FBQS9GLEVBQUE4SCxPQUFBdkssSUFBQUEsT0FnQkF3SyxPQUFBQyIsImZpbGUiOiJhY2YtaW5wdXQtb3NtLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiggJCwgYXJnICl7XG5cdHZhciBvcHRpb25zID0gYXJnLm9wdGlvbnMsXG5cdFx0cmVzdWx0X3RwbCA9ICc8ZGl2IHRhYmluZGV4PVwiPCU9IGRhdGEuaSAlPlwiIGNsYXNzPVwib3NtLXJlc3VsdFwiPidcblx0XHRcdCsgJzwlPSBkYXRhLnJlc3VsdF90ZXh0ICU+J1xuXHRcdFx0KyAnPGJyIC8+PHNtYWxsPjwlPSBkYXRhLnByb3BlcnRpZXMub3NtX3ZhbHVlICU+PC9zbWFsbD4nXG5cdFx0XHQrICc8L2Rpdj4nO1xuXG5cdHZhciBvc20gPSB7XG5cdH07XG5cblx0b3NtLmZpZWxkID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXHRcdC8qXG5cdFx0dG9kbzpcblx0XHQtIE1hcCBMYXllciBzZWxlY3RvclxuXHRcdC0gc2V0IC8gdW5zZXQgbWFya2VyXG5cdFx0Ki9cblx0XHRtYXA6IG51bGwsXG5cdFx0Z2VvY29kZXI6IG51bGwsXG5cdFx0dmlzaWJsZTogbnVsbCxcblx0XHRldmVudHM6e1xuXHRcdH0sXG5cblx0XHQkcGFyZW50OmZ1bmN0aW9uKCl7XG5cdFx0XHRyZXR1cm4gdGhpcy4kZWwuY2xvc2VzdCgnLmFjZi1maWVsZC1zZXR0aW5ncywuYWNmLWZpZWxkLW9wZW4tc3RyZWV0LW1hcCcpXG5cdFx0fSxcblx0XHQkem9vbSA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJ2lucHV0W2lkJD1cIi16b29tXCJdJyk7XG5cdFx0fSxcblx0XHQkbGF0IDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnaW5wdXRbaWQkPVwiLWNlbnRlcl9sYXRcIl0nKTtcblx0XHR9LFxuXHRcdCRsbmcgOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCdpbnB1dFtpZCQ9XCItY2VudGVyX2xuZ1wiXScpO1xuXHRcdH0sXG5cdFx0JGxheWVyU3RvcmU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJ2lucHV0W2lkJD1cIi1sZWFmbGV0X2xheWVyc1wiXScpO1xuXHRcdH0sXG5cdFx0JGFkZHJlc3M6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJ2lucHV0W2lkJD1cIi1hZGRyZXNzXCJdJyk7XG5cdFx0fSxcblx0XHQkbWxhdCA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJ2lucHV0W2lkJD1cIi1tYXJrZXJfbGF0XCJdJyk7XG5cdFx0fSxcblx0XHQkbWxuZyA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJ2lucHV0W2lkJD1cIi1tYXJrZXJfbG5nXCJdJyk7XG5cdFx0fSxcblx0XHQkcmVzdWx0cyA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJy5vc20tcmVzdWx0cycpO1xuXHRcdH0sXG5cdFx0aW5pdGlhbGl6ZTpmdW5jdGlvbihjb25mKSB7XG5cdFx0Ly9cdHRoaXMuJGVsXHRcdD0gdGhpcy5hdHRyaWJ1dGVzLiRlbDtcblxuXHRcdFx0dGhpcy5tYXBcdFx0PSBjb25mLm1hcDtcblxuXHRcdFx0Ly8gdGhpcy4kbWxhdFx0XHQ9IHRoaXMuJHBhcmVudC5maW5kKCdbZGF0YS1wcm9wPVwibWFya2VyX2xhdFwiXScpO1xuXHRcdFx0Ly8gdGhpcy4kbWxuZ1x0XHQ9IHRoaXMuJHBhcmVudC5maW5kKCdbZGF0YS1wcm9wPVwibWFya2VyX2xuZ1wiXScpO1xuXHRcdFx0Ly8gdGhpcy4kYWRkcmVzc1x0PSB0aGlzLiRwYXJlbnQuZmluZCgnW2RhdGEtcHJvcD1cImFkZHJlc3NcIl0nKTtcblx0XHRcdC8vIHRoaXMuJHJlc3VsdHNcdD0gdGhpcy4kYWRkcmVzcy5uZXh0KCcub3NtLXJlc3VsdHMnKTtcblxuXHRcdFx0Ly90aGlzLiRsYXllcnNcdD0gdGhpcy4kcGFyZW50LmZpbmQoJ2lucHV0W2lkJD1cIi1sZWFmbGV0X2xheWVyc1wiXScpO1xuXG5cblx0XHRcdHRoaXMudXBkYXRlX21hcCgpOyAvLyBzZXQgbWFwIHRvIGlucHV0IHZhbHVlc1xuXG5cdFx0XHR0aGlzLmluaXRfbGF5ZXJzKCk7XG5cblx0XHRcdGlmICggdGhpcy4kbWxhdCgpLmxlbmd0aCAmJiB0aGlzLiRtbG5nKCkubGVuZ3RoICkge1xuXHRcdFx0XHR0aGlzLmluaXRfbWFya2VyKCk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuaW5pdF9nZW9jb2RlKCk7XG5cblx0XHRcdHRoaXMuaW5pdF9hY2YoKTtcblxuXHRcdFx0dGhpcy51cGRhdGVfdmlzaWJsZSgpO1xuXHRcdH0sXG5cdFx0aW5pdF9tYXJrZXI6ZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdG1sYXQgPSB0aGlzLiRtbGF0KCkudmFsKCkgfHwgdGhpcy4kbGF0KCkudmFsKCksXG5cdFx0XHRcdG1sbmcgPSB0aGlzLiRtbG5nKCkudmFsKCkgfHwgdGhpcy4kbG5nKCkudmFsKCk7XG5cdFx0XHQvKlxuXHRcdFx0RXZlbnRzOlxuXHRcdFx0Y2xpY2sgIG1hcDogcmV2ZXJzZSBnZW9jb2RlIGFuIHNldCByZXN1bHRcblx0XHRcdGNoYW5nZSBxdWVyeTogZ2VvY29kZSBxdWVyeSwgYWRkL3NldCBtYXJrZXJcblx0XHRcdCovXG5cdFx0XHR0aGlzLmljb25cdFx0PSBMLmRpdkljb24oIHsgY2xhc3NOYW1lOiAnb3NtLW1hcmtlcicsIGh0bWw6JycsIGljb25TaXplOjAgfSApO1xuXHRcdFx0dGhpcy5tYXJrZXJcdFx0PSBMLm1hcmtlcihcblx0XHRcdFx0WyBtbGF0LCBtbG5nIF0sXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRpY29uOnRoaXMuaWNvbixcblx0XHRcdFx0XHRkcmFnZ2FibGU6dHJ1ZSxcblx0XHRcdFx0XHR0aXRsZTogdGhpcy4kYWRkcmVzcygpLnZhbCgpIHx8ICcnLFxuXHRcdFx0XHR9XG5cdFx0XHQpLmFkZFRvKCB0aGlzLm1hcCApO1xuXG5cdFx0XHR0aGlzLm1hcC5vbignY2xpY2snLCBmdW5jdGlvbihlKXsgc2VsZi5tYXBfY2xpY2tlZC5hcHBseShzZWxmLFtlXSk7IH0gKTtcblxuXHRcdH0sXG5cdFx0bWFwX2NsaWNrZWQ6ZnVuY3Rpb24oZSkge1xuXHRcdFx0dmFyIGNvb3JkID0gZS5sYXRsbmc7XG5cdFx0XHR0aGlzLnNldF9tYXJrZXIoIGUubGF0bG5nICk7XG5cblx0XHR9LFxuXHRcdHNldF9tYXJrZXI6ZnVuY3Rpb24oY29vcmQpe1xuXHRcdFx0JCh0aGlzLm1hcmtlci5faWNvbikuYXR0ciggJ3RpdGxlJywgdGhpcy5tYXJrZXIudGl0bGUgKTtcblx0XHRcdHRoaXMubWFya2VyLnNldExhdExuZyhjb29yZCk7XG5cdFx0XHR0aGlzLiRtbGF0KCkudmFsKCBjb29yZC5sYXQgKTtcblx0XHRcdHRoaXMuJG1sbmcoKS52YWwoIGNvb3JkLmxuZyApO1xuLy9cdFx0XHR0aGlzLm1hcmtlci5iaW5kVG9vbHRpcCh0aGlzLiRhZGRyZXNzKCkudmFsKCkpO1xuXHRcdH0sXG5cdFx0aW5pdF9sYXllcnM6ZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdHNlbGVjdGVkTGF5ZXJzLFxuXHRcdFx0XHRiYXNlTGF5ZXJzID0ge30sXG5cdFx0XHRcdG92ZXJsYXlzID0ge30sXG5cdFx0XHRcdGlzX292ZXJsYXkgPSBmdW5jdGlvbigga2V5LCBsYXllciApIHtcblxuXHRcdFx0XHRcdHZhciBwYXR0ZXJucztcblxuXHRcdFx0XHRcdGlmICggbGF5ZXIub3B0aW9ucy5vcGFjaXR5ICYmIGxheWVyLm9wdGlvbnMub3BhY2l0eSA8IDEgKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cGF0dGVybnMgPSBbJ14oT3BlbldlYXRoZXJNYXB8T3BlblNlYU1hcCknLFxuXHRcdFx0XHRcdFx0J09wZW5NYXBTdXJmZXIuQWRtaW5Cb3VuZHMnLFxuXHRcdFx0XHRcdFx0J1N0YW1lbi5Ub25lcihIeWJyaWR8TGluZXN8TGFiZWxzKScsXG5cdFx0XHRcdFx0XHQnQWNldGF0ZS4oZm9yZWdyb3VuZHxsYWJlbHN8cm9hZHMpJyxcblx0XHRcdFx0XHRcdCdIaWxsU2hhZGluZycsXG5cdFx0XHRcdFx0XHQnSHlkZGEuUm9hZHNBbmRMYWJlbHMnLFxuXHRcdFx0XHRcdFx0J15KdXN0aWNlTWFwJyxcblx0XHRcdFx0XHRcdCdPcGVuSW5mcmFNYXAuKFBvd2VyfFRlbGVjb218UGV0cm9sZXVtfFdhdGVyKScsXG5cdFx0XHRcdFx0XHQnT3BlblB0TWFwJyxcblx0XHRcdFx0XHRcdCdPcGVuUmFpbHdheU1hcCcsXG5cdFx0XHRcdFx0XHQnT3BlbkZpcmVNYXAnLFxuXHRcdFx0XHRcdFx0J1NhZmVDYXN0Jyxcblx0XHRcdFx0XHRcdCdDYXJ0b0RCLkRhcmtNYXR0ZXJPbmx5TGFiZWxzJyxcblx0XHRcdFx0XHRcdCdDYXJ0b0RCLlBvc2l0cm9uT25seUxhYmVscydcblx0XHRcdFx0XHRdO1xuXHRcdFx0XHRcdHJldHVybiBrZXkubWF0Y2goJygnICsgcGF0dGVybnMuam9pbignfCcpICsgJyknKSAhPT0gbnVsbDtcblx0XHRcdFx0fSxcblx0XHRcdFx0aXNfb21pdHRlZCA9IGZ1bmN0aW9uKGtleSkge1xuXG5cdFx0XHRcdFx0cmV0dXJuIGtleSA9PT0gbnVsbDtcblx0XHRcdFx0fSxcblx0XHRcdFx0c2V0dXBNYXAgPSBmdW5jdGlvbigga2V5LCB2YWwgKXtcblx0XHRcdFx0XHR2YXIgbGF5ZXIsIGxheWVyX2NvbmZpZztcblx0XHRcdFx0XHRpZiAoIF8uaXNPYmplY3QodmFsKSApIHtcblx0XHRcdFx0XHRcdHJldHVybiAkLmVhY2goIHZhbCwgc2V0dXBNYXAgKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIGlzX29taXR0ZWQoa2V5KSApIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRsYXllcl9jb25maWcgPSBvcHRpb25zLmxheWVyX2NvbmZpZ1sga2V5LnNwbGl0KCcuJylbMF0gXSB8fCB7b3B0aW9uczp7fX07XG5cdFx0XHRcdFx0bGF5ZXIgPSBMLnRpbGVMYXllci5wcm92aWRlcigga2V5LCBsYXllcl9jb25maWcub3B0aW9ucyApO1xuXHRcdFx0XHRcdGxheWVyLnByb3ZpZGVyS2V5ID0ga2V5O1xuXG5cdFx0XHRcdFx0aWYgKCBpc19vdmVybGF5KCBrZXksIGxheWVyICkgKSB7XG5cdFx0XHRcdFx0XHRvdmVybGF5c1trZXldID0gbGF5ZXI7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGJhc2VMYXllcnNba2V5XSA9IGxheWVyO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAoIHNlbGVjdGVkTGF5ZXJzLmluZGV4T2YoIGtleSApICE9PSAtMSApe1xuXHRcdFx0XHRcdFx0c2VsZi5tYXAuYWRkTGF5ZXIobGF5ZXIpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fTtcblxuXHRcdFx0c2VsZWN0ZWRMYXllcnMgPSB0aGlzLiRlbC5kYXRhKCkubWFwTGF5ZXJzO1xuXG5cdFx0XHQvLyBraWxsIGFsbCB0aGUgb2xkIGxheWVycy4uLlxuXHRcdFx0dGhpcy5tYXAuZWFjaExheWVyKGZ1bmN0aW9uKGxheWVyKXtcblx0XHRcdFx0c2VsZi5tYXAucmVtb3ZlTGF5ZXIobGF5ZXIpO1xuXHRcdFx0fSlcblx0XHRcdC8vIC4uLiBhbmQgYWRkIG5ldyBvbmVzXG5cdFx0XHQkLmVhY2goIG9wdGlvbnMucHJvdmlkZXJzLCBzZXR1cE1hcCApO1xuXG5cdFx0XHQvLyAuLi4gbm8gbGF5ZXIgZWRpdGluZyBhbGxvd2VkXG5cdFx0XHRpZiAoICEgdGhpcy4kbGF5ZXJTdG9yZSgpLmxlbmd0aCApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmxheWVyc0NvbnRyb2wgPSBMLmNvbnRyb2wubGF5ZXJzKCBiYXNlTGF5ZXJzLCBvdmVybGF5cywge1xuXHRcdFx0XHRjb2xsYXBzZWQ6IHRydWUsXG5cdFx0XHRcdGhpZGVTaW5nbGVCYXNlOiB0cnVlLFxuXHRcdFx0fSkuYWRkVG8odGhpcy5tYXApO1xuXG5cdFx0fSxcblx0XHRpbml0X2dlb2NvZGU6ZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLmdlb2NvZGVyID0gTC5Db250cm9sLmdlb2NvZGVyKHtcblx0XHRcdFx0Y29sbGFwc2VkOiBmYWxzZSxcblx0XHRcdFx0cG9zaXRpb246J3RvcGxlZnQnLFxuXHRcdFx0XHRwbGFjZWhvbGRlcjonU2VhcmNoLi4uJyxcblx0XHRcdFx0ZXJyb3JNZXNzYWdlOidOb3RoaW5nIGZvdW5kLi4uJyxcblx0XHRcdFx0c2hvd1Jlc3VsdEljb25zOnRydWUsXG5cdFx0XHRcdHN1Z2dlc3RNaW5MZW5ndGg6Myxcblx0XHRcdFx0c3VnZ2VzdFRpbWVvdXQ6MjUwLFxuXHRcdFx0XHRxdWVyeU1pbkxlbmd0aDozLFxuXHRcdFx0fSkuYWRkVG8odGhpcy5tYXApO1xuXHRcdH0sXG5cdFx0dXBkYXRlX3Zpc2libGU6IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRpZiAoIHRoaXMudmlzaWJsZSA9PT0gdGhpcy4kZWwuaXMoJzp2aXNpYmxlJykgKSB7XG5cdFx0XHRcdHJldHVybiB0aGlzO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnZpc2libGUgPSB0aGlzLiRlbC5pcygnOnZpc2libGUnKTtcblxuXHRcdFx0aWYgKCB0aGlzLnZpc2libGUgKSB7XG5cdFx0XHRcdHRoaXMubWFwLmludmFsaWRhdGVTaXplKCk7XG5cdFx0XHRcdHRoaXMuYmluZF9ldmVudHMoKTtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLnVuYmluZF9ldmVudHMoKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0aW5pdF9hY2Y6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHR0b2dnbGVfY2IgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHQvLyBubyBjaGFuZ2Vcblx0XHRcdFx0XHRzZWxmLnVwZGF0ZV92aXNpYmxlKCk7XG5cdFx0XHRcdH07XG5cblx0XHRcdC8vIGV4cGFuZC9jb2xsYXBzZSBhY2Ygc2V0dGluZ1xuXHRcdFx0YWNmLmFkZEFjdGlvbiggJ3Nob3cnLCB0b2dnbGVfY2IgKTtcblx0XHRcdGFjZi5hZGRBY3Rpb24oICdoaWRlJywgdG9nZ2xlX2NiICk7XG5cblxuXG5cdFx0XHQvLyBleHBhbmQgYWNmIHJlcGVhdGVyXG5cdFx0XHQvLyAuLi5cblxuXHRcdFx0Ly8gZXhwYW5kIGFjZiBsYXlvdXRcblx0XHRcdC8vIC4uLlxuXG5cdFx0XHQvLyBleHBhbmQgd3AgbWV0YWJveFxuXHRcdFx0JChkb2N1bWVudCkub24oJ3Bvc3Rib3gtdG9nZ2xlZCcsdG9nZ2xlX2NiKVxuXG5cblx0XHRcdHRoaXMubWFwLm9uKCd6b29tZW5kJywgZnVuY3Rpb24oZSl7IHNlbGYubWFwX3pvb21lZC5hcHBseSggc2VsZiwgW2VdICk7IH0gKTtcblx0XHRcdHRoaXMubWFwLm9uKCdtb3ZlZW5kJywgZnVuY3Rpb24oZSl7IHNlbGYubWFwX21vdmVkLmFwcGx5KCBzZWxmLCBbZV0gKTsgfSApO1xuXG5cdFx0XHR0aGlzLm1hcC5vbiggJ2Jhc2VsYXllcmNoYW5nZSBvdmVybGF5YWRkIG92ZXJsYXlyZW1vdmUgbGF5ZXJhZGQgbGF5ZXJyZW1vdmUnLCBmdW5jdGlvbihlKXtcblx0XHRcdFx0dmFyIGxheWVycyA9IFtdO1xuXHRcdFx0XHRzZWxmLm1hcC5lYWNoTGF5ZXIoZnVuY3Rpb24obGF5ZXIpIHtcblx0XHRcdFx0XHRsYXllcnMucHVzaChsYXllci5wcm92aWRlcktleSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRzZWxmLiRsYXllclN0b3JlKCkudmFsKCBKU09OLnN0cmluZ2lmeSggbGF5ZXJzICkgKTtcblx0XHRcdH0gKTtcblx0XHR9LFxuXHRcdHVuYmluZF9ldmVudHM6ZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cdFx0XHRzZWxmLiRsYXQoKS5vZmYoJ2JsdXInKTtcblx0XHRcdHNlbGYuJGxuZygpLm9mZignYmx1cicpO1xuXHRcdFx0c2VsZi4kem9vbSgpLm9mZignYmx1cicpO1xuXHRcdFx0c2VsZi4kem9vbSgpLm9mZigna2V5dXAgZm9jdXMnKTtcblxuXHRcdH0sXG5cdFx0YmluZF9ldmVudHM6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLiRsYXQoKS5vbignYmx1cicsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHNlbGYudXBkYXRlX21hcCgpO1xuXHRcdFx0fSk7XG5cdFx0XHRzZWxmLiRsbmcoKS5vbignYmx1cicsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHNlbGYudXBkYXRlX21hcCgpO1xuXHRcdFx0fSk7XG5cdFx0XHRzZWxmLiR6b29tKCkub24oJ2JsdXInLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRzZWxmLnVwZGF0ZV9tYXAoKTtcblx0XHRcdH0pO1xuXHRcdFx0Ly8gc2VsZi4kYWRkcmVzcygpLm9uKCdrZXl1cCBmb2N1cycsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0Ly8gXHRzZWxmLnNlYXJjaChlKTtcblx0XHRcdC8vIH0gKTtcblxuXG4vL1x0XHRcdHRoaXMubGlzdGVuVG8oIHRoaXMuJGFkZHJlc3MsICdrZXl1cCBmb2N1cycsIHRoaXMuc2VhcmNoICk7XG5cblx0XHRcdC8vIHRoaXMuJHRpbGVzLm9uKCdjaGFuZ2UnLCBkb19sYXllcnMgKVxuXHRcdFx0Ly8gXHQucHJldignaW5wdXQnKS5vbignY2hhbmdlJywgZG9fbGF5ZXJzICk7XG5cblx0XHR9LFxuXHRcdHVwZGF0ZV9tYXA6ZnVuY3Rpb24oKSB7XG5cdFx0XHRpZiAoICEgdGhpcy4kbGF0KCkudmFsKCkgfHwgISB0aGlzLiRsbmcoKS52YWwoKSApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0dmFyIGxhdGxuZyA9IEwubGF0TG5nKCB0aGlzLiRsYXQoKS52YWwoKSwgdGhpcy4kbG5nKCkudmFsKCkgKTtcblx0XHRcdHRoaXMubWFwLnNldFZpZXcoIGxhdGxuZywgIHRoaXMuJHpvb20oKS52YWwoKSApO1xuXHRcdH0sXG5cdFx0bWFwX21vdmVkOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dmFyIGNlbnRlciA9IHRoaXMubWFwLmdldENlbnRlcigpO1xuXHRcdFx0dGhpcy4kbGF0KCkudmFsKGNlbnRlci5sYXQpO1xuXHRcdFx0dGhpcy4kbG5nKCkudmFsKGNlbnRlci5sbmcpO1xuXHRcdH0sXG5cdFx0bWFwX3pvb21lZDpmdW5jdGlvbihlKXtcblx0XHRcdHRoaXMuJHpvb20oKS52YWwoIHRoaXMubWFwLmdldFpvb20oKSApO1xuXHRcdH0sXG5cblx0XHRzZWFyY2g6ZnVuY3Rpb24oZSl7XG5cdFx0XHQvLyBnZW9jb2RlXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdGRhdGEgPSB7fTtcblx0XHRcdGlmICggJ3VuZGVmaW5lZCcgIT09IHR5cGVvZiB0aGlzLl93YWl0X2FkZHJlc3MgKSB7XG5cdFx0XHRcdGNsZWFyVGltZW91dCh0aGlzLl93YWl0X2FkZHJlc3MpO1xuXHRcdFx0XHRkZWxldGUgdGhpcy5fd2FpdF9hZGRyZXNzO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBpZiAoISEgZGF0YVsnZyddICYmIGRhdGFbJ2cnXSA9PT0gdGhpcy4kYWRkcmVzcygpLnZhbCgpICkge1xuXHRcdFx0Ly8gXHRyZXR1cm47XG5cdFx0XHQvLyB9XG5cblx0XHRcdHRoaXMuY2xlYXJfcmVzdWx0cygpO1xuXG5cdFx0XHRpZiAoIGUudHlwZT09J2tleXVwJyAmJiAyNyA9PSBlLm9yaWdpbmFsRXZlbnQua2V5Q29kZSApIHsgLy8gZXNjXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0dGhpcy4kcmVzdWx0cygpLmh0bWwoJycpO1xuXHRcdFx0XHR0aGlzLiRhZGRyZXNzKCkuYmx1cigpO1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0XHRpZiAoICcnID09PSB0aGlzLiRhZGRyZXNzKCkudmFsKCkgKSB7XG5cdFx0XHRcdHRoaXMubWFya2VyLnRpdGxlID0gJyc7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5fd2FpdF9hZGRyZXNzID0gc2V0VGltZW91dCggZnVuY3Rpb24oKXtcblxuXHRcdFx0XHRkYXRhID0ge1xuXHRcdFx0XHRcdHE6c2VsZi4kYWRkcmVzcygpLnZhbCgpLFxuLy9cdFx0XHRcdFx0XHRsYW5nOidkZScsIC3CtC8vIC0+IFdQLUxhbmchXG5cdFx0XHRcdFx0bGltaXQ6NSxcblx0XHRcdFx0XHRsb246c2VsZi4kbG5nKCkudmFsKCksXG5cdFx0XHRcdFx0bGF0OnNlbGYuJGxhdCgpLnZhbCgpLFxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdHNlbGYuYWpheF9nZXQoJ2h0dHBzOi8vcGhvdG9uLmtvbW9vdC5kZS9hcGkvJyxkYXRhLCBmdW5jdGlvbihyZXNwb25zZSl7XG5cdFx0XHRcdFx0c2VsZi5idWlsZF9yZXN1bHRzKHJlc3BvbnNlKTtcblx0XHRcdFx0XHRkZWxldGUgdGhpcy5fd2FpdF9hZGRyZXNzO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0sIDY2NiApO1xuXG5cdFx0fSxcblxuXHRcdHNlbGVjdF9yZXN1bHQ6ZnVuY3Rpb24oZGF0YSl7XG5cdFx0XHR2YXIgbGF0bG5nID0gTC5sYXRMbmcoIGRhdGEuY29vcmRbMV0sIGRhdGEuY29vcmRbMF0gKTtcblxuXHRcdFx0aWYgKCBkYXRhLmV4dCApIHtcblxuXHRcdFx0XHR0aGlzLm1hcC5maXRCb3VuZHMoIEwubGF0TG5nQm91bmRzKFxuXHRcdFx0XHRcdEwubGF0TG5nKCBkYXRhLmV4dFsxXSwgZGF0YS5leHRbMF0gKSxcblx0XHRcdFx0XHRMLmxhdExuZyggZGF0YS5leHRbM10sIGRhdGEuZXh0WzJdIClcblx0XHRcdFx0KSApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5tYXAuc2V0VmlldyggbGF0bG5nLCB0aGlzLm1hcC5nZXRab29tKCkgKTtcblx0XHRcdH1cblx0XHRcdHRoaXMuJGFkZHJlc3MoKS52YWwoIGRhdGEudGV4dCApO1xuXHRcdFx0dGhpcy5jbGVhcl9yZXN1bHRzKCk7XG5cblx0XHRcdHRoaXMubWFya2VyLnRpdGxlID0gZGF0YS50ZXh0O1xuXHRcdFx0dGhpcy5zZXRfbWFya2VyKCBsYXRsbmcgKTtcblx0XHR9LFxuXHRcdGJ1aWxkX3Jlc3VsdHM6ZnVuY3Rpb24ocmVzcG9uc2Upe1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRpPTAsIGxlbiA9IHJlc3BvbnNlLmZlYXR1cmVzLmxlbmd0aCxcblx0XHRcdFx0cSA9IHRoaXMuJGFkZHJlc3MoKS52YWwoKSxcblx0XHRcdFx0ZmVhdCA9IHJlc3BvbnNlLmZlYXR1cmVzOy8vc29ydF9mdXp6eSggcmVzcG9uc2UuZmVhdHVyZXMsIHEgKTtcblxuXHRcdFx0dGhpcy5jbGVhcl9yZXN1bHRzKCk7XG5cblx0XHRcdGlmICggbGVuICkge1xuXHRcdFx0XHQkLmVhY2goIGZlYXQsIGZ1bmN0aW9uKGksZWwpe1xuXHRcdFx0XHRcdHZhciBmbXQgPSBzZWxmLmZvcm1hdF9yZXN1bHQoIGVsICksXG5cdFx0XHRcdFx0XHRodG1sID0gZm10LnJlcGxhY2UoIG5ldyBSZWdFeHAoXCIoXCIrcS5zcGxpdCgvW15hLXowLTldLykuam9pbignfCcpK1wiKVwiLCdnaScpLFwiPHN0cm9uZz4kMTwvc3Ryb25nPlwiKTtcblx0XHRcdFx0XHRodG1sICs9ICc8YnIgLz48c21hbGw+KCcgKyBzZWxmLm5pY2Vfd29yZHMoIGVsLnByb3BlcnRpZXMub3NtX3ZhbHVlICkgKyAnKTwvc21hbGw+JztcblxuXHRcdFx0XHRcdCQoJzxkaXYgdGFiaW5kZXg9XCInK2krJ1wiIGNsYXNzPVwib3NtLXJlc3VsdFwiPjwvZGl2PicpXG5cdFx0XHRcdFx0XHQuaHRtbCggaHRtbCApLmFwcGVuZFRvKCBzZWxmLiRyZXN1bHRzKCkgKS5vbignY2xpY2snLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdFx0c2VsZi5zZWxlY3RfcmVzdWx0KHtcblx0XHRcdFx0XHRcdFx0dGV4dDpmbXQsXG5cdFx0XHRcdFx0XHRcdGJvdW5kczplbC5wcm9wZXJ0aWVzLmV4dGVudCxcblx0XHRcdFx0XHRcdFx0Y29vcmQ6ZWwuZ2VvbWV0cnkuY29vcmRpbmF0ZXMsXG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHR9LFxuXHRcdGNsZWFyX3Jlc3VsdHM6ZnVuY3Rpb24oKXtcblx0XHRcdHRoaXMuJHJlc3VsdHMoKS5odG1sKCcnKTtcblx0XHR9LFxuXG5cdFx0Zm9ybWF0X3Jlc3VsdDogZnVuY3Rpb24oIGhpdCApIHtcblx0XHRcdHJldHVybiB0aGlzLmdldF9yZXN1bHRfd29yZHMoIGhpdCApLmpvaW4oJywgJyk7XG5cdFx0fSxcblxuXHRcdGdldF9yZXN1bHRfd29yZHM6IGZ1bmN0aW9uKCBoaXQgKSB7XG5cblx0XHRcdHZhciBoID0gW10sXG5cdFx0XHRcdHByb3BzID0gWyAnbmFtZScsJ3N0cmVldCcsJ2hvdXNlbnVtYmVyJywnY2l0eScsJ3Bvc3Rjb2RlJywnc3RhdGUnLCdjb3VudHJ5JyBdO1xuXHRcdFx0JC5lYWNoKHByb3BzLCBmdW5jdGlvbihpLHByb3ApIHtcblx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRpZiAoICEhIGhpdC5wcm9wZXJ0aWVzW3Byb3BdICkge1xuXHRcdFx0XHRcdFx0aC5wdXNoKGhpdC5wcm9wZXJ0aWVzW3Byb3BdKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gY2F0Y2goZXJyKXt9XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiBBcnJheS5mcm9tKG5ldyBTZXQoaCkpO1xuXHRcdH0sXG5cdFx0bmljZV93b3JkczogZnVuY3Rpb24oc3RyKSB7XG5cdFx0XHRyZXR1cm4gc3RyLnNwbGl0KC9bXFxzX10vKS5tYXAoZnVuY3Rpb24ocyl7IHJldHVybiBzWzBdLnRvVXBwZXJDYXNlKCkgKyBzLnN1YnN0cmluZygxKTsgfSkuam9pbignICcpO1xuXHRcdH0sXG5cdFx0Ly8gbWFwX2NsaWNrZWQ6ZnVuY3Rpb24oZSl7XG5cdFx0Ly8gXHQvLyByZXZlcnNlIGdlb2NvZGVcblx0XHQvLyBcdHZhciBjb29yZCA9IGUubGF0bG5nO1xuXHRcdC8vXG5cdFx0Ly8gXHR0aGlzLmFqYXhfZ2V0KCdodHRwczovL3Bob3Rvbi5rb21vb3QuZGUvcmV2ZXJzZScsIHtcblx0XHQvLyBcdFx0bG9uOmNvb3JkLmxuZyxcblx0XHQvLyBcdFx0bGF0OmNvb3JkLmxhdCxcblx0XHQvLyBcdH0sIGZ1bmN0aW9uKHJlc3BvbnNlKXtcblx0XHQvLyBcdFx0dmFyIGk9MCxcblx0XHQvLyBcdFx0XHRsZW4gPSByZXNwb25zZS5mZWF0dXJlcy5sZW5ndGg7XG5cdFx0Ly8gXHRcdGNvbnNvbGUubG9nKHJlc3BvbnNlKVxuXHRcdC8vIFx0XHRmb3IgKGk7aTxsZW47aSsrKXtcblx0XHQvLyBcdFx0XHR2YXIgcmVzdWx0ID0gbmV3IG9zbS5mZWF0dXJlKCByZXNwb25zZS5mZWF0dXJlc1tpXSApO1xuXHRcdC8vIFx0XHRcdHRoaXMubWFya2VyLnRpdGxlID0gcmVzdWx0LmZvcm1hdCgpO1xuXHRcdC8vIFx0XHRcdHRoaXMuJGFkZHJlc3MoKS52YWwoIHJlc3VsdC5mb3JtYXQoKSApO1xuXHRcdC8vIFx0XHRcdHRoaXMuc2V0X21hcmtlciggY29vcmQgKTtcblx0XHQvLyBcdFx0XHRicmVhaztcblx0XHQvLyBcdFx0fVxuXHRcdC8vIFx0fSApO1xuXHRcdC8vXG5cdFx0Ly8gXHR0aGlzLnNldF9tYXJrZXIoIGUubGF0bG5nICk7XG5cdFx0Ly8gfSxcblx0XHQvLyBzZXRfbWFya2VyOmZ1bmN0aW9uKGNvb3JkKXtcblx0XHQvLyBcdCQodGhpcy5tYXJrZXIuX2ljb24pLmF0dHIoICd0aXRsZScsIHRoaXMubWFya2VyLnRpdGxlICk7XG5cdFx0Ly8gXHR0aGlzLm1hcmtlci5zZXRMYXRMbmcoY29vcmQpO1xuXHRcdC8vIFx0dGhpcy4kbWxhdCgpLnZhbCggY29vcmQubGF0ICk7XG5cdFx0Ly8gXHR0aGlzLiRtbG5nKCkudmFsKCBjb29yZC5sbmcgKTtcblx0XHQvLyB9LFxuXHRcdGFqYXhfZ2V0OiBmdW5jdGlvbiggdXJsLCBkYXRhLCBjYWxsYmFjaykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0JC5hamF4KHtcblx0XHRcdFx0dXJsOnVybCxcblx0XHRcdFx0bWV0aG9kOidnZXQnLFxuXHRcdFx0XHRkYXRhOmRhdGEsXG5cdFx0XHRcdHN1Y2Nlc3M6ZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0XHQnZnVuY3Rpb24nID09PSB0eXBlb2YgY2FsbGJhY2sgJiYgY2FsbGJhY2suYXBwbHkoc2VsZixbcmVzcG9uc2VdKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHR9LFxuXG5cdH0pO1xuXG5cdC8qXG5cdCAqICByZWFkeSBhcHBlbmQgKEFDRjUpXG5cdCAqXG5cdCAqICBUaGVzZSBhcmUgMiBldmVudHMgd2hpY2ggYXJlIGZpcmVkIGR1cmluZyB0aGUgcGFnZSBsb2FkXG5cdCAqICByZWFkeSA9IG9uIHBhZ2UgbG9hZCBzaW1pbGFyIHRvICQoZG9jdW1lbnQpLnJlYWR5KClcblx0ICogIGFwcGVuZCA9IG9uIG5ldyBET00gZWxlbWVudHMgYXBwZW5kZWQgdmlhIHJlcGVhdGVyIGZpZWxkXG5cdCAqXG5cdCAqICBAdHlwZVx0ZXZlbnRcblx0ICogIEBkYXRlXHQyMC8wNy8xM1xuXHQgKlxuXHQgKiAgQHBhcmFtXHQkZWwgKGpRdWVyeSBzZWxlY3Rpb24pIHRoZSBqUXVlcnkgZWxlbWVudCB3aGljaCBjb250YWlucyB0aGUgQUNGIGZpZWxkc1xuXHQgKiAgQHJldHVyblx0bi9hXG5cdCAqL1xuXHQkKGRvY3VtZW50KS5vbigncmVuZGVyLW1hcCcsZnVuY3Rpb24oIGUsIG1hcCApIHtcblx0XHRuZXcgb3NtLmZpZWxkKCB7IGVsOiBlLnRhcmdldCwgbWFwOiBtYXAgfSApO1xuXHR9KTtcblxuXG5cdC8vIGFjZi5hZGRfYWN0aW9uKCdyZWFkeSBhcHBlbmQnLCBmdW5jdGlvbiggJGVsICl7XG5cdC8vXG5cdC8vIFx0Ly8gc2VhcmNoICRlbCBmb3IgZmllbGRzIG9mIHR5cGUgJ0ZJRUxEX05BTUUnXG5cdC8vIFx0YWNmLmdldF9maWVsZHMoeyB0eXBlIDogJ29wZW5fc3RyZWV0X21hcCd9LCAkZWwpLmVhY2goZnVuY3Rpb24oKXtcblx0Ly9cblx0Ly8gXHRcdG5ldyBvc20uZmllbGQoIHsgZWw6IHRoaXMgfSApO1xuXHQvL1xuXHQvLyBcdH0pO1xuXHQvL1xuXHQvLyB9KTtcblxuXG59KSggalF1ZXJ5LCBhY2Zfb3NtX2FkbWluICk7XG4iXX0=
