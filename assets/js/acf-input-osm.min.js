!function(c,i){i.options;var n={};n.MarkerList=Backbone.View.extend({}),n.MarkerEntry=Backbone.View.extend({tagName:"div",className:"osm-marker",events:{'click [data-name="locate-marker"]':"locate_marker",'click [data-name="remove-marker"]':"remove_marker",'change [id$="-marker-label"]':"update_marker_label"},get_label:function(){return this.$el.find('[id$="-marker-label"]').val()},get_default_label:function(){return this.$el.find('[id$="-marker-geocode"]').val()},is_default_label:function(){return this.get_default_label()===this.get_label()},initialize:function(e){return this.template=e.template,this.marker=e.marker,this.marker.osm_controller=this},render:function(){var t=this;return this.$el.html(this.template(this)),this._update_values_from_marker(),this.$el.height(this.$el.data("height")),this.$el.find('[id$="-marker-label"]').on("focus",function(e){t.hilite_marker()}).on("blur",function(e){t.lolite_marker()}),c(this.marker._icon).on("focus",function(e){t.hilite_marker()}).on("blur",function(e){t.lolite_marker()}),this},update_marker_label:function(e){var t=this.get_label();return""===t&&(t=this.get_default_label()),c(e.target).val(t),this.set_marker_label(t)},set_marker_label:function(e){return this.marker.unbindTooltip(),this.marker.bindTooltip(e),this.marker.options.title=e,c(this.marker._icon).attr("title",e),this},update_marker_geocode:function(e){return this.is_default_label()&&this.set_marker_label(e),this.$el.find('[id$="-marker-geocode"]').val(e),this._update_values_from_marker(),this},_update_values_from_marker:function(){var e=this.marker.getLatLng();return this.$el.find('[id$="-marker-lat"]').val(e.lat),this.$el.find('[id$="-marker-lng"]').val(e.lng),this.$el.find('[id$="-marker-label"]').val(this.marker.options.title),this},hilite_marker:function(e){this.$el.addClass("focus"),c(this.marker._icon).addClass("focus")},lolite_marker:function(e){this.$el.removeClass("focus"),c(this.marker._icon).removeClass("focus")},locate_marker:function(){return this.marker._map.flyTo(this.marker.getLatLng()),this},remove_marker:function(e){return e.preventDefault(),this.marker.remove(),this}}),n.field=Backbone.View.extend({map:null,geocoder:null,visible:null,events:{},$parent:function(){return this.$el.closest(".acf-field-settings,.acf-field-open-street-map")},$zoom:function(){return this.$parent().find('input[id$="-zoom"]')},$lat:function(){return this.$parent().find('input[id$="-center_lat"]')},$lng:function(){return this.$parent().find('input[id$="-center_lng"]')},$layerStore:function(){return this.$parent().find(".acf-osm-layers")},$results:function(){return this.$parent().find(".osm-results")},$markers:function(){return this.$parent().find(".osm-markers")},initialize:function(e){return this.map=e.map,this.update_map(),this.init_acf(),this.init_layers(),this.init_markers(),this.update_visible(),this},_get_geocoder_result_label:function(e,t){var r=!1;return e.length?c.each(e,function(e,t){return r=t.html?t.html:t.name,!1}):r=t.lat.toString()+", "+t.lng.toString(),c("<p>"+r+"</p>").text().replace(/^(\s+)/g,"").replace(/(\s+)$/g,"").replace(/(\s+)/g," ")},init_markers:function(){var a=this,i=this.$el.data().editorConfig;this.init_geocode(),0!==i.max_markers&&(this.icon=new L.DivIcon({html:"",className:"osm-marker-icon"}),this.map.on("click",function(e){var r=e.latlng,t=a.$markers().children().not("[data-id]").length;!1!==i.max_markers&&t>=i.max_markers||a.geocoder.options.geocoder.reverse(e.latlng,a.map.getZoom(),function(e){var t=a._get_geocoder_result_label(e,r);a.add_marker(r,t)},a)}),this.map.on("layeradd",function(e){if(e.layer.constructor===L.Marker){var t=a.$markers().find('[data-id="__osm_marker_template__"]').html().split("__osm_marker_template__").join("<%= id %>"),r=new n.MarkerEntry({controller:this,marker:e.layer,id:acf.uniqid(),template:_.template(t)});r.render().$el.appendTo(a.$markers()),a.geocode_marker(r),e.layer.setIcon(a.icon).on("click",function(e){this.remove()}).on("remove",function(e){r.$el.remove(),a.$el.trigger("change")}).on("dragend",function(e){a.geocode_marker(r),a.$el.trigger("change")}).dragging.enable()}}),this.map.on("layerremove",function(e){e.layer.constructor===L.Marker&&a.$el.trigger("change")}),c.each(this.$el.data().mapMarkers,function(e,t){L.marker(L.latLng(1*t.lat,1*t.lng),{title:t.label}).bindTooltip(t.label).addTo(a.map)}))},geocode_marker:function(e){var r=this,a=e,i=a.marker.getLatLng();r.geocoder.options.geocoder.reverse(i,r.map.getZoom(),function(e){var t=r._get_geocoder_result_label(e,i);a.update_marker_geocode(t)},this)},add_marker:function(e,t){L.marker(e,{title:t,icon:this.icon}).bindTooltip(t).addTo(this.map),this.$el.trigger("change")},layer_is_overlay:function(e,t){var r;return!!(t.options.opacity&&t.options.opacity<1)||(r=["^(OpenWeatherMap|OpenSeaMap)","OpenMapSurfer.AdminBounds","Stamen.Toner(Hybrid|Lines|Labels)","Acetate.(foreground|labels|roads)","HillShading","Hydda.RoadsAndLabels","^JusticeMap","OpenInfraMap.(Power|Telecom|Petroleum|Water)","OpenPtMap","OpenRailwayMap","OpenFireMap","SafeCast","CartoDB.DarkMatterOnlyLabels","CartoDB.PositronOnlyLabels"],null!==e.match("("+r.join("|")+")"))},reset_layers:function(){this.map.eachLayer(function(e){e.constructor===L.TileLayer.Provider&&e.remove()}),this.$layerStore().remove(),this.layersControl&&this.layersControl.remove()},init_layers:function(){var a=this,i=[],n={},o={},s={},l=this.$el.data().editorConfig,d=function(e,t){var r;if(_.isObject(e))return c.each(e,d);if(!function(e){return null===e||!!l.restrict_providers&&-1===l.restrict_providers.indexOf(e)}(t)){if(s[t])r=s[t],a.map.addLayer(r);else{try{r=L.tileLayer.provider(t)}catch(e){return}r.providerKey=t}a.layer_is_overlay(t,r)?o[t]=r:n[t]=r,-1!==i.indexOf(t)&&a.map.addLayer(r)}};i=this.$el.data().mapLayers,!1!==l.restrict_providers&&_.isArray(l.restrict_providers)&&(i=i.filter(function(e){return-1!==l.restrict_providers.indexOf(e)})),i.length||(i=Object.keys(l.restrict_providers).slice(0,1)),l.allow_providers&&(c('<div class="acf-osm-layers"></div>').insertAfter(this.$el),this.map.on("baselayerchange layeradd layerremove",function(e){if(e.layer.providerKey){var r=a.$layerStore();a.$parent().find('[data-id="__osm_layer_template__"]');r.html(""),a.map.eachLayer(function(e){var t;e.providerKey&&((t=c('<input type="hidden" name="'+l.name_prefix+'[layers][]" />')).val(e.providerKey),a.layer_is_overlay(e.providerKey,e)?r.append(t):r.prepend(t))}),a.$el.trigger("change")}})),c.each(l.restrict_providers,d),this.$layerStore().length&&(this.layersControl=L.control.layers(n,o,{collapsed:!0,hideSingleBase:!0}).addTo(this.map))},init_geocode:function(){var n=this;this.$el.data().editorConfig;this.map._controlCorners.above=c('<div class="acf-osm-above"></div>').insertBefore(this.$el).get(0),this.geocoder=L.Control.geocoder({collapsed:!1,position:"above",placeholder:"Search...",errorMessage:"Nothing found...",showResultIcons:!0,suggestMinLength:3,suggestTimeout:250,queryMinLength:3,defaultMarkGeocode:!1}).on("markgeocode",function(e){var t=e.geocode.center,r=n.$el.data().editorConfig,a=n.$markers().children().not("[data-id]").length,i=n._get_geocoder_result_label([e.geocode],t);(!1===a||a<r.max_markers)&&n.add_marker(t,i),1===r.max_markers&&1===a&&(marker=n.get_first_marker(),marker&&(entry=marker.osm_controller,marker.setLatLng(t),entry.update_marker_geocode(i))),0===r.max_markers?n.map.fitBounds(e.geocode.bbox):n.map.setView(t,n.map.getZoom())}).addTo(this.map)},get_first_marker:function(){var t=!1;return this.map.eachLayer(function(e){if(e.constructor===L.Marker)return t=e,!1}),t},update_visible:function(){return this.visible===this.$el.is(":visible")?this:(this.visible=this.$el.is(":visible"),this.visible?(this.map.invalidateSize(),this.bind_events()):this.unbind_events(),this)},init_acf:function(){function e(){t.update_visible()}var t=this;acf.addAction("show",e),acf.addAction("hide",e),acf.addAction("disable_field",function(){t.unbind_events()}),c(document).on("postbox-toggled",e),c(document).on("click",".widget-top *",e)},unbind_events:function(){this.$lat().off("blur"),this.$lng().off("blur"),this.$zoom().off("blur"),this.$zoom().off("keyup focus"),this.map.off("zoomend",this.map_zoomed,this),this.map.off("moveend",this.map_moved,this)},bind_events:function(){var t=this;t.$lat().on("blur",function(e){t.update_map()}),t.$lng().on("blur",function(e){t.update_map()}),t.$zoom().on("blur",function(e){t.update_map()}),this.map.on("zoomend",this.map_zoomed,this),this.map.on("moveend",this.map_moved,this)},update_map:function(){if(this.$lat().val()&&this.$lng().val()){var e=L.latLng(this.$lat().val(),this.$lng().val());this.map.setView(e,this.$zoom().val())}},map_moved:function(e){var t=this.map.getCenter();this.$lat().val(t.lat),this.$lng().val(t.lng),this.$el.trigger("change")},map_zoomed:function(e){this.$zoom().val(this.map.getZoom()),this.$el.trigger("change")}}),c(document).on("acf-osm-map-init",function(e,t){c(e.target).closest('[data-id="acfcloneindex"]').length?e.preventDefault():c(e.target).is("[data-editor-config]")&&(e.preventDefault(),c(e.target).data("_map_editor",new n.field({el:e.target,map:t})))}).on("change",'[data-type="open_street_map"] [data-name="return_format"] input',function(e){c('[data-name="return_format"] input:checked').val();var t=c(this).closest(".acf-field-object").find("[data-editor-config]"),r=t.data("_map_editor"),a=t.data("editor-config");r.reset_layers(),"osm"===c(this).val()?a.restrict_providers=Object.values(i.options.osm_layers):a.restrict_providers=Object.values(i.options.leaflet_layers),t.data("editor-config",a),r.init_layers()}),acf.addAction("append",function(){c.acf_leaflet()}),acf.addAction("show_field/type=open_street_map",function(e){e.$el.find("[data-editor-config]").data("_map_editor").update_visible()})}(jQuery,acf_osm_admin);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1pbnB1dC1vc20uanMiXSwibmFtZXMiOlsiJCIsImFyZyIsIm9wdGlvbnMiLCJvc20iLCJNYXJrZXJMaXN0IiwiQmFja2JvbmUiLCJWaWV3IiwiZXh0ZW5kIiwiTWFya2VyRW50cnkiLCJ0YWdOYW1lIiwiY2xhc3NOYW1lIiwiZXZlbnRzIiwiY2xpY2sgW2RhdGEtbmFtZT1cImxvY2F0ZS1tYXJrZXJcIl0iLCJjbGljayBbZGF0YS1uYW1lPVwicmVtb3ZlLW1hcmtlclwiXSIsImNoYW5nZSBbaWQkPVwiLW1hcmtlci1sYWJlbFwiXSIsImdldF9sYWJlbCIsInRoaXMiLCIkZWwiLCJmaW5kIiwidmFsIiwiZ2V0X2RlZmF1bHRfbGFiZWwiLCJpc19kZWZhdWx0X2xhYmVsIiwiaW5pdGlhbGl6ZSIsIm9wdCIsInRlbXBsYXRlIiwibWFya2VyIiwib3NtX2NvbnRyb2xsZXIiLCJyZW5kZXIiLCJzZWxmIiwiaHRtbCIsIl91cGRhdGVfdmFsdWVzX2Zyb21fbWFya2VyIiwiaGVpZ2h0IiwiZGF0YSIsIm9uIiwiZSIsImhpbGl0ZV9tYXJrZXIiLCJsb2xpdGVfbWFya2VyIiwiX2ljb24iLCJ1cGRhdGVfbWFya2VyX2xhYmVsIiwibGFiZWwiLCJ0YXJnZXQiLCJzZXRfbWFya2VyX2xhYmVsIiwidW5iaW5kVG9vbHRpcCIsImJpbmRUb29sdGlwIiwidGl0bGUiLCJhdHRyIiwidXBkYXRlX21hcmtlcl9nZW9jb2RlIiwibGF0bG5nIiwiZ2V0TGF0TG5nIiwibGF0IiwibG5nIiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyIsImxvY2F0ZV9tYXJrZXIiLCJfbWFwIiwiZmx5VG8iLCJyZW1vdmVfbWFya2VyIiwicHJldmVudERlZmF1bHQiLCJyZW1vdmUiLCJmaWVsZCIsIm1hcCIsImdlb2NvZGVyIiwidmlzaWJsZSIsIiRwYXJlbnQiLCJjbG9zZXN0IiwiJHpvb20iLCIkbGF0IiwiJGxuZyIsIiRsYXllclN0b3JlIiwiJHJlc3VsdHMiLCIkbWFya2VycyIsImNvbmYiLCJ1cGRhdGVfbWFwIiwiaW5pdF9hY2YiLCJpbml0X2xheWVycyIsImluaXRfbWFya2VycyIsInVwZGF0ZV92aXNpYmxlIiwiX2dldF9nZW9jb2Rlcl9yZXN1bHRfbGFiZWwiLCJsZW5ndGgiLCJlYWNoIiwiaSIsInJlc3VsdCIsIm5hbWUiLCJ0b1N0cmluZyIsInRleHQiLCJyZXBsYWNlIiwiZWRpdG9yX2NvbmZpZyIsImVkaXRvckNvbmZpZyIsImluaXRfZ2VvY29kZSIsIm1heF9tYXJrZXJzIiwiaWNvbiIsIkwiLCJEaXZJY29uIiwiY291bnRfbWFya2VycyIsImNoaWxkcmVuIiwibm90IiwicmV2ZXJzZSIsImdldFpvb20iLCJhZGRfbWFya2VyIiwibGF5ZXIiLCJjb25zdHJ1Y3RvciIsIk1hcmtlciIsInNwbGl0Iiwiam9pbiIsImVudHJ5IiwiY29udHJvbGxlciIsImlkIiwiYWNmIiwidW5pcWlkIiwiXyIsImFwcGVuZFRvIiwiZ2VvY29kZV9tYXJrZXIiLCJzZXRJY29uIiwidHJpZ2dlciIsImRyYWdnaW5nIiwiZW5hYmxlIiwibWFwTWFya2VycyIsIm1hcmtlckRhdGEiLCJsYXRMbmciLCJhZGRUbyIsIm1hcmtlcl9lbnRyeSIsImxuZ2xhdCIsImxheWVyX2lzX292ZXJsYXkiLCJrZXkiLCJwYXR0ZXJucyIsIm9wYWNpdHkiLCJtYXRjaCIsInJlc2V0X2xheWVycyIsImVhY2hMYXllciIsIlRpbGVMYXllciIsIlByb3ZpZGVyIiwibGF5ZXJzQ29udHJvbCIsInNlbGVjdGVkTGF5ZXJzIiwiYmFzZUxheWVycyIsIm92ZXJsYXlzIiwibWFwTGF5ZXJzIiwic2V0dXBNYXAiLCJpc09iamVjdCIsInJlc3RyaWN0X3Byb3ZpZGVycyIsImluZGV4T2YiLCJpc19vbWl0dGVkIiwiYWRkTGF5ZXIiLCJ0aWxlTGF5ZXIiLCJwcm92aWRlciIsImV4IiwicHJvdmlkZXJLZXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiZWwiLCJPYmplY3QiLCJrZXlzIiwic2xpY2UiLCJhbGxvd19wcm92aWRlcnMiLCJpbnNlcnRBZnRlciIsIiRsYXllcklucHV0IiwibmFtZV9wcmVmaXgiLCJhcHBlbmQiLCJwcmVwZW5kIiwiY29udHJvbCIsImxheWVycyIsImNvbGxhcHNlZCIsImhpZGVTaW5nbGVCYXNlIiwiX2NvbnRyb2xDb3JuZXJzIiwiaW5zZXJ0QmVmb3JlIiwiZ2V0IiwiQ29udHJvbCIsInBvc2l0aW9uIiwicGxhY2Vob2xkZXIiLCJlcnJvck1lc3NhZ2UiLCJzaG93UmVzdWx0SWNvbnMiLCJzdWdnZXN0TWluTGVuZ3RoIiwic3VnZ2VzdFRpbWVvdXQiLCJxdWVyeU1pbkxlbmd0aCIsImRlZmF1bHRNYXJrR2VvY29kZSIsImdlb2NvZGUiLCJjZW50ZXIiLCJnZXRfZmlyc3RfbWFya2VyIiwic2V0TGF0TG5nIiwiZml0Qm91bmRzIiwiYmJveCIsInNldFZpZXciLCJpcyIsImludmFsaWRhdGVTaXplIiwiYmluZF9ldmVudHMiLCJ1bmJpbmRfZXZlbnRzIiwidG9nZ2xlX2NiIiwiYWRkQWN0aW9uIiwiZG9jdW1lbnQiLCJvZmYiLCJtYXBfem9vbWVkIiwibWFwX21vdmVkIiwiZ2V0Q2VudGVyIiwiJG1hcCIsImVkaXRvciIsInZhbHVlcyIsIm9zbV9sYXllcnMiLCJsZWFmbGV0X2xheWVycyIsImFjZl9sZWFmbGV0IiwialF1ZXJ5IiwiYWNmX29zbV9hZG1pbiJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FDQUEsRUFBQUMsUUFBQSxJQU1BQyxFQUFBLEdBR0FBLEVBQUFDLFdBQUFDLFNBQUFDLEtBQUFDLE9BQUEsSUFFQUosRUFBQUssWUFBQUgsU0FBQUMsS0FBQUMsT0FBQSxDQUNBRSxRQUFBLE1BQ0FDLFVBQUEsYUFDQUMsT0FBQSxDQUNBQyxvQ0FBQSxnQkFDQUMsb0NBQUEsZ0JBQ0FDLCtCQUFBLHVCQUdBQyxVQUFBLFdBQ0EsT0FBQUMsS0FBQUMsSUFBQUMsS0FBQSx5QkFBQUMsT0FFQUMsa0JBQUEsV0FDQSxPQUFBSixLQUFBQyxJQUFBQyxLQUFBLDJCQUFBQyxPQUVBRSxpQkFBQSxXQUNBLE9B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QUFBQyxRQUFBaU0sWUFHQTVILEVBQUFtRSxtQkFBQVcsT0FBQTZDLE9BQUFqTSxFQUFBQyxRQUFBa00sZ0JBRUFKLEVBQUFoSyxLQUFBLGdCQUFBdUMsR0FDQTBILEVBQUF2SCxnQkFJQWlDLElBQUErRSxVQUFBLFNBQUEsV0FDQTFMLEVBQUFxTSxnQkFFQTFGLElBQUErRSxVQUFBLGtDQUFBLFNBQUEvSCxHQUNBQSxFQUFBMUMsSUFBQUMsS0FBQSx3QkFBQWMsS0FBQSxlQUNBNEMsbUJBdm1CQSxDQXltQkEwSCxPQUFBQyIsImZpbGUiOiJhY2YtaW5wdXQtb3NtLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiggJCwgYXJnICl7XG5cdHZhciBvcHRpb25zID0gYXJnLm9wdGlvbnMsXG5cdFx0cmVzdWx0X3RwbCA9ICc8ZGl2IHRhYmluZGV4PVwiPCU9IGRhdGEuaSAlPlwiIGNsYXNzPVwib3NtLXJlc3VsdFwiPidcblx0XHRcdCsgJzwlPSBkYXRhLnJlc3VsdF90ZXh0ICU+J1xuXHRcdFx0KyAnPGJyIC8+PHNtYWxsPjwlPSBkYXRhLnByb3BlcnRpZXMub3NtX3ZhbHVlICU+PC9zbWFsbD4nXG5cdFx0XHQrICc8L2Rpdj4nO1xuXG5cdHZhciBvc20gPSB7XG5cdH07XG5cblx0b3NtLk1hcmtlckxpc3QgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG5cdH0pXG5cdG9zbS5NYXJrZXJFbnRyeSA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcblx0XHR0YWdOYW1lOiAnZGl2Jyxcblx0XHRjbGFzc05hbWU6J29zbS1tYXJrZXInLFxuXHRcdGV2ZW50czoge1xuXHRcdFx0J2NsaWNrIFtkYXRhLW5hbWU9XCJsb2NhdGUtbWFya2VyXCJdJyA6ICdsb2NhdGVfbWFya2VyJyxcblx0XHRcdCdjbGljayBbZGF0YS1uYW1lPVwicmVtb3ZlLW1hcmtlclwiXScgOiAncmVtb3ZlX21hcmtlcicsXG5cdFx0XHQnY2hhbmdlIFtpZCQ9XCItbWFya2VyLWxhYmVsXCJdJ1x0XHQ6ICd1cGRhdGVfbWFya2VyX2xhYmVsJyxcbi8vXHRcdFx0J2ZvY3VzIFt0eXBlPVwidGV4dFwiXSdcdFx0XHRcdDogJ2hpbGl0ZV9tYXJrZXInXG5cdFx0fSxcblx0XHRnZXRfbGFiZWw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWxhYmVsXCJdJykudmFsKCk7XG5cdFx0fSxcblx0XHRnZXRfZGVmYXVsdF9sYWJlbDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItZ2VvY29kZVwiXScpLnZhbCgpO1xuXHRcdH0sXG5cdFx0aXNfZGVmYXVsdF9sYWJlbDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5nZXRfZGVmYXVsdF9sYWJlbCgpID09PSB0aGlzLmdldF9sYWJlbCgpO1xuXHRcdH0sXG5cdFx0aW5pdGlhbGl6ZTpmdW5jdGlvbihvcHQpe1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0dGhpcy50ZW1wbGF0ZSA9IG9wdC50ZW1wbGF0ZTtcblx0XHRcdHRoaXMubWFya2VyID0gb3B0Lm1hcmtlcjtcblx0XHRcdHRoaXMubWFya2VyLm9zbV9jb250cm9sbGVyID0gdGhpcztcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRyZW5kZXI6ZnVuY3Rpb24oKXtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0dGhpcy4kZWwuaHRtbCggdGhpcy50ZW1wbGF0ZSggdGhpcyApICk7XG5cdFx0XHR0aGlzLl91cGRhdGVfdmFsdWVzX2Zyb21fbWFya2VyKCk7XG5cblx0XHRcdHRoaXMuJGVsLmhlaWdodCggdGhpcy4kZWwuZGF0YSgnaGVpZ2h0JykgKTtcblxuXHRcdFx0dGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItbGFiZWxcIl0nKVxuXHRcdFx0XHQub24oJ2ZvY3VzJyxmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0c2VsZi5oaWxpdGVfbWFya2VyKCk7XG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5vbignYmx1cicsZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdHNlbGYubG9saXRlX21hcmtlcigpO1xuXHRcdFx0XHR9KTtcblx0XHRcdCQodGhpcy5tYXJrZXIuX2ljb24pXG5cdFx0XHRcdC5vbignZm9jdXMnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdHNlbGYuaGlsaXRlX21hcmtlcigpO1xuXHRcdFx0XHR9KVxuXHRcdFx0XHQub24oJ2JsdXInLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdHNlbGYubG9saXRlX21hcmtlcigpO1xuXHRcdFx0XHR9KVxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHR1cGRhdGVfbWFya2VyX2xhYmVsOmZ1bmN0aW9uKGUpIHtcblx0XHRcdHZhciBsYWJlbCA9IHRoaXMuZ2V0X2xhYmVsKCk7XG5cblx0XHRcdGlmICggbGFiZWwgPT09ICcnICkge1xuXHRcdFx0XHRsYWJlbCA9IHRoaXMuZ2V0X2RlZmF1bHRfbGFiZWwoKTtcblx0XHRcdH1cblx0XHRcdC8vIHJlc3RvcmUgZ2VvY29kZSBkZWZhdWx0XG5cdFx0XHQkKGUudGFyZ2V0KS52YWwobGFiZWwpO1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5zZXRfbWFya2VyX2xhYmVsKCBsYWJlbCApO1xuXHRcdH0sXG5cdFx0c2V0X21hcmtlcl9sYWJlbDpmdW5jdGlvbihsYWJlbCkge1xuXHRcdFx0dGhpcy5tYXJrZXIudW5iaW5kVG9vbHRpcCgpO1xuXHRcdFx0dGhpcy5tYXJrZXIuYmluZFRvb2x0aXAobGFiZWwpO1xuXG5cdFx0XHR0aGlzLm1hcmtlci5vcHRpb25zLnRpdGxlID0gbGFiZWw7XG5cdFx0XHQkKCB0aGlzLm1hcmtlci5faWNvbiApLmF0dHIoICd0aXRsZScsIGxhYmVsICk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHVwZGF0ZV9tYXJrZXJfZ2VvY29kZTpmdW5jdGlvbiggbGFiZWwgKSB7XG5cblx0XHRcdGlmICggdGhpcy5pc19kZWZhdWx0X2xhYmVsKCkgKSB7XG5cdFx0XHRcdC8vIHVwZGF0ZSBtYXJrZXIgbGFiZWxzXG5cdFx0XHRcdHRoaXMuc2V0X21hcmtlcl9sYWJlbCggbGFiZWwgKTtcblx0XHRcdFx0Ly8gdXBkYXRlIG1hcmtlciBsYWJlbCBpbnB1dFxuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1nZW9jb2RlXCJdJykudmFsKCBsYWJlbCApO1xuXG5cdFx0XHR0aGlzLl91cGRhdGVfdmFsdWVzX2Zyb21fbWFya2VyKCk7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0X3VwZGF0ZV92YWx1ZXNfZnJvbV9tYXJrZXI6IGZ1bmN0aW9uKCApIHtcblx0XHRcdHZhciBsYXRsbmcgPSB0aGlzLm1hcmtlci5nZXRMYXRMbmcoKTtcblx0XHRcdHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWxhdFwiXScpLnZhbCggbGF0bG5nLmxhdCApO1xuXHRcdFx0dGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItbG5nXCJdJykudmFsKCBsYXRsbmcubG5nICk7XG5cdFx0XHR0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1sYWJlbFwiXScpLnZhbCggdGhpcy5tYXJrZXIub3B0aW9ucy50aXRsZSApO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRoaWxpdGVfbWFya2VyOmZ1bmN0aW9uKGUpIHtcblx0XHRcdHRoaXMuJGVsLmFkZENsYXNzKCdmb2N1cycpO1xuXHRcdFx0JCggdGhpcy5tYXJrZXIuX2ljb24gKS5hZGRDbGFzcygnZm9jdXMnKVxuXHRcdH0sXG5cdFx0bG9saXRlX21hcmtlcjpmdW5jdGlvbihlKSB7XG5cdFx0XHR0aGlzLiRlbC5yZW1vdmVDbGFzcygnZm9jdXMnKTtcblx0XHRcdCQoIHRoaXMubWFya2VyLl9pY29uICkucmVtb3ZlQ2xhc3MoJ2ZvY3VzJylcblx0XHR9LFxuXHRcdGxvY2F0ZV9tYXJrZXI6ZnVuY3Rpb24oKXtcblx0XHRcdHRoaXMubWFya2VyLl9tYXAuZmx5VG8oIHRoaXMubWFya2VyLmdldExhdExuZygpICk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHJlbW92ZV9tYXJrZXI6ZnVuY3Rpb24oZSkge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpXG5cdFx0XHR0aGlzLm1hcmtlci5yZW1vdmUoKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblx0fSk7XG5cblx0b3NtLmZpZWxkID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXG5cdFx0bWFwOiBudWxsLFxuXHRcdGdlb2NvZGVyOiBudWxsLFxuXHRcdHZpc2libGU6IG51bGwsXG5cdFx0ZXZlbnRzOntcblx0XHR9LFxuXG5cdFx0JHBhcmVudDpmdW5jdGlvbigpe1xuXHRcdFx0cmV0dXJuIHRoaXMuJGVsLmNsb3Nlc3QoJy5hY2YtZmllbGQtc2V0dGluZ3MsLmFjZi1maWVsZC1vcGVuLXN0cmVldC1tYXAnKVxuXHRcdH0sXG5cdFx0JHpvb20gOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCdpbnB1dFtpZCQ9XCItem9vbVwiXScpO1xuXHRcdH0sXG5cdFx0JGxhdCA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJ2lucHV0W2lkJD1cIi1jZW50ZXJfbGF0XCJdJyk7XG5cdFx0fSxcblx0XHQkbG5nIDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnaW5wdXRbaWQkPVwiLWNlbnRlcl9sbmdcIl0nKTtcblx0XHR9LFxuXHRcdCRsYXllclN0b3JlOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCcuYWNmLW9zbS1sYXllcnMnKTtcblx0XHR9LFxuXHRcdCRyZXN1bHRzIDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnLm9zbS1yZXN1bHRzJyk7XG5cdFx0fSxcblx0XHQkbWFya2VyczpmdW5jdGlvbigpe1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJy5vc20tbWFya2VycycpO1xuXHRcdH0sXG5cdFx0aW5pdGlhbGl6ZTpmdW5jdGlvbihjb25mKSB7XG5cblx0XHRcdHRoaXMubWFwXHRcdD0gY29uZi5tYXA7XG5cblx0XHRcdHRoaXMudXBkYXRlX21hcCgpOyAvLyBzZXQgbWFwIHRvIGlucHV0IHZhbHVlc1xuXG5cdFx0XHR0aGlzLmluaXRfYWNmKCk7XG5cblx0XHRcdHRoaXMuaW5pdF9sYXllcnMoKTtcblxuXHRcdFx0dGhpcy5pbml0X21hcmtlcnMoKTtcblxuXHRcdFx0dGhpcy51cGRhdGVfdmlzaWJsZSgpO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdF9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsOmZ1bmN0aW9uKCBlLCBsYXRsbmcgKSB7XG5cdFx0XHR2YXIgbGFiZWwgPSBmYWxzZTtcblxuXHRcdFx0aWYgKCAhIGUubGVuZ3RoICkge1xuXHRcdFx0XHRsYWJlbCA9IGxhdGxuZy5sYXQudG9TdHJpbmcoKSArICcsICcgKyBsYXRsbmcubG5nLnRvU3RyaW5nKCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQkLmVhY2goIGUsIGZ1bmN0aW9uKCBpLCByZXN1bHQgKSB7XG5cdFx0XHRcdFx0aWYgKCAhISByZXN1bHQuaHRtbCApIHtcblx0XHRcdFx0XHRcdGxhYmVsID0gcmVzdWx0Lmh0bWw7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGxhYmVsID0gcmVzdWx0Lm5hbWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gJCgnPHA+JytsYWJlbCsnPC9wPicpLnRleHQoKS5yZXBsYWNlKC9eKFxccyspL2csJycpLnJlcGxhY2UoLyhcXHMrKSQvZywnJykucmVwbGFjZSgvKFxccyspL2csJyAnKTtcblx0XHR9LFxuXHRcdGluaXRfbWFya2VyczpmdW5jdGlvbigpe1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdGVkaXRvcl9jb25maWcgPSB0aGlzLiRlbC5kYXRhKCkuZWRpdG9yQ29uZmlnO1xuXG5cdFx0XHR0aGlzLmluaXRfZ2VvY29kZSgpO1xuXG5cdFx0XHQvLyBubyBtYXJrZXJzIGFsbG93ZWQhXG5cdFx0XHRpZiAoIGVkaXRvcl9jb25maWcubWF4X21hcmtlcnMgPT09IDAgKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5pY29uID0gbmV3IEwuRGl2SWNvbih7XG5cdFx0XHRcdGh0bWw6ICcnLFxuXHRcdFx0XHRjbGFzc05hbWU6J29zbS1tYXJrZXItaWNvbidcblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLm1hcC5vbignY2xpY2snLCBmdW5jdGlvbihlKXtcblx0XHRcdFx0dmFyIGxhdGxuZyA9IGUubGF0bG5nLFxuXHRcdFx0XHRcdGNvdW50X21hcmtlcnMgPSBzZWxmLiRtYXJrZXJzKCkuY2hpbGRyZW4oKS5ub3QoJ1tkYXRhLWlkXScpLmxlbmd0aDtcblxuXHRcdFx0XHQvLyBubyBtb3JlIG1hcmtlcnNcblx0XHRcdFx0aWYgKCBlZGl0b3JfY29uZmlnLm1heF9tYXJrZXJzICE9PSBmYWxzZSAmJiBjb3VudF9tYXJrZXJzID49IGVkaXRvcl9jb25maWcubWF4X21hcmtlcnMgKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZi5nZW9jb2Rlci5vcHRpb25zLmdlb2NvZGVyLnJldmVyc2UoZS5sYXRsbmcsc2VsZi5tYXAuZ2V0Wm9vbSgpLGZ1bmN0aW9uKGUpe1xuXG5cdFx0XHRcdFx0dmFyIGxhYmVsID0gc2VsZi5fZ2V0X2dlb2NvZGVyX3Jlc3VsdF9sYWJlbCggZSwgbGF0bG5nICk7XG5cblx0XHRcdFx0XHRzZWxmLmFkZF9tYXJrZXIoIGxhdGxuZywgbGFiZWwgKTtcblxuXHRcdFx0XHR9LHNlbGYpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMubWFwLm9uKCAnbGF5ZXJhZGQnLCBmdW5jdGlvbihlKXtcblx0XHRcdFx0aWYgKCBlLmxheWVyLmNvbnN0cnVjdG9yICE9PSBMLk1hcmtlciApIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdFx0Ly8gbWFya2VyIGFkZGVkXG5cdFx0XHRcdHZhciB0ZW1wbGF0ZSA9IHNlbGYuJG1hcmtlcnMoKS5maW5kKCdbZGF0YS1pZD1cIl9fb3NtX21hcmtlcl90ZW1wbGF0ZV9fXCJdJykuaHRtbCgpLnNwbGl0KCdfX29zbV9tYXJrZXJfdGVtcGxhdGVfXycpLmpvaW4oICc8JT0gaWQgJT4nICksXG5cdFx0XHRcdFx0ZW50cnkgPSBuZXcgb3NtLk1hcmtlckVudHJ5KHtcblx0XHRcdFx0XHRcdGNvbnRyb2xsZXI6IHRoaXMsXG5cdFx0XHRcdFx0XHRtYXJrZXI6IGUubGF5ZXIsXG5cdFx0XHRcdFx0XHRpZDogYWNmLnVuaXFpZCgpLCAvL3NlbGYuJG1hcmtlcnMoKS5jaGlsZHJlbigpLmxlbmd0aCxcblx0XHRcdFx0XHRcdHRlbXBsYXRlOiBfLnRlbXBsYXRlKCB0ZW1wbGF0ZSApLFxuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGVudHJ5LnJlbmRlcigpLiRlbC5hcHBlbmRUbyggc2VsZi4kbWFya2VycygpICk7XG5cblx0XHRcdFx0c2VsZi5nZW9jb2RlX21hcmtlciggZW50cnkgKTtcblxuXHRcdFx0XHRlLmxheWVyXG5cdFx0XHRcdFx0LnNldEljb24oIHNlbGYuaWNvbiApXG5cdFx0XHRcdFx0Lm9uKCdjbGljaycsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0XHR0aGlzLnJlbW92ZSgpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0Lm9uKCdyZW1vdmUnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdFx0ZW50cnkuJGVsLnJlbW92ZSgpO1xuXHRcdFx0XHRcdFx0c2VsZi4kZWwudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQub24oJ2RyYWdlbmQnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdFx0c2VsZi5nZW9jb2RlX21hcmtlciggZW50cnkgKTtcblx0XHRcdFx0XHRcdHNlbGYuJGVsLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0LmRyYWdnaW5nLmVuYWJsZSgpO1xuXHRcdFx0fSApO1xuXHRcdFx0dGhpcy5tYXAub24oICdsYXllcnJlbW92ZScsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRpZiAoIGUubGF5ZXIuY29uc3RydWN0b3IgIT09IEwuTWFya2VyICkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0XHRzZWxmLiRlbC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdH0gKTtcblx0XHRcdC8vIGFkZCBtYXJrZXJzXG5cdFx0XHQkLmVhY2goIHRoaXMuJGVsLmRhdGEoKS5tYXBNYXJrZXJzLGZ1bmN0aW9uKCBpLCBtYXJrZXJEYXRhICkge1xuXHRcdFx0XHQvLyBhZGQgbWFya2Vyc1xuXHRcdFx0XHR2YXIgbWFya2VyID0gTC5tYXJrZXIoIEwubGF0TG5nKCBtYXJrZXJEYXRhLmxhdCAqIDEsIG1hcmtlckRhdGEubG5nICogMSApLCB7XG5cdFx0XHRcdFx0XHR0aXRsZTogbWFya2VyRGF0YS5sYWJlbFxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0LmJpbmRUb29sdGlwKCBtYXJrZXJEYXRhLmxhYmVsIClcblx0XHRcdFx0XHQuYWRkVG8oIHNlbGYubWFwICk7XG5cblx0XHRcdH0pO1xuXG5cdFx0fSxcblx0XHRnZW9jb2RlX21hcmtlcjpmdW5jdGlvbiggbWFya2VyX2VudHJ5ICkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRlbnRyeSA9IG1hcmtlcl9lbnRyeSxcblx0XHRcdFx0bGF0bG5nID0gZW50cnkubWFya2VyLmdldExhdExuZygpO1xuXG5cdFx0XHRzZWxmLmdlb2NvZGVyLm9wdGlvbnMuZ2VvY29kZXIucmV2ZXJzZSggbGF0bG5nLCBzZWxmLm1hcC5nZXRab29tKCksIGZ1bmN0aW9uKGUpe1xuXG5cdFx0XHRcdHZhciBsYWJlbCA9IHNlbGYuX2dldF9nZW9jb2Rlcl9yZXN1bHRfbGFiZWwoIGUsIGxhdGxuZyApO1xuXG5cdFx0XHRcdGVudHJ5LnVwZGF0ZV9tYXJrZXJfZ2VvY29kZSggbGFiZWwgKTtcblxuXHRcdFx0fSwgdGhpcyApO1xuXG5cdFx0fSxcblx0XHRhZGRfbWFya2VyOmZ1bmN0aW9uKCBsbmdsYXQsIGxhYmVsICl7XG5cdFx0XHRMLm1hcmtlcihsbmdsYXQse1xuXHRcdFx0XHR0aXRsZTogbGFiZWwsXG5cdFx0XHRcdGljb246IHRoaXMuaWNvbixcblx0XHRcdH0pXG5cdFx0XHQuYmluZFRvb2x0aXAoIGxhYmVsIClcblx0XHRcdC5hZGRUbyggdGhpcy5tYXAgKTtcblxuXHRcdFx0dGhpcy4kZWwudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0fSxcblx0XHRsYXllcl9pc19vdmVybGF5OiBmdW5jdGlvbiggIGtleSwgbGF5ZXIgKSB7XG5cdFx0XHR2YXIgcGF0dGVybnM7XG5cblx0XHRcdGlmICggbGF5ZXIub3B0aW9ucy5vcGFjaXR5ICYmIGxheWVyLm9wdGlvbnMub3BhY2l0eSA8IDEgKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0cGF0dGVybnMgPSBbJ14oT3BlbldlYXRoZXJNYXB8T3BlblNlYU1hcCknLFxuXHRcdFx0XHQnT3Blbk1hcFN1cmZlci5BZG1pbkJvdW5kcycsXG5cdFx0XHRcdCdTdGFtZW4uVG9uZXIoSHlicmlkfExpbmVzfExhYmVscyknLFxuXHRcdFx0XHQnQWNldGF0ZS4oZm9yZWdyb3VuZHxsYWJlbHN8cm9hZHMpJyxcblx0XHRcdFx0J0hpbGxTaGFkaW5nJyxcblx0XHRcdFx0J0h5ZGRhLlJvYWRzQW5kTGFiZWxzJyxcblx0XHRcdFx0J15KdXN0aWNlTWFwJyxcblx0XHRcdFx0J09wZW5JbmZyYU1hcC4oUG93ZXJ8VGVsZWNvbXxQZXRyb2xldW18V2F0ZXIpJyxcblx0XHRcdFx0J09wZW5QdE1hcCcsXG5cdFx0XHRcdCdPcGVuUmFpbHdheU1hcCcsXG5cdFx0XHRcdCdPcGVuRmlyZU1hcCcsXG5cdFx0XHRcdCdTYWZlQ2FzdCcsXG5cdFx0XHRcdCdDYXJ0b0RCLkRhcmtNYXR0ZXJPbmx5TGFiZWxzJyxcblx0XHRcdFx0J0NhcnRvREIuUG9zaXRyb25Pbmx5TGFiZWxzJ1xuXHRcdFx0XTtcblx0XHRcdHJldHVybiBrZXkubWF0Y2goJygnICsgcGF0dGVybnMuam9pbignfCcpICsgJyknKSAhPT0gbnVsbDtcblx0XHR9LFxuXHRcdHJlc2V0X2xheWVyczpmdW5jdGlvbigpIHtcblx0XHRcdC8vIHNldCB0aGlzLiRlbC5kYXRhKCkubWFwTGF5ZXJzIHNvIGl0IGZpdHNcblx0XHRcdC8vIHJlbW92ZSBhbGwgbWFwIGxheWVyc1xuXHRcdFx0dGhpcy5tYXAuZWFjaExheWVyKGZ1bmN0aW9uKGxheWVyKXtcblx0XHRcdFx0aWYgKCBsYXllci5jb25zdHJ1Y3RvciA9PT0gTC5UaWxlTGF5ZXIuUHJvdmlkZXIgKSB7XG5cdFx0XHRcdFx0bGF5ZXIucmVtb3ZlKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pXG5cdFx0XHQvLyByZW1vdmUgbGF5ZXIgc3RvcmVcblx0XHRcdHRoaXMuJGxheWVyU3RvcmUoKS5yZW1vdmUoKTtcblxuXHRcdFx0Ly8gcmVtb3ZlIGxheWVyIGNvbnRyb2xcblx0XHRcdCEhIHRoaXMubGF5ZXJzQ29udHJvbCAmJiB0aGlzLmxheWVyc0NvbnRyb2wucmVtb3ZlKClcblx0XHR9LFxuXHRcdGluaXRfbGF5ZXJzOmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRzZWxlY3RlZExheWVycyA9IFtdLFxuXHRcdFx0XHRiYXNlTGF5ZXJzID0ge30sXG5cdFx0XHRcdG92ZXJsYXlzID0ge30sXG5cdFx0XHRcdG1hcExheWVycyA9IHt9LFxuXHRcdFx0XHRlZGl0b3JfY29uZmlnID0gdGhpcy4kZWwuZGF0YSgpLmVkaXRvckNvbmZpZyxcblx0XHRcdFx0aXNfb21pdHRlZCA9IGZ1bmN0aW9uKGtleSkge1xuXHRcdFx0XHRcdHJldHVybiBrZXkgPT09IG51bGwgfHwgKCAhISBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycyAmJiBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycy5pbmRleE9mKCBrZXkgKSA9PT0gLTEgKTtcblx0XHRcdFx0fSxcblx0XHRcdFx0c2V0dXBNYXAgPSBmdW5jdGlvbiggdmFsLCBrZXkgKXtcblx0XHRcdFx0XHR2YXIgbGF5ZXIsIGxheWVyX2NvbmZpZztcblx0XHRcdFx0XHRpZiAoIF8uaXNPYmplY3QodmFsKSApIHtcblx0XHRcdFx0XHRcdHJldHVybiAkLmVhY2goIHZhbCwgc2V0dXBNYXAgKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIGlzX29taXR0ZWQoa2V5KSApIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKCAhISBtYXBMYXllcnNbIGtleSBdICkge1xuXHRcdFx0XHRcdFx0bGF5ZXIgPSBtYXBMYXllcnNbIGtleSBdO1xuXHRcdFx0XHRcdFx0c2VsZi5tYXAuYWRkTGF5ZXIobGF5ZXIpXG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRcdGxheWVyID0gTC50aWxlTGF5ZXIucHJvdmlkZXIoIGtleSAvKiwgbGF5ZXJfY29uZmlnLm9wdGlvbnMqLyApO1xuXHRcdFx0XHRcdFx0fSBjYXRjaChleCkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRsYXllci5wcm92aWRlcktleSA9IGtleTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIHNlbGYubGF5ZXJfaXNfb3ZlcmxheSgga2V5LCBsYXllciApICkge1xuXHRcdFx0XHRcdFx0b3ZlcmxheXNba2V5XSA9IGxheWVyO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRiYXNlTGF5ZXJzW2tleV0gPSBsYXllcjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIHNlbGVjdGVkTGF5ZXJzLmluZGV4T2YoIGtleSApICE9PSAtMSApIHtcblx0XHRcdFx0XHRcdHNlbGYubWFwLmFkZExheWVyKGxheWVyKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH07XG5cblx0XHRcdHNlbGVjdGVkTGF5ZXJzID0gdGhpcy4kZWwuZGF0YSgpLm1hcExheWVyczsgLy8gc2hvdWxkIGJlIGxheWVyIHN0b3JlIHZhbHVlXG5cblx0XHRcdC8vIGZpbHRlciBhdmFpYWxibGUgbGF5ZXJzIGluIGZpZWxkIHZhbHVlXG5cdFx0XHRpZiAoIGVkaXRvcl9jb25maWcucmVzdHJpY3RfcHJvdmlkZXJzICE9PSBmYWxzZSAmJiBfLmlzQXJyYXkoIGVkaXRvcl9jb25maWcucmVzdHJpY3RfcHJvdmlkZXJzICkgKSB7XG5cdFx0XHRcdHNlbGVjdGVkTGF5ZXJzID0gc2VsZWN0ZWRMYXllcnMuZmlsdGVyKCBmdW5jdGlvbihlbCkge1xuXHRcdFx0XHRcdHJldHVybiBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycy5pbmRleE9mKCBlbCApICE9PSAtMTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIHNldCBkZWZhdWx0IGxheWVyXG5cdFx0XHRpZiAoICEgc2VsZWN0ZWRMYXllcnMubGVuZ3RoICkge1xuXG5cdFx0XHRcdHNlbGVjdGVkTGF5ZXJzID0gT2JqZWN0LmtleXMoIGVkaXRvcl9jb25maWcucmVzdHJpY3RfcHJvdmlkZXJzICkuc2xpY2UoIDAsIDEgKTtcblxuXHRcdFx0fVxuXG5cdFx0XHQvLyBlZGl0YWJsZSBsYXllcnMhXG5cdFx0XHRpZiAoIGVkaXRvcl9jb25maWcuYWxsb3dfcHJvdmlkZXJzICkge1xuXG5cdFx0XHRcdCQoJzxkaXYgY2xhc3M9XCJhY2Ytb3NtLWxheWVyc1wiPjwvZGl2PicpLmluc2VydEFmdGVyKCB0aGlzLiRlbCApO1xuXG5cdFx0XHRcdHRoaXMubWFwLm9uKCAnYmFzZWxheWVyY2hhbmdlIGxheWVyYWRkIGxheWVycmVtb3ZlJywgZnVuY3Rpb24oZSl7XG5cblx0XHRcdFx0XHRpZiAoICEgZS5sYXllci5wcm92aWRlcktleSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHR2YXIgJGxheWVyU3RvcmUgPSBzZWxmLiRsYXllclN0b3JlKCksXG5cdFx0XHRcdFx0XHQkdGVtcGxhdGUgPSBzZWxmLiRwYXJlbnQoKS5maW5kKCdbZGF0YS1pZD1cIl9fb3NtX2xheWVyX3RlbXBsYXRlX19cIl0nKTtcblxuXHRcdFx0XHRcdCRsYXllclN0b3JlLmh0bWwoJycpO1xuXG5cdFx0XHRcdFx0c2VsZi5tYXAuZWFjaExheWVyKGZ1bmN0aW9uKGxheWVyKSB7XG5cdFx0XHRcdFx0XHR2YXIgJGxheWVySW5wdXQ7XG5cdFx0XHRcdFx0XHRpZiAoICEgbGF5ZXIucHJvdmlkZXJLZXkgKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdC8qXG5cdFx0XHRcdFx0XHQkbGF5ZXJJbnB1dCA9ICR0ZW1wbGF0ZS5jbG9uZSgpLnJlbW92ZUF0dHIoJ2RhdGEtaWQnKTtcblx0XHRcdFx0XHRcdC8qL1xuXHRcdFx0XHRcdFx0JGxheWVySW5wdXQgPSAkKCc8aW5wdXQgdHlwZT1cImhpZGRlblwiIG5hbWU9XCInICsgZWRpdG9yX2NvbmZpZy5uYW1lX3ByZWZpeCArICdbbGF5ZXJzXVtdXCIgLz4nKTtcblx0XHRcdFx0XHRcdC8vKi9cblx0XHRcdFx0XHRcdCRsYXllcklucHV0LnZhbCggbGF5ZXIucHJvdmlkZXJLZXkgKTtcblxuXHRcdFx0XHRcdFx0aWYgKCBzZWxmLmxheWVyX2lzX292ZXJsYXkoIGxheWVyLnByb3ZpZGVyS2V5LCBsYXllciApICkge1xuXHRcdFx0XHRcdFx0XHQkbGF5ZXJTdG9yZS5hcHBlbmQoICRsYXllcklucHV0ICk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHQkbGF5ZXJTdG9yZS5wcmVwZW5kKCAkbGF5ZXJJbnB1dCApO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdHNlbGYuJGVsLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0XHR9ICk7XG5cdFx0XHR9XG5cblxuXHRcdFx0JC5lYWNoKCBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycywgc2V0dXBNYXAgKTtcblxuXHRcdFx0Ly8gLi4uIG5vIGxheWVyIGVkaXRpbmcgYWxsb3dlZFxuXHRcdFx0aWYgKCB0aGlzLiRsYXllclN0b3JlKCkubGVuZ3RoICkge1xuXHRcdFx0XHR0aGlzLmxheWVyc0NvbnRyb2wgPSBMLmNvbnRyb2wubGF5ZXJzKCBiYXNlTGF5ZXJzLCBvdmVybGF5cywge1xuXHRcdFx0XHRcdGNvbGxhcHNlZDogdHJ1ZSxcblx0XHRcdFx0XHRoaWRlU2luZ2xlQmFzZTogdHJ1ZSxcblx0XHRcdFx0fSkuYWRkVG8odGhpcy5tYXApO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0aW5pdF9nZW9jb2RlOmZ1bmN0aW9uKCkge1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdGVkaXRvcl9jb25maWcgPSB0aGlzLiRlbC5kYXRhKCkuZWRpdG9yQ29uZmlnO1xuXG5cdFx0XHR0aGlzLm1hcC5fY29udHJvbENvcm5lcnNbJ2Fib3ZlJ10gPSAkKCc8ZGl2IGNsYXNzPVwiYWNmLW9zbS1hYm92ZVwiPjwvZGl2PicpLmluc2VydEJlZm9yZSggdGhpcy4kZWwgKS5nZXQoMCk7XG5cblx0XHRcdHRoaXMuZ2VvY29kZXIgPSBMLkNvbnRyb2wuZ2VvY29kZXIoe1xuXHRcdFx0XHRjb2xsYXBzZWQ6IGZhbHNlLFxuXHRcdFx0XHRwb3NpdGlvbjonYWJvdmUnLFxuXHRcdFx0XHRwbGFjZWhvbGRlcjonU2VhcmNoLi4uJyxcblx0XHRcdFx0ZXJyb3JNZXNzYWdlOidOb3RoaW5nIGZvdW5kLi4uJyxcblx0XHRcdFx0c2hvd1Jlc3VsdEljb25zOnRydWUsXG5cdFx0XHRcdHN1Z2dlc3RNaW5MZW5ndGg6Myxcblx0XHRcdFx0c3VnZ2VzdFRpbWVvdXQ6MjUwLFxuXHRcdFx0XHRxdWVyeU1pbkxlbmd0aDozLFxuXHRcdFx0XHRkZWZhdWx0TWFya0dlb2NvZGU6ZmFsc2UsXG5cdFx0XHR9KVxuXHRcdFx0Lm9uKCdtYXJrZ2VvY29kZScsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHZhciBsYXRsbmcgPSAgZS5nZW9jb2RlLmNlbnRlcixcblx0XHRcdFx0XHRlZGl0b3JfY29uZmlnID0gc2VsZi4kZWwuZGF0YSgpLmVkaXRvckNvbmZpZyxcblx0XHRcdFx0XHRjb3VudF9tYXJrZXJzID0gc2VsZi4kbWFya2VycygpLmNoaWxkcmVuKCkubm90KCdbZGF0YS1pZF0nKS5sZW5ndGgsXG5cdFx0XHRcdFx0bGFiZWwgPSBzZWxmLl9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsKCBbIGUuZ2VvY29kZSBdLCBsYXRsbmcgKTtcblxuXHRcdFx0XHRpZiAoIGNvdW50X21hcmtlcnMgPT09IGZhbHNlIHx8IGNvdW50X21hcmtlcnMgPCBlZGl0b3JfY29uZmlnLm1heF9tYXJrZXJzICkge1xuXHRcdFx0XHRcdC8vIGFkZCBtYXJrZXIgaWYgbm8gcmVzdHJpY3Rpb24gb3IgbWF4IG1hcmtlcnMgbm90IGV4Y2VlZGVkXG5cdFx0XHRcdFx0c2VsZi5hZGRfbWFya2VyKCBsYXRsbmcsIGxhYmVsICk7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKCBlZGl0b3JfY29uZmlnLm1heF9tYXJrZXJzID09PSAxICYmIGNvdW50X21hcmtlcnMgPT09IDEgKSB7XG5cdFx0XHRcdFx0Ly8gdXBkYXRlIHNpbmdsZSBtYXJrZXJcblx0XHRcdFx0XHRtYXJrZXIgPSBzZWxmLmdldF9maXJzdF9tYXJrZXIoKTtcblx0XHRcdFx0XHRpZiAoICEhIG1hcmtlciApIHtcblx0XHRcdFx0XHRcdGVudHJ5ID0gbWFya2VyLm9zbV9jb250cm9sbGVyO1xuXHRcdFx0XHRcdFx0bWFya2VyLnNldExhdExuZyggbGF0bG5nICk7XG5cdFx0XHRcdFx0XHRlbnRyeS51cGRhdGVfbWFya2VyX2dlb2NvZGUoIGxhYmVsICk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCBlZGl0b3JfY29uZmlnLm1heF9tYXJrZXJzID09PSAwICkge1xuXHRcdFx0XHRcdHNlbGYubWFwLmZpdEJvdW5kcyggZS5nZW9jb2RlLmJib3ggKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRzZWxmLm1hcC5zZXRWaWV3KCBsYXRsbmcsIHNlbGYubWFwLmdldFpvb20oKSApOyAvLyBrZWVwIHpvb20sIG1pZ2h0IGJlIGNvbmZ1c2luZyBlbHNlXG5cdFx0XHRcdH1cblxuXHRcdFx0fSlcblx0XHRcdC5hZGRUbyggdGhpcy5tYXAgKTtcblxuXHRcdH0sXG5cdFx0Z2V0X2ZpcnN0X21hcmtlcjpmdW5jdGlvbigpIHtcblx0XHRcdHZhciBtYXJrZXIgPSBmYWxzZTtcblx0XHRcdHRoaXMubWFwLmVhY2hMYXllcihmdW5jdGlvbihsYXllcil7XG5cdFx0XHRcdGlmICggbGF5ZXIuY29uc3RydWN0b3IgPT09IEwuTWFya2VyICkge1xuXHRcdFx0XHRcdG1hcmtlciA9IGxheWVyO1xuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gbWFya2VyO1xuXHRcdH0sXG5cdFx0dXBkYXRlX3Zpc2libGU6IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRpZiAoIHRoaXMudmlzaWJsZSA9PT0gdGhpcy4kZWwuaXMoJzp2aXNpYmxlJykgKSB7XG5cdFx0XHRcdHJldHVybiB0aGlzO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnZpc2libGUgPSB0aGlzLiRlbC5pcygnOnZpc2libGUnKTtcblxuXHRcdFx0aWYgKCB0aGlzLnZpc2libGUgKSB7XG5cdFx0XHRcdHRoaXMubWFwLmludmFsaWRhdGVTaXplKCk7XG5cdFx0XHRcdHRoaXMuYmluZF9ldmVudHMoKTtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLnVuYmluZF9ldmVudHMoKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0aW5pdF9hY2Y6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHR0b2dnbGVfY2IgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHQvLyBubyBjaGFuZ2Vcblx0XHRcdFx0XHRzZWxmLnVwZGF0ZV92aXNpYmxlKCk7XG5cdFx0XHRcdH07XG5cblx0XHRcdC8vIGV4cGFuZC9jb2xsYXBzZSBhY2Ygc2V0dGluZ1xuXHRcdFx0YWNmLmFkZEFjdGlvbiggJ3Nob3cnLCB0b2dnbGVfY2IgKTtcblx0XHRcdGFjZi5hZGRBY3Rpb24oICdoaWRlJywgdG9nZ2xlX2NiICk7XG5cdFx0XHRhY2YuYWRkQWN0aW9uKCAnZGlzYWJsZV9maWVsZCcsIGZ1bmN0aW9uKCl7XG5cdFx0XHRcdHNlbGYudW5iaW5kX2V2ZW50cygpO1xuXHRcdFx0fSApO1xuXG5cdFx0XHQvLyBleHBhbmQgd3AgbWV0YWJveFxuXHRcdFx0JChkb2N1bWVudCkub24oJ3Bvc3Rib3gtdG9nZ2xlZCcsIHRvZ2dsZV9jYiApO1xuXHRcdFx0JChkb2N1bWVudCkub24oJ2NsaWNrJywnLndpZGdldC10b3AgKicsIHRvZ2dsZV9jYiApO1xuXG5cblxuXHRcdH0sXG5cdFx0dW5iaW5kX2V2ZW50czpmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblx0XHRcdHNlbGYuJGxhdCgpLm9mZignYmx1cicpO1xuXHRcdFx0c2VsZi4kbG5nKCkub2ZmKCdibHVyJyk7XG5cdFx0XHRzZWxmLiR6b29tKCkub2ZmKCdibHVyJyk7XG5cdFx0XHRzZWxmLiR6b29tKCkub2ZmKCdrZXl1cCBmb2N1cycpO1xuXG5cdFx0XHR0aGlzLm1hcC5vZmYoJ3pvb21lbmQnLCB0aGlzLm1hcF96b29tZWQsIHRoaXMgKTtcblx0XHRcdHRoaXMubWFwLm9mZignbW92ZWVuZCcsIHRoaXMubWFwX21vdmVkLCB0aGlzICk7XG5cdFx0fSxcblx0XHRiaW5kX2V2ZW50czogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNlbGYuJGxhdCgpLm9uKCdibHVyJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0c2VsZi51cGRhdGVfbWFwKCk7XG5cdFx0XHR9KTtcblx0XHRcdHNlbGYuJGxuZygpLm9uKCdibHVyJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0c2VsZi51cGRhdGVfbWFwKCk7XG5cdFx0XHR9KTtcblx0XHRcdHNlbGYuJHpvb20oKS5vbignYmx1cicsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHNlbGYudXBkYXRlX21hcCgpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMubWFwLm9uKCd6b29tZW5kJywgdGhpcy5tYXBfem9vbWVkLCB0aGlzICk7XG5cdFx0XHR0aGlzLm1hcC5vbignbW92ZWVuZCcsIHRoaXMubWFwX21vdmVkLCB0aGlzICk7XG5cdFx0fSxcblx0XHR1cGRhdGVfbWFwOmZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKCAhIHRoaXMuJGxhdCgpLnZhbCgpIHx8ICEgdGhpcy4kbG5nKCkudmFsKCkgKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdHZhciBsYXRsbmcgPSBMLmxhdExuZyggdGhpcy4kbGF0KCkudmFsKCksIHRoaXMuJGxuZygpLnZhbCgpICk7XG5cdFx0XHR0aGlzLm1hcC5zZXRWaWV3KCBsYXRsbmcsICB0aGlzLiR6b29tKCkudmFsKCkgKTtcblx0XHR9LFxuXHRcdG1hcF9tb3ZlZDpmdW5jdGlvbihlKXtcblx0XHRcdHZhciBjZW50ZXIgPSB0aGlzLm1hcC5nZXRDZW50ZXIoKTtcblx0XHRcdHRoaXMuJGxhdCgpLnZhbChjZW50ZXIubGF0KTtcblx0XHRcdHRoaXMuJGxuZygpLnZhbChjZW50ZXIubG5nKTtcblx0XHRcdHRoaXMuJGVsLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdH0sXG5cdFx0bWFwX3pvb21lZDpmdW5jdGlvbihlKXtcblx0XHRcdHRoaXMuJHpvb20oKS52YWwoIHRoaXMubWFwLmdldFpvb20oKSApO1xuXHRcdFx0dGhpcy4kZWwudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0fVxuXHR9KTtcblxuXG5cdCQoZG9jdW1lbnQpXG5cdFx0Lm9uKCdhY2Ytb3NtLW1hcC1pbml0JyxmdW5jdGlvbiggZSwgbWFwICkge1xuXHRcdFx0Ly8gZG9uJ3QgaW5pdCBpbiByZXBlYXRlciB0ZW1wbGF0ZXNcblx0XHRcdGlmICggJChlLnRhcmdldCkuY2xvc2VzdCgnW2RhdGEtaWQ9XCJhY2ZjbG9uZWluZGV4XCJdJykubGVuZ3RoICkge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdC8vIHdyYXAgb3NtLmZpZWxkIGJhY2tib25lIHZpZXcgYXJvdW5kIGVkaXRvcnNcblx0XHRcdGlmICggJChlLnRhcmdldCkuaXMoJ1tkYXRhLWVkaXRvci1jb25maWddJykgKSB7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0JChlLnRhcmdldCkuZGF0YSggJ19tYXBfZWRpdG9yJywgbmV3IG9zbS5maWVsZCggeyBlbDogZS50YXJnZXQsIG1hcDogbWFwIH0gKSApO1xuXHRcdFx0fVxuXHRcdH0pXG5cdFx0Ly8gZmllbGQgc2V0dGluZ3Ncblx0XHQub24oJ2NoYW5nZScsJ1tkYXRhLXR5cGU9XCJvcGVuX3N0cmVldF9tYXBcIl0gW2RhdGEtbmFtZT1cInJldHVybl9mb3JtYXRcIl0gaW5wdXQnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0Ly8gZmluZCBtYXAgZmllbGRcblx0XHRcdCQoJ1tkYXRhLW5hbWU9XCJyZXR1cm5fZm9ybWF0XCJdIGlucHV0OmNoZWNrZWQnKS52YWwoKVxuXHRcdFx0dmFyICRtYXAgPSAkKHRoaXMpLmNsb3Nlc3QoJy5hY2YtZmllbGQtb2JqZWN0JykuZmluZCgnW2RhdGEtZWRpdG9yLWNvbmZpZ10nKSxcblx0XHRcdFx0ZWRpdG9yID0gJG1hcC5kYXRhKCAnX21hcF9lZGl0b3InICksXG5cdFx0XHRcdGNvbmYgPSAkbWFwLmRhdGEoJ2VkaXRvci1jb25maWcnKTtcblx0XHRcdC8vIG1hcFxuXHRcdFx0ZWRpdG9yLnJlc2V0X2xheWVycygpO1xuXHRcdFx0aWYgKCAkKHRoaXMpLnZhbCgpID09PSAnb3NtJyApIHtcblx0XHRcdFx0Ly8gc2V0IHByb3ZpZGVyIHJlc3RyaWN0aW9uIHRvIG9zbSBwcm92aWRlcnNcblx0XHRcdFx0Y29uZi5yZXN0cmljdF9wcm92aWRlcnMgPSBPYmplY3QudmFsdWVzKCBhcmcub3B0aW9ucy5vc21fbGF5ZXJzICk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBzZXQgcHJvdmlkZXIgcmVzdHJpY3Rpb24gdG8gb3NtIHByb3ZpZGVyc1xuXHRcdFx0XHRjb25mLnJlc3RyaWN0X3Byb3ZpZGVycyA9IE9iamVjdC52YWx1ZXMoIGFyZy5vcHRpb25zLmxlYWZsZXRfbGF5ZXJzICk7XG5cdFx0XHR9XG5cdFx0XHQkbWFwLmRhdGEoICdlZGl0b3ItY29uZmlnJywgY29uZiApO1xuXHRcdFx0ZWRpdG9yLmluaXRfbGF5ZXJzKCk7XG5cdFx0fSk7XG5cblx0Ly8gd2hlbiBmaWVsZHMgZ2V0IGxvYWRlZCAuLi5cblx0YWNmLmFkZEFjdGlvbiggJ2FwcGVuZCcsIGZ1bmN0aW9uKCl7XG5cdFx0JC5hY2ZfbGVhZmxldCgpO1xuXHR9KTtcblx0YWNmLmFkZEFjdGlvbiggJ3Nob3dfZmllbGQvdHlwZT1vcGVuX3N0cmVldF9tYXAnLCBmdW5jdGlvbiggZmllbGQgKXtcblx0ICAgIHZhciBlZGl0b3IgPSBmaWVsZC4kZWwuZmluZCgnW2RhdGEtZWRpdG9yLWNvbmZpZ10nKS5kYXRhKCAnX21hcF9lZGl0b3InICk7XG5cdCAgICBlZGl0b3IudXBkYXRlX3Zpc2libGUoKTtcblx0fSk7XG59KSggalF1ZXJ5LCBhY2Zfb3NtX2FkbWluICk7XG4iXX0=
