!function(c,i){i.options;var n={};n.MarkerList=Backbone.View.extend({}),n.MarkerEntry=Backbone.View.extend({tagName:"div",className:"osm-marker",events:{'click [data-name="locate-marker"]':"locate_marker",'click [data-name="remove-marker"]':"remove_marker",'change [id$="-marker-label"]':"update_marker_label"},get_label:function(){return this.$el.find('[id$="-marker-label"]').val()},get_default_label:function(){return this.$el.find('[id$="-marker-geocode"]').val()},is_default_label:function(){return this.get_default_label()===this.get_label()},initialize:function(e){return this.template=e.template,this.marker=e.marker,this.marker.osm_controller=this},render:function(){var t=this;return this.$el.html(this.template(this)),this._update_values_from_marker(),this.$el.find('[id$="-marker-label"]').on("focus",function(e){t.hilite_marker()}).on("blur",function(e){t.lolite_marker()}),c(this.marker._icon).on("focus",function(e){t.hilite_marker()}).on("blur",function(e){t.lolite_marker()}),this},update_marker_label:function(e){var t=this.get_label();return""===t&&(t=this.get_default_label()),c(e.target).val(t),this.set_marker_label(t)},set_marker_label:function(e){return this.marker.unbindTooltip(),this.marker.bindTooltip(e),this.marker.options.title=e,c(this.marker._icon).attr("title",e),this},update_marker_geocode:function(e){return this.is_default_label()&&this.set_marker_label(e),this.$el.find('[id$="-marker-geocode"]').val(e),this._update_values_from_marker(),this},_update_values_from_marker:function(){var e=this.marker.getLatLng();return this.$el.find('[id$="-marker-lat"]').val(e.lat),this.$el.find('[id$="-marker-lng"]').val(e.lng),this.$el.find('[id$="-marker-label"]').val(this.marker.options.title),this},hilite_marker:function(e){this.$el.addClass("focus"),c(this.marker._icon).addClass("focus")},lolite_marker:function(e){this.$el.removeClass("focus"),c(this.marker._icon).removeClass("focus")},locate_marker:function(){return this.marker._map.flyTo(this.marker.getLatLng()),this},remove_marker:function(e){return e.preventDefault(),this.marker.remove(),this}}),n.field=Backbone.View.extend({map:null,geocoder:null,visible:null,events:{},$parent:function(){return this.$el.closest(".acf-field-settings,.acf-field-open-street-map")},$zoom:function(){return this.$parent().find('input[id$="-zoom"]')},$lat:function(){return this.$parent().find('input[id$="-center_lat"]')},$lng:function(){return this.$parent().find('input[id$="-center_lng"]')},$layerStore:function(){return this.$parent().find(".acf-osm-layers")},$results:function(){return this.$parent().find(".osm-results")},$markers:function(){return this.$parent().find(".osm-markers")},initialize:function(e){return this.map=e.map,this.update_map(),this.init_acf(),this.init_layers(),this.init_markers(),this.update_visible(),this},_get_geocoder_result_label:function(e,t){var r=!1;return e.length?c.each(e,function(e,t){return r=t.html?t.html:t.name,!1}):r=t.lat.toString()+", "+t.lng.toString(),c("<p>"+r+"</p>").text().replace(/^(\s+)/g,"").replace(/(\s+)$/g,"").replace(/(\s+)/g," ")},init_markers:function(){var a=this,i=this.$el.data().editorConfig;this.init_geocode(),0!==i.max_markers&&(this.icon=new L.DivIcon({html:"",className:"osm-marker-icon"}),this.map.on("click",function(e){var r=e.latlng,t=a.$markers().children().not("[data-id]").length;!1!==i.max_markers&&t>=i.max_markers||a.geocoder.options.geocoder.reverse(e.latlng,a.map.getZoom(),function(e){var t=a._get_geocoder_result_label(e,r);a.add_marker(r,t)},a)}),this.map.on("layeradd",function(e){if(e.layer.constructor===L.Marker){var t=a.$markers().find('[data-id="__osm_marker_template__"]').html().split("__osm_marker_template__").join("<%= id %>"),r=new n.MarkerEntry({controller:this,marker:e.layer,id:acf.uniqid(),template:_.template(t)});r.render().$el.appendTo(a.$markers()),a.geocode_marker(r),e.layer.setIcon(a.icon).on("click",function(e){this.remove()}).on("remove",function(e){r.$el.remove(),a.$el.trigger("change")}).on("dragend",function(e){a.geocode_marker(r),a.$el.trigger("change")}).dragging.enable()}}),this.map.on("layerremove",function(e){e.layer.constructor===L.Marker&&a.$el.trigger("change")}),c.each(this.$el.data().mapMarkers,function(e,t){L.marker(L.latLng(1*t.lat,1*t.lng),{title:t.label}).bindTooltip(t.label).addTo(a.map)}))},geocode_marker:function(e){var r=this,a=e,i=a.marker.getLatLng();r.geocoder.options.geocoder.reverse(i,r.map.getZoom(),function(e){var t=r._get_geocoder_result_label(e,i);a.update_marker_geocode(t)},this)},add_marker:function(e,t){L.marker(e,{title:t,icon:this.icon}).bindTooltip(t).addTo(this.map),this.$el.trigger("change")},layer_is_overlay:function(e,t){var r;return!!(t.options.opacity&&t.options.opacity<1)||(r=["^(OpenWeatherMap|OpenSeaMap)","OpenMapSurfer.AdminBounds","Stamen.Toner(Hybrid|Lines|Labels)","Acetate.(foreground|labels|roads)","HillShading","Hydda.RoadsAndLabels","^JusticeMap","OpenInfraMap.(Power|Telecom|Petroleum|Water)","OpenPtMap","OpenRailwayMap","OpenFireMap","SafeCast","CartoDB.DarkMatterOnlyLabels","CartoDB.PositronOnlyLabels"],null!==e.match("("+r.join("|")+")"))},reset_layers:function(){this.map.eachLayer(function(e){e.constructor===L.TileLayer.Provider&&e.remove()}),this.$layerStore().remove(),this.layersControl&&this.layersControl.remove()},init_layers:function(){var a=this,i=[],n={},o={},s={},l=this.$el.data().editorConfig,d=function(e,t){var r;if(_.isObject(e))return c.each(e,d);if(!function(e){return null===e||!!l.restrict_providers&&-1===l.restrict_providers.indexOf(e)}(t)){if(s[t])r=s[t],a.map.addLayer(r);else{try{r=L.tileLayer.provider(t)}catch(e){return}r.providerKey=t}a.layer_is_overlay(t,r)?o[t]=r:n[t]=r,-1!==i.indexOf(t)&&a.map.addLayer(r)}};i=this.$el.data().mapLayers,!1!==l.restrict_providers&&_.isArray(l.restrict_providers)&&(i=i.filter(function(e){return-1!==l.restrict_providers.indexOf(e)})),i.length||(i=Object.keys(l.restrict_providers).slice(0,1)),l.allow_providers&&(c('<div class="acf-osm-layers"></div>').insertAfter(this.$el),this.map.on("baselayerchange layeradd layerremove",function(e){if(e.layer.providerKey){var r=a.$layerStore();a.$parent().find('[data-id="__osm_layer_template__"]');r.html(""),a.map.eachLayer(function(e){var t;e.providerKey&&((t=c('<input type="hidden" name="'+l.name_prefix+'[layers][]" />')).val(e.providerKey),a.layer_is_overlay(e.providerKey,e)?r.append(t):r.prepend(t))}),a.$el.trigger("change")}})),c.each(l.restrict_providers,d),this.$layerStore().length&&(this.layersControl=L.control.layers(n,o,{collapsed:!0,hideSingleBase:!0}).addTo(this.map))},init_geocode:function(){var n=this;this.$el.data().editorConfig;this.map._controlCorners.above=c('<div class="acf-osm-above"></div>').insertBefore(this.$el).get(0),this.geocoder=L.Control.geocoder({collapsed:!1,position:"above",placeholder:"Search...",errorMessage:"Nothing found...",showResultIcons:!0,suggestMinLength:3,suggestTimeout:250,queryMinLength:3,defaultMarkGeocode:!1}).on("markgeocode",function(e){var t=e.geocode.center,r=n.$el.data().editorConfig,a=n.$markers().children().not("[data-id]").length,i=n._get_geocoder_result_label([e.geocode],t);(!1===a||a<r.max_markers)&&n.add_marker(t,i),1===r.max_markers&&1===a&&(marker=n.get_first_marker(),marker&&(entry=marker.osm_controller,marker.setLatLng(t),entry.update_marker_geocode(i))),0===r.max_markers?n.map.fitBounds(e.geocode.bbox):n.map.setView(t,n.map.getZoom())}).addTo(this.map)},get_first_marker:function(){var t=!1;return this.map.eachLayer(function(e){if(e.constructor===L.Marker)return t=e,!1}),t},update_visible:function(){return this.visible===this.$el.is(":visible")?this:(this.visible=this.$el.is(":visible"),this.visible?(this.map.invalidateSize(),this.bind_events()):this.unbind_events(),this)},init_acf:function(){function e(){t.update_visible()}var t=this;acf.addAction("show",e),acf.addAction("hide",e),acf.addAction("disable_field",function(){t.unbind_events()}),c(document).on("postbox-toggled",e),c(document).on("click",".widget-top *",e)},unbind_events:function(){this.$lat().off("blur"),this.$lng().off("blur"),this.$zoom().off("blur"),this.$zoom().off("keyup focus"),this.map.off("zoomend",this.map_zoomed,this),this.map.off("moveend",this.map_moved,this)},bind_events:function(){var t=this;t.$lat().on("blur",function(e){t.update_map()}),t.$lng().on("blur",function(e){t.update_map()}),t.$zoom().on("blur",function(e){t.update_map()}),this.map.on("zoomend",this.map_zoomed,this),this.map.on("moveend",this.map_moved,this)},update_map:function(){if(this.$lat().val()&&this.$lng().val()){var e=L.latLng(this.$lat().val(),this.$lng().val());this.map.setView(e,this.$zoom().val())}},map_moved:function(e){var t=this.map.getCenter();this.$lat().val(t.lat),this.$lng().val(t.lng),this.$el.trigger("change")},map_zoomed:function(e){this.$zoom().val(this.map.getZoom()),this.$el.trigger("change")}}),c(document).on("acf-osm-map-init",function(t,r){c(t.target).closest('[data-id="acfcloneindex"]').length?t.preventDefault():c(t.target).is("[data-editor-config]")&&(t.preventDefault(),function e(){if(!c(t.target).is(":visible"))return setTimeout(e,250);r.invalidateSize()}(),c(t.target).data("_map_editor",new n.field({el:t.target,map:r})))}).on("change",'[data-type="open_street_map"] [data-name="return_format"] input',function(e){c('[data-name="return_format"] input:checked').val();var t=c(this).closest(".acf-field-object").find("[data-editor-config]"),r=t.data("_map_editor"),a=t.data("editor-config");r.reset_layers(),"osm"===c(this).val()?a.restrict_providers=Object.values(i.options.osm_layers):a.restrict_providers=Object.values(i.options.leaflet_layers),t.data("editor-config",a),r.init_layers()}),acf.addAction("append",function(){c.acf_leaflet()}),acf.addAction("show_field/type=open_street_map",function(e){e.$el.find("[data-editor-config]").data("_map_editor").update_visible()})}(jQuery,acf_osm_admin);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1pbnB1dC1vc20uanMiXSwibmFtZXMiOlsiJCIsImFyZyIsIm9wdGlvbnMiLCJvc20iLCJNYXJrZXJMaXN0IiwiQmFja2JvbmUiLCJWaWV3IiwiZXh0ZW5kIiwiTWFya2VyRW50cnkiLCJ0YWdOYW1lIiwiY2xhc3NOYW1lIiwiZXZlbnRzIiwiY2xpY2sgW2RhdGEtbmFtZT1cImxvY2F0ZS1tYXJrZXJcIl0iLCJjbGljayBbZGF0YS1uYW1lPVwicmVtb3ZlLW1hcmtlclwiXSIsImNoYW5nZSBbaWQkPVwiLW1hcmtlci1sYWJlbFwiXSIsImdldF9sYWJlbCIsInRoaXMiLCIkZWwiLCJmaW5kIiwidmFsIiwiZ2V0X2RlZmF1bHRfbGFiZWwiLCJpc19kZWZhdWx0X2xhYmVsIiwiaW5pdGlhbGl6ZSIsIm9wdCIsInRlbXBsYXRlIiwibWFya2VyIiwib3NtX2NvbnRyb2xsZXIiLCJyZW5kZXIiLCJzZWxmIiwiaHRtbCIsIl91cGRhdGVfdmFsdWVzX2Zyb21fbWFya2VyIiwib24iLCJlIiwiaGlsaXRlX21hcmtlciIsImxvbGl0ZV9tYXJrZXIiLCJfaWNvbiIsInVwZGF0ZV9tYXJrZXJfbGFiZWwiLCJsYWJlbCIsInRhcmdldCIsInNldF9tYXJrZXJfbGFiZWwiLCJ1bmJpbmRUb29sdGlwIiwiYmluZFRvb2x0aXAiLCJ0aXRsZSIsImF0dHIiLCJ1cGRhdGVfbWFya2VyX2dlb2NvZGUiLCJsYXRsbmciLCJnZXRMYXRMbmciLCJsYXQiLCJsbmciLCJhZGRDbGFzcyIsInJlbW92ZUNsYXNzIiwibG9jYXRlX21hcmtlciIsIl9tYXAiLCJmbHlUbyIsInJlbW92ZV9tYXJrZXIiLCJwcmV2ZW50RGVmYXVsdCIsInJlbW92ZSIsImZpZWxkIiwibWFwIiwiZ2VvY29kZXIiLCJ2aXNpYmxlIiwiJHBhcmVudCIsImNsb3Nlc3QiLCIkem9vbSIsIiRsYXQiLCIkbG5nIiwiJGxheWVyU3RvcmUiLCIkcmVzdWx0cyIsIiRtYXJrZXJzIiwiY29uZiIsInVwZGF0ZV9tYXAiLCJpbml0X2FjZiIsImluaXRfbGF5ZXJzIiwiaW5pdF9tYXJrZXJzIiwidXBkYXRlX3Zpc2libGUiLCJfZ2V0X2dlb2NvZGVyX3Jlc3VsdF9sYWJlbCIsImxlbmd0aCIsImVhY2giLCJpIiwicmVzdWx0IiwibmFtZSIsInRvU3RyaW5nIiwidGV4dCIsInJlcGxhY2UiLCJlZGl0b3JfY29uZmlnIiwiZGF0YSIsImVkaXRvckNvbmZpZyIsImluaXRfZ2VvY29kZSIsIm1heF9tYXJrZXJzIiwiaWNvbiIsIkwiLCJEaXZJY29uIiwiY291bnRfbWFya2VycyIsImNoaWxkcmVuIiwibm90IiwicmV2ZXJzZSIsImdldFpvb20iLCJhZGRfbWFya2VyIiwibGF5ZXIiLCJjb25zdHJ1Y3RvciIsIk1hcmtlciIsInNwbGl0Iiwiam9pbiIsImVudHJ5IiwiY29udHJvbGxlciIsImlkIiwiYWNmIiwidW5pcWlkIiwiXyIsImFwcGVuZFRvIiwiZ2VvY29kZV9tYXJrZXIiLCJzZXRJY29uIiwidHJpZ2dlciIsImRyYWdnaW5nIiwiZW5hYmxlIiwibWFwTWFya2VycyIsIm1hcmtlckRhdGEiLCJsYXRMbmciLCJhZGRUbyIsIm1hcmtlcl9lbnRyeSIsImxuZ2xhdCIsImxheWVyX2lzX292ZXJsYXkiLCJrZXkiLCJwYXR0ZXJucyIsIm9wYWNpdHkiLCJtYXRjaCIsInJlc2V0X2xheWVycyIsImVhY2hMYXllciIsIlRpbGVMYXllciIsIlByb3ZpZGVyIiwibGF5ZXJzQ29udHJvbCIsInNlbGVjdGVkTGF5ZXJzIiwiYmFzZUxheWVycyIsIm92ZXJsYXlzIiwibWFwTGF5ZXJzIiwic2V0dXBNYXAiLCJpc09iamVjdCIsInJlc3RyaWN0X3Byb3ZpZGVycyIsImluZGV4T2YiLCJpc19vbWl0dGVkIiwiYWRkTGF5ZXIiLCJ0aWxlTGF5ZXIiLCJwcm92aWRlciIsImV4IiwicHJvdmlkZXJLZXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiZWwiLCJPYmplY3QiLCJrZXlzIiwic2xpY2UiLCJhbGxvd19wcm92aWRlcnMiLCJpbnNlcnRBZnRlciIsIiRsYXllcklucHV0IiwibmFtZV9wcmVmaXgiLCJhcHBlbmQiLCJwcmVwZW5kIiwiY29udHJvbCIsImxheWVycyIsImNvbGxhcHNlZCIsImhpZGVTaW5nbGVCYXNlIiwiX2NvbnRyb2xDb3JuZXJzIiwiaW5zZXJ0QmVmb3JlIiwiZ2V0IiwiQ29udHJvbCIsInBvc2l0aW9uIiwicGxhY2Vob2xkZXIiLCJlcnJvck1lc3NhZ2UiLCJzaG93UmVzdWx0SWNvbnMiLCJzdWdnZXN0TWluTGVuZ3RoIiwic3VnZ2VzdFRpbWVvdXQiLCJxdWVyeU1pbkxlbmd0aCIsImRlZmF1bHRNYXJrR2VvY29kZSIsImdlb2NvZGUiLCJjZW50ZXIiLCJnZXRfZmlyc3RfbWFya2VyIiwic2V0TGF0TG5nIiwiZml0Qm91bmRzIiwiYmJveCIsInNldFZpZXciLCJpcyIsImludmFsaWRhdGVTaXplIiwiYmluZF9ldmVudHMiLCJ1bmJpbmRfZXZlbnRzIiwidG9nZ2xlX2NiIiwiYWRkQWN0aW9uIiwiZG9jdW1lbnQiLCJvZmYiLCJtYXBfem9vbWVkIiwibWFwX21vdmVkIiwiZ2V0Q2VudGVyIiwiY2hlY2tWaXMiLCJzZXRUaW1lb3V0IiwiJG1hcCIsImVkaXRvciIsInZhbHVlcyIsIm9zbV9sYXllcnMiLCJsZWFmbGV0X2xheWVycyIsImFjZl9sZWFmbGV0IiwialF1ZXJ5IiwiYWNmX29zbV9hZG1pbiJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FDQUEsRUFBQUMsUUFBQSxJQU1BQyxFQUFBLEdBR0FBLEVBQUFDLFdBQUFDLFNBQUFDLEtBQUFDLE9BQUEsSUFFQUosRUFBQUssWUFBQUgsU0FBQUMsS0FBQUMsT0FBQSxDQUNBRSxRQUFBLE1BQ0FDLFVBQUEsYUFDQUMsT0FBQSxDQUNBQyxvQ0FBQSxnQkFDQUMsb0NBQUEsZ0JBQ0FDLCtCQUFBLHVCQUdBQyxVQUFBLFdBQ0EsT0FBQUMsS0FBQUMsSUFBQUMsS0FBQSx5QkFBQUMsT0FFQUMsa0JBQUEsV0FDQSxPQUFBSixLQUFBQyxJQUFBQyxLQUFBLDJCQUFBQyxPQUVB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RSxlQUNBLFFBQUE5SCxFQUFBZ0IsTUFBQUcsTUFFQWtELEVBQUFvRSxtQkFBQVcsT0FBQStDLE9BQUFsTSxFQUFBQyxRQUFBa00sWUFHQS9ILEVBQUFvRSxtQkFBQVcsT0FBQStDLE9BQUFsTSxFQUFBQyxRQUFBbU0sZ0JBRUFKLEVBQUE1RyxLQUFBLGdCQUFBaEIsR0FDQTZILEVBQUExSCxnQkFJQWtDLElBQUErRSxVQUFBLFNBQUEsV0FDQXpMLEVBQUFzTSxnQkFHQTVGLElBQUErRSxVQUFBLGtDQUFBLFNBQUFoSSxHQUNBQSxFQUFBeEMsSUFBQUMsS0FBQSx3QkFBQW1FLEtBQUEsZUFDQVgsbUJBOW1CQSxDQWduQkE2SCxPQUFBQyIsImZpbGUiOiJhY2YtaW5wdXQtb3NtLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiggJCwgYXJnICl7XG5cdHZhciBvcHRpb25zID0gYXJnLm9wdGlvbnMsXG5cdFx0cmVzdWx0X3RwbCA9ICc8ZGl2IHRhYmluZGV4PVwiPCU9IGRhdGEuaSAlPlwiIGNsYXNzPVwib3NtLXJlc3VsdFwiPidcblx0XHRcdCsgJzwlPSBkYXRhLnJlc3VsdF90ZXh0ICU+J1xuXHRcdFx0KyAnPGJyIC8+PHNtYWxsPjwlPSBkYXRhLnByb3BlcnRpZXMub3NtX3ZhbHVlICU+PC9zbWFsbD4nXG5cdFx0XHQrICc8L2Rpdj4nO1xuXG5cdHZhciBvc20gPSB7XG5cdH07XG5cblx0b3NtLk1hcmtlckxpc3QgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG5cdH0pXG5cdG9zbS5NYXJrZXJFbnRyeSA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcblx0XHR0YWdOYW1lOiAnZGl2Jyxcblx0XHRjbGFzc05hbWU6J29zbS1tYXJrZXInLFxuXHRcdGV2ZW50czoge1xuXHRcdFx0J2NsaWNrIFtkYXRhLW5hbWU9XCJsb2NhdGUtbWFya2VyXCJdJyA6ICdsb2NhdGVfbWFya2VyJyxcblx0XHRcdCdjbGljayBbZGF0YS1uYW1lPVwicmVtb3ZlLW1hcmtlclwiXScgOiAncmVtb3ZlX21hcmtlcicsXG5cdFx0XHQnY2hhbmdlIFtpZCQ9XCItbWFya2VyLWxhYmVsXCJdJ1x0XHQ6ICd1cGRhdGVfbWFya2VyX2xhYmVsJyxcbi8vXHRcdFx0J2ZvY3VzIFt0eXBlPVwidGV4dFwiXSdcdFx0XHRcdDogJ2hpbGl0ZV9tYXJrZXInXG5cdFx0fSxcblx0XHRnZXRfbGFiZWw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWxhYmVsXCJdJykudmFsKCk7XG5cdFx0fSxcblx0XHRnZXRfZGVmYXVsdF9sYWJlbDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItZ2VvY29kZVwiXScpLnZhbCgpO1xuXHRcdH0sXG5cdFx0aXNfZGVmYXVsdF9sYWJlbDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5nZXRfZGVmYXVsdF9sYWJlbCgpID09PSB0aGlzLmdldF9sYWJlbCgpO1xuXHRcdH0sXG5cdFx0aW5pdGlhbGl6ZTpmdW5jdGlvbihvcHQpe1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0dGhpcy50ZW1wbGF0ZSA9IG9wdC50ZW1wbGF0ZTtcblx0XHRcdHRoaXMubWFya2VyID0gb3B0Lm1hcmtlcjtcblx0XHRcdHRoaXMubWFya2VyLm9zbV9jb250cm9sbGVyID0gdGhpcztcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRyZW5kZXI6ZnVuY3Rpb24oKXtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0dGhpcy4kZWwuaHRtbCggdGhpcy50ZW1wbGF0ZSggdGhpcyApICk7XG5cdFx0XHR0aGlzLl91cGRhdGVfdmFsdWVzX2Zyb21fbWFya2VyKCk7XG5cblx0XHRcdHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWxhYmVsXCJdJylcblx0XHRcdFx0Lm9uKCdmb2N1cycsZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdHNlbGYuaGlsaXRlX21hcmtlcigpO1xuXHRcdFx0XHR9KVxuXHRcdFx0XHQub24oJ2JsdXInLGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHRzZWxmLmxvbGl0ZV9tYXJrZXIoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHQkKHRoaXMubWFya2VyLl9pY29uKVxuXHRcdFx0XHQub24oJ2ZvY3VzJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRzZWxmLmhpbGl0ZV9tYXJrZXIoKTtcblx0XHRcdFx0fSlcblx0XHRcdFx0Lm9uKCdibHVyJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRzZWxmLmxvbGl0ZV9tYXJrZXIoKTtcblx0XHRcdFx0fSlcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0dXBkYXRlX21hcmtlcl9sYWJlbDpmdW5jdGlvbihlKSB7XG5cdFx0XHR2YXIgbGFiZWwgPSB0aGlzLmdldF9sYWJlbCgpO1xuXG5cdFx0XHRpZiAoIGxhYmVsID09PSAnJyApIHtcblx0XHRcdFx0bGFiZWwgPSB0aGlzLmdldF9kZWZhdWx0X2xhYmVsKCk7XG5cdFx0XHR9XG5cdFx0XHQvLyByZXN0b3JlIGdlb2NvZGUgZGVmYXVsdFxuXHRcdFx0JChlLnRhcmdldCkudmFsKGxhYmVsKTtcblxuXHRcdFx0cmV0dXJuIHRoaXMuc2V0X21hcmtlcl9sYWJlbCggbGFiZWwgKTtcblx0XHR9LFxuXHRcdHNldF9tYXJrZXJfbGFiZWw6ZnVuY3Rpb24obGFiZWwpIHtcblx0XHRcdHRoaXMubWFya2VyLnVuYmluZFRvb2x0aXAoKTtcblx0XHRcdHRoaXMubWFya2VyLmJpbmRUb29sdGlwKGxhYmVsKTtcblxuXHRcdFx0dGhpcy5tYXJrZXIub3B0aW9ucy50aXRsZSA9IGxhYmVsO1xuXHRcdFx0JCggdGhpcy5tYXJrZXIuX2ljb24gKS5hdHRyKCAndGl0bGUnLCBsYWJlbCApO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHR1cGRhdGVfbWFya2VyX2dlb2NvZGU6ZnVuY3Rpb24oIGxhYmVsICkge1xuXG5cdFx0XHRpZiAoIHRoaXMuaXNfZGVmYXVsdF9sYWJlbCgpICkge1xuXHRcdFx0XHQvLyB1cGRhdGUgbWFya2VyIGxhYmVsc1xuXHRcdFx0XHR0aGlzLnNldF9tYXJrZXJfbGFiZWwoIGxhYmVsICk7XG5cdFx0XHRcdC8vIHVwZGF0ZSBtYXJrZXIgbGFiZWwgaW5wdXRcblx0XHRcdH1cblxuXHRcdFx0dGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItZ2VvY29kZVwiXScpLnZhbCggbGFiZWwgKTtcblxuXHRcdFx0dGhpcy5fdXBkYXRlX3ZhbHVlc19mcm9tX21hcmtlcigpO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdF91cGRhdGVfdmFsdWVzX2Zyb21fbWFya2VyOiBmdW5jdGlvbiggKSB7XG5cdFx0XHR2YXIgbGF0bG5nID0gdGhpcy5tYXJrZXIuZ2V0TGF0TG5nKCk7XG5cdFx0XHR0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1sYXRcIl0nKS52YWwoIGxhdGxuZy5sYXQgKTtcblx0XHRcdHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWxuZ1wiXScpLnZhbCggbGF0bG5nLmxuZyApO1xuXHRcdFx0dGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItbGFiZWxcIl0nKS52YWwoIHRoaXMubWFya2VyLm9wdGlvbnMudGl0bGUgKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0aGlsaXRlX21hcmtlcjpmdW5jdGlvbihlKSB7XG5cdFx0XHR0aGlzLiRlbC5hZGRDbGFzcygnZm9jdXMnKTtcblx0XHRcdCQoIHRoaXMubWFya2VyLl9pY29uICkuYWRkQ2xhc3MoJ2ZvY3VzJylcblx0XHR9LFxuXHRcdGxvbGl0ZV9tYXJrZXI6ZnVuY3Rpb24oZSkge1xuXHRcdFx0dGhpcy4kZWwucmVtb3ZlQ2xhc3MoJ2ZvY3VzJyk7XG5cdFx0XHQkKCB0aGlzLm1hcmtlci5faWNvbiApLnJlbW92ZUNsYXNzKCdmb2N1cycpXG5cdFx0fSxcblx0XHRsb2NhdGVfbWFya2VyOmZ1bmN0aW9uKCl7XG5cdFx0XHR0aGlzLm1hcmtlci5fbWFwLmZseVRvKCB0aGlzLm1hcmtlci5nZXRMYXRMbmcoKSApO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRyZW1vdmVfbWFya2VyOmZ1bmN0aW9uKGUpIHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKVxuXHRcdFx0dGhpcy5tYXJrZXIucmVtb3ZlKCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cdH0pO1xuXG5cdG9zbS5maWVsZCA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcblxuXHRcdG1hcDogbnVsbCxcblx0XHRnZW9jb2RlcjogbnVsbCxcblx0XHR2aXNpYmxlOiBudWxsLFxuXHRcdGV2ZW50czp7XG5cdFx0fSxcblxuXHRcdCRwYXJlbnQ6ZnVuY3Rpb24oKXtcblx0XHRcdHJldHVybiB0aGlzLiRlbC5jbG9zZXN0KCcuYWNmLWZpZWxkLXNldHRpbmdzLC5hY2YtZmllbGQtb3Blbi1zdHJlZXQtbWFwJylcblx0XHR9LFxuXHRcdCR6b29tIDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnaW5wdXRbaWQkPVwiLXpvb21cIl0nKTtcblx0XHR9LFxuXHRcdCRsYXQgOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCdpbnB1dFtpZCQ9XCItY2VudGVyX2xhdFwiXScpO1xuXHRcdH0sXG5cdFx0JGxuZyA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJ2lucHV0W2lkJD1cIi1jZW50ZXJfbG5nXCJdJyk7XG5cdFx0fSxcblx0XHQkbGF5ZXJTdG9yZTogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnLmFjZi1vc20tbGF5ZXJzJyk7XG5cdFx0fSxcblx0XHQkcmVzdWx0cyA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJy5vc20tcmVzdWx0cycpO1xuXHRcdH0sXG5cdFx0JG1hcmtlcnM6ZnVuY3Rpb24oKXtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCcub3NtLW1hcmtlcnMnKTtcblx0XHR9LFxuXHRcdGluaXRpYWxpemU6ZnVuY3Rpb24oY29uZikge1xuXG5cdFx0XHR0aGlzLm1hcFx0XHQ9IGNvbmYubWFwO1xuXG5cdFx0XHR0aGlzLnVwZGF0ZV9tYXAoKTsgLy8gc2V0IG1hcCB0byBpbnB1dCB2YWx1ZXNcblxuXHRcdFx0dGhpcy5pbml0X2FjZigpO1xuXG5cdFx0XHR0aGlzLmluaXRfbGF5ZXJzKCk7XG5cblx0XHRcdHRoaXMuaW5pdF9tYXJrZXJzKCk7XG5cblx0XHRcdHRoaXMudXBkYXRlX3Zpc2libGUoKTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRfZ2V0X2dlb2NvZGVyX3Jlc3VsdF9sYWJlbDpmdW5jdGlvbiggZSwgbGF0bG5nICkge1xuXHRcdFx0dmFyIGxhYmVsID0gZmFsc2U7XG5cblx0XHRcdGlmICggISBlLmxlbmd0aCApIHtcblx0XHRcdFx0bGFiZWwgPSBsYXRsbmcubGF0LnRvU3RyaW5nKCkgKyAnLCAnICsgbGF0bG5nLmxuZy50b1N0cmluZygpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0JC5lYWNoKCBlLCBmdW5jdGlvbiggaSwgcmVzdWx0ICkge1xuXHRcdFx0XHRcdGlmICggISEgcmVzdWx0Lmh0bWwgKSB7XG5cdFx0XHRcdFx0XHRsYWJlbCA9IHJlc3VsdC5odG1sO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRsYWJlbCA9IHJlc3VsdC5uYW1lO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuICQoJzxwPicrbGFiZWwrJzwvcD4nKS50ZXh0KCkucmVwbGFjZSgvXihcXHMrKS9nLCcnKS5yZXBsYWNlKC8oXFxzKykkL2csJycpLnJlcGxhY2UoLyhcXHMrKS9nLCcgJyk7XG5cdFx0fSxcblx0XHRpbml0X21hcmtlcnM6ZnVuY3Rpb24oKXtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRlZGl0b3JfY29uZmlnID0gdGhpcy4kZWwuZGF0YSgpLmVkaXRvckNvbmZpZztcblxuXHRcdFx0dGhpcy5pbml0X2dlb2NvZGUoKTtcblxuXHRcdFx0Ly8gbm8gbWFya2VycyBhbGxvd2VkIVxuXHRcdFx0aWYgKCBlZGl0b3JfY29uZmlnLm1heF9tYXJrZXJzID09PSAwICkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuaWNvbiA9IG5ldyBMLkRpdkljb24oe1xuXHRcdFx0XHRodG1sOiAnJyxcblx0XHRcdFx0Y2xhc3NOYW1lOidvc20tbWFya2VyLWljb24nXG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5tYXAub24oJ2NsaWNrJywgZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHZhciBsYXRsbmcgPSBlLmxhdGxuZyxcblx0XHRcdFx0XHRjb3VudF9tYXJrZXJzID0gc2VsZi4kbWFya2VycygpLmNoaWxkcmVuKCkubm90KCdbZGF0YS1pZF0nKS5sZW5ndGg7XG5cblx0XHRcdFx0Ly8gbm8gbW9yZSBtYXJrZXJzXG5cdFx0XHRcdGlmICggZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyAhPT0gZmFsc2UgJiYgY291bnRfbWFya2VycyA+PSBlZGl0b3JfY29uZmlnLm1heF9tYXJrZXJzICkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHNlbGYuZ2VvY29kZXIub3B0aW9ucy5nZW9jb2Rlci5yZXZlcnNlKGUubGF0bG5nLHNlbGYubWFwLmdldFpvb20oKSxmdW5jdGlvbihlKXtcblxuXHRcdFx0XHRcdHZhciBsYWJlbCA9IHNlbGYuX2dldF9nZW9jb2Rlcl9yZXN1bHRfbGFiZWwoIGUsIGxhdGxuZyApO1xuXG5cdFx0XHRcdFx0c2VsZi5hZGRfbWFya2VyKCBsYXRsbmcsIGxhYmVsICk7XG5cblx0XHRcdFx0fSxzZWxmKTtcblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLm1hcC5vbiggJ2xheWVyYWRkJywgZnVuY3Rpb24oZSl7XG5cdFx0XHRcdGlmICggZS5sYXllci5jb25zdHJ1Y3RvciAhPT0gTC5NYXJrZXIgKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHRcdC8vIG1hcmtlciBhZGRlZFxuXHRcdFx0XHR2YXIgdGVtcGxhdGUgPSBzZWxmLiRtYXJrZXJzKCkuZmluZCgnW2RhdGEtaWQ9XCJfX29zbV9tYXJrZXJfdGVtcGxhdGVfX1wiXScpLmh0bWwoKS5zcGxpdCgnX19vc21fbWFya2VyX3RlbXBsYXRlX18nKS5qb2luKCAnPCU9IGlkICU+JyApLFxuXHRcdFx0XHRcdGVudHJ5ID0gbmV3IG9zbS5NYXJrZXJFbnRyeSh7XG5cdFx0XHRcdFx0XHRjb250cm9sbGVyOiB0aGlzLFxuXHRcdFx0XHRcdFx0bWFya2VyOiBlLmxheWVyLFxuXHRcdFx0XHRcdFx0aWQ6IGFjZi51bmlxaWQoKSwgLy9zZWxmLiRtYXJrZXJzKCkuY2hpbGRyZW4oKS5sZW5ndGgsXG5cdFx0XHRcdFx0XHR0ZW1wbGF0ZTogXy50ZW1wbGF0ZSggdGVtcGxhdGUgKSxcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRlbnRyeS5yZW5kZXIoKS4kZWwuYXBwZW5kVG8oIHNlbGYuJG1hcmtlcnMoKSApO1xuXG5cdFx0XHRcdHNlbGYuZ2VvY29kZV9tYXJrZXIoIGVudHJ5ICk7XG5cblx0XHRcdFx0ZS5sYXllclxuXHRcdFx0XHRcdC5zZXRJY29uKCBzZWxmLmljb24gKVxuXHRcdFx0XHRcdC5vbignY2xpY2snLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdFx0dGhpcy5yZW1vdmUoKTtcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5vbigncmVtb3ZlJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRcdGVudHJ5LiRlbC5yZW1vdmUoKTtcblx0XHRcdFx0XHRcdHNlbGYuJGVsLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0Lm9uKCdkcmFnZW5kJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRcdHNlbGYuZ2VvY29kZV9tYXJrZXIoIGVudHJ5ICk7XG5cdFx0XHRcdFx0XHRzZWxmLiRlbC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5kcmFnZ2luZy5lbmFibGUoKTtcblx0XHRcdH0gKTtcblx0XHRcdHRoaXMubWFwLm9uKCAnbGF5ZXJyZW1vdmUnLCBmdW5jdGlvbihlKXtcblx0XHRcdFx0aWYgKCBlLmxheWVyLmNvbnN0cnVjdG9yICE9PSBMLk1hcmtlciApIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdFx0c2VsZi4kZWwudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0XHR9ICk7XG5cdFx0XHQvLyBhZGQgbWFya2Vyc1xuXHRcdFx0JC5lYWNoKCB0aGlzLiRlbC5kYXRhKCkubWFwTWFya2VycyxmdW5jdGlvbiggaSwgbWFya2VyRGF0YSApIHtcblx0XHRcdFx0Ly8gYWRkIG1hcmtlcnNcblx0XHRcdFx0dmFyIG1hcmtlciA9IEwubWFya2VyKCBMLmxhdExuZyggbWFya2VyRGF0YS5sYXQgKiAxLCBtYXJrZXJEYXRhLmxuZyAqIDEgKSwge1xuXHRcdFx0XHRcdFx0dGl0bGU6IG1hcmtlckRhdGEubGFiZWxcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5iaW5kVG9vbHRpcCggbWFya2VyRGF0YS5sYWJlbCApXG5cdFx0XHRcdFx0LmFkZFRvKCBzZWxmLm1hcCApO1xuXG5cdFx0XHR9KTtcblxuXHRcdH0sXG5cdFx0Z2VvY29kZV9tYXJrZXI6ZnVuY3Rpb24oIG1hcmtlcl9lbnRyeSApIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0ZW50cnkgPSBtYXJrZXJfZW50cnksXG5cdFx0XHRcdGxhdGxuZyA9IGVudHJ5Lm1hcmtlci5nZXRMYXRMbmcoKTtcblxuXHRcdFx0c2VsZi5nZW9jb2Rlci5vcHRpb25zLmdlb2NvZGVyLnJldmVyc2UoIGxhdGxuZywgc2VsZi5tYXAuZ2V0Wm9vbSgpLCBmdW5jdGlvbihlKXtcblxuXHRcdFx0XHR2YXIgbGFiZWwgPSBzZWxmLl9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsKCBlLCBsYXRsbmcgKTtcblxuXHRcdFx0XHRlbnRyeS51cGRhdGVfbWFya2VyX2dlb2NvZGUoIGxhYmVsICk7XG5cblx0XHRcdH0sIHRoaXMgKTtcblxuXHRcdH0sXG5cdFx0YWRkX21hcmtlcjpmdW5jdGlvbiggbG5nbGF0LCBsYWJlbCApe1xuXHRcdFx0TC5tYXJrZXIobG5nbGF0LHtcblx0XHRcdFx0dGl0bGU6IGxhYmVsLFxuXHRcdFx0XHRpY29uOiB0aGlzLmljb24sXG5cdFx0XHR9KVxuXHRcdFx0LmJpbmRUb29sdGlwKCBsYWJlbCApXG5cdFx0XHQuYWRkVG8oIHRoaXMubWFwICk7XG5cblx0XHRcdHRoaXMuJGVsLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdH0sXG5cdFx0bGF5ZXJfaXNfb3ZlcmxheTogZnVuY3Rpb24oICBrZXksIGxheWVyICkge1xuXHRcdFx0dmFyIHBhdHRlcm5zO1xuXG5cdFx0XHRpZiAoIGxheWVyLm9wdGlvbnMub3BhY2l0eSAmJiBsYXllci5vcHRpb25zLm9wYWNpdHkgPCAxICkge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdHBhdHRlcm5zID0gWydeKE9wZW5XZWF0aGVyTWFwfE9wZW5TZWFNYXApJyxcblx0XHRcdFx0J09wZW5NYXBTdXJmZXIuQWRtaW5Cb3VuZHMnLFxuXHRcdFx0XHQnU3RhbWVuLlRvbmVyKEh5YnJpZHxMaW5lc3xMYWJlbHMpJyxcblx0XHRcdFx0J0FjZXRhdGUuKGZvcmVncm91bmR8bGFiZWxzfHJvYWRzKScsXG5cdFx0XHRcdCdIaWxsU2hhZGluZycsXG5cdFx0XHRcdCdIeWRkYS5Sb2Fkc0FuZExhYmVscycsXG5cdFx0XHRcdCdeSnVzdGljZU1hcCcsXG5cdFx0XHRcdCdPcGVuSW5mcmFNYXAuKFBvd2VyfFRlbGVjb218UGV0cm9sZXVtfFdhdGVyKScsXG5cdFx0XHRcdCdPcGVuUHRNYXAnLFxuXHRcdFx0XHQnT3BlblJhaWx3YXlNYXAnLFxuXHRcdFx0XHQnT3BlbkZpcmVNYXAnLFxuXHRcdFx0XHQnU2FmZUNhc3QnLFxuXHRcdFx0XHQnQ2FydG9EQi5EYXJrTWF0dGVyT25seUxhYmVscycsXG5cdFx0XHRcdCdDYXJ0b0RCLlBvc2l0cm9uT25seUxhYmVscydcblx0XHRcdF07XG5cdFx0XHRyZXR1cm4ga2V5Lm1hdGNoKCcoJyArIHBhdHRlcm5zLmpvaW4oJ3wnKSArICcpJykgIT09IG51bGw7XG5cdFx0fSxcblx0XHRyZXNldF9sYXllcnM6ZnVuY3Rpb24oKSB7XG5cdFx0XHQvLyBzZXQgdGhpcy4kZWwuZGF0YSgpLm1hcExheWVycyBzbyBpdCBmaXRzXG5cdFx0XHQvLyByZW1vdmUgYWxsIG1hcCBsYXllcnNcblx0XHRcdHRoaXMubWFwLmVhY2hMYXllcihmdW5jdGlvbihsYXllcil7XG5cdFx0XHRcdGlmICggbGF5ZXIuY29uc3RydWN0b3IgPT09IEwuVGlsZUxheWVyLlByb3ZpZGVyICkge1xuXHRcdFx0XHRcdGxheWVyLnJlbW92ZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KVxuXHRcdFx0Ly8gcmVtb3ZlIGxheWVyIHN0b3JlXG5cdFx0XHR0aGlzLiRsYXllclN0b3JlKCkucmVtb3ZlKCk7XG5cblx0XHRcdC8vIHJlbW92ZSBsYXllciBjb250cm9sXG5cdFx0XHQhISB0aGlzLmxheWVyc0NvbnRyb2wgJiYgdGhpcy5sYXllcnNDb250cm9sLnJlbW92ZSgpXG5cdFx0fSxcblx0XHRpbml0X2xheWVyczpmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0c2VsZWN0ZWRMYXllcnMgPSBbXSxcblx0XHRcdFx0YmFzZUxheWVycyA9IHt9LFxuXHRcdFx0XHRvdmVybGF5cyA9IHt9LFxuXHRcdFx0XHRtYXBMYXllcnMgPSB7fSxcblx0XHRcdFx0ZWRpdG9yX2NvbmZpZyA9IHRoaXMuJGVsLmRhdGEoKS5lZGl0b3JDb25maWcsXG5cdFx0XHRcdGlzX29taXR0ZWQgPSBmdW5jdGlvbihrZXkpIHtcblx0XHRcdFx0XHRyZXR1cm4ga2V5ID09PSBudWxsIHx8ICggISEgZWRpdG9yX2NvbmZpZy5yZXN0cmljdF9wcm92aWRlcnMgJiYgZWRpdG9yX2NvbmZpZy5yZXN0cmljdF9wcm92aWRlcnMuaW5kZXhPZigga2V5ICkgPT09IC0xICk7XG5cdFx0XHRcdH0sXG5cdFx0XHRcdHNldHVwTWFwID0gZnVuY3Rpb24oIHZhbCwga2V5ICl7XG5cdFx0XHRcdFx0dmFyIGxheWVyLCBsYXllcl9jb25maWc7XG5cdFx0XHRcdFx0aWYgKCBfLmlzT2JqZWN0KHZhbCkgKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gJC5lYWNoKCB2YWwsIHNldHVwTWFwICk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCBpc19vbWl0dGVkKGtleSkgKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICggISEgbWFwTGF5ZXJzWyBrZXkgXSApIHtcblx0XHRcdFx0XHRcdGxheWVyID0gbWFwTGF5ZXJzWyBrZXkgXTtcblx0XHRcdFx0XHRcdHNlbGYubWFwLmFkZExheWVyKGxheWVyKVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0XHRsYXllciA9IEwudGlsZUxheWVyLnByb3ZpZGVyKCBrZXkgLyosIGxheWVyX2NvbmZpZy5vcHRpb25zKi8gKTtcblx0XHRcdFx0XHRcdH0gY2F0Y2goZXgpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0bGF5ZXIucHJvdmlkZXJLZXkgPSBrZXk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCBzZWxmLmxheWVyX2lzX292ZXJsYXkoIGtleSwgbGF5ZXIgKSApIHtcblx0XHRcdFx0XHRcdG92ZXJsYXlzW2tleV0gPSBsYXllcjtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0YmFzZUxheWVyc1trZXldID0gbGF5ZXI7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCBzZWxlY3RlZExheWVycy5pbmRleE9mKCBrZXkgKSAhPT0gLTEgKSB7XG5cdFx0XHRcdFx0XHRzZWxmLm1hcC5hZGRMYXllcihsYXllcik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9O1xuXG5cdFx0XHRzZWxlY3RlZExheWVycyA9IHRoaXMuJGVsLmRhdGEoKS5tYXBMYXllcnM7IC8vIHNob3VsZCBiZSBsYXllciBzdG9yZSB2YWx1ZVxuXG5cdFx0XHQvLyBmaWx0ZXIgYXZhaWFsYmxlIGxheWVycyBpbiBmaWVsZCB2YWx1ZVxuXHRcdFx0aWYgKCBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycyAhPT0gZmFsc2UgJiYgXy5pc0FycmF5KCBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycyApICkge1xuXHRcdFx0XHRzZWxlY3RlZExheWVycyA9IHNlbGVjdGVkTGF5ZXJzLmZpbHRlciggZnVuY3Rpb24oZWwpIHtcblx0XHRcdFx0XHRyZXR1cm4gZWRpdG9yX2NvbmZpZy5yZXN0cmljdF9wcm92aWRlcnMuaW5kZXhPZiggZWwgKSAhPT0gLTE7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBzZXQgZGVmYXVsdCBsYXllclxuXHRcdFx0aWYgKCAhIHNlbGVjdGVkTGF5ZXJzLmxlbmd0aCApIHtcblxuXHRcdFx0XHRzZWxlY3RlZExheWVycyA9IE9iamVjdC5rZXlzKCBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycyApLnNsaWNlKCAwLCAxICk7XG5cblx0XHRcdH1cblxuXHRcdFx0Ly8gZWRpdGFibGUgbGF5ZXJzIVxuXHRcdFx0aWYgKCBlZGl0b3JfY29uZmlnLmFsbG93X3Byb3ZpZGVycyApIHtcblxuXHRcdFx0XHQkKCc8ZGl2IGNsYXNzPVwiYWNmLW9zbS1sYXllcnNcIj48L2Rpdj4nKS5pbnNlcnRBZnRlciggdGhpcy4kZWwgKTtcblxuXHRcdFx0XHR0aGlzLm1hcC5vbiggJ2Jhc2VsYXllcmNoYW5nZSBsYXllcmFkZCBsYXllcnJlbW92ZScsIGZ1bmN0aW9uKGUpe1xuXG5cdFx0XHRcdFx0aWYgKCAhIGUubGF5ZXIucHJvdmlkZXJLZXkpIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0dmFyICRsYXllclN0b3JlID0gc2VsZi4kbGF5ZXJTdG9yZSgpLFxuXHRcdFx0XHRcdFx0JHRlbXBsYXRlID0gc2VsZi4kcGFyZW50KCkuZmluZCgnW2RhdGEtaWQ9XCJfX29zbV9sYXllcl90ZW1wbGF0ZV9fXCJdJyk7XG5cblx0XHRcdFx0XHQkbGF5ZXJTdG9yZS5odG1sKCcnKTtcblxuXHRcdFx0XHRcdHNlbGYubWFwLmVhY2hMYXllcihmdW5jdGlvbihsYXllcikge1xuXHRcdFx0XHRcdFx0dmFyICRsYXllcklucHV0O1xuXHRcdFx0XHRcdFx0aWYgKCAhIGxheWVyLnByb3ZpZGVyS2V5ICkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHQvKlxuXHRcdFx0XHRcdFx0JGxheWVySW5wdXQgPSAkdGVtcGxhdGUuY2xvbmUoKS5yZW1vdmVBdHRyKCdkYXRhLWlkJyk7XG5cdFx0XHRcdFx0XHQvKi9cblx0XHRcdFx0XHRcdCRsYXllcklucHV0ID0gJCgnPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBuYW1lPVwiJyArIGVkaXRvcl9jb25maWcubmFtZV9wcmVmaXggKyAnW2xheWVyc11bXVwiIC8+Jyk7XG5cdFx0XHRcdFx0XHQvLyovXG5cdFx0XHRcdFx0XHQkbGF5ZXJJbnB1dC52YWwoIGxheWVyLnByb3ZpZGVyS2V5ICk7XG5cblx0XHRcdFx0XHRcdGlmICggc2VsZi5sYXllcl9pc19vdmVybGF5KCBsYXllci5wcm92aWRlcktleSwgbGF5ZXIgKSApIHtcblx0XHRcdFx0XHRcdFx0JGxheWVyU3RvcmUuYXBwZW5kKCAkbGF5ZXJJbnB1dCApO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0JGxheWVyU3RvcmUucHJlcGVuZCggJGxheWVySW5wdXQgKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRzZWxmLiRlbC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdFx0fSApO1xuXHRcdFx0fVxuXG5cblx0XHRcdCQuZWFjaCggZWRpdG9yX2NvbmZpZy5yZXN0cmljdF9wcm92aWRlcnMsIHNldHVwTWFwICk7XG5cblx0XHRcdC8vIC4uLiBubyBsYXllciBlZGl0aW5nIGFsbG93ZWRcblx0XHRcdGlmICggdGhpcy4kbGF5ZXJTdG9yZSgpLmxlbmd0aCApIHtcblx0XHRcdFx0dGhpcy5sYXllcnNDb250cm9sID0gTC5jb250cm9sLmxheWVycyggYmFzZUxheWVycywgb3ZlcmxheXMsIHtcblx0XHRcdFx0XHRjb2xsYXBzZWQ6IHRydWUsXG5cdFx0XHRcdFx0aGlkZVNpbmdsZUJhc2U6IHRydWUsXG5cdFx0XHRcdH0pLmFkZFRvKHRoaXMubWFwKTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdGluaXRfZ2VvY29kZTpmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRlZGl0b3JfY29uZmlnID0gdGhpcy4kZWwuZGF0YSgpLmVkaXRvckNvbmZpZztcblxuXHRcdFx0dGhpcy5tYXAuX2NvbnRyb2xDb3JuZXJzWydhYm92ZSddID0gJCgnPGRpdiBjbGFzcz1cImFjZi1vc20tYWJvdmVcIj48L2Rpdj4nKS5pbnNlcnRCZWZvcmUoIHRoaXMuJGVsICkuZ2V0KDApO1xuXG5cdFx0XHR0aGlzLmdlb2NvZGVyID0gTC5Db250cm9sLmdlb2NvZGVyKHtcblx0XHRcdFx0Y29sbGFwc2VkOiBmYWxzZSxcblx0XHRcdFx0cG9zaXRpb246J2Fib3ZlJyxcblx0XHRcdFx0cGxhY2Vob2xkZXI6J1NlYXJjaC4uLicsXG5cdFx0XHRcdGVycm9yTWVzc2FnZTonTm90aGluZyBmb3VuZC4uLicsXG5cdFx0XHRcdHNob3dSZXN1bHRJY29uczp0cnVlLFxuXHRcdFx0XHRzdWdnZXN0TWluTGVuZ3RoOjMsXG5cdFx0XHRcdHN1Z2dlc3RUaW1lb3V0OjI1MCxcblx0XHRcdFx0cXVlcnlNaW5MZW5ndGg6Myxcblx0XHRcdFx0ZGVmYXVsdE1hcmtHZW9jb2RlOmZhbHNlLFxuXHRcdFx0fSlcblx0XHRcdC5vbignbWFya2dlb2NvZGUnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHR2YXIgbGF0bG5nID0gIGUuZ2VvY29kZS5jZW50ZXIsXG5cdFx0XHRcdFx0ZWRpdG9yX2NvbmZpZyA9IHNlbGYuJGVsLmRhdGEoKS5lZGl0b3JDb25maWcsXG5cdFx0XHRcdFx0Y291bnRfbWFya2VycyA9IHNlbGYuJG1hcmtlcnMoKS5jaGlsZHJlbigpLm5vdCgnW2RhdGEtaWRdJykubGVuZ3RoLFxuXHRcdFx0XHRcdGxhYmVsID0gc2VsZi5fZ2V0X2dlb2NvZGVyX3Jlc3VsdF9sYWJlbCggWyBlLmdlb2NvZGUgXSwgbGF0bG5nICk7XG5cblx0XHRcdFx0aWYgKCBjb3VudF9tYXJrZXJzID09PSBmYWxzZSB8fCBjb3VudF9tYXJrZXJzIDwgZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyApIHtcblx0XHRcdFx0XHQvLyBhZGQgbWFya2VyIGlmIG5vIHJlc3RyaWN0aW9uIG9yIG1heCBtYXJrZXJzIG5vdCBleGNlZWRlZFxuXHRcdFx0XHRcdHNlbGYuYWRkX21hcmtlciggbGF0bG5nLCBsYWJlbCApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmICggZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyA9PT0gMSAmJiBjb3VudF9tYXJrZXJzID09PSAxICkge1xuXHRcdFx0XHRcdC8vIHVwZGF0ZSBzaW5nbGUgbWFya2VyXG5cdFx0XHRcdFx0bWFya2VyID0gc2VsZi5nZXRfZmlyc3RfbWFya2VyKCk7XG5cdFx0XHRcdFx0aWYgKCAhISBtYXJrZXIgKSB7XG5cdFx0XHRcdFx0XHRlbnRyeSA9IG1hcmtlci5vc21fY29udHJvbGxlcjtcblx0XHRcdFx0XHRcdG1hcmtlci5zZXRMYXRMbmcoIGxhdGxuZyApO1xuXHRcdFx0XHRcdFx0ZW50cnkudXBkYXRlX21hcmtlcl9nZW9jb2RlKCBsYWJlbCApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICggZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyA9PT0gMCApIHtcblx0XHRcdFx0XHRzZWxmLm1hcC5maXRCb3VuZHMoIGUuZ2VvY29kZS5iYm94ICk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c2VsZi5tYXAuc2V0VmlldyggbGF0bG5nLCBzZWxmLm1hcC5nZXRab29tKCkgKTsgLy8ga2VlcCB6b29tLCBtaWdodCBiZSBjb25mdXNpbmcgZWxzZVxuXHRcdFx0XHR9XG5cblx0XHRcdH0pXG5cdFx0XHQuYWRkVG8oIHRoaXMubWFwICk7XG5cblx0XHR9LFxuXHRcdGdldF9maXJzdF9tYXJrZXI6ZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgbWFya2VyID0gZmFsc2U7XG5cdFx0XHR0aGlzLm1hcC5lYWNoTGF5ZXIoZnVuY3Rpb24obGF5ZXIpe1xuXHRcdFx0XHRpZiAoIGxheWVyLmNvbnN0cnVjdG9yID09PSBMLk1hcmtlciApIHtcblx0XHRcdFx0XHRtYXJrZXIgPSBsYXllcjtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIG1hcmtlcjtcblx0XHR9LFxuXHRcdHVwZGF0ZV92aXNpYmxlOiBmdW5jdGlvbigpIHtcblxuXHRcdFx0aWYgKCB0aGlzLnZpc2libGUgPT09IHRoaXMuJGVsLmlzKCc6dmlzaWJsZScpICkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH1cblxuXHRcdFx0dGhpcy52aXNpYmxlID0gdGhpcy4kZWwuaXMoJzp2aXNpYmxlJyk7XG5cblx0XHRcdGlmICggdGhpcy52aXNpYmxlICkge1xuXHRcdFx0XHR0aGlzLm1hcC5pbnZhbGlkYXRlU2l6ZSgpO1xuXHRcdFx0XHR0aGlzLmJpbmRfZXZlbnRzKCk7XG5cdFx0XHRcdHJldHVybiB0aGlzO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy51bmJpbmRfZXZlbnRzKCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdGluaXRfYWNmOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0dG9nZ2xlX2NiID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0Ly8gbm8gY2hhbmdlXG5cdFx0XHRcdFx0c2VsZi51cGRhdGVfdmlzaWJsZSgpO1xuXHRcdFx0XHR9O1xuXG5cdFx0XHQvLyBleHBhbmQvY29sbGFwc2UgYWNmIHNldHRpbmdcblx0XHRcdGFjZi5hZGRBY3Rpb24oICdzaG93JywgdG9nZ2xlX2NiICk7XG5cdFx0XHRhY2YuYWRkQWN0aW9uKCAnaGlkZScsIHRvZ2dsZV9jYiApO1xuXHRcdFx0YWNmLmFkZEFjdGlvbiggJ2Rpc2FibGVfZmllbGQnLCBmdW5jdGlvbigpe1xuXHRcdFx0XHRzZWxmLnVuYmluZF9ldmVudHMoKTtcblx0XHRcdH0gKTtcblxuXHRcdFx0Ly8gZXhwYW5kIHdwIG1ldGFib3hcblx0XHRcdCQoZG9jdW1lbnQpLm9uKCdwb3N0Ym94LXRvZ2dsZWQnLCB0b2dnbGVfY2IgKTtcblx0XHRcdCQoZG9jdW1lbnQpLm9uKCdjbGljaycsJy53aWRnZXQtdG9wIConLCB0b2dnbGVfY2IgKTtcblxuXG5cblx0XHR9LFxuXHRcdHVuYmluZF9ldmVudHM6ZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cdFx0XHRzZWxmLiRsYXQoKS5vZmYoJ2JsdXInKTtcblx0XHRcdHNlbGYuJGxuZygpLm9mZignYmx1cicpO1xuXHRcdFx0c2VsZi4kem9vbSgpLm9mZignYmx1cicpO1xuXHRcdFx0c2VsZi4kem9vbSgpLm9mZigna2V5dXAgZm9jdXMnKTtcblxuXHRcdFx0dGhpcy5tYXAub2ZmKCd6b29tZW5kJywgdGhpcy5tYXBfem9vbWVkLCB0aGlzICk7XG5cdFx0XHR0aGlzLm1hcC5vZmYoJ21vdmVlbmQnLCB0aGlzLm1hcF9tb3ZlZCwgdGhpcyApO1xuXHRcdH0sXG5cdFx0YmluZF9ldmVudHM6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLiRsYXQoKS5vbignYmx1cicsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHNlbGYudXBkYXRlX21hcCgpO1xuXHRcdFx0fSk7XG5cdFx0XHRzZWxmLiRsbmcoKS5vbignYmx1cicsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHNlbGYudXBkYXRlX21hcCgpO1xuXHRcdFx0fSk7XG5cdFx0XHRzZWxmLiR6b29tKCkub24oJ2JsdXInLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRzZWxmLnVwZGF0ZV9tYXAoKTtcblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLm1hcC5vbignem9vbWVuZCcsIHRoaXMubWFwX3pvb21lZCwgdGhpcyApO1xuXHRcdFx0dGhpcy5tYXAub24oJ21vdmVlbmQnLCB0aGlzLm1hcF9tb3ZlZCwgdGhpcyApO1xuXHRcdH0sXG5cdFx0dXBkYXRlX21hcDpmdW5jdGlvbigpIHtcblx0XHRcdGlmICggISB0aGlzLiRsYXQoKS52YWwoKSB8fCAhIHRoaXMuJGxuZygpLnZhbCgpICkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHR2YXIgbGF0bG5nID0gTC5sYXRMbmcoIHRoaXMuJGxhdCgpLnZhbCgpLCB0aGlzLiRsbmcoKS52YWwoKSApO1xuXHRcdFx0dGhpcy5tYXAuc2V0VmlldyggbGF0bG5nLCAgdGhpcy4kem9vbSgpLnZhbCgpICk7XG5cdFx0fSxcblx0XHRtYXBfbW92ZWQ6ZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgY2VudGVyID0gdGhpcy5tYXAuZ2V0Q2VudGVyKCk7XG5cdFx0XHR0aGlzLiRsYXQoKS52YWwoY2VudGVyLmxhdCk7XG5cdFx0XHR0aGlzLiRsbmcoKS52YWwoY2VudGVyLmxuZyk7XG5cdFx0XHR0aGlzLiRlbC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHR9LFxuXHRcdG1hcF96b29tZWQ6ZnVuY3Rpb24oZSl7XG5cdFx0XHR0aGlzLiR6b29tKCkudmFsKCB0aGlzLm1hcC5nZXRab29tKCkgKTtcblx0XHRcdHRoaXMuJGVsLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdH1cblx0fSk7XG5cblxuXHQkKGRvY3VtZW50KVxuXHRcdC5vbignYWNmLW9zbS1tYXAtaW5pdCcsZnVuY3Rpb24oIGUsIG1hcCApIHtcblx0XHRcdC8vIGRvbid0IGluaXQgaW4gcmVwZWF0ZXIgdGVtcGxhdGVzXG5cdFx0XHRpZiAoICQoZS50YXJnZXQpLmNsb3Nlc3QoJ1tkYXRhLWlkPVwiYWNmY2xvbmVpbmRleFwiXScpLmxlbmd0aCApIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHQvLyB3cmFwIG9zbS5maWVsZCBiYWNrYm9uZSB2aWV3IGFyb3VuZCBlZGl0b3JzXG5cdFx0XHRpZiAoICQoZS50YXJnZXQpLmlzKCdbZGF0YS1lZGl0b3ItY29uZmlnXScpICkge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0KGZ1bmN0aW9uIGNoZWNrVmlzKCl7XG5cdFx0XHRcdFx0aWYgKCAhICQoZS50YXJnZXQpLmlzKCc6dmlzaWJsZScpICkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHNldFRpbWVvdXQoY2hlY2tWaXMsMjUwKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0bWFwLmludmFsaWRhdGVTaXplKCk7XG5cdFx0XHRcdH0pKCk7XG5cblx0XHRcdFx0JChlLnRhcmdldCkuZGF0YSggJ19tYXBfZWRpdG9yJywgbmV3IG9zbS5maWVsZCggeyBlbDogZS50YXJnZXQsIG1hcDogbWFwIH0gKSApO1xuXHRcdFx0fVxuXHRcdH0pXG5cdFx0Ly8gZmllbGQgc2V0dGluZ3Ncblx0XHQub24oJ2NoYW5nZScsJ1tkYXRhLXR5cGU9XCJvcGVuX3N0cmVldF9tYXBcIl0gW2RhdGEtbmFtZT1cInJldHVybl9mb3JtYXRcIl0gaW5wdXQnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0Ly8gZmluZCBtYXAgZmllbGRcblx0XHRcdCQoJ1tkYXRhLW5hbWU9XCJyZXR1cm5fZm9ybWF0XCJdIGlucHV0OmNoZWNrZWQnKS52YWwoKVxuXHRcdFx0dmFyICRtYXAgPSAkKHRoaXMpLmNsb3Nlc3QoJy5hY2YtZmllbGQtb2JqZWN0JykuZmluZCgnW2RhdGEtZWRpdG9yLWNvbmZpZ10nKSxcblx0XHRcdFx0ZWRpdG9yID0gJG1hcC5kYXRhKCAnX21hcF9lZGl0b3InICksXG5cdFx0XHRcdGNvbmYgPSAkbWFwLmRhdGEoJ2VkaXRvci1jb25maWcnKTtcblx0XHRcdC8vIG1hcFxuXHRcdFx0ZWRpdG9yLnJlc2V0X2xheWVycygpO1xuXHRcdFx0aWYgKCAkKHRoaXMpLnZhbCgpID09PSAnb3NtJyApIHtcblx0XHRcdFx0Ly8gc2V0IHByb3ZpZGVyIHJlc3RyaWN0aW9uIHRvIG9zbSBwcm92aWRlcnNcblx0XHRcdFx0Y29uZi5yZXN0cmljdF9wcm92aWRlcnMgPSBPYmplY3QudmFsdWVzKCBhcmcub3B0aW9ucy5vc21fbGF5ZXJzICk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBzZXQgcHJvdmlkZXIgcmVzdHJpY3Rpb24gdG8gb3NtIHByb3ZpZGVyc1xuXHRcdFx0XHRjb25mLnJlc3RyaWN0X3Byb3ZpZGVycyA9IE9iamVjdC52YWx1ZXMoIGFyZy5vcHRpb25zLmxlYWZsZXRfbGF5ZXJzICk7XG5cdFx0XHR9XG5cdFx0XHQkbWFwLmRhdGEoICdlZGl0b3ItY29uZmlnJywgY29uZiApO1xuXHRcdFx0ZWRpdG9yLmluaXRfbGF5ZXJzKCk7XG5cdFx0fSk7XG5cblx0Ly8gaW5pdCB3aGVuIGZpZWxkcyBnZXQgbG9hZGVkIC4uLlxuXHRhY2YuYWRkQWN0aW9uKCAnYXBwZW5kJywgZnVuY3Rpb24oKXtcblx0XHQkLmFjZl9sZWFmbGV0KCk7XG5cdH0pO1xuXHQvLyBpbml0IHdoZW4gZmllbGRzIHNodyAuLi5cblx0YWNmLmFkZEFjdGlvbiggJ3Nob3dfZmllbGQvdHlwZT1vcGVuX3N0cmVldF9tYXAnLCBmdW5jdGlvbiggZmllbGQgKXtcblx0ICAgIHZhciBlZGl0b3IgPSBmaWVsZC4kZWwuZmluZCgnW2RhdGEtZWRpdG9yLWNvbmZpZ10nKS5kYXRhKCAnX21hcF9lZGl0b3InICk7XG5cdCAgICBlZGl0b3IudXBkYXRlX3Zpc2libGUoKTtcblx0fSk7XG59KSggalF1ZXJ5LCBhY2Zfb3NtX2FkbWluICk7XG4iXX0=
