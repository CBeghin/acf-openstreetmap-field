!function(t,e){var i=e.options,a={};a.feature=wp.media.View.extend({template:_.template('<div tabindex="<%= data.i %>" class="osm-result"><%= data.result_text %><br /><small><%= data.properties.osm_value %></small></div>'),initialize:function(t){console.log(arguments),console.log(this,this.$el)},render:function(){return wp.media.View.prototpe.render.apply(this,arguments)}}),a.field=Backbone.View.extend({map:null,visible:null,events:{},$parent:function(){return this.$el.closest(".acf-field-settings,.acf-field-open-street-map")},$zoom:function(){return this.$parent().find('input[id$="-zoom"]')},$lat:function(){return this.$parent().find('input[id$="-center_lat"]')},$lng:function(){return this.$parent().find('input[id$="-center_lng"]')},$layerStore:function(){return this.$parent().find('input[id$="-leaflet_layers"]')},$address:function(){return this.$parent().find('input[id$="-address"]')},$mlat:function(){return this.$parent().find('input[id$="-marker_lat"]')},$mlng:function(){return this.$parent().find('input[id$="-marker_lng"]')},$results:function(){return this.$parent().find(".osm-results")},initialize:function(t){this.map=t.map,this.update_map(),this.init_layers(),this.init_marker(),this.init_acf(),this.update_visible()},init_marker:function(){var t=this;this.icon=L.divIcon({className:"osm-marker",html:"",iconSize:0}),this.marker=L.marker([this.$mlat().val(),this.$mlng().val()],{icon:this.icon,draggable:!0,title:this.$address().val()||""}).addTo(this.map),this.map.on("click",function(e){t.map_clicked.apply(t,[e])})},map_clicked:function(t){t.latlng;this.set_marker(t.latlng)},set_marker:function(e){t(this.marker._icon).attr("title",this.marker.title),this.marker.setLatLng(e),this.$mlat().val(e.lat),this.$mlng().val(e.lng)},init_layers:function(){var e,a=this,n={},s={},r=function(t,e){var i;return!!(e.options.opacity&&e.options.opacity<1)||(i=["^(OpenWeatherMap|OpenSeaMap)","OpenMapSurfer.AdminBounds","Stamen.Toner(Hybrid|Lines|Labels)","Acetate.(foreground|labels|roads)","HillShading","Hydda.RoadsAndLabels","^JusticeMap","OpenInfraMap.(Power|Telecom|Petroleum|Water)","OpenPtMap","OpenRailwayMap","OpenFireMap","SafeCast","CartoDB.DarkMatterOnlyLabels","CartoDB.PositronOnlyLabels"],null!==t.match("("+i.join("|")+")"))},o=function(l,u){var d,p;if(_.isObject(u))return t.each(u,o);p=i.layer_config[l.split(".")[0]]||{options:{}},d=L.tileLayer.provider(l,p.options),d.providerKey=l,r(l,d)?s[l]=d:n[l]=d,-1!==e.indexOf(l)&&a.map.addLayer(d)};e=this.$el.data().mapLayers,this.map.eachLayer(function(t){a.map.removeLayer(t)}),t.each(i.providers,o),this.$layerStore().length&&(this.layersControl=L.control.layers(n,s,{collapsed:!0,hideSingleBase:!0}).addTo(this.map))},update_visible:function(){return this.visible===this.$el.is(":visible")?this:(this.visible=this.$el.is(":visible"),this.visible?(this.map.invalidateSize(),this.bind_events(),this):(this.unbind_events(),this))},init_acf:function(){var e=this,i=function(){e.update_visible()};acf.addAction("show",i),acf.addAction("hide",i),t(document).on("postbox-toggled",i),this.map.on("zoomend",function(t){e.map_zoomed.apply(e,[t])}),this.map.on("moveend",function(t){e.map_moved.apply(e,[t])}),this.map.on("baselayerchange overlayadd overlayremove layeradd layerremove",function(t){var i=[];e.map.eachLayer(function(t){i.push(t.providerKey)}),e.$layerStore().val(JSON.stringify(i))})},unbind_events:function(){var t=this;t.$lat().off("blur"),t.$lng().off("blur"),t.$zoom().off("blur"),t.$zoom().off("keyup focus")},bind_events:function(){var t=this;t.$lat().on("blur",function(e){t.update_map()}),t.$lng().on("blur",function(e){t.update_map()}),t.$zoom().on("blur",function(e){t.update_map()}),t.$address().on("keyup focus",function(e){t.search(e)})},update_map:function(){var t=L.latLng(this.$lat().val(),this.$lng().val());this.map.setView(t,this.$zoom().val())},map_moved:function(t){var e=this.map.getCenter();this.$lat().val(e.lat),this.$lng().val(e.lng)},map_zoomed:function(t){this.$zoom().val(this.map.getZoom())},search:function(t){var e=this,i={};return void 0!==this._wait_address&&(clearTimeout(this._wait_address),delete this._wait_address),this.clear_results(),"keyup"==t.type&&27==t.originalEvent.keyCode?(t.preventDefault(),this.$results().html(""),this.$address().blur(),!1):""===this.$address().val()?void(this.marker.title=""):void(this._wait_address=setTimeout(function(){i={q:e.$address().val(),limit:5,lon:e.$lng().val(),lat:e.$lat().val()},e.ajax_get("https://photon.komoot.de/api/",i,function(t){e.build_results(t),delete this._wait_address})},666))},select_result:function(t){var e=L.latLng(t.coord[1],t.coord[0]);t.ext?this.map.fitBounds(L.latLngBounds(L.latLng(t.ext[1],t.ext[0]),L.latLng(t.ext[3],t.ext[2]))):this.map.setView(e,this.map.getZoom()),this.$address().val(t.text),this.clear_results(),this.marker.title=t.text,this.set_marker(e)},build_results:function(e){var i=this,a=e.features.length,n=this.$address().val(),s=e.features;this.clear_results(),a&&t.each(s,function(e,a){var s=i.format_result(a),r=s.replace(new RegExp("("+n.split(/[^a-z0-9]/).join("|")+")","gi"),"<strong>$1</strong>");r+="<br /><small>("+i.nice_words(a.properties.osm_value)+")</small>",t('<div tabindex="'+e+'" class="osm-result"></div>').html(r).appendTo(i.$results()).on("click",function(t){i.select_result({text:s,bounds:a.properties.extent,coord:a.geometry.coordinates})})})},clear_results:function(){this.$results().html("")},format_result:function(t){return this.get_result_words(t).join(", ")},get_result_words:function(e){var i=[],a=["name","street","housenumber","city","postcode","state","country"];return t.each(a,function(t,a){try{e.properties[a]&&i.push(e.properties[a])}catch(t){}}),Array.from(new Set(i))},nice_words:function(t){return t.split(/[\s_]/).map(function(t){return t[0].toUpperCase()+t.substring(1)}).join(" ")},ajax_get:function(e,i,a){var n=this;t.ajax({url:e,method:"get",data:i,success:function(t){"function"==typeof a&&a.apply(n,[t])}})}}),t(document).on("render-map",function(t,e){new a.field({el:t.target,map:e})})}(jQuery,acf_osm_admin);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1pbnB1dC1vc20uanMiXSwibmFtZXMiOlsiJCIsImFyZyIsIm9wdGlvbnMiLCJvc20iLCJmZWF0dXJlIiwid3AiLCJtZWRpYSIsIlZpZXciLCJleHRlbmQiLCJ0ZW1wbGF0ZSIsIl8iLCJpbml0aWFsaXplIiwiY29uc29sZSIsImxvZyIsImFyZ3VtZW50cyIsInRoaXMiLCIkZWwiLCJyZW5kZXIiLCJwcm90b3RwZSIsImFwcGx5IiwiZmllbGQiLCJCYWNrYm9uZSIsIm1hcCIsInZpc2libGUiLCJldmVudHMiLCIkcGFyZW50IiwiY2xvc2VzdCIsIiR6b29tIiwiZmluZCIsIiRsYXQiLCIkbG5nIiwiJGxheWVyU3RvcmUiLCIkYWRkcmVzcyIsIiRtbGF0IiwiJG1sbmciLCIkcmVzdWx0cyIsImNvbmYiLCJ1cGRhdGVfbWFwIiwiaW5pdF9sYXllcnMiLCJpbml0X21hcmtlciIsImluaXRfYWNmIiwidXBkYXRlX3Zpc2libGUiLCJzZWxmIiwiaWNvbiIsIkwiLCJkaXZJY29uIiwiY2xhc3NOYW1lIiwiaHRtbCIsImljb25TaXplIiwibWFya2VyIiwidmFsIiwiZHJhZ2dhYmxlIiwidGl0bGUiLCJhZGRUbyIsIm9uIiwiZSIsIm1hcF9jbGlja2VkIiwibGF0bG5nIiwic2V0X21hcmtlciIsImNvb3JkIiwiX2ljb24iLCJhdHRyIiwic2V0TGF0TG5nIiwibGF0IiwibG5nIiwic2VsZWN0ZWRMYXllcnMiLCJiYXNlTGF5ZXJzIiwib3ZlcmxheXMiLCJpc19vdmVybGF5Iiwia2V5IiwibGF5ZXIiLCJwYXR0ZXJucyIsIm9wYWNpdHkiLCJtYXRjaCIsImpvaW4iLCJzZXR1cE1hcCIsImxheWVyX2NvbmZpZyIsImlzT2JqZWN0IiwiZWFjaCIsInNwbGl0IiwidGlsZUxheWVyIiwicHJvdmlkZXIiLCJwcm92aWRlcktleSIsImluZGV4T2YiLCJhZGRMYXllciIsImRhdGEiLCJtYXBMYXllcnMiLCJlYWNoTGF5ZXIiLCJyZW1vdmVMYXllciIsInByb3ZpZGVycyIsImxlbmd0aCIsImxheWVyc0NvbnRyb2wiLCJjb250cm9sIiwibGF5ZXJzIiwiY29sbGFwc2VkIiwiaGlkZVNpbmdsZUJhc2UiLCJpcyIsImludmFsaWRhdGVTaXplIiwiYmluZF9ldmVudHMiLCJ1bmJpbmRfZXZlbnRzIiwidG9nZ2xlX2NiIiwiYWNmIiwiYWRkQWN0aW9uIiwiZG9jdW1lbnQiLCJtYXBfem9vbWVkIiwibWFwX21vdmVkIiwicHVzaCIsIkpTT04iLCJzdHJpbmdpZnkiLCJvZmYiLCJzZWFyY2giLCJsYXRMbmciLCJzZXRWaWV3IiwiY2VudGVyIiwiZ2V0Q2VudGVyIiwiZ2V0Wm9vbSIsIl93YWl0X2FkZHJlc3MiLCJjbGVhclRpbWVvdXQiLCJjbGVhcl9yZXN1bHRzIiwidHlwZSIsIm9yaWdpbmFsRXZlbnQiLCJrZXlDb2RlIiwicHJldmVudERlZmF1bHQiLCJibHVyIiwic2V0VGltZW91dCIsInEiLCJsaW1pdCIsImxvbiIsImFqYXhfZ2V0IiwicmVzcG9uc2UiLCJidWlsZF9yZXN1bHRzIiwic2VsZWN0X3Jlc3VsdCIsImV4dCIsImZpdEJvdW5kcyIsImxhdExuZ0JvdW5kcyIsInRleHQiLCJsZW4iLCJmZWF0dXJlcyIsImZlYXQiLCJpIiwiZWwiLCJmbXQiLCJmb3JtYXRfcmVzdWx0IiwicmVwbGFjZSIsIlJlZ0V4cCIsIm5pY2Vfd29yZHMiLCJwcm9wZXJ0aWVzIiwib3NtX3ZhbHVlIiwiYXBwZW5kVG8iLCJib3VuZHMiLCJleHRlbnQiLCJnZW9tZXRyeSIsImNvb3JkaW5hdGVzIiwiaGl0IiwiZ2V0X3Jlc3VsdF93b3JkcyIsImgiLCJwcm9wcyIsInByb3AiLCJlcnIiLCJBcnJheSIsImZyb20iLCJTZXQiLCJzdHIiLCJzIiwidG9VcHBlckNhc2UiLCJzdWJzdHJpbmciLCJ1cmwiLCJjYWxsYmFjayIsImFqYXgiLCJtZXRob2QiLCJzdWNjZXNzIiwidGFyZ2V0IiwialF1ZXJ5IiwiYWNmX29zbV9hZG1pbiJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBV0EsRUFBR0MsR0FDYixHQUFJ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QU11QixHQUFNdUYsVUFxQjNEakksRUFBRXVHLFVBQVVqRCxHQUFHLGFBQWEsU0FBVUMsRUFBR2pDLEdBQ3hDLEdBQUluQixHQUFJaUIsT0FBU3dILEdBQUlyRixFQUFFb0gsT0FBUXJKLElBQUtBLE9BZ0JsQ3NKLE9BQVFDIiwiZmlsZSI6ImFjZi1pbnB1dC1vc20ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCAkLCBhcmcgKXtcblx0dmFyIG9wdGlvbnMgPSBhcmcub3B0aW9ucyxcblx0XHRyZXN1bHRfdHBsID0gJzxkaXYgdGFiaW5kZXg9XCI8JT0gZGF0YS5pICU+XCIgY2xhc3M9XCJvc20tcmVzdWx0XCI+J1xuXHRcdFx0KyAnPCU9IGRhdGEucmVzdWx0X3RleHQgJT4nXG5cdFx0XHQrICc8YnIgLz48c21hbGw+PCU9IGRhdGEucHJvcGVydGllcy5vc21fdmFsdWUgJT48L3NtYWxsPidcblx0XHRcdCsgJzwvZGl2Pic7XG5cblx0dmFyIG9zbSA9IHtcblx0fTtcblx0b3NtLmZlYXR1cmUgPSB3cC5tZWRpYS5WaWV3LmV4dGVuZCh7XG5cdFx0dGVtcGxhdGU6IF8udGVtcGxhdGUoIHJlc3VsdF90cGwgKSxcblx0XHRpbml0aWFsaXplOmZ1bmN0aW9uKCBmZWF0dXJlICkge1xuXHRcdFx0Y29uc29sZS5sb2coYXJndW1lbnRzKTtcblx0XHRcdGNvbnNvbGUubG9nKHRoaXMsdGhpcy4kZWwpO1xuLy9cdFx0XHRodG1sID0gZm10LnJlcGxhY2UoIG5ldyBSZWdFeHAoXCIoXCIrcS5zcGxpdCgvW15hLXowLTldLykuam9pbignfCcpK1wiKVwiLCdnaScpLFwiPHN0cm9uZz4kMTwvc3Ryb25nPlwiKTtcblx0XHR9LFxuXHRcdHJlbmRlcjpmdW5jdGlvbigpIHtcblx0XHRcdHZhciByZXQgPSB3cC5tZWRpYS5WaWV3LnByb3RvdHBlLnJlbmRlci5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG5cdFx0XHRyZXR1cm4gcmV0O1xuXHRcdH1cblx0fSk7XG5cblxuXHRvc20uZmllbGQgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG5cdFx0Lypcblx0XHR0b2RvOlxuXHRcdC0gTWFwIExheWVyIHNlbGVjdG9yXG5cdFx0LSBzZXQgLyB1bnNldCBtYXJrZXJcblx0XHQqL1xuXHRcdG1hcDogbnVsbCxcblx0XHR2aXNpYmxlOiBudWxsLFxuXHRcdGV2ZW50czp7XG5cdFx0fSxcblxuXHRcdCRwYXJlbnQ6ZnVuY3Rpb24oKXtcblx0XHRcdHJldHVybiB0aGlzLiRlbC5jbG9zZXN0KCcuYWNmLWZpZWxkLXNldHRpbmdzLC5hY2YtZmllbGQtb3Blbi1zdHJlZXQtbWFwJylcblx0XHR9LFxuXHRcdCR6b29tIDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnaW5wdXRbaWQkPVwiLXpvb21cIl0nKTtcblx0XHR9LFxuXHRcdCRsYXQgOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCdpbnB1dFtpZCQ9XCItY2VudGVyX2xhdFwiXScpO1xuXHRcdH0sXG5cdFx0JGxuZyA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJ2lucHV0W2lkJD1cIi1jZW50ZXJfbG5nXCJdJyk7XG5cdFx0fSxcblx0XHQkbGF5ZXJTdG9yZTogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnaW5wdXRbaWQkPVwiLWxlYWZsZXRfbGF5ZXJzXCJdJyk7XG5cdFx0fSxcblx0XHQkYWRkcmVzczogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnaW5wdXRbaWQkPVwiLWFkZHJlc3NcIl0nKTtcblx0XHR9LFxuXHRcdCRtbGF0IDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnaW5wdXRbaWQkPVwiLW1hcmtlcl9sYXRcIl0nKTtcblx0XHR9LFxuXHRcdCRtbG5nIDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnaW5wdXRbaWQkPVwiLW1hcmtlcl9sbmdcIl0nKTtcblx0XHR9LFxuXHRcdCRyZXN1bHRzIDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnLm9zbS1yZXN1bHRzJyk7XG5cdFx0fSxcblx0XHRpbml0aWFsaXplOmZ1bmN0aW9uKGNvbmYpIHtcblx0XHQvL1x0dGhpcy4kZWxcdFx0PSB0aGlzLmF0dHJpYnV0ZXMuJGVsO1xuXG5cdFx0XHR0aGlzLm1hcFx0XHQ9IGNvbmYubWFwO1xuXG5cdFx0XHQvLyB0aGlzLiRtbGF0XHRcdD0gdGhpcy4kcGFyZW50LmZpbmQoJ1tkYXRhLXByb3A9XCJtYXJrZXJfbGF0XCJdJyk7XG5cdFx0XHQvLyB0aGlzLiRtbG5nXHRcdD0gdGhpcy4kcGFyZW50LmZpbmQoJ1tkYXRhLXByb3A9XCJtYXJrZXJfbG5nXCJdJyk7XG5cdFx0XHQvLyB0aGlzLiRhZGRyZXNzXHQ9IHRoaXMuJHBhcmVudC5maW5kKCdbZGF0YS1wcm9wPVwiYWRkcmVzc1wiXScpO1xuXHRcdFx0Ly8gdGhpcy4kcmVzdWx0c1x0PSB0aGlzLiRhZGRyZXNzLm5leHQoJy5vc20tcmVzdWx0cycpO1xuXG5cdFx0XHQvL3RoaXMuJGxheWVyc1x0PSB0aGlzLiRwYXJlbnQuZmluZCgnaW5wdXRbaWQkPVwiLWxlYWZsZXRfbGF5ZXJzXCJdJyk7XG5cblxuXHRcdFx0dGhpcy51cGRhdGVfbWFwKCk7IC8vIHNldCBtYXAgdG8gaW5wdXQgdmFsdWVzXG5cblx0XHRcdHRoaXMuaW5pdF9sYXllcnMoKTtcblxuXHRcdFx0dGhpcy5pbml0X21hcmtlcigpO1xuXG5cdFx0XHR0aGlzLmluaXRfYWNmKCk7XG5cblx0XHRcdHRoaXMudXBkYXRlX3Zpc2libGUoKTtcblx0XHR9LFxuXHRcdGluaXRfbWFya2VyOmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0Lypcblx0XHRcdEV2ZW50czpcblx0XHRcdGNsaWNrICBtYXA6IHJldmVyc2UgZ2VvY29kZSBhbiBzZXQgcmVzdWx0XG5cdFx0XHRjaGFuZ2UgcXVlcnk6IGdlb2NvZGUgcXVlcnksIGFkZC9zZXQgbWFya2VyXG5cdFx0XHQqL1xuXHRcdFx0dGhpcy5pY29uXHRcdD0gTC5kaXZJY29uKCB7IGNsYXNzTmFtZTogJ29zbS1tYXJrZXInLCBodG1sOicnLCBpY29uU2l6ZTowIH0gKTtcblx0XHRcdHRoaXMubWFya2VyXHRcdD0gTC5tYXJrZXIoXG5cdFx0XHRcdFsgdGhpcy4kbWxhdCgpLnZhbCgpLCB0aGlzLiRtbG5nKCkudmFsKCkgXSxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGljb246dGhpcy5pY29uLFxuXHRcdFx0XHRcdGRyYWdnYWJsZTp0cnVlLFxuXHRcdFx0XHRcdHRpdGxlOiB0aGlzLiRhZGRyZXNzKCkudmFsKCkgfHwgJycsXG5cdFx0XHRcdH1cblx0XHRcdCkuYWRkVG8oIHRoaXMubWFwICk7XG5cblx0XHRcdHRoaXMubWFwLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpeyBzZWxmLm1hcF9jbGlja2VkLmFwcGx5KHNlbGYsW2VdKTsgfSApO1xuXG5cdFx0fSxcblx0XHRtYXBfY2xpY2tlZDpmdW5jdGlvbihlKSB7XG5cdFx0XHR2YXIgY29vcmQgPSBlLmxhdGxuZztcblx0XHRcdHRoaXMuc2V0X21hcmtlciggZS5sYXRsbmcgKTtcblxuXHRcdH0sXG5cdFx0c2V0X21hcmtlcjpmdW5jdGlvbihjb29yZCl7XG5cdFx0XHQkKHRoaXMubWFya2VyLl9pY29uKS5hdHRyKCAndGl0bGUnLCB0aGlzLm1hcmtlci50aXRsZSApO1xuXHRcdFx0dGhpcy5tYXJrZXIuc2V0TGF0TG5nKGNvb3JkKTtcblx0XHRcdHRoaXMuJG1sYXQoKS52YWwoIGNvb3JkLmxhdCApO1xuXHRcdFx0dGhpcy4kbWxuZygpLnZhbCggY29vcmQubG5nICk7XG4vL1x0XHRcdHRoaXMubWFya2VyLmJpbmRUb29sdGlwKHRoaXMuJGFkZHJlc3MoKS52YWwoKSk7XG5cdFx0fSxcblx0XHRpbml0X2xheWVyczpmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0c2VsZWN0ZWRMYXllcnMsXG5cdFx0XHRcdGJhc2VMYXllcnMgPSB7fSxcblx0XHRcdFx0b3ZlcmxheXMgPSB7fSxcblx0XHRcdFx0aXNfb3ZlcmxheSA9IGZ1bmN0aW9uKCBrZXksIGxheWVyICkge1xuXG5cdFx0XHRcdFx0dmFyIHBhdHRlcm5zO1xuXG5cdFx0XHRcdFx0aWYgKCBsYXllci5vcHRpb25zLm9wYWNpdHkgJiYgbGF5ZXIub3B0aW9ucy5vcGFjaXR5IDwgMSApIHtcblx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRwYXR0ZXJucyA9IFsnXihPcGVuV2VhdGhlck1hcHxPcGVuU2VhTWFwKScsXG5cdFx0XHRcdFx0XHQnT3Blbk1hcFN1cmZlci5BZG1pbkJvdW5kcycsXG5cdFx0XHRcdFx0XHQnU3RhbWVuLlRvbmVyKEh5YnJpZHxMaW5lc3xMYWJlbHMpJyxcblx0XHRcdFx0XHRcdCdBY2V0YXRlLihmb3JlZ3JvdW5kfGxhYmVsc3xyb2FkcyknLFxuXHRcdFx0XHRcdFx0J0hpbGxTaGFkaW5nJyxcblx0XHRcdFx0XHRcdCdIeWRkYS5Sb2Fkc0FuZExhYmVscycsXG5cdFx0XHRcdFx0XHQnXkp1c3RpY2VNYXAnLFxuXHRcdFx0XHRcdFx0J09wZW5JbmZyYU1hcC4oUG93ZXJ8VGVsZWNvbXxQZXRyb2xldW18V2F0ZXIpJyxcblx0XHRcdFx0XHRcdCdPcGVuUHRNYXAnLFxuXHRcdFx0XHRcdFx0J09wZW5SYWlsd2F5TWFwJyxcblx0XHRcdFx0XHRcdCdPcGVuRmlyZU1hcCcsXG5cdFx0XHRcdFx0XHQnU2FmZUNhc3QnLFxuXHRcdFx0XHRcdFx0J0NhcnRvREIuRGFya01hdHRlck9ubHlMYWJlbHMnLFxuXHRcdFx0XHRcdFx0J0NhcnRvREIuUG9zaXRyb25Pbmx5TGFiZWxzJ1xuXHRcdFx0XHRcdF07XG5cdFx0XHRcdFx0cmV0dXJuIGtleS5tYXRjaCgnKCcgKyBwYXR0ZXJucy5qb2luKCd8JykgKyAnKScpICE9PSBudWxsO1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRpc19vbWl0dGVkID0gZnVuY3Rpb24oa2V5KSB7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRzZXR1cE1hcCA9IGZ1bmN0aW9uKCBrZXksIHZhbCApe1xuXHRcdFx0XHRcdHZhciBsYXllciwgbGF5ZXJfY29uZmlnO1xuXHRcdFx0XHRcdGlmICggXy5pc09iamVjdCh2YWwpICkge1xuXHRcdFx0XHRcdFx0cmV0dXJuICQuZWFjaCggdmFsLCBzZXR1cE1hcCApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAoIGlzX29taXR0ZWQoa2V5KSApIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0bGF5ZXJfY29uZmlnID0gb3B0aW9ucy5sYXllcl9jb25maWdbIGtleS5zcGxpdCgnLicpWzBdIF0gfHwge29wdGlvbnM6e319O1xuXHRcdFx0XHRcdGxheWVyID0gTC50aWxlTGF5ZXIucHJvdmlkZXIoIGtleSwgbGF5ZXJfY29uZmlnLm9wdGlvbnMgKTtcblx0XHRcdFx0XHRsYXllci5wcm92aWRlcktleSA9IGtleTtcblxuXHRcdFx0XHRcdGlmICggaXNfb3ZlcmxheSgga2V5LCBsYXllciApICkge1xuXHRcdFx0XHRcdFx0b3ZlcmxheXNba2V5XSA9IGxheWVyO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRiYXNlTGF5ZXJzW2tleV0gPSBsYXllcjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKCBzZWxlY3RlZExheWVycy5pbmRleE9mKCBrZXkgKSAhPT0gLTEgKXtcblx0XHRcdFx0XHRcdHNlbGYubWFwLmFkZExheWVyKGxheWVyKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH07XG5cblx0XHRcdHNlbGVjdGVkTGF5ZXJzID0gdGhpcy4kZWwuZGF0YSgpLm1hcExheWVycztcblxuXHRcdFx0Ly8ga2lsbCBhbGwgdGhlIG9sZCBsYXllcnMuLi5cblx0XHRcdHRoaXMubWFwLmVhY2hMYXllcihmdW5jdGlvbihsYXllcil7XG5cdFx0XHRcdHNlbGYubWFwLnJlbW92ZUxheWVyKGxheWVyKTtcblx0XHRcdH0pXG5cdFx0XHQvLyAuLi4gYW5kIGFkZCBuZXcgb25lc1xuXHRcdFx0JC5lYWNoKCBvcHRpb25zLnByb3ZpZGVycywgc2V0dXBNYXAgKTtcblxuXHRcdFx0Ly8gLi4uIG5vIGxheWVyIGVkaXRpbmcgYWxsb3dlZFxuXHRcdFx0aWYgKCAhIHRoaXMuJGxheWVyU3RvcmUoKS5sZW5ndGggKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5sYXllcnNDb250cm9sID0gTC5jb250cm9sLmxheWVycyggYmFzZUxheWVycywgb3ZlcmxheXMsIHtcblx0XHRcdFx0Y29sbGFwc2VkOiB0cnVlLFxuXHRcdFx0XHRoaWRlU2luZ2xlQmFzZTogdHJ1ZSxcblx0XHRcdH0pLmFkZFRvKHRoaXMubWFwKTtcblxuXHRcdH0sXG5cdFx0dXBkYXRlX3Zpc2libGU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKCB0aGlzLnZpc2libGUgPT09IHRoaXMuJGVsLmlzKCc6dmlzaWJsZScpICkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH1cblxuXHRcdFx0dGhpcy52aXNpYmxlID0gdGhpcy4kZWwuaXMoJzp2aXNpYmxlJyk7XG5cblx0XHRcdGlmICggdGhpcy52aXNpYmxlICkge1xuXHRcdFx0XHR0aGlzLm1hcC5pbnZhbGlkYXRlU2l6ZSgpO1xuXHRcdFx0XHR0aGlzLmJpbmRfZXZlbnRzKCk7XG5cdFx0XHRcdHJldHVybiB0aGlzO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy51bmJpbmRfZXZlbnRzKCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdGluaXRfYWNmOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0dG9nZ2xlX2NiID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0Ly8gbm8gY2hhbmdlXG5cdFx0XHRcdFx0c2VsZi51cGRhdGVfdmlzaWJsZSgpO1xuXHRcdFx0XHR9O1xuXG5cdFx0XHQvLyBleHBhbmQvY29sbGFwc2UgYWNmIHNldHRpbmdcblx0XHRcdGFjZi5hZGRBY3Rpb24oICdzaG93JywgdG9nZ2xlX2NiICk7XG5cdFx0XHRhY2YuYWRkQWN0aW9uKCAnaGlkZScsIHRvZ2dsZV9jYiApO1xuXG5cblxuXHRcdFx0Ly8gZXhwYW5kIGFjZiByZXBlYXRlclxuXHRcdFx0Ly8gLi4uXG5cblx0XHRcdC8vIGV4cGFuZCBhY2YgbGF5b3V0XG5cdFx0XHQvLyAuLi5cblxuXHRcdFx0Ly8gZXhwYW5kIHdwIG1ldGFib3hcblx0XHRcdCQoZG9jdW1lbnQpLm9uKCdwb3N0Ym94LXRvZ2dsZWQnLHRvZ2dsZV9jYilcblxuXG5cdFx0XHR0aGlzLm1hcC5vbignem9vbWVuZCcsIGZ1bmN0aW9uKGUpeyBzZWxmLm1hcF96b29tZWQuYXBwbHkoIHNlbGYsIFtlXSApOyB9ICk7XG5cdFx0XHR0aGlzLm1hcC5vbignbW92ZWVuZCcsIGZ1bmN0aW9uKGUpeyBzZWxmLm1hcF9tb3ZlZC5hcHBseSggc2VsZiwgW2VdICk7IH0gKTtcblxuXHRcdFx0dGhpcy5tYXAub24oICdiYXNlbGF5ZXJjaGFuZ2Ugb3ZlcmxheWFkZCBvdmVybGF5cmVtb3ZlIGxheWVyYWRkIGxheWVycmVtb3ZlJywgZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHZhciBsYXllcnMgPSBbXTtcblx0XHRcdFx0c2VsZi5tYXAuZWFjaExheWVyKGZ1bmN0aW9uKGxheWVyKSB7XG5cdFx0XHRcdFx0bGF5ZXJzLnB1c2gobGF5ZXIucHJvdmlkZXJLZXkpO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0c2VsZi4kbGF5ZXJTdG9yZSgpLnZhbCggSlNPTi5zdHJpbmdpZnkoIGxheWVycyApICk7XG5cdFx0XHR9ICk7XG5cdFx0fSxcblx0XHR1bmJpbmRfZXZlbnRzOmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0c2VsZi4kbGF0KCkub2ZmKCdibHVyJyk7XG5cdFx0XHRzZWxmLiRsbmcoKS5vZmYoJ2JsdXInKTtcblx0XHRcdHNlbGYuJHpvb20oKS5vZmYoJ2JsdXInKTtcblx0XHRcdHNlbGYuJHpvb20oKS5vZmYoJ2tleXVwIGZvY3VzJyk7XG5cblx0XHR9LFxuXHRcdGJpbmRfZXZlbnRzOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi4kbGF0KCkub24oJ2JsdXInLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRzZWxmLnVwZGF0ZV9tYXAoKTtcblx0XHRcdH0pO1xuXHRcdFx0c2VsZi4kbG5nKCkub24oJ2JsdXInLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRzZWxmLnVwZGF0ZV9tYXAoKTtcblx0XHRcdH0pO1xuXHRcdFx0c2VsZi4kem9vbSgpLm9uKCdibHVyJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0c2VsZi51cGRhdGVfbWFwKCk7XG5cdFx0XHR9KTtcblx0XHRcdHNlbGYuJGFkZHJlc3MoKS5vbigna2V5dXAgZm9jdXMnLCBmdW5jdGlvbihlKXtcblx0XHRcdFx0c2VsZi5zZWFyY2goZSk7XG5cdFx0XHR9ICk7XG5cblxuLy9cdFx0XHR0aGlzLmxpc3RlblRvKCB0aGlzLiRhZGRyZXNzLCAna2V5dXAgZm9jdXMnLCB0aGlzLnNlYXJjaCApO1xuXG5cdFx0XHQvLyB0aGlzLiR0aWxlcy5vbignY2hhbmdlJywgZG9fbGF5ZXJzIClcblx0XHRcdC8vIFx0LnByZXYoJ2lucHV0Jykub24oJ2NoYW5nZScsIGRvX2xheWVycyApO1xuXG5cdFx0fSxcblx0XHR1cGRhdGVfbWFwOmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIGxhdGxuZyA9IEwubGF0TG5nKCB0aGlzLiRsYXQoKS52YWwoKSwgdGhpcy4kbG5nKCkudmFsKCkgKTtcblx0XHRcdHRoaXMubWFwLnNldFZpZXcoIGxhdGxuZywgIHRoaXMuJHpvb20oKS52YWwoKSApO1xuXHRcdH0sXG5cdFx0bWFwX21vdmVkOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dmFyIGNlbnRlciA9IHRoaXMubWFwLmdldENlbnRlcigpO1xuXHRcdFx0dGhpcy4kbGF0KCkudmFsKGNlbnRlci5sYXQpO1xuXHRcdFx0dGhpcy4kbG5nKCkudmFsKGNlbnRlci5sbmcpO1xuXHRcdH0sXG5cdFx0bWFwX3pvb21lZDpmdW5jdGlvbihlKXtcblx0XHRcdHRoaXMuJHpvb20oKS52YWwoIHRoaXMubWFwLmdldFpvb20oKSApO1xuXHRcdH0sXG5cblx0XHRzZWFyY2g6ZnVuY3Rpb24oZSl7XG5cdFx0XHQvLyBnZW9jb2RlXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdGRhdGEgPSB7fTtcblx0XHRcdGlmICggJ3VuZGVmaW5lZCcgIT09IHR5cGVvZiB0aGlzLl93YWl0X2FkZHJlc3MgKSB7XG5cdFx0XHRcdGNsZWFyVGltZW91dCh0aGlzLl93YWl0X2FkZHJlc3MpO1xuXHRcdFx0XHRkZWxldGUgdGhpcy5fd2FpdF9hZGRyZXNzO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBpZiAoISEgZGF0YVsnZyddICYmIGRhdGFbJ2cnXSA9PT0gdGhpcy4kYWRkcmVzcygpLnZhbCgpICkge1xuXHRcdFx0Ly8gXHRyZXR1cm47XG5cdFx0XHQvLyB9XG5cblx0XHRcdHRoaXMuY2xlYXJfcmVzdWx0cygpO1xuXG5cdFx0XHRpZiAoIGUudHlwZT09J2tleXVwJyAmJiAyNyA9PSBlLm9yaWdpbmFsRXZlbnQua2V5Q29kZSApIHsgLy8gZXNjXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0dGhpcy4kcmVzdWx0cygpLmh0bWwoJycpO1xuXHRcdFx0XHR0aGlzLiRhZGRyZXNzKCkuYmx1cigpO1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0XHRpZiAoICcnID09PSB0aGlzLiRhZGRyZXNzKCkudmFsKCkgKSB7XG5cdFx0XHRcdHRoaXMubWFya2VyLnRpdGxlID0gJyc7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5fd2FpdF9hZGRyZXNzID0gc2V0VGltZW91dCggZnVuY3Rpb24oKXtcblxuXHRcdFx0XHRkYXRhID0ge1xuXHRcdFx0XHRcdHE6c2VsZi4kYWRkcmVzcygpLnZhbCgpLFxuLy9cdFx0XHRcdFx0XHRsYW5nOidkZScsIC3CtC8vIC0+IFdQLUxhbmchXG5cdFx0XHRcdFx0bGltaXQ6NSxcblx0XHRcdFx0XHRsb246c2VsZi4kbG5nKCkudmFsKCksXG5cdFx0XHRcdFx0bGF0OnNlbGYuJGxhdCgpLnZhbCgpLFxuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdHNlbGYuYWpheF9nZXQoJ2h0dHBzOi8vcGhvdG9uLmtvbW9vdC5kZS9hcGkvJyxkYXRhLCBmdW5jdGlvbihyZXNwb25zZSl7XG5cdFx0XHRcdFx0c2VsZi5idWlsZF9yZXN1bHRzKHJlc3BvbnNlKTtcblx0XHRcdFx0XHRkZWxldGUgdGhpcy5fd2FpdF9hZGRyZXNzO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0sIDY2NiApO1xuXG5cdFx0fSxcblxuXHRcdHNlbGVjdF9yZXN1bHQ6ZnVuY3Rpb24oZGF0YSl7XG5cdFx0XHR2YXIgbGF0bG5nID0gTC5sYXRMbmcoIGRhdGEuY29vcmRbMV0sIGRhdGEuY29vcmRbMF0gKTtcblxuXHRcdFx0aWYgKCBkYXRhLmV4dCApIHtcblxuXHRcdFx0XHR0aGlzLm1hcC5maXRCb3VuZHMoIEwubGF0TG5nQm91bmRzKFxuXHRcdFx0XHRcdEwubGF0TG5nKCBkYXRhLmV4dFsxXSwgZGF0YS5leHRbMF0gKSxcblx0XHRcdFx0XHRMLmxhdExuZyggZGF0YS5leHRbM10sIGRhdGEuZXh0WzJdIClcblx0XHRcdFx0KSApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5tYXAuc2V0VmlldyggbGF0bG5nLCB0aGlzLm1hcC5nZXRab29tKCkgKTtcblx0XHRcdH1cblx0XHRcdHRoaXMuJGFkZHJlc3MoKS52YWwoIGRhdGEudGV4dCApO1xuXHRcdFx0dGhpcy5jbGVhcl9yZXN1bHRzKCk7XG5cblx0XHRcdHRoaXMubWFya2VyLnRpdGxlID0gZGF0YS50ZXh0O1xuXHRcdFx0dGhpcy5zZXRfbWFya2VyKCBsYXRsbmcgKTtcblx0XHR9LFxuXHRcdGJ1aWxkX3Jlc3VsdHM6ZnVuY3Rpb24ocmVzcG9uc2Upe1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRpPTAsIGxlbiA9IHJlc3BvbnNlLmZlYXR1cmVzLmxlbmd0aCxcblx0XHRcdFx0cSA9IHRoaXMuJGFkZHJlc3MoKS52YWwoKSxcblx0XHRcdFx0ZmVhdCA9IHJlc3BvbnNlLmZlYXR1cmVzOy8vc29ydF9mdXp6eSggcmVzcG9uc2UuZmVhdHVyZXMsIHEgKTtcblxuXHRcdFx0dGhpcy5jbGVhcl9yZXN1bHRzKCk7XG5cblx0XHRcdGlmICggbGVuICkge1xuXHRcdFx0XHQkLmVhY2goIGZlYXQsIGZ1bmN0aW9uKGksZWwpe1xuXHRcdFx0XHRcdHZhciBmbXQgPSBzZWxmLmZvcm1hdF9yZXN1bHQoIGVsICksXG5cdFx0XHRcdFx0XHRodG1sID0gZm10LnJlcGxhY2UoIG5ldyBSZWdFeHAoXCIoXCIrcS5zcGxpdCgvW15hLXowLTldLykuam9pbignfCcpK1wiKVwiLCdnaScpLFwiPHN0cm9uZz4kMTwvc3Ryb25nPlwiKTtcblx0XHRcdFx0XHRodG1sICs9ICc8YnIgLz48c21hbGw+KCcgKyBzZWxmLm5pY2Vfd29yZHMoIGVsLnByb3BlcnRpZXMub3NtX3ZhbHVlICkgKyAnKTwvc21hbGw+JztcblxuXHRcdFx0XHRcdCQoJzxkaXYgdGFiaW5kZXg9XCInK2krJ1wiIGNsYXNzPVwib3NtLXJlc3VsdFwiPjwvZGl2PicpXG5cdFx0XHRcdFx0XHQuaHRtbCggaHRtbCApLmFwcGVuZFRvKCBzZWxmLiRyZXN1bHRzKCkgKS5vbignY2xpY2snLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdFx0c2VsZi5zZWxlY3RfcmVzdWx0KHtcblx0XHRcdFx0XHRcdFx0dGV4dDpmbXQsXG5cdFx0XHRcdFx0XHRcdGJvdW5kczplbC5wcm9wZXJ0aWVzLmV4dGVudCxcblx0XHRcdFx0XHRcdFx0Y29vcmQ6ZWwuZ2VvbWV0cnkuY29vcmRpbmF0ZXMsXG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHR9LFxuXHRcdGNsZWFyX3Jlc3VsdHM6ZnVuY3Rpb24oKXtcblx0XHRcdHRoaXMuJHJlc3VsdHMoKS5odG1sKCcnKTtcblx0XHR9LFxuXG5cdFx0Zm9ybWF0X3Jlc3VsdDogZnVuY3Rpb24oIGhpdCApIHtcblx0XHRcdHJldHVybiB0aGlzLmdldF9yZXN1bHRfd29yZHMoIGhpdCApLmpvaW4oJywgJyk7XG5cdFx0fSxcblxuXHRcdGdldF9yZXN1bHRfd29yZHM6IGZ1bmN0aW9uKCBoaXQgKSB7XG5cblx0XHRcdHZhciBoID0gW10sXG5cdFx0XHRcdHByb3BzID0gWyAnbmFtZScsJ3N0cmVldCcsJ2hvdXNlbnVtYmVyJywnY2l0eScsJ3Bvc3Rjb2RlJywnc3RhdGUnLCdjb3VudHJ5JyBdO1xuXHRcdFx0JC5lYWNoKHByb3BzLCBmdW5jdGlvbihpLHByb3ApIHtcblx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRpZiAoICEhIGhpdC5wcm9wZXJ0aWVzW3Byb3BdICkge1xuXHRcdFx0XHRcdFx0aC5wdXNoKGhpdC5wcm9wZXJ0aWVzW3Byb3BdKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gY2F0Y2goZXJyKXt9XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiBBcnJheS5mcm9tKG5ldyBTZXQoaCkpO1xuXHRcdH0sXG5cdFx0bmljZV93b3JkczogZnVuY3Rpb24oc3RyKSB7XG5cdFx0XHRyZXR1cm4gc3RyLnNwbGl0KC9bXFxzX10vKS5tYXAoZnVuY3Rpb24ocyl7IHJldHVybiBzWzBdLnRvVXBwZXJDYXNlKCkgKyBzLnN1YnN0cmluZygxKTsgfSkuam9pbignICcpO1xuXHRcdH0sXG5cdFx0Ly8gbWFwX2NsaWNrZWQ6ZnVuY3Rpb24oZSl7XG5cdFx0Ly8gXHQvLyByZXZlcnNlIGdlb2NvZGVcblx0XHQvLyBcdHZhciBjb29yZCA9IGUubGF0bG5nO1xuXHRcdC8vXG5cdFx0Ly8gXHR0aGlzLmFqYXhfZ2V0KCdodHRwczovL3Bob3Rvbi5rb21vb3QuZGUvcmV2ZXJzZScsIHtcblx0XHQvLyBcdFx0bG9uOmNvb3JkLmxuZyxcblx0XHQvLyBcdFx0bGF0OmNvb3JkLmxhdCxcblx0XHQvLyBcdH0sIGZ1bmN0aW9uKHJlc3BvbnNlKXtcblx0XHQvLyBcdFx0dmFyIGk9MCxcblx0XHQvLyBcdFx0XHRsZW4gPSByZXNwb25zZS5mZWF0dXJlcy5sZW5ndGg7XG5cdFx0Ly8gXHRcdGNvbnNvbGUubG9nKHJlc3BvbnNlKVxuXHRcdC8vIFx0XHRmb3IgKGk7aTxsZW47aSsrKXtcblx0XHQvLyBcdFx0XHR2YXIgcmVzdWx0ID0gbmV3IG9zbS5mZWF0dXJlKCByZXNwb25zZS5mZWF0dXJlc1tpXSApO1xuXHRcdC8vIFx0XHRcdHRoaXMubWFya2VyLnRpdGxlID0gcmVzdWx0LmZvcm1hdCgpO1xuXHRcdC8vIFx0XHRcdHRoaXMuJGFkZHJlc3MoKS52YWwoIHJlc3VsdC5mb3JtYXQoKSApO1xuXHRcdC8vIFx0XHRcdHRoaXMuc2V0X21hcmtlciggY29vcmQgKTtcblx0XHQvLyBcdFx0XHRicmVhaztcblx0XHQvLyBcdFx0fVxuXHRcdC8vIFx0fSApO1xuXHRcdC8vXG5cdFx0Ly8gXHR0aGlzLnNldF9tYXJrZXIoIGUubGF0bG5nICk7XG5cdFx0Ly8gfSxcblx0XHQvLyBzZXRfbWFya2VyOmZ1bmN0aW9uKGNvb3JkKXtcblx0XHQvLyBcdCQodGhpcy5tYXJrZXIuX2ljb24pLmF0dHIoICd0aXRsZScsIHRoaXMubWFya2VyLnRpdGxlICk7XG5cdFx0Ly8gXHR0aGlzLm1hcmtlci5zZXRMYXRMbmcoY29vcmQpO1xuXHRcdC8vIFx0dGhpcy4kbWxhdCgpLnZhbCggY29vcmQubGF0ICk7XG5cdFx0Ly8gXHR0aGlzLiRtbG5nKCkudmFsKCBjb29yZC5sbmcgKTtcblx0XHQvLyB9LFxuXHRcdGFqYXhfZ2V0OiBmdW5jdGlvbiggdXJsLCBkYXRhLCBjYWxsYmFjaykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0JC5hamF4KHtcblx0XHRcdFx0dXJsOnVybCxcblx0XHRcdFx0bWV0aG9kOidnZXQnLFxuXHRcdFx0XHRkYXRhOmRhdGEsXG5cdFx0XHRcdHN1Y2Nlc3M6ZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0XHQnZnVuY3Rpb24nID09PSB0eXBlb2YgY2FsbGJhY2sgJiYgY2FsbGJhY2suYXBwbHkoc2VsZixbcmVzcG9uc2VdKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHR9LFxuXG5cdH0pO1xuXG5cdC8qXG5cdCAqICByZWFkeSBhcHBlbmQgKEFDRjUpXG5cdCAqXG5cdCAqICBUaGVzZSBhcmUgMiBldmVudHMgd2hpY2ggYXJlIGZpcmVkIGR1cmluZyB0aGUgcGFnZSBsb2FkXG5cdCAqICByZWFkeSA9IG9uIHBhZ2UgbG9hZCBzaW1pbGFyIHRvICQoZG9jdW1lbnQpLnJlYWR5KClcblx0ICogIGFwcGVuZCA9IG9uIG5ldyBET00gZWxlbWVudHMgYXBwZW5kZWQgdmlhIHJlcGVhdGVyIGZpZWxkXG5cdCAqXG5cdCAqICBAdHlwZVx0ZXZlbnRcblx0ICogIEBkYXRlXHQyMC8wNy8xM1xuXHQgKlxuXHQgKiAgQHBhcmFtXHQkZWwgKGpRdWVyeSBzZWxlY3Rpb24pIHRoZSBqUXVlcnkgZWxlbWVudCB3aGljaCBjb250YWlucyB0aGUgQUNGIGZpZWxkc1xuXHQgKiAgQHJldHVyblx0bi9hXG5cdCAqL1xuXHQkKGRvY3VtZW50KS5vbigncmVuZGVyLW1hcCcsZnVuY3Rpb24oIGUsIG1hcCApe1xuXHRcdG5ldyBvc20uZmllbGQoIHsgZWw6IGUudGFyZ2V0LCBtYXA6IG1hcCB9ICk7XG5cdH0pO1xuXG5cblx0Ly8gYWNmLmFkZF9hY3Rpb24oJ3JlYWR5IGFwcGVuZCcsIGZ1bmN0aW9uKCAkZWwgKXtcblx0Ly9cblx0Ly8gXHQvLyBzZWFyY2ggJGVsIGZvciBmaWVsZHMgb2YgdHlwZSAnRklFTERfTkFNRSdcblx0Ly8gXHRhY2YuZ2V0X2ZpZWxkcyh7IHR5cGUgOiAnb3Blbl9zdHJlZXRfbWFwJ30sICRlbCkuZWFjaChmdW5jdGlvbigpe1xuXHQvL1xuXHQvLyBcdFx0bmV3IG9zbS5maWVsZCggeyBlbDogdGhpcyB9ICk7XG5cdC8vXG5cdC8vIFx0fSk7XG5cdC8vXG5cdC8vIH0pO1xuXG5cbn0pKCBqUXVlcnksIGFjZl9vc21fYWRtaW4gKTtcbiJdfQ==
