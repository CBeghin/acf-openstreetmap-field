!function(e,t){var i=t.options,n={};n.MarkerList=Backbone.View.extend({}),n.MarkerEntry=Backbone.View.extend({tagName:"div",className:"osm-marker",events:{'click [data-name="locate-marker"]':"locate_marker",'click [data-name="remove-marker"]':"remove_marker"},initialize:function(e){return this.template=e.template,this.marker=e.marker,this},render:function(){return this.$el.html(this.template(this)),this.update_marker(),this},update_marker:function(){return this.$el.find('[id$="-marker-lat"]').val(this.marker.getLatLng().lat),this.$el.find('[id$="-marker-lng"]').val(this.marker.getLatLng().lng),this.$el.find('[id$="-marker-label"]').val(this.marker.options.title),this},locate_marker:function(){return this.marker._map.flyTo(this.marker.getLatLng()),e(this.marker._icon).focus(),this},remove_marker:function(e){return e.preventDefault(),this.marker.remove(),this}}),n.field=Backbone.View.extend({map:null,geocoder:null,visible:null,events:{},$parent:function(){return this.$el.closest(".acf-field-settings,.acf-field-open-street-map")},$zoom:function(){return this.$parent().find('input[id$="-zoom"]')},$lat:function(){return this.$parent().find('input[id$="-center_lat"]')},$lng:function(){return this.$parent().find('input[id$="-center_lng"]')},$layerStore:function(){return this.$parent().find('input[id$="-leaflet_layers"]')},$results:function(){return this.$parent().find(".osm-results")},$markers:function(){return this.$parent().find(".osm-markers")},initialize:function(e){return this.map=e.map,this.update_map(),this.init_layers(),this.init_markers(),this.init_acf(),this.update_visible(),this},_get_geocoder_result_label:function(t,i){var n=!1;return t.length?e.each(t,function(e,t){return n=t.html?t.html:t.name,!1}):n=i.lat.toString()+", "+i.lng.toString(),e(n).text().replace(/^(\s+)/g,"").replace(/(\s+)$/g,"")},init_markers:function(){var t=this;this.icon=new L.DivIcon({html:"",className:"osm-marker-icon"}),this.init_geocode(),this.map.on("click",function(e){var i=e.latlng;t.geocoder.options.geocoder.reverse(e.latlng,t.map.getZoom(),function(e){var n=t._get_geocoder_result_label(e,i);t.add_marker(i,n)},t)}),this.map.on("layeradd",function(i){if(i.layer.constructor===L.Marker){var a=t.$markers().find('[data-id="__osm_marker_template__"]').html().split("__osm_marker_template__").join("<%= id %>"),r=new n.MarkerEntry({controller:this,marker:i.layer,id:acf.uniqid(),template:_.template(a)});r.render().$el.prependTo(t.$markers()),i.layer.setIcon(t.icon).on("click",function(e){this.remove()}).on("remove",function(e){r.$el.remove()}).on("dragend",function(i){t.geocoder.options.geocoder.reverse(this.getLatLng(),t.map.getZoom(),function(i){var n=t._get_geocoder_result_label(i,this.getLatLng());this.unbindTooltip(),this.bindTooltip(n),this.options.title=n,e(this._icon).attr("title",n),r.update_marker()},this)}).dragging.enable()}})},add_marker:function(e,t){L.marker(e,{title:t,icon:this.icon}).bindTooltip(t).addTo(this.map)},layer_is_overlay:function(e,t){var i;return!!(t.options.opacity&&t.options.opacity<1)||(i=["^(OpenWeatherMap|OpenSeaMap)","OpenMapSurfer.AdminBounds","Stamen.Toner(Hybrid|Lines|Labels)","Acetate.(foreground|labels|roads)","HillShading","Hydda.RoadsAndLabels","^JusticeMap","OpenInfraMap.(Power|Telecom|Petroleum|Water)","OpenPtMap","OpenRailwayMap","OpenFireMap","SafeCast","CartoDB.DarkMatterOnlyLabels","CartoDB.PositronOnlyLabels"],null!==e.match("("+i.join("|")+")"))},init_layers:function(){var t=this,n=[],a={},r={},o=function(e){return null===e},s=function(l,d){var c,m;if(_.isObject(d))return e.each(d,s);o(l)||(m=i.layer_config[l.split(".")[0]]||{options:{}},c=L.tileLayer.provider(l,m.options),c.providerKey=l,console.log(n),t.layer_is_overlay(l,c)?r[l]=c:a[l]=c,-1!==n.indexOf(l)&&t.map.addLayer(c))};n=this.$el.data().mapLayers,e.each(i.providers,s),this.$layerStore().length&&(this.layersControl=L.control.layers(a,r,{collapsed:!0,hideSingleBase:!0}).addTo(this.map))},init_geocode:function(){var t=this;this.map._controlCorners.above=e('<div class="acf-osm-above"></div>').insertBefore(this.$el).get(0),this.geocoder=L.Control.geocoder({collapsed:!1,position:"above",placeholder:"Search...",errorMessage:"Nothing found...",showResultIcons:!0,suggestMinLength:3,suggestTimeout:250,queryMinLength:3,defaultMarkGeocode:!1}).on("markgeocode",function(e){var i=t._get_geocoder_result_label([e.geocode],e.geocode.center);t.add_marker(e.geocode.center,i),t.map.fitBounds(e.geocode.bbox)}).addTo(this.map),L.DomEvent.addListener(this.geocoder._input,"keydown",function(e){13===e.keyCode&&e.preventDefault()},this.geocoder)},update_visible:function(){return this.visible===this.$el.is(":visible")?this:(this.visible=this.$el.is(":visible"),this.visible?(this.map.invalidateSize(),this.bind_events(),this):(this.unbind_events(),this))},init_acf:function(){var t=this,i=function(){t.update_visible()};acf.addAction("show",i),acf.addAction("hide",i),e(document).on("postbox-toggled",i),this.map.on("zoomend",function(e){t.map_zoomed.apply(t,[e])}),this.map.on("moveend",function(e){t.map_moved.apply(t,[e])}),this.map.on("baselayerchange overlayadd overlayremove layeradd layerremove",function(e){var i=[];t.map.eachLayer(function(e){console.log(e),e.providerKey&&(t.layer_is_overlay(e.providerKey,e)?i.push(e.providerKey):i.unshift(e.providerKey))}),t.$layerStore().val(JSON.stringify(i))})},unbind_events:function(){var e=this;e.$lat().off("blur"),e.$lng().off("blur"),e.$zoom().off("blur"),e.$zoom().off("keyup focus")},bind_events:function(){var e=this;e.$lat().on("blur",function(t){e.update_map()}),e.$lng().on("blur",function(t){e.update_map()}),e.$zoom().on("blur",function(t){e.update_map()})},update_map:function(){if(this.$lat().val()&&this.$lng().val()){var e=L.latLng(this.$lat().val(),this.$lng().val());this.map.setView(e,this.$zoom().val())}},map_moved:function(e){var t=this.map.getCenter();this.$lat().val(t.lat),this.$lng().val(t.lng)},map_zoomed:function(e){this.$zoom().val(this.map.getZoom())}}),e(document).on("pre-render-map",function(e,t){new n.field({el:e.target,map:t})})}(jQuery,acf_osm_admin);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1pbnB1dC1vc20uanMiXSwibmFtZXMiOlsiJCIsImFyZyIsIm9wdGlvbnMiLCJvc20iLCJNYXJrZXJMaXN0IiwiQmFja2JvbmUiLCJWaWV3IiwiZXh0ZW5kIiwiTWFya2VyRW50cnkiLCJ0YWdOYW1lIiwiY2xhc3NOYW1lIiwiZXZlbnRzIiwiY2xpY2sgW2RhdGEtbmFtZT1cImxvY2F0ZS1tYXJrZXJcIl0iLCJjbGljayBbZGF0YS1uYW1lPVwicmVtb3ZlLW1hcmtlclwiXSIsImluaXRpYWxpemUiLCJvcHQiLCJ0aGlzIiwidGVtcGxhdGUiLCJtYXJrZXIiLCJyZW5kZXIiLCIkZWwiLCJodG1sIiwidXBkYXRlX21hcmtlciIsImZpbmQiLCJ2YWwiLCJnZXRMYXRMbmciLCJsYXQiLCJsbmciLCJ0aXRsZSIsImxvY2F0ZV9tYXJrZXIiLCJfbWFwIiwiZmx5VG8iLCJfaWNvbiIsImZvY3VzIiwicmVtb3ZlX21hcmtlciIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInJlbW92ZSIsImZpZWxkIiwibWFwIiwiZ2VvY29kZXIiLCJ2aXNpYmxlIiwiJHBhcmVudCIsImNsb3Nlc3QiLCIkem9vbSIsIiRsYXQiLCIkbG5nIiwiJGxheWVyU3RvcmUiLCIkcmVzdWx0cyIsIiRtYXJrZXJzIiwiY29uZiIsInVwZGF0ZV9tYXAiLCJpbml0X2xheWVycyIsImluaXRfbWFya2VycyIsImluaXRfYWNmIiwidXBkYXRlX3Zpc2libGUiLCJfZ2V0X2dlb2NvZGVyX3Jlc3VsdF9sYWJlbCIsImxhdGxuZyIsImxhYmVsIiwibGVuZ3RoIiwiZWFjaCIsImkiLCJyZXN1bHQiLCJuYW1lIiwidG9TdHJpbmciLCJ0ZXh0IiwicmVwbGFjZSIsInNlbGYiLCJpY29uIiwiTCIsIkRpdkljb24iLCJpbml0X2dlb2NvZGUiLCJvbiIsInJldmVyc2UiLCJnZXRab29tIiwiYWRkX21hcmtlciIsImxheWVyIiwiY29uc3RydWN0b3IiLCJNYXJrZXIiLCJzcGxpdCIsImpvaW4iLCJlbnRyeSIsImNvbnRyb2xsZXIiLCJpZCIsImFjZiIsInVuaXFpZCIsIl8iLCJwcmVwZW5kVG8iLCJzZXRJY29uIiwidW5iaW5kVG9vbHRpcCIsImJpbmRUb29sdGlwIiwiYXR0ciIsImRyYWdnaW5nIiwiZW5hYmxlIiwibG5nbGF0IiwiYWRkVG8iLCJsYXllcl9pc19vdmVybGF5Iiwia2V5IiwicGF0dGVybnMiLCJvcGFjaXR5IiwibWF0Y2giLCJzZWxlY3RlZExheWVycyIsImJhc2VMYXllcnMiLCJvdmVybGF5cyIsImlzX29taXR0ZWQiLCJzZXR1cE1hcCIsImxheWVyX2NvbmZpZyIsImlzT2JqZWN0IiwidGlsZUxheWVyIiwicHJvdmlkZXIiLCJwcm92aWRlcktleSIsImNvbnNvbGUiLCJsb2ciLCJpbmRleE9mIiwiYWRkTGF5ZXIiLCJkYXRhIiwibWFwTGF5ZXJzIiwicHJvdmlkZXJzIiwibGF5ZXJzQ29udHJvbCIsImNvbnRyb2wiLCJsYXllcnMiLCJjb2xsYXBzZWQiLCJoaWRlU2luZ2xlQmFzZSIsIl9jb250cm9sQ29ybmVycyIsImluc2VydEJlZm9yZSIsImdldCIsIkNvbnRyb2wiLCJwb3NpdGlvbiIsInBsYWNlaG9sZGVyIiwiZXJyb3JNZXNzYWdlIiwic2hvd1Jlc3VsdEljb25zIiwic3VnZ2VzdE1pbkxlbmd0aCIsInN1Z2dlc3RUaW1lb3V0IiwicXVlcnlNaW5MZW5ndGgiLCJkZWZhdWx0TWFya0dlb2NvZGUiLCJnZW9jb2RlIiwiY2VudGVyIiwiZml0Qm91bmRzIiwiYmJveCIsIkRvbUV2ZW50IiwiYWRkTGlzdGVuZXIiLCJfaW5wdXQiLCJrZXlDb2RlIiwiaXMiLCJpbnZhbGlkYXRlU2l6ZSIsImJpbmRfZXZlbnRzIiwidW5iaW5kX2V2ZW50cyIsInRvZ2dsZV9jYiIsImFkZEFjdGlvbiIsImRvY3VtZW50IiwibWFwX3pvb21lZCIsImFwcGx5IiwibWFwX21vdmVkIiwiZWFjaExheWVyIiwicHVzaCIsInVuc2hpZnQiLCJKU09OIiwic3RyaW5naWZ5Iiwib2ZmIiwibGF0TG5nIiwic2V0VmlldyIs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QSxTQUFBckMsRUFBQUksR0FDQSxHQUFBcEMsR0FBQW1DLE9BQUE0SCxHQUFBL0gsRUFBQWdJLE9BQUE1SCxJQUFBQSxPQUlBNkgsT0FBQUMiLCJmaWxlIjoiYWNmLWlucHV0LW9zbS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oICQsIGFyZyApe1xuXHR2YXIgb3B0aW9ucyA9IGFyZy5vcHRpb25zLFxuXHRcdHJlc3VsdF90cGwgPSAnPGRpdiB0YWJpbmRleD1cIjwlPSBkYXRhLmkgJT5cIiBjbGFzcz1cIm9zbS1yZXN1bHRcIj4nXG5cdFx0XHQrICc8JT0gZGF0YS5yZXN1bHRfdGV4dCAlPidcblx0XHRcdCsgJzxiciAvPjxzbWFsbD48JT0gZGF0YS5wcm9wZXJ0aWVzLm9zbV92YWx1ZSAlPjwvc21hbGw+J1xuXHRcdFx0KyAnPC9kaXY+JztcblxuXHR2YXIgb3NtID0ge1xuXHR9O1xuXG5cdG9zbS5NYXJrZXJMaXN0ID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXHR9KVxuXHRvc20uTWFya2VyRW50cnkgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG5cdFx0dGFnTmFtZTogJ2RpdicsXG5cdFx0Y2xhc3NOYW1lOidvc20tbWFya2VyJyxcblx0XHRldmVudHM6IHtcblx0XHRcdCdjbGljayBbZGF0YS1uYW1lPVwibG9jYXRlLW1hcmtlclwiXScgOiAnbG9jYXRlX21hcmtlcicsXG5cdFx0XHQnY2xpY2sgW2RhdGEtbmFtZT1cInJlbW92ZS1tYXJrZXJcIl0nIDogJ3JlbW92ZV9tYXJrZXInLFxuXHRcdH0sXG5cdFx0aW5pdGlhbGl6ZTpmdW5jdGlvbihvcHQpe1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0dGhpcy50ZW1wbGF0ZSA9IG9wdC50ZW1wbGF0ZTtcblx0XHRcdHRoaXMubWFya2VyID0gb3B0Lm1hcmtlcjtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRyZW5kZXI6ZnVuY3Rpb24oKXtcblx0XHRcdHRoaXMuJGVsLmh0bWwoIHRoaXMudGVtcGxhdGUoIHRoaXMgKSApO1xuXHRcdFx0dGhpcy51cGRhdGVfbWFya2VyKCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHVwZGF0ZV9tYXJrZXI6ZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1sYXRcIl0nKS52YWwoIHRoaXMubWFya2VyLmdldExhdExuZygpLmxhdCApO1xuXHRcdFx0dGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItbG5nXCJdJykudmFsKCB0aGlzLm1hcmtlci5nZXRMYXRMbmcoKS5sbmcgKTtcblx0XHRcdHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWxhYmVsXCJdJykudmFsKCB0aGlzLm1hcmtlci5vcHRpb25zLnRpdGxlICk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdGxvY2F0ZV9tYXJrZXI6ZnVuY3Rpb24oKXtcblx0XHRcdHRoaXMubWFya2VyLl9tYXAuZmx5VG8oIHRoaXMubWFya2VyLmdldExhdExuZygpICk7XG5cdFx0XHQkKHRoaXMubWFya2VyLl9pY29uKS5mb2N1cygpXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHJlbW92ZV9tYXJrZXI6ZnVuY3Rpb24oZSkge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpXG5cdFx0XHR0aGlzLm1hcmtlci5yZW1vdmUoKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblx0fSk7XG5cblx0b3NtLmZpZWxkID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXHRcdC8qXG5cdFx0dG9kbzpcblx0XHQtIE1hcCBMYXllciBzZWxlY3RvclxuXHRcdC0gc2V0IC8gdW5zZXQgbWFya2VyXG5cdFx0Ki9cblxuXHRcdG1hcDogbnVsbCxcblx0XHRnZW9jb2RlcjogbnVsbCxcblx0XHR2aXNpYmxlOiBudWxsLFxuXHRcdGV2ZW50czp7XG5cdFx0fSxcblxuXHRcdCRwYXJlbnQ6ZnVuY3Rpb24oKXtcblx0XHRcdHJldHVybiB0aGlzLiRlbC5jbG9zZXN0KCcuYWNmLWZpZWxkLXNldHRpbmdzLC5hY2YtZmllbGQtb3Blbi1zdHJlZXQtbWFwJylcblx0XHR9LFxuXHRcdCR6b29tIDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnaW5wdXRbaWQkPVwiLXpvb21cIl0nKTtcblx0XHR9LFxuXHRcdCRsYXQgOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCdpbnB1dFtpZCQ9XCItY2VudGVyX2xhdFwiXScpO1xuXHRcdH0sXG5cdFx0JGxuZyA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJ2lucHV0W2lkJD1cIi1jZW50ZXJfbG5nXCJdJyk7XG5cdFx0fSxcblx0XHQkbGF5ZXJTdG9yZTogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnaW5wdXRbaWQkPVwiLWxlYWZsZXRfbGF5ZXJzXCJdJyk7XG5cdFx0fSxcblx0XHQkcmVzdWx0cyA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJy5vc20tcmVzdWx0cycpO1xuXHRcdH0sXG5cdFx0JG1hcmtlcnM6ZnVuY3Rpb24oKXtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCcub3NtLW1hcmtlcnMnKTtcblx0XHR9LFxuXHRcdGluaXRpYWxpemU6ZnVuY3Rpb24oY29uZikge1xuXG5cdFx0XHR0aGlzLm1hcFx0XHQ9IGNvbmYubWFwO1xuXG5cdFx0XHR0aGlzLnVwZGF0ZV9tYXAoKTsgLy8gc2V0IG1hcCB0byBpbnB1dCB2YWx1ZXNcblxuXHRcdFx0dGhpcy5pbml0X2xheWVycygpO1xuXG5cdFx0XHR0aGlzLmluaXRfbWFya2VycygpO1xuXG5cdFx0XHR0aGlzLmluaXRfYWNmKCk7XG5cblx0XHRcdHRoaXMudXBkYXRlX3Zpc2libGUoKTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRfZ2V0X2dlb2NvZGVyX3Jlc3VsdF9sYWJlbDpmdW5jdGlvbiggZSwgbGF0bG5nICkge1xuXHRcdFx0dmFyIGxhYmVsID0gZmFsc2U7XG5cblx0XHRcdGlmICggISBlLmxlbmd0aCApIHtcblx0XHRcdFx0bGFiZWwgPSBsYXRsbmcubGF0LnRvU3RyaW5nKCkgKyAnLCAnICsgbGF0bG5nLmxuZy50b1N0cmluZygpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0JC5lYWNoKCBlLCBmdW5jdGlvbiggaSwgcmVzdWx0ICkge1xuXHRcdFx0XHRcdGlmICggISEgcmVzdWx0Lmh0bWwgKSB7XG5cdFx0XHRcdFx0XHRsYWJlbCA9IHJlc3VsdC5odG1sO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRsYWJlbCA9IHJlc3VsdC5uYW1lO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuICQobGFiZWwpLnRleHQoKS5yZXBsYWNlKC9eKFxccyspL2csJycpLnJlcGxhY2UoLyhcXHMrKSQvZywnJyk7XG5cdFx0fSxcblx0XHRpbml0X21hcmtlcnM6ZnVuY3Rpb24oKXtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHR0aGlzLmljb24gPSBuZXcgTC5EaXZJY29uKHtcblx0XHRcdFx0aHRtbDogJycsXG5cdFx0XHRcdGNsYXNzTmFtZTonb3NtLW1hcmtlci1pY29uJ1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMuaW5pdF9nZW9jb2RlKCk7XG5cblx0XHRcdHRoaXMubWFwLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHR2YXIgbGF0bG5nID0gZS5sYXRsbmc7XG5cdFx0XHRcdHNlbGYuZ2VvY29kZXIub3B0aW9ucy5nZW9jb2Rlci5yZXZlcnNlKGUubGF0bG5nLHNlbGYubWFwLmdldFpvb20oKSxmdW5jdGlvbihlKXtcblx0XHRcdFx0XHR2YXIgbGFiZWwgPSBzZWxmLl9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsKCBlLCBsYXRsbmcgKTtcblx0XHRcdFx0XHRzZWxmLmFkZF9tYXJrZXIoIGxhdGxuZywgbGFiZWwgKTtcblx0XHRcdFx0fSxzZWxmKTtcblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLm1hcC5vbiggJ2xheWVyYWRkJywgZnVuY3Rpb24oZSl7XG5cdFx0XHRcdGlmICggZS5sYXllci5jb25zdHJ1Y3RvciAhPT0gTC5NYXJrZXIgKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHZhciB0ZW1wbGF0ZSA9IHNlbGYuJG1hcmtlcnMoKS5maW5kKCdbZGF0YS1pZD1cIl9fb3NtX21hcmtlcl90ZW1wbGF0ZV9fXCJdJykuaHRtbCgpLnNwbGl0KCdfX29zbV9tYXJrZXJfdGVtcGxhdGVfXycpLmpvaW4oICc8JT0gaWQgJT4nICksXG5cdFx0XHRcdFx0ZW50cnkgPSBuZXcgb3NtLk1hcmtlckVudHJ5KHtcblx0XHRcdFx0XHRcdGNvbnRyb2xsZXI6IHRoaXMsXG5cdFx0XHRcdFx0XHRtYXJrZXI6IGUubGF5ZXIsXG5cdFx0XHRcdFx0XHRpZDogYWNmLnVuaXFpZCgpLCAvL3NlbGYuJG1hcmtlcnMoKS5jaGlsZHJlbigpLmxlbmd0aCxcblx0XHRcdFx0XHRcdHRlbXBsYXRlOiBfLnRlbXBsYXRlKCB0ZW1wbGF0ZSApLFxuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGVudHJ5LnJlbmRlcigpLiRlbC5wcmVwZW5kVG8oIHNlbGYuJG1hcmtlcnMoKSApO1xuXG5cdFx0XHRcdGUubGF5ZXJcblx0XHRcdFx0XHQuc2V0SWNvbiggc2VsZi5pY29uIClcblx0XHRcdFx0XHQub24oJ2NsaWNrJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRcdHRoaXMucmVtb3ZlKCk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQub24oJ3JlbW92ZScsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0XHRlbnRyeS4kZWwucmVtb3ZlKCk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQub24oJ2RyYWdlbmQnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdFx0c2VsZi5nZW9jb2Rlci5vcHRpb25zLmdlb2NvZGVyLnJldmVyc2UodGhpcy5nZXRMYXRMbmcoKSxzZWxmLm1hcC5nZXRab29tKCksZnVuY3Rpb24oZSl7XG5cblx0XHRcdFx0XHRcdFx0dmFyIGxhYmVsID0gc2VsZi5fZ2V0X2dlb2NvZGVyX3Jlc3VsdF9sYWJlbCggZSwgdGhpcy5nZXRMYXRMbmcoKSApO1xuXHRcdFx0XHRcdFx0XHR0aGlzLnVuYmluZFRvb2x0aXAoKVxuXHRcdFx0XHRcdFx0XHR0aGlzLmJpbmRUb29sdGlwKGxhYmVsKTtcblx0XHRcdFx0XHRcdFx0dGhpcy5vcHRpb25zLnRpdGxlID0gbGFiZWw7XG5cdFx0XHRcdFx0XHRcdCQodGhpcy5faWNvbikuYXR0ciggJ3RpdGxlJywgbGFiZWwgKTtcblx0XHRcdFx0XHRcdFx0ZW50cnkudXBkYXRlX21hcmtlcigpO1xuXG5cdFx0XHRcdFx0XHR9LCB0aGlzICk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQuZHJhZ2dpbmcuZW5hYmxlKCk7XG5cdFx0XHR9ICk7XG5cdFx0fSxcblx0XHRhZGRfbWFya2VyOmZ1bmN0aW9uKCBsbmdsYXQsIGxhYmVsICl7XG5cdFx0XHRMLm1hcmtlcihsbmdsYXQse1xuXHRcdFx0XHR0aXRsZTogbGFiZWwsXG5cdFx0XHRcdGljb246IHRoaXMuaWNvbixcblx0XHRcdH0pXG5cdFx0XHRcdC5iaW5kVG9vbHRpcCggbGFiZWwgKVxuXHRcdFx0XHQuYWRkVG8oIHRoaXMubWFwICk7XG5cdFx0fSxcblx0XHRsYXllcl9pc19vdmVybGF5OiBmdW5jdGlvbiggIGtleSwgbGF5ZXIgKSB7XG5cdFx0XHR2YXIgcGF0dGVybnM7XG5cblx0XHRcdGlmICggbGF5ZXIub3B0aW9ucy5vcGFjaXR5ICYmIGxheWVyLm9wdGlvbnMub3BhY2l0eSA8IDEgKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0cGF0dGVybnMgPSBbJ14oT3BlbldlYXRoZXJNYXB8T3BlblNlYU1hcCknLFxuXHRcdFx0XHQnT3Blbk1hcFN1cmZlci5BZG1pbkJvdW5kcycsXG5cdFx0XHRcdCdTdGFtZW4uVG9uZXIoSHlicmlkfExpbmVzfExhYmVscyknLFxuXHRcdFx0XHQnQWNldGF0ZS4oZm9yZWdyb3VuZHxsYWJlbHN8cm9hZHMpJyxcblx0XHRcdFx0J0hpbGxTaGFkaW5nJyxcblx0XHRcdFx0J0h5ZGRhLlJvYWRzQW5kTGFiZWxzJyxcblx0XHRcdFx0J15KdXN0aWNlTWFwJyxcblx0XHRcdFx0J09wZW5JbmZyYU1hcC4oUG93ZXJ8VGVsZWNvbXxQZXRyb2xldW18V2F0ZXIpJyxcblx0XHRcdFx0J09wZW5QdE1hcCcsXG5cdFx0XHRcdCdPcGVuUmFpbHdheU1hcCcsXG5cdFx0XHRcdCdPcGVuRmlyZU1hcCcsXG5cdFx0XHRcdCdTYWZlQ2FzdCcsXG5cdFx0XHRcdCdDYXJ0b0RCLkRhcmtNYXR0ZXJPbmx5TGFiZWxzJyxcblx0XHRcdFx0J0NhcnRvREIuUG9zaXRyb25Pbmx5TGFiZWxzJ1xuXHRcdFx0XTtcblx0XHRcdHJldHVybiBrZXkubWF0Y2goJygnICsgcGF0dGVybnMuam9pbignfCcpICsgJyknKSAhPT0gbnVsbDtcblx0XHR9LFxuXHRcdGluaXRfbGF5ZXJzOmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRzZWxlY3RlZExheWVycyA9IFtdLFxuXHRcdFx0XHRiYXNlTGF5ZXJzID0ge30sXG5cdFx0XHRcdG92ZXJsYXlzID0ge30sXG5cdFx0XHRcdGlzX29taXR0ZWQgPSBmdW5jdGlvbihrZXkpIHtcblxuXHRcdFx0XHRcdHJldHVybiBrZXkgPT09IG51bGw7XG5cdFx0XHRcdH0sXG5cdFx0XHRcdHNldHVwTWFwID0gZnVuY3Rpb24oIGtleSwgdmFsICl7XG5cdFx0XHRcdFx0dmFyIGxheWVyLCBsYXllcl9jb25maWc7XG5cdFx0XHRcdFx0aWYgKCBfLmlzT2JqZWN0KHZhbCkgKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gJC5lYWNoKCB2YWwsIHNldHVwTWFwICk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCBpc19vbWl0dGVkKGtleSkgKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0bGF5ZXJfY29uZmlnID0gb3B0aW9ucy5sYXllcl9jb25maWdbIGtleS5zcGxpdCgnLicpWzBdIF0gfHwge29wdGlvbnM6e319O1xuXHRcdFx0XHRcdGxheWVyID0gTC50aWxlTGF5ZXIucHJvdmlkZXIoIGtleSwgbGF5ZXJfY29uZmlnLm9wdGlvbnMgKTtcblx0XHRcdFx0XHRsYXllci5wcm92aWRlcktleSA9IGtleTtcbmNvbnNvbGUubG9nKHNlbGVjdGVkTGF5ZXJzKVxuXHRcdFx0XHRcdGlmICggc2VsZi5sYXllcl9pc19vdmVybGF5KCBrZXksIGxheWVyICkgKSB7XG5cdFx0XHRcdFx0XHRvdmVybGF5c1trZXldID0gbGF5ZXI7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGJhc2VMYXllcnNba2V5XSA9IGxheWVyO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAoIHNlbGVjdGVkTGF5ZXJzLmluZGV4T2YoIGtleSApICE9PSAtMSApe1xuXG5cdFx0XHRcdFx0XHRzZWxmLm1hcC5hZGRMYXllcihsYXllcik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9O1xuXG5cdFx0XHRzZWxlY3RlZExheWVycyA9IHRoaXMuJGVsLmRhdGEoKS5tYXBMYXllcnM7XG5cblx0XHRcdCQuZWFjaCggb3B0aW9ucy5wcm92aWRlcnMsIHNldHVwTWFwICk7XG5cblx0XHRcdC8vIC4uLiBubyBsYXllciBlZGl0aW5nIGFsbG93ZWRcblx0XHRcdGlmICggISB0aGlzLiRsYXllclN0b3JlKCkubGVuZ3RoICkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMubGF5ZXJzQ29udHJvbCA9IEwuY29udHJvbC5sYXllcnMoIGJhc2VMYXllcnMsIG92ZXJsYXlzLCB7XG5cdFx0XHRcdGNvbGxhcHNlZDogdHJ1ZSxcblx0XHRcdFx0aGlkZVNpbmdsZUJhc2U6IHRydWUsXG5cdFx0XHR9KS5hZGRUbyh0aGlzLm1hcCk7XG5cblx0XHR9LFxuXHRcdGluaXRfZ2VvY29kZTpmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHR0aGlzLm1hcC5fY29udHJvbENvcm5lcnNbJ2Fib3ZlJ10gPSAkKCc8ZGl2IGNsYXNzPVwiYWNmLW9zbS1hYm92ZVwiPjwvZGl2PicpLmluc2VydEJlZm9yZSggdGhpcy4kZWwgKS5nZXQoMCk7XG5cblx0XHRcdHRoaXMuZ2VvY29kZXIgPSBMLkNvbnRyb2wuZ2VvY29kZXIoe1xuXHRcdFx0XHRjb2xsYXBzZWQ6IGZhbHNlLFxuXHRcdFx0XHRwb3NpdGlvbjonYWJvdmUnLFxuXHRcdFx0XHRwbGFjZWhvbGRlcjonU2VhcmNoLi4uJyxcblx0XHRcdFx0ZXJyb3JNZXNzYWdlOidOb3RoaW5nIGZvdW5kLi4uJyxcblx0XHRcdFx0c2hvd1Jlc3VsdEljb25zOnRydWUsXG5cdFx0XHRcdHN1Z2dlc3RNaW5MZW5ndGg6Myxcblx0XHRcdFx0c3VnZ2VzdFRpbWVvdXQ6MjUwLFxuXHRcdFx0XHRxdWVyeU1pbkxlbmd0aDozLFxuXHRcdFx0XHRkZWZhdWx0TWFya0dlb2NvZGU6ZmFsc2UsXG5cdFx0XHR9KVxuXHRcdFx0Lm9uKCdtYXJrZ2VvY29kZScsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdC8vY29uc29sZS5sb2coZS5nZW9jb2RlLmNuZXRlcik7cmV0dXJuO1xuXHRcdFx0XHR2YXIgbGFiZWwgPSBzZWxmLl9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsKCBbZS5nZW9jb2RlXSwgZS5nZW9jb2RlLmNlbnRlciApO1xuXHRcdFx0XHRzZWxmLmFkZF9tYXJrZXIoIGUuZ2VvY29kZS5jZW50ZXIsIGxhYmVsICk7XG5cdFx0XHRcdC8qXG5cdFx0XHRcdHNlbGYubWFwLmZseVRvQm91bmRzKGUuZ2VvY29kZS5iYm94KTtcblx0XHRcdFx0LyovXG5cdFx0XHRcdHNlbGYubWFwLmZpdEJvdW5kcyhlLmdlb2NvZGUuYmJveCk7XG5cdFx0XHRcdC8vKi9cblxuLy9cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdH0pXG5cdFx0XHQuYWRkVG8oIHRoaXMubWFwICk7XG5cblx0XHRcdC8vIHByZXZlbnQgd3AgcG9zdCBmb3JtIGZyb20gYmVpbmcgc3VibWl0dGVkXG5cdFx0XHRMLkRvbUV2ZW50LmFkZExpc3RlbmVyKHRoaXMuZ2VvY29kZXIuX2lucHV0LCAna2V5ZG93bicsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRpZiAoIGUua2V5Q29kZSA9PT0gMTMgKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCB0aGlzLmdlb2NvZGVyICk7XG5cdFx0fSxcblx0XHR1cGRhdGVfdmlzaWJsZTogZnVuY3Rpb24oKSB7XG5cblx0XHRcdGlmICggdGhpcy52aXNpYmxlID09PSB0aGlzLiRlbC5pcygnOnZpc2libGUnKSApIHtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudmlzaWJsZSA9IHRoaXMuJGVsLmlzKCc6dmlzaWJsZScpO1xuXG5cdFx0XHRpZiAoIHRoaXMudmlzaWJsZSApIHtcblx0XHRcdFx0dGhpcy5tYXAuaW52YWxpZGF0ZVNpemUoKTtcblx0XHRcdFx0dGhpcy5iaW5kX2V2ZW50cygpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH1cblx0XHRcdHRoaXMudW5iaW5kX2V2ZW50cygpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRpbml0X2FjZjogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdHRvZ2dsZV9jYiA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdC8vIG5vIGNoYW5nZVxuXHRcdFx0XHRcdHNlbGYudXBkYXRlX3Zpc2libGUoKTtcblx0XHRcdFx0fTtcblxuXHRcdFx0Ly8gZXhwYW5kL2NvbGxhcHNlIGFjZiBzZXR0aW5nXG5cdFx0XHRhY2YuYWRkQWN0aW9uKCAnc2hvdycsIHRvZ2dsZV9jYiApO1xuXHRcdFx0YWNmLmFkZEFjdGlvbiggJ2hpZGUnLCB0b2dnbGVfY2IgKTtcblxuXG5cblx0XHRcdC8vIGV4cGFuZCBhY2YgcmVwZWF0ZXJcblx0XHRcdC8vIC4uLlxuXG5cdFx0XHQvLyBleHBhbmQgYWNmIGxheW91dFxuXHRcdFx0Ly8gLi4uXG5cblx0XHRcdC8vIGV4cGFuZCB3cCBtZXRhYm94XG5cdFx0XHQkKGRvY3VtZW50KS5vbigncG9zdGJveC10b2dnbGVkJyx0b2dnbGVfY2IpXG5cblxuXHRcdFx0dGhpcy5tYXAub24oJ3pvb21lbmQnLCBmdW5jdGlvbihlKXsgc2VsZi5tYXBfem9vbWVkLmFwcGx5KCBzZWxmLCBbZV0gKTsgfSApO1xuXHRcdFx0dGhpcy5tYXAub24oJ21vdmVlbmQnLCBmdW5jdGlvbihlKXsgc2VsZi5tYXBfbW92ZWQuYXBwbHkoIHNlbGYsIFtlXSApOyB9ICk7XG5cblx0XHRcdHRoaXMubWFwLm9uKCAnYmFzZWxheWVyY2hhbmdlIG92ZXJsYXlhZGQgb3ZlcmxheXJlbW92ZSBsYXllcmFkZCBsYXllcnJlbW92ZScsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHR2YXIgbGF5ZXJzID0gW107XG5cdFx0XHRcdHNlbGYubWFwLmVhY2hMYXllcihmdW5jdGlvbihsYXllcikge1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKGxheWVyKTtcblx0XHRcdFx0XHRpZiAoICEgbGF5ZXIucHJvdmlkZXJLZXkgKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICggc2VsZi5sYXllcl9pc19vdmVybGF5KCBsYXllci5wcm92aWRlcktleSwgbGF5ZXIgKSApIHtcblx0XHRcdFx0XHRcdGxheWVycy5wdXNoKGxheWVyLnByb3ZpZGVyS2V5KTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0bGF5ZXJzLnVuc2hpZnQobGF5ZXIucHJvdmlkZXJLZXkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHRcdHNlbGYuJGxheWVyU3RvcmUoKS52YWwoIEpTT04uc3RyaW5naWZ5KCBsYXllcnMgKSApO1xuXHRcdFx0fSApO1xuXHRcdH0sXG5cdFx0dW5iaW5kX2V2ZW50czpmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblx0XHRcdHNlbGYuJGxhdCgpLm9mZignYmx1cicpO1xuXHRcdFx0c2VsZi4kbG5nKCkub2ZmKCdibHVyJyk7XG5cdFx0XHRzZWxmLiR6b29tKCkub2ZmKCdibHVyJyk7XG5cdFx0XHRzZWxmLiR6b29tKCkub2ZmKCdrZXl1cCBmb2N1cycpO1xuXG5cdFx0fSxcblx0XHRiaW5kX2V2ZW50czogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNlbGYuJGxhdCgpLm9uKCdibHVyJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0c2VsZi51cGRhdGVfbWFwKCk7XG5cdFx0XHR9KTtcblx0XHRcdHNlbGYuJGxuZygpLm9uKCdibHVyJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0c2VsZi51cGRhdGVfbWFwKCk7XG5cdFx0XHR9KTtcblx0XHRcdHNlbGYuJHpvb20oKS5vbignYmx1cicsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHNlbGYudXBkYXRlX21hcCgpO1xuXHRcdFx0fSk7XG5cdFx0XHQvLyBzZWxmLiRhZGRyZXNzKCkub24oJ2tleXVwIGZvY3VzJywgZnVuY3Rpb24oZSl7XG5cdFx0XHQvLyBcdHNlbGYuc2VhcmNoKGUpO1xuXHRcdFx0Ly8gfSApO1xuXG5cbi8vXHRcdFx0dGhpcy5saXN0ZW5UbyggdGhpcy4kYWRkcmVzcywgJ2tleXVwIGZvY3VzJywgdGhpcy5zZWFyY2ggKTtcblxuXHRcdFx0Ly8gdGhpcy4kdGlsZXMub24oJ2NoYW5nZScsIGRvX2xheWVycyApXG5cdFx0XHQvLyBcdC5wcmV2KCdpbnB1dCcpLm9uKCdjaGFuZ2UnLCBkb19sYXllcnMgKTtcblxuXHRcdH0sXG5cdFx0dXBkYXRlX21hcDpmdW5jdGlvbigpIHtcblx0XHRcdGlmICggISB0aGlzLiRsYXQoKS52YWwoKSB8fCAhIHRoaXMuJGxuZygpLnZhbCgpICkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHR2YXIgbGF0bG5nID0gTC5sYXRMbmcoIHRoaXMuJGxhdCgpLnZhbCgpLCB0aGlzLiRsbmcoKS52YWwoKSApO1xuXHRcdFx0dGhpcy5tYXAuc2V0VmlldyggbGF0bG5nLCAgdGhpcy4kem9vbSgpLnZhbCgpICk7XG5cdFx0fSxcblx0XHRtYXBfbW92ZWQ6ZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgY2VudGVyID0gdGhpcy5tYXAuZ2V0Q2VudGVyKCk7XG5cdFx0XHR0aGlzLiRsYXQoKS52YWwoY2VudGVyLmxhdCk7XG5cdFx0XHR0aGlzLiRsbmcoKS52YWwoY2VudGVyLmxuZyk7XG5cdFx0fSxcblx0XHRtYXBfem9vbWVkOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dGhpcy4kem9vbSgpLnZhbCggdGhpcy5tYXAuZ2V0Wm9vbSgpICk7XG5cdFx0fSxcblxuXHR9KTtcblxuXHQvKlxuXHQgKiAgcmVhZHkgYXBwZW5kIChBQ0Y1KVxuXHQgKlxuXHQgKiAgVGhlc2UgYXJlIDIgZXZlbnRzIHdoaWNoIGFyZSBmaXJlZCBkdXJpbmcgdGhlIHBhZ2UgbG9hZFxuXHQgKiAgcmVhZHkgPSBvbiBwYWdlIGxvYWQgc2ltaWxhciB0byAkKGRvY3VtZW50KS5yZWFkeSgpXG5cdCAqICBhcHBlbmQgPSBvbiBuZXcgRE9NIGVsZW1lbnRzIGFwcGVuZGVkIHZpYSByZXBlYXRlciBmaWVsZFxuXHQgKlxuXHQgKiAgQHR5cGVcdGV2ZW50XG5cdCAqICBAZGF0ZVx0MjAvMDcvMTNcblx0ICpcblx0ICogIEBwYXJhbVx0JGVsIChqUXVlcnkgc2VsZWN0aW9uKSB0aGUgalF1ZXJ5IGVsZW1lbnQgd2hpY2ggY29udGFpbnMgdGhlIEFDRiBmaWVsZHNcblx0ICogIEByZXR1cm5cdG4vYVxuXHQgKi9cblx0JChkb2N1bWVudCkub24oJ3ByZS1yZW5kZXItbWFwJyxmdW5jdGlvbiggZSwgbWFwICkge1xuXHRcdG5ldyBvc20uZmllbGQoIHsgZWw6IGUudGFyZ2V0LCBtYXA6IG1hcCB9ICk7XG5cdH0pO1xuXG5cbn0pKCBqUXVlcnksIGFjZl9vc21fYWRtaW4gKTtcbiJdfQ==
