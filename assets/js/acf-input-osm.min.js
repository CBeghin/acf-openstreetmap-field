!function(e,t,r){var a=(t.options,{});a.MarkerList=Backbone.View.extend({}),a.MarkerEntry=Backbone.View.extend({tagName:"div",className:"osm-marker",events:{'click [data-name="locate-marker"]':"locate_marker",'click [data-name="remove-marker"]':"remove_marker",'change [id$="-marker-label"]':"update_marker_label"},get_label:function(){return this.$el.find('[id$="-marker-label"]').val()},get_default_label:function(){return this.$el.find('[id$="-marker-geocode"]').val()},is_default_label:function(){return this.get_default_label()===this.get_label()},initialize:function(e){return this.template=e.template,this.marker=e.marker,this.marker.osm_controller=this,this},render:function(){var t=this;return this.$el.html(this.template(this)),this._update_values_from_marker(),this.$el.find('[id$="-marker-label"]').on("focus",function(e){t.hilite_marker()}).on("blur",function(e){t.lolite_marker()}),e(this.marker._icon).on("focus",function(e){t.hilite_marker()}).on("blur",function(e){t.lolite_marker()}),this},update_marker_label:function(t){var r=this.get_label();return""===r&&(r=this.get_default_label()),e(t.target).val(r),this.set_marker_label(r)},set_marker_label:function(t){return this.marker.unbindTooltip(),this.marker.bindTooltip(t),this.marker.options.title=t,e(this.marker._icon).attr("title",t),this},update_marker_geocode:function(e){return this.is_default_label()&&this.set_marker_label(e),this.$el.find('[id$="-marker-geocode"]').val(e),this._update_values_from_marker(),this},_update_values_from_marker:function(){var e=this.marker.getLatLng();return this.$el.find('[id$="-marker-lat"]').val(e.lat),this.$el.find('[id$="-marker-lng"]').val(e.lng),this.$el.find('[id$="-marker-label"]').val(this.marker.options.title),this},hilite_marker:function(t){this.$el.addClass("focus"),e(this.marker._icon).addClass("focus")},lolite_marker:function(t){this.$el.removeClass("focus"),e(this.marker._icon).removeClass("focus")},locate_marker:function(){return this.marker._map.flyTo(this.marker.getLatLng()),this},remove_marker:function(e){return e.preventDefault(),this.marker.remove(),this}}),a.field=Backbone.View.extend({map:null,geocoder:null,visible:null,events:{},$parent:function(){return this.$el.closest(".acf-field-settings,.acf-field-open-street-map")},$zoom:function(){return this.$parent().find('input[id$="-zoom"]')},$lat:function(){return this.$parent().find('input[id$="-center_lat"]')},$lng:function(){return this.$parent().find('input[id$="-center_lng"]')},$layerStore:function(){return this.$parent().find(".acf-osm-layers")},$results:function(){return this.$parent().find(".osm-results")},$markers:function(){return this.$parent().find(".osm-markers")},initialize:function(e){return this.map=e.map,this.update_map(),this.init_acf(),this.init_layers(),this.init_markers(),this.update_visible(),this},_get_geocoder_result_label:function(t,r){var a=!1;return t.length?e.each(t,function(e,t){return a=t.html?t.html:t.name,!1}):a=r.lat.toString()+", "+r.lng.toString(),e("<p>"+a+"</p>").text().replace(/^(\s+)/g,"").replace(/(\s+)$/g,"").replace(/(\s+)/g," ")},init_markers:function(){var t=this,r=this.$el.data().editorConfig;this.init_geocode(),0!==r.max_markers&&(this.icon=new L.DivIcon({html:"",className:"osm-marker-icon"}),this.map.on("click",function(e){var a=e.latlng,i=t.$markers().children().not("[data-id]").length;!1!==r.max_markers&&i>=r.max_markers||t.geocoder.options.geocoder.reverse(e.latlng,t.map.getZoom(),function(e){var r=t._get_geocoder_result_label(e,a);t.add_marker(a,r)},t)}),this.map.on("layeradd",function(e){if(e.layer.constructor===L.Marker){var r=t.$markers().find('[data-id="__osm_marker_template__"]').html().split("__osm_marker_template__").join("<%= id %>"),i=new a.MarkerEntry({controller:this,marker:e.layer,id:acf.uniqid(),template:_.template(r)});i.render().$el.appendTo(t.$markers()),t.geocode_marker(i),e.layer.setIcon(t.icon).on("click",function(e){this.remove()}).on("remove",function(e){i.$el.remove()}).on("dragend",function(e){t.geocode_marker(i),t.$el.trigger("change")}).dragging.enable()}}),this.map.on("layerremove",function(e){e.layer.constructor===L.Marker&&t.$el.trigger("change")}),e.each(this.$el.data().mapMarkers,function(e,r){L.marker(L.latLng(1*r.lat,1*r.lng),{title:r.label}).bindTooltip(r.label).addTo(t.map)}))},geocode_marker:function(e){var t=this,r=e,a=r.marker.getLatLng();t.geocoder.options.geocoder.reverse(a,t.map.getZoom(),function(e){var i=t._get_geocoder_result_label(e,a);r.update_marker_geocode(i)},this)},add_marker:function(e,t){L.marker(e,{title:t,icon:this.icon}).bindTooltip(t).addTo(this.map),this.$el.trigger("change")},layer_is_overlay:function(e,t){var r;return!!(t.options.opacity&&t.options.opacity<1)||(r=["^(OpenWeatherMap|OpenSeaMap)","OpenMapSurfer.AdminBounds","Stamen.Toner(Hybrid|Lines|Labels)","Acetate.(foreground|labels|roads)","HillShading","Hydda.RoadsAndLabels","^JusticeMap","OpenInfraMap.(Power|Telecom|Petroleum|Water)","OpenPtMap","OpenRailwayMap","OpenFireMap","SafeCast","CartoDB.DarkMatterOnlyLabels","CartoDB.PositronOnlyLabels"],null!==e.match("("+r.join("|")+")"))},reset_layers:function(){this.map.eachLayer(function(e){e.constructor===L.TileLayer.Provider&&e.remove()}),this.$layerStore().remove(),!!this.layersControl&&this.layersControl.remove()},init_layers:function(){var t=this,r=[],a={},i={},n={},o=this.$el.data().editorConfig,s=function(e){return null===e||!!o.restrict_providers&&-1===o.restrict_providers.indexOf(e)},l=function(o,d){var c;if(_.isObject(o))return e.each(o,l);if(!s(d)){if(n[d])c=n[d],t.map.addLayer(c);else{try{c=L.tileLayer.provider(d)}catch(e){return}c.providerKey=d}t.layer_is_overlay(d,c)?i[d]=c:a[d]=c,-1!==r.indexOf(d)&&t.map.addLayer(c)}};r=this.$el.data().mapLayers,!1!==o.restrict_providers&&_.isArray(o.restrict_providers)&&(r=r.filter(function(e){return-1!==o.restrict_providers.indexOf(e)})),r.length||(r=Object.keys(o.restrict_providers).slice(0,1)),o.allow_providers&&(e('<div class="acf-osm-layers"></div>').insertAfter(this.$el),this.map.on("baselayerchange layeradd layerremove",function(r){if(r.layer.providerKey){var a=t.$layerStore();t.$parent().find('[data-id="__osm_layer_template__"]');a.html(""),t.map.eachLayer(function(r){var i;r.providerKey&&(i=e('<input type="hidden" name="'+o.name_prefix+'[layers][]" />'),i.val(r.providerKey),t.layer_is_overlay(r.providerKey,r)?a.append(i):a.prepend(i))}),t.$el.trigger("change")}})),e.each(o.restrict_providers,l),console.log(o.restrict_providers),this.$layerStore().length&&(this.layersControl=L.control.layers(a,i,{collapsed:!0,hideSingleBase:!0}).addTo(this.map))},init_geocode:function(){var t=this;this.$el.data().editorConfig;this.map._controlCorners.above=e('<div class="acf-osm-above"></div>').insertBefore(this.$el).get(0),this.geocoder=L.Control.geocoder({collapsed:!1,position:"above",placeholder:"Search...",errorMessage:"Nothing found...",showResultIcons:!0,suggestMinLength:3,suggestTimeout:250,queryMinLength:3,defaultMarkGeocode:!1}).on("markgeocode",function(e){var r=e.geocode.center,a=t.$el.data().editorConfig,i=t.$markers().children().not("[data-id]").length,n=t._get_geocoder_result_label([e.geocode],r);(!1===i||i<a.max_markers)&&t.add_marker(r,n),1===a.max_markers&&1===i&&(marker=t.get_first_marker(),marker&&(entry=marker.osm_controller,marker.setLatLng(r),entry.update_marker_geocode(n))),0===a.max_markers?t.map.fitBounds(e.geocode.bbox):t.map.setView(r,t.map.getZoom())}).addTo(this.map),L.DomEvent.addListener(this.geocoder._input,"keydown",function(e){13===e.keyCode&&e.preventDefault()},this.geocoder)},get_first_marker:function(){var e=!1;return this.map.eachLayer(function(t){if(t.constructor===L.Marker)return e=t,!1}),e},update_visible:function(){return this.visible===this.$el.is(":visible")?this:(this.visible=this.$el.is(":visible"),this.visible?(this.map.invalidateSize(),this.bind_events(),this):(this.unbind_events(),this))},init_acf:function(){var t=this,r=function(){t.update_visible()};acf.addAction("show",r),acf.addAction("hide",r),acf.addAction("disable_field",function(){t.unbind_events()}),e(document).on("postbox-toggled",r),e(document).on("click",".widget-top *",r)},unbind_events:function(){var e=this;e.$lat().off("blur"),e.$lng().off("blur"),e.$zoom().off("blur"),e.$zoom().off("keyup focus"),this.map.off("zoomend",this.map_zoomed,this),this.map.off("moveend",this.map_moved,this)},bind_events:function(){var e=this;e.$lat().on("blur",function(t){e.update_map()}),e.$lng().on("blur",function(t){e.update_map()}),e.$zoom().on("blur",function(t){e.update_map()}),this.map.on("zoomend",this.map_zoomed,this),this.map.on("moveend",this.map_moved,this)},update_map:function(){if(this.$lat().val()&&this.$lng().val()){var e=L.latLng(this.$lat().val(),this.$lng().val());this.map.setView(e,this.$zoom().val())}},map_moved:function(e){var t=this.map.getCenter();this.$lat().val(t.lat),this.$lng().val(t.lng),this.$el.trigger("change")},map_zoomed:function(e){this.$zoom().val(this.map.getZoom()),this.$el.trigger("change")}}),e(document).on("acf-osm-map-init",function(t,r){t.preventDefault(),e(t.target).data("_map_editor",new a.field({el:t.target,map:r}))}).on("change",'[data-name="return_format"] input',function(t){e('[data-name="return_format"] input:checked').val();var r=e(this).closest(".acf-field-object").find("[data-editor-config]"),a=r.data("_map_editor"),i=r.data("editor-config");a.reset_layers(),"osm"===e(this).val()?i.restrict_providers=Object.values((void 0).options.osm_layers):i.restrict_providers=Object.values((void 0).options.leaflet_layers),r.data("editor-config",i),a.init_layers()}),acf.addAction("append",function(){e.acf_leaflet()})}(jQuery,acf_osm_admin);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1pbnB1dC1vc20uanMiXSwibmFtZXMiOlsiJCIsImFyZyIsImVkaXRfYXJnIiwib3NtIiwib3B0aW9ucyIsIk1hcmtlckxpc3QiLCJCYWNrYm9uZSIsIlZpZXciLCJleHRlbmQiLCJNYXJrZXJFbnRyeSIsInRhZ05hbWUiLCJjbGFzc05hbWUiLCJldmVudHMiLCJjbGljayBbZGF0YS1uYW1lPVwibG9jYXRlLW1hcmtlclwiXSIsImNsaWNrIFtkYXRhLW5hbWU9XCJyZW1vdmUtbWFya2VyXCJdIiwiY2hhbmdlIFtpZCQ9XCItbWFya2VyLWxhYmVsXCJdIiwiZ2V0X2xhYmVsIiwidGhpcyIsIiRlbCIsImZpbmQiLCJ2YWwiLCJnZXRfZGVmYXVsdF9sYWJlbCIsImlzX2RlZmF1bHRfbGFiZWwiLCJpbml0aWFsaXplIiwib3B0IiwidGVtcGxhdGUiLCJtYXJrZXIiLCJvc21fY29udHJvbGxlciIsInJlbmRlciIsInNlbGYiLCJodG1sIiwiX3VwZGF0ZV92YWx1ZXNfZnJvbV9tYXJrZXIiLCJvbiIsImUiLCJoaWxpdGVfbWFya2VyIiwibG9saXRlX21hcmtlciIsIl9pY29uIiwidXBkYXRlX21hcmtlcl9sYWJlbCIsImxhYmVsIiwidGFyZ2V0Iiwic2V0X21hcmtlcl9sYWJlbCIsInVuYmluZFRvb2x0aXAiLCJiaW5kVG9vbHRpcCIsInRpdGxlIiwiYXR0ciIsInVwZGF0ZV9tYXJrZXJfZ2VvY29kZSIsImxhdGxuZyIsImdldExhdExuZyIsImxhdCIsImxuZyIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiLCJsb2NhdGVfbWFya2VyIiwiX21hcCIsImZseVRvIiwicmVtb3ZlX21hcmtlciIsInByZXZlbnREZWZhdWx0IiwicmVtb3ZlIiwiZmllbGQiLCJtYXAiLCJnZW9jb2RlciIsInZpc2libGUiLCIkcGFyZW50IiwiY2xvc2VzdCIsIiR6b29tIiwiJGxhdCIsIiRsbmciLCIkbGF5ZXJTdG9yZSIsIiRyZXN1bHRzIiwiJG1hcmtlcnMiLCJjb25mIiwidXBkYXRlX21hcCIsImluaXRfYWNmIiwiaW5pdF9sYXllcnMiLCJpbml0X21hcmtlcnMiLCJ1cGRhdGVfdmlzaWJsZSIsIl9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsIiwibGVuZ3RoIiwiZWFjaCIsImkiLCJyZXN1bHQiLCJuYW1lIiwidG9TdHJpbmciLCJ0ZXh0IiwicmVwbGFjZSIsImVkaXRvcl9jb25maWciLCJkYXRhIiwiZWRpdG9yQ29uZmlnIiwiaW5pdF9nZW9jb2RlIiwibWF4X21hcmtlcnMiLCJpY29uIiwiTCIsIkRpdkljb24iLCJjb3VudF9tYXJrZXJzIiwiY2hpbGRyZW4iLCJub3QiLCJyZXZlcnNlIiwiZ2V0Wm9vbSIsImFkZF9tYXJrZXIiLCJsYXllciIsImNvbnN0cnVjdG9yIiwiTWFya2VyIiwic3BsaXQiLCJqb2luIiwiZW50cnkiLCJjb250cm9sbGVyIiwiaWQiLCJhY2YiLCJ1bmlxaWQiLCJfIiwiYXBwZW5kVG8iLCJnZW9jb2RlX21hcmtlciIsInNldEljb24iLCJ0cmlnZ2VyIiwiZHJhZ2dpbmciLCJlbmFibGUiLCJtYXBNYXJrZXJzIiwibWFya2VyRGF0YSIsImxhdExuZyIsImFkZFRvIiwibWFya2VyX2VudHJ5IiwibG5nbGF0IiwibGF5ZXJfaXNfb3ZlcmxheSIsImtleSIsInBhdHRlcm5zIiwib3BhY2l0eSIsIm1hdGNoIiwicmVzZXRfbGF5ZXJzIiwiZWFjaExheWVyIiwiVGlsZUxheWVyIiwiUHJvdmlkZXIiLCJsYXllcnNDb250cm9sIiwic2VsZWN0ZWRMYXllcnMiLCJiYXNlTGF5ZXJzIiwib3ZlcmxheXMiLCJtYXBMYXllcnMiLCJpc19vbWl0dGVkIiwicmVzdHJpY3RfcHJvdmlkZXJzIiwiaW5kZXhPZiIsInNldHVwTWFwIiwiaXNPYmplY3QiLCJhZGRMYXllciIsInRpbGVMYXllciIsInByb3ZpZGVyIiwiZXgiLCJwcm92aWRlcktleSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJlbCIsIk9iamVjdCIsImtleXMiLCJzbGljZSIsImFsbG93X3Byb3ZpZGVycyIsImluc2VydEFmdGVyIiwiJGxheWVySW5wdXQiLCJuYW1lX3ByZWZpeCIsImFwcGVuZCIsInByZXBlbmQiLCJjb25zb2xlIiwibG9nIiwiY29udHJvbCIsImxheWVycyIsImNvbGxhcHNlZCIsImhpZGVTaW5nbGVCYXNlIiwiX2NvbnRyb2xDb3JuZXJzIiwiaW5zZXJ0QmVmb3JlIiwiZ2V0IiwiQ29udHJvbCIsInBvc2l0aW9uIiwicGxhY2Vob2xkZXIiLCJlcnJvck1lc3NhZ2UiLCJzaG93UmVzdWx0SWNvbnMiLCJzdWdnZXN0TWluTGVuZ3RoIiwic3VnZ2VzdFRpbWVvdXQiLCJxdWVyeU1pbkxlbmd0aCIsImRlZmF1bHRNYXJrR2VvY29kZSIsImdlb2NvZGUiLCJjZW50ZXIiLCJnZXRfZmlyc3RfbWFya2VyIiwic2V0TGF0TG5nIiwiZml0Qm91bmRzIiwiYmJveCIsInNldFZpZXciLCJEb21FdmVudCIsImFkZExpc3RlbmVyIiwiX2lucHV0Iiwia2V5Q29kZSIsImlzIiwiaW52YWxpZGF0ZVNpemUiLCJiaW5kX2V2ZW50cyIsInVuYmluZF9ldmVudHMiLCJ0b2dnbGVfY2IiLCJhZGRBY3Rpb24iLCJkb2N1bWVudCIsIm9mZiIsIm1hcF96b29tZWQiLCJtYXBfbW92ZWQiLCJnZXRDZW50ZXIiLCIkbWFwIiwiZWRpdG9yIiwidmFsdWVzIiwib3NtX2xheWVycyIsImxlYWZsZXRfbGF5ZXJzIiwiYWNmX2xlYWZsZXQiLCJqUXVlcnkiLCJhY2Zfb3NtX2FkbWluIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFBQSxFQUFBQyxFQUFBQyxHQUNBLEdBTUFDLElBTkFGLEVBQUFHLFdBU0FELEdBQUFFLFdBQUFDLFNBQUFDLEtBQUFDLFdBRUFMLEVBQUFNLFlBQUFILFNBQUFDLEtBQUFDLFFBQ0FFLFFBQUEsTUFDQUMsVUFBQSxhQUNBQyxRQUNBQyxvQ0FBQSxnQkFDQUMsb0NBQUEsZ0JBQ0FDLCtCQUFBLHVCQUdBQyxVQUFBLFdBQ0EsTUFBQUMsTUFBQUMsSUFBQUMsS0FBQSx5QkFBQUMsT0FFQUMsa0JBQUEsV0FDQSxN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QXFNLFlBR0FuSSxFQUFBbUUsbUJBQUFZLE9BQUFtRCxZQXZsQkEsSUF1bEJBcE0sUUFBQXNNLGdCQUVBSixFQUFBaEgsS0FBQSxnQkFBQWhCLEdBQ0FpSSxFQUFBOUgsZ0JBSUFrQyxJQUFBcUYsVUFBQSxTQUFBLFdBQ0FoTSxFQUFBMk0saUJBR0FDLE9BQUFDIiwiZmlsZSI6ImFjZi1pbnB1dC1vc20ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCAkLCBhcmcsIGVkaXRfYXJnICl7XG5cdHZhciBvcHRpb25zID0gYXJnLm9wdGlvbnMsXG5cdFx0cmVzdWx0X3RwbCA9ICc8ZGl2IHRhYmluZGV4PVwiPCU9IGRhdGEuaSAlPlwiIGNsYXNzPVwib3NtLXJlc3VsdFwiPidcblx0XHRcdCsgJzwlPSBkYXRhLnJlc3VsdF90ZXh0ICU+J1xuXHRcdFx0KyAnPGJyIC8+PHNtYWxsPjwlPSBkYXRhLnByb3BlcnRpZXMub3NtX3ZhbHVlICU+PC9zbWFsbD4nXG5cdFx0XHQrICc8L2Rpdj4nO1xuXG5cdHZhciBvc20gPSB7XG5cdH07XG5cblx0b3NtLk1hcmtlckxpc3QgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG5cdH0pXG5cdG9zbS5NYXJrZXJFbnRyeSA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcblx0XHR0YWdOYW1lOiAnZGl2Jyxcblx0XHRjbGFzc05hbWU6J29zbS1tYXJrZXInLFxuXHRcdGV2ZW50czoge1xuXHRcdFx0J2NsaWNrIFtkYXRhLW5hbWU9XCJsb2NhdGUtbWFya2VyXCJdJyA6ICdsb2NhdGVfbWFya2VyJyxcblx0XHRcdCdjbGljayBbZGF0YS1uYW1lPVwicmVtb3ZlLW1hcmtlclwiXScgOiAncmVtb3ZlX21hcmtlcicsXG5cdFx0XHQnY2hhbmdlIFtpZCQ9XCItbWFya2VyLWxhYmVsXCJdJ1x0XHQ6ICd1cGRhdGVfbWFya2VyX2xhYmVsJyxcbi8vXHRcdFx0J2ZvY3VzIFt0eXBlPVwidGV4dFwiXSdcdFx0XHRcdDogJ2hpbGl0ZV9tYXJrZXInXG5cdFx0fSxcblx0XHRnZXRfbGFiZWw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWxhYmVsXCJdJykudmFsKCk7XG5cdFx0fSxcblx0XHRnZXRfZGVmYXVsdF9sYWJlbDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItZ2VvY29kZVwiXScpLnZhbCgpO1xuXHRcdH0sXG5cdFx0aXNfZGVmYXVsdF9sYWJlbDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5nZXRfZGVmYXVsdF9sYWJlbCgpID09PSB0aGlzLmdldF9sYWJlbCgpO1xuXHRcdH0sXG5cdFx0aW5pdGlhbGl6ZTpmdW5jdGlvbihvcHQpe1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0dGhpcy50ZW1wbGF0ZSA9IG9wdC50ZW1wbGF0ZTtcblx0XHRcdHRoaXMubWFya2VyID0gb3B0Lm1hcmtlcjtcblx0XHRcdHRoaXMubWFya2VyLm9zbV9jb250cm9sbGVyID0gdGhpcztcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRyZW5kZXI6ZnVuY3Rpb24oKXtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0dGhpcy4kZWwuaHRtbCggdGhpcy50ZW1wbGF0ZSggdGhpcyApICk7XG5cdFx0XHR0aGlzLl91cGRhdGVfdmFsdWVzX2Zyb21fbWFya2VyKCk7XG5cblx0XHRcdHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWxhYmVsXCJdJylcblx0XHRcdFx0Lm9uKCdmb2N1cycsZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdHNlbGYuaGlsaXRlX21hcmtlcigpO1xuXHRcdFx0XHR9KVxuXHRcdFx0XHQub24oJ2JsdXInLGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHRzZWxmLmxvbGl0ZV9tYXJrZXIoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHQkKHRoaXMubWFya2VyLl9pY29uKVxuXHRcdFx0XHQub24oJ2ZvY3VzJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRzZWxmLmhpbGl0ZV9tYXJrZXIoKTtcblx0XHRcdFx0fSlcblx0XHRcdFx0Lm9uKCdibHVyJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRzZWxmLmxvbGl0ZV9tYXJrZXIoKTtcblx0XHRcdFx0fSlcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0dXBkYXRlX21hcmtlcl9sYWJlbDpmdW5jdGlvbihlKSB7XG5cdFx0XHR2YXIgbGFiZWwgPSB0aGlzLmdldF9sYWJlbCgpO1xuXG5cdFx0XHRpZiAoIGxhYmVsID09PSAnJyApIHtcblx0XHRcdFx0bGFiZWwgPSB0aGlzLmdldF9kZWZhdWx0X2xhYmVsKCk7XG5cdFx0XHR9XG5cdFx0XHQvLyByZXN0b3JlIGdlb2NvZGUgZGVmYXVsdFxuXHRcdFx0JChlLnRhcmdldCkudmFsKGxhYmVsKTtcblxuXHRcdFx0cmV0dXJuIHRoaXMuc2V0X21hcmtlcl9sYWJlbCggbGFiZWwgKTtcblx0XHR9LFxuXHRcdHNldF9tYXJrZXJfbGFiZWw6ZnVuY3Rpb24obGFiZWwpIHtcblx0XHRcdHRoaXMubWFya2VyLnVuYmluZFRvb2x0aXAoKTtcblx0XHRcdHRoaXMubWFya2VyLmJpbmRUb29sdGlwKGxhYmVsKTtcblxuXHRcdFx0dGhpcy5tYXJrZXIub3B0aW9ucy50aXRsZSA9IGxhYmVsO1xuXHRcdFx0JCggdGhpcy5tYXJrZXIuX2ljb24gKS5hdHRyKCAndGl0bGUnLCBsYWJlbCApO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHR1cGRhdGVfbWFya2VyX2dlb2NvZGU6ZnVuY3Rpb24oIGxhYmVsICkge1xuXG5cdFx0XHRpZiAoIHRoaXMuaXNfZGVmYXVsdF9sYWJlbCgpICkge1xuXHRcdFx0XHQvLyB1cGRhdGUgbWFya2VyIGxhYmVsc1xuXHRcdFx0XHR0aGlzLnNldF9tYXJrZXJfbGFiZWwoIGxhYmVsICk7XG5cdFx0XHRcdC8vIHVwZGF0ZSBtYXJrZXIgbGFiZWwgaW5wdXRcblx0XHRcdH1cblxuXHRcdFx0dGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItZ2VvY29kZVwiXScpLnZhbCggbGFiZWwgKTtcblxuXHRcdFx0dGhpcy5fdXBkYXRlX3ZhbHVlc19mcm9tX21hcmtlcigpO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdF91cGRhdGVfdmFsdWVzX2Zyb21fbWFya2VyOiBmdW5jdGlvbiggKSB7XG5cdFx0XHR2YXIgbGF0bG5nID0gdGhpcy5tYXJrZXIuZ2V0TGF0TG5nKCk7XG5cdFx0XHR0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1sYXRcIl0nKS52YWwoIGxhdGxuZy5sYXQgKTtcblx0XHRcdHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWxuZ1wiXScpLnZhbCggbGF0bG5nLmxuZyApO1xuXHRcdFx0dGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItbGFiZWxcIl0nKS52YWwoIHRoaXMubWFya2VyLm9wdGlvbnMudGl0bGUgKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0aGlsaXRlX21hcmtlcjpmdW5jdGlvbihlKSB7XG5cdFx0XHR0aGlzLiRlbC5hZGRDbGFzcygnZm9jdXMnKTtcblx0XHRcdCQoIHRoaXMubWFya2VyLl9pY29uICkuYWRkQ2xhc3MoJ2ZvY3VzJylcblx0XHR9LFxuXHRcdGxvbGl0ZV9tYXJrZXI6ZnVuY3Rpb24oZSkge1xuXHRcdFx0dGhpcy4kZWwucmVtb3ZlQ2xhc3MoJ2ZvY3VzJyk7XG5cdFx0XHQkKCB0aGlzLm1hcmtlci5faWNvbiApLnJlbW92ZUNsYXNzKCdmb2N1cycpXG5cdFx0fSxcblx0XHRsb2NhdGVfbWFya2VyOmZ1bmN0aW9uKCl7XG5cdFx0XHR0aGlzLm1hcmtlci5fbWFwLmZseVRvKCB0aGlzLm1hcmtlci5nZXRMYXRMbmcoKSApO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRyZW1vdmVfbWFya2VyOmZ1bmN0aW9uKGUpIHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKVxuXHRcdFx0dGhpcy5tYXJrZXIucmVtb3ZlKCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cdH0pO1xuXG5cdG9zbS5maWVsZCA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcblxuXHRcdG1hcDogbnVsbCxcblx0XHRnZW9jb2RlcjogbnVsbCxcblx0XHR2aXNpYmxlOiBudWxsLFxuXHRcdGV2ZW50czp7XG5cdFx0fSxcblxuXHRcdCRwYXJlbnQ6ZnVuY3Rpb24oKXtcblx0XHRcdHJldHVybiB0aGlzLiRlbC5jbG9zZXN0KCcuYWNmLWZpZWxkLXNldHRpbmdzLC5hY2YtZmllbGQtb3Blbi1zdHJlZXQtbWFwJylcblx0XHR9LFxuXHRcdCR6b29tIDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnaW5wdXRbaWQkPVwiLXpvb21cIl0nKTtcblx0XHR9LFxuXHRcdCRsYXQgOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCdpbnB1dFtpZCQ9XCItY2VudGVyX2xhdFwiXScpO1xuXHRcdH0sXG5cdFx0JGxuZyA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJ2lucHV0W2lkJD1cIi1jZW50ZXJfbG5nXCJdJyk7XG5cdFx0fSxcblx0XHQkbGF5ZXJTdG9yZTogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnLmFjZi1vc20tbGF5ZXJzJyk7XG5cdFx0fSxcblx0XHQkcmVzdWx0cyA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJy5vc20tcmVzdWx0cycpO1xuXHRcdH0sXG5cdFx0JG1hcmtlcnM6ZnVuY3Rpb24oKXtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCcub3NtLW1hcmtlcnMnKTtcblx0XHR9LFxuXHRcdGluaXRpYWxpemU6ZnVuY3Rpb24oY29uZikge1xuXG5cdFx0XHR0aGlzLm1hcFx0XHQ9IGNvbmYubWFwO1xuXG5cdFx0XHR0aGlzLnVwZGF0ZV9tYXAoKTsgLy8gc2V0IG1hcCB0byBpbnB1dCB2YWx1ZXNcblxuXHRcdFx0dGhpcy5pbml0X2FjZigpO1xuXG5cdFx0XHR0aGlzLmluaXRfbGF5ZXJzKCk7XG5cblx0XHRcdHRoaXMuaW5pdF9tYXJrZXJzKCk7XG5cblx0XHRcdHRoaXMudXBkYXRlX3Zpc2libGUoKTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRfZ2V0X2dlb2NvZGVyX3Jlc3VsdF9sYWJlbDpmdW5jdGlvbiggZSwgbGF0bG5nICkge1xuXHRcdFx0dmFyIGxhYmVsID0gZmFsc2U7XG5cblx0XHRcdGlmICggISBlLmxlbmd0aCApIHtcblx0XHRcdFx0bGFiZWwgPSBsYXRsbmcubGF0LnRvU3RyaW5nKCkgKyAnLCAnICsgbGF0bG5nLmxuZy50b1N0cmluZygpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0JC5lYWNoKCBlLCBmdW5jdGlvbiggaSwgcmVzdWx0ICkge1xuXHRcdFx0XHRcdGlmICggISEgcmVzdWx0Lmh0bWwgKSB7XG5cdFx0XHRcdFx0XHRsYWJlbCA9IHJlc3VsdC5odG1sO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRsYWJlbCA9IHJlc3VsdC5uYW1lO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuICQoJzxwPicrbGFiZWwrJzwvcD4nKS50ZXh0KCkucmVwbGFjZSgvXihcXHMrKS9nLCcnKS5yZXBsYWNlKC8oXFxzKykkL2csJycpLnJlcGxhY2UoLyhcXHMrKS9nLCcgJyk7XG5cdFx0fSxcblx0XHRpbml0X21hcmtlcnM6ZnVuY3Rpb24oKXtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRlZGl0b3JfY29uZmlnID0gdGhpcy4kZWwuZGF0YSgpLmVkaXRvckNvbmZpZztcblxuXHRcdFx0dGhpcy5pbml0X2dlb2NvZGUoKTtcblxuXHRcdFx0Ly8gbm8gbWFya2VycyBhbGxvd2VkIVxuXHRcdFx0aWYgKCBlZGl0b3JfY29uZmlnLm1heF9tYXJrZXJzID09PSAwICkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuaWNvbiA9IG5ldyBMLkRpdkljb24oe1xuXHRcdFx0XHRodG1sOiAnJyxcblx0XHRcdFx0Y2xhc3NOYW1lOidvc20tbWFya2VyLWljb24nXG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5tYXAub24oJ2NsaWNrJywgZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHZhciBsYXRsbmcgPSBlLmxhdGxuZyxcblx0XHRcdFx0XHRjb3VudF9tYXJrZXJzID0gc2VsZi4kbWFya2VycygpLmNoaWxkcmVuKCkubm90KCdbZGF0YS1pZF0nKS5sZW5ndGg7XG5cblx0XHRcdFx0Ly8gbm8gbW9yZSBtYXJrZXJzXG5cdFx0XHRcdGlmICggZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyAhPT0gZmFsc2UgJiYgY291bnRfbWFya2VycyA+PSBlZGl0b3JfY29uZmlnLm1heF9tYXJrZXJzICkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHNlbGYuZ2VvY29kZXIub3B0aW9ucy5nZW9jb2Rlci5yZXZlcnNlKGUubGF0bG5nLHNlbGYubWFwLmdldFpvb20oKSxmdW5jdGlvbihlKXtcblxuXHRcdFx0XHRcdHZhciBsYWJlbCA9IHNlbGYuX2dldF9nZW9jb2Rlcl9yZXN1bHRfbGFiZWwoIGUsIGxhdGxuZyApO1xuXG5cdFx0XHRcdFx0c2VsZi5hZGRfbWFya2VyKCBsYXRsbmcsIGxhYmVsICk7XG5cblx0XHRcdFx0fSxzZWxmKTtcblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLm1hcC5vbiggJ2xheWVyYWRkJywgZnVuY3Rpb24oZSl7XG5cdFx0XHRcdGlmICggZS5sYXllci5jb25zdHJ1Y3RvciAhPT0gTC5NYXJrZXIgKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHRcdC8vIG1hcmtlciBhZGRlZFxuXHRcdFx0XHR2YXIgdGVtcGxhdGUgPSBzZWxmLiRtYXJrZXJzKCkuZmluZCgnW2RhdGEtaWQ9XCJfX29zbV9tYXJrZXJfdGVtcGxhdGVfX1wiXScpLmh0bWwoKS5zcGxpdCgnX19vc21fbWFya2VyX3RlbXBsYXRlX18nKS5qb2luKCAnPCU9IGlkICU+JyApLFxuXHRcdFx0XHRcdGVudHJ5ID0gbmV3IG9zbS5NYXJrZXJFbnRyeSh7XG5cdFx0XHRcdFx0XHRjb250cm9sbGVyOiB0aGlzLFxuXHRcdFx0XHRcdFx0bWFya2VyOiBlLmxheWVyLFxuXHRcdFx0XHRcdFx0aWQ6IGFjZi51bmlxaWQoKSwgLy9zZWxmLiRtYXJrZXJzKCkuY2hpbGRyZW4oKS5sZW5ndGgsXG5cdFx0XHRcdFx0XHR0ZW1wbGF0ZTogXy50ZW1wbGF0ZSggdGVtcGxhdGUgKSxcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRlbnRyeS5yZW5kZXIoKS4kZWwuYXBwZW5kVG8oIHNlbGYuJG1hcmtlcnMoKSApO1xuXG5cdFx0XHRcdHNlbGYuZ2VvY29kZV9tYXJrZXIoIGVudHJ5ICk7XG5cblx0XHRcdFx0ZS5sYXllclxuXHRcdFx0XHRcdC5zZXRJY29uKCBzZWxmLmljb24gKVxuXHRcdFx0XHRcdC5vbignY2xpY2snLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdFx0dGhpcy5yZW1vdmUoKTtcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5vbigncmVtb3ZlJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRcdGVudHJ5LiRlbC5yZW1vdmUoKTtcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5vbignZHJhZ2VuZCcsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0XHRzZWxmLmdlb2NvZGVfbWFya2VyKCBlbnRyeSApO1xuXHRcdFx0XHRcdFx0c2VsZi4kZWwudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQuZHJhZ2dpbmcuZW5hYmxlKCk7XG5cdFx0XHR9ICk7XG5cdFx0XHR0aGlzLm1hcC5vbiggJ2xheWVycmVtb3ZlJywgZnVuY3Rpb24oZSl7XG5cdFx0XHRcdGlmICggZS5sYXllci5jb25zdHJ1Y3RvciAhPT0gTC5NYXJrZXIgKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHNlbGYuJGVsLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0fSApO1xuXHRcdFx0Ly8gYWRkIG1hcmtlcnNcblx0XHRcdCQuZWFjaCggdGhpcy4kZWwuZGF0YSgpLm1hcE1hcmtlcnMsZnVuY3Rpb24oIGksIG1hcmtlckRhdGEgKSB7XG5cdFx0XHRcdC8vIGFkZCBtYXJrZXJzXG5cdFx0XHRcdHZhciBtYXJrZXIgPSBMLm1hcmtlciggTC5sYXRMbmcoIG1hcmtlckRhdGEubGF0ICogMSwgbWFya2VyRGF0YS5sbmcgKiAxICksIHtcblx0XHRcdFx0XHRcdHRpdGxlOiBtYXJrZXJEYXRhLmxhYmVsXG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQuYmluZFRvb2x0aXAoIG1hcmtlckRhdGEubGFiZWwgKVxuXHRcdFx0XHRcdC5hZGRUbyggc2VsZi5tYXAgKTtcblxuXHRcdFx0fSk7XG5cblx0XHR9LFxuXHRcdGdlb2NvZGVfbWFya2VyOmZ1bmN0aW9uKCBtYXJrZXJfZW50cnkgKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdGVudHJ5ID0gbWFya2VyX2VudHJ5LFxuXHRcdFx0XHRsYXRsbmcgPSBlbnRyeS5tYXJrZXIuZ2V0TGF0TG5nKCk7XG5cblx0XHRcdHNlbGYuZ2VvY29kZXIub3B0aW9ucy5nZW9jb2Rlci5yZXZlcnNlKCBsYXRsbmcsIHNlbGYubWFwLmdldFpvb20oKSwgZnVuY3Rpb24oZSl7XG5cblx0XHRcdFx0dmFyIGxhYmVsID0gc2VsZi5fZ2V0X2dlb2NvZGVyX3Jlc3VsdF9sYWJlbCggZSwgbGF0bG5nICk7XG5cblx0XHRcdFx0ZW50cnkudXBkYXRlX21hcmtlcl9nZW9jb2RlKCBsYWJlbCApO1xuXG5cdFx0XHR9LCB0aGlzICk7XG5cblx0XHR9LFxuXHRcdGFkZF9tYXJrZXI6ZnVuY3Rpb24oIGxuZ2xhdCwgbGFiZWwgKXtcblx0XHRcdEwubWFya2VyKGxuZ2xhdCx7XG5cdFx0XHRcdHRpdGxlOiBsYWJlbCxcblx0XHRcdFx0aWNvbjogdGhpcy5pY29uLFxuXHRcdFx0fSlcblx0XHRcdFx0LmJpbmRUb29sdGlwKCBsYWJlbCApXG5cdFx0XHRcdC5hZGRUbyggdGhpcy5tYXAgKTtcblx0XHRcdHRoaXMuJGVsLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdH0sXG5cdFx0bGF5ZXJfaXNfb3ZlcmxheTogZnVuY3Rpb24oICBrZXksIGxheWVyICkge1xuXHRcdFx0dmFyIHBhdHRlcm5zO1xuXG5cdFx0XHRpZiAoIGxheWVyLm9wdGlvbnMub3BhY2l0eSAmJiBsYXllci5vcHRpb25zLm9wYWNpdHkgPCAxICkge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdHBhdHRlcm5zID0gWydeKE9wZW5XZWF0aGVyTWFwfE9wZW5TZWFNYXApJyxcblx0XHRcdFx0J09wZW5NYXBTdXJmZXIuQWRtaW5Cb3VuZHMnLFxuXHRcdFx0XHQnU3RhbWVuLlRvbmVyKEh5YnJpZHxMaW5lc3xMYWJlbHMpJyxcblx0XHRcdFx0J0FjZXRhdGUuKGZvcmVncm91bmR8bGFiZWxzfHJvYWRzKScsXG5cdFx0XHRcdCdIaWxsU2hhZGluZycsXG5cdFx0XHRcdCdIeWRkYS5Sb2Fkc0FuZExhYmVscycsXG5cdFx0XHRcdCdeSnVzdGljZU1hcCcsXG5cdFx0XHRcdCdPcGVuSW5mcmFNYXAuKFBvd2VyfFRlbGVjb218UGV0cm9sZXVtfFdhdGVyKScsXG5cdFx0XHRcdCdPcGVuUHRNYXAnLFxuXHRcdFx0XHQnT3BlblJhaWx3YXlNYXAnLFxuXHRcdFx0XHQnT3BlbkZpcmVNYXAnLFxuXHRcdFx0XHQnU2FmZUNhc3QnLFxuXHRcdFx0XHQnQ2FydG9EQi5EYXJrTWF0dGVyT25seUxhYmVscycsXG5cdFx0XHRcdCdDYXJ0b0RCLlBvc2l0cm9uT25seUxhYmVscydcblx0XHRcdF07XG5cdFx0XHRyZXR1cm4ga2V5Lm1hdGNoKCcoJyArIHBhdHRlcm5zLmpvaW4oJ3wnKSArICcpJykgIT09IG51bGw7XG5cdFx0fSxcblx0XHRyZXNldF9sYXllcnM6ZnVuY3Rpb24oKSB7XG5cdFx0XHQvLyBzZXQgdGhpcy4kZWwuZGF0YSgpLm1hcExheWVycyBzbyBpdCBmaXRzXG5cdFx0XHQvLyByZW1vdmUgYWxsIG1hcCBsYXllcnNcblx0XHRcdHRoaXMubWFwLmVhY2hMYXllcihmdW5jdGlvbihsYXllcil7XG5cdFx0XHRcdGlmICggbGF5ZXIuY29uc3RydWN0b3IgPT09IEwuVGlsZUxheWVyLlByb3ZpZGVyICkge1xuXHRcdFx0XHRcdGxheWVyLnJlbW92ZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KVxuXHRcdFx0Ly8gcmVtb3ZlIGxheWVyIHN0b3JlXG5cdFx0XHR0aGlzLiRsYXllclN0b3JlKCkucmVtb3ZlKCk7XG5cblx0XHRcdC8vIHJlbW92ZSBsYXllciBjb250cm9sXG5cdFx0XHQhISB0aGlzLmxheWVyc0NvbnRyb2wgJiYgdGhpcy5sYXllcnNDb250cm9sLnJlbW92ZSgpXG5cdFx0fSxcblx0XHRpbml0X2xheWVyczpmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0c2VsZWN0ZWRMYXllcnMgPSBbXSxcblx0XHRcdFx0YmFzZUxheWVycyA9IHt9LFxuXHRcdFx0XHRvdmVybGF5cyA9IHt9LFxuXHRcdFx0XHRtYXBMYXllcnMgPSB7fSxcblx0XHRcdFx0ZWRpdG9yX2NvbmZpZyA9IHRoaXMuJGVsLmRhdGEoKS5lZGl0b3JDb25maWcsXG5cdFx0XHRcdGlzX29taXR0ZWQgPSBmdW5jdGlvbihrZXkpIHtcblxuXHRcdFx0XHRcdHJldHVybiBrZXkgPT09IG51bGwgfHwgKCAhISBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycyAmJiBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycy5pbmRleE9mKCBrZXkgKSA9PT0gLTEgKTtcblx0XHRcdFx0fSxcblx0XHRcdFx0c2V0dXBNYXAgPSBmdW5jdGlvbiggdmFsLCBrZXkgKXtcblx0XHRcdFx0XHR2YXIgbGF5ZXIsIGxheWVyX2NvbmZpZztcblx0XHRcdFx0XHRpZiAoIF8uaXNPYmplY3QodmFsKSApIHtcblx0XHRcdFx0XHRcdHJldHVybiAkLmVhY2goIHZhbCwgc2V0dXBNYXAgKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIGlzX29taXR0ZWQoa2V5KSApIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKCAhISBtYXBMYXllcnNbIGtleSBdICkge1xuXHRcdFx0XHRcdFx0bGF5ZXIgPSBtYXBMYXllcnNbIGtleSBdO1xuXHRcdFx0XHRcdFx0c2VsZi5tYXAuYWRkTGF5ZXIobGF5ZXIpXG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRcdGxheWVyID0gTC50aWxlTGF5ZXIucHJvdmlkZXIoIGtleSAvKiwgbGF5ZXJfY29uZmlnLm9wdGlvbnMqLyApO1xuXHRcdFx0XHRcdFx0fSBjYXRjaChleCkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRsYXllci5wcm92aWRlcktleSA9IGtleTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIHNlbGYubGF5ZXJfaXNfb3ZlcmxheSgga2V5LCBsYXllciApICkge1xuXHRcdFx0XHRcdFx0b3ZlcmxheXNba2V5XSA9IGxheWVyO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRiYXNlTGF5ZXJzW2tleV0gPSBsYXllcjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIHNlbGVjdGVkTGF5ZXJzLmluZGV4T2YoIGtleSApICE9PSAtMSApIHtcblx0XHRcdFx0XHRcdHNlbGYubWFwLmFkZExheWVyKGxheWVyKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH07XG5cblx0XHRcdHNlbGVjdGVkTGF5ZXJzID0gdGhpcy4kZWwuZGF0YSgpLm1hcExheWVyczsgLy8gc2hvdWxkIGJlIGxheWVyIHN0b3JlIHZhbHVlXG5cblx0XHRcdC8vIGZpbHRlciBhdmFpYWxibGUgbGF5ZXJzIGluIGZpZWxkIHZhbHVlXG5cdFx0XHRpZiAoIGVkaXRvcl9jb25maWcucmVzdHJpY3RfcHJvdmlkZXJzICE9PSBmYWxzZSAmJiBfLmlzQXJyYXkoIGVkaXRvcl9jb25maWcucmVzdHJpY3RfcHJvdmlkZXJzICkgKSB7XG5cdFx0XHRcdHNlbGVjdGVkTGF5ZXJzID0gc2VsZWN0ZWRMYXllcnMuZmlsdGVyKCBmdW5jdGlvbihlbCkge1xuXHRcdFx0XHRcdHJldHVybiBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycy5pbmRleE9mKCBlbCApICE9PSAtMTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIHNldCBkZWZhdWx0IGxheWVyXG5cdFx0XHRpZiAoICEgc2VsZWN0ZWRMYXllcnMubGVuZ3RoICkge1xuXG5cdFx0XHRcdHNlbGVjdGVkTGF5ZXJzID0gT2JqZWN0LmtleXMoIGVkaXRvcl9jb25maWcucmVzdHJpY3RfcHJvdmlkZXJzICkuc2xpY2UoIDAsIDEgKTtcblxuXHRcdFx0fVxuXG5cdFx0XHQvLyBlZGl0YWJsZSBsYXllcnMhXG5cdFx0XHRpZiAoIGVkaXRvcl9jb25maWcuYWxsb3dfcHJvdmlkZXJzICkge1xuXG5cdFx0XHRcdCQoJzxkaXYgY2xhc3M9XCJhY2Ytb3NtLWxheWVyc1wiPjwvZGl2PicpLmluc2VydEFmdGVyKCB0aGlzLiRlbCApO1xuXG5cdFx0XHRcdHRoaXMubWFwLm9uKCAnYmFzZWxheWVyY2hhbmdlIGxheWVyYWRkIGxheWVycmVtb3ZlJywgZnVuY3Rpb24oZSl7XG5cblx0XHRcdFx0XHRpZiAoICEgZS5sYXllci5wcm92aWRlcktleSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHR2YXIgJGxheWVyU3RvcmUgPSBzZWxmLiRsYXllclN0b3JlKCksXG5cdFx0XHRcdFx0XHQkdGVtcGxhdGUgPSBzZWxmLiRwYXJlbnQoKS5maW5kKCdbZGF0YS1pZD1cIl9fb3NtX2xheWVyX3RlbXBsYXRlX19cIl0nKTtcblxuXHRcdFx0XHRcdCRsYXllclN0b3JlLmh0bWwoJycpO1xuXG5cdFx0XHRcdFx0c2VsZi5tYXAuZWFjaExheWVyKGZ1bmN0aW9uKGxheWVyKSB7XG5cdFx0XHRcdFx0XHR2YXIgJGxheWVySW5wdXQ7XG5cdFx0XHRcdFx0XHRpZiAoICEgbGF5ZXIucHJvdmlkZXJLZXkgKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdC8qXG5cdFx0XHRcdFx0XHQkbGF5ZXJJbnB1dCA9ICR0ZW1wbGF0ZS5jbG9uZSgpLnJlbW92ZUF0dHIoJ2RhdGEtaWQnKTtcblx0XHRcdFx0XHRcdC8qL1xuXHRcdFx0XHRcdFx0JGxheWVySW5wdXQgPSAkKCc8aW5wdXQgdHlwZT1cImhpZGRlblwiIG5hbWU9XCInICsgZWRpdG9yX2NvbmZpZy5uYW1lX3ByZWZpeCArICdbbGF5ZXJzXVtdXCIgLz4nKTtcblx0XHRcdFx0XHRcdC8vKi9cblx0XHRcdFx0XHRcdCRsYXllcklucHV0LnZhbCggbGF5ZXIucHJvdmlkZXJLZXkgKTtcblxuXHRcdFx0XHRcdFx0aWYgKCBzZWxmLmxheWVyX2lzX292ZXJsYXkoIGxheWVyLnByb3ZpZGVyS2V5LCBsYXllciApICkge1xuXHRcdFx0XHRcdFx0XHQkbGF5ZXJTdG9yZS5hcHBlbmQoICRsYXllcklucHV0ICk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHQkbGF5ZXJTdG9yZS5wcmVwZW5kKCAkbGF5ZXJJbnB1dCApO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdHNlbGYuJGVsLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0XHR9ICk7XG5cdFx0XHR9XG5cblxuXHRcdFx0JC5lYWNoKCBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycywgc2V0dXBNYXAgKTtcbmNvbnNvbGUubG9nKGVkaXRvcl9jb25maWcucmVzdHJpY3RfcHJvdmlkZXJzKTtcblx0XHRcdC8vIC4uLiBubyBsYXllciBlZGl0aW5nIGFsbG93ZWRcblx0XHRcdGlmICggdGhpcy4kbGF5ZXJTdG9yZSgpLmxlbmd0aCApIHtcblx0XHRcdFx0dGhpcy5sYXllcnNDb250cm9sID0gTC5jb250cm9sLmxheWVycyggYmFzZUxheWVycywgb3ZlcmxheXMsIHtcblx0XHRcdFx0XHRjb2xsYXBzZWQ6IHRydWUsXG5cdFx0XHRcdFx0aGlkZVNpbmdsZUJhc2U6IHRydWUsXG5cdFx0XHRcdH0pLmFkZFRvKHRoaXMubWFwKTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdGluaXRfZ2VvY29kZTpmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRlZGl0b3JfY29uZmlnID0gdGhpcy4kZWwuZGF0YSgpLmVkaXRvckNvbmZpZztcblxuXHRcdFx0dGhpcy5tYXAuX2NvbnRyb2xDb3JuZXJzWydhYm92ZSddID0gJCgnPGRpdiBjbGFzcz1cImFjZi1vc20tYWJvdmVcIj48L2Rpdj4nKS5pbnNlcnRCZWZvcmUoIHRoaXMuJGVsICkuZ2V0KDApO1xuXG5cdFx0XHR0aGlzLmdlb2NvZGVyID0gTC5Db250cm9sLmdlb2NvZGVyKHtcblx0XHRcdFx0Y29sbGFwc2VkOiBmYWxzZSxcblx0XHRcdFx0cG9zaXRpb246J2Fib3ZlJyxcblx0XHRcdFx0cGxhY2Vob2xkZXI6J1NlYXJjaC4uLicsXG5cdFx0XHRcdGVycm9yTWVzc2FnZTonTm90aGluZyBmb3VuZC4uLicsXG5cdFx0XHRcdHNob3dSZXN1bHRJY29uczp0cnVlLFxuXHRcdFx0XHRzdWdnZXN0TWluTGVuZ3RoOjMsXG5cdFx0XHRcdHN1Z2dlc3RUaW1lb3V0OjI1MCxcblx0XHRcdFx0cXVlcnlNaW5MZW5ndGg6Myxcblx0XHRcdFx0ZGVmYXVsdE1hcmtHZW9jb2RlOmZhbHNlLFxuXHRcdFx0fSlcblx0XHRcdC5vbignbWFya2dlb2NvZGUnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHR2YXIgbGF0bG5nID0gIGUuZ2VvY29kZS5jZW50ZXIsXG5cdFx0XHRcdFx0ZWRpdG9yX2NvbmZpZyA9IHNlbGYuJGVsLmRhdGEoKS5lZGl0b3JDb25maWcsXG5cdFx0XHRcdFx0Y291bnRfbWFya2VycyA9IHNlbGYuJG1hcmtlcnMoKS5jaGlsZHJlbigpLm5vdCgnW2RhdGEtaWRdJykubGVuZ3RoLFxuXHRcdFx0XHRcdGxhYmVsID0gc2VsZi5fZ2V0X2dlb2NvZGVyX3Jlc3VsdF9sYWJlbCggWyBlLmdlb2NvZGUgXSwgbGF0bG5nICk7XG5cblx0XHRcdFx0aWYgKCBjb3VudF9tYXJrZXJzID09PSBmYWxzZSB8fCBjb3VudF9tYXJrZXJzIDwgZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyApIHtcblx0XHRcdFx0XHQvLyBhZGQgbWFya2VyIGlmIG5vIHJlc3RyaWN0aW9uIG9yIG1heCBtYXJrZXJzIG5vdCBleGNlZWRlZFxuXHRcdFx0XHRcdHNlbGYuYWRkX21hcmtlciggbGF0bG5nLCBsYWJlbCApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmICggZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyA9PT0gMSAmJiBjb3VudF9tYXJrZXJzID09PSAxICkge1xuXHRcdFx0XHRcdC8vIHVwZGF0ZSBzaW5nbGUgbWFya2VyXG5cdFx0XHRcdFx0bWFya2VyID0gc2VsZi5nZXRfZmlyc3RfbWFya2VyKCk7XG5cdFx0XHRcdFx0aWYgKCAhISBtYXJrZXIgKSB7XG5cdFx0XHRcdFx0XHRlbnRyeSA9IG1hcmtlci5vc21fY29udHJvbGxlcjtcblx0XHRcdFx0XHRcdG1hcmtlci5zZXRMYXRMbmcoIGxhdGxuZyApO1xuXHRcdFx0XHRcdFx0ZW50cnkudXBkYXRlX21hcmtlcl9nZW9jb2RlKCBsYWJlbCApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICggZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyA9PT0gMCApIHtcblx0XHRcdFx0XHRzZWxmLm1hcC5maXRCb3VuZHMoIGUuZ2VvY29kZS5iYm94ICk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c2VsZi5tYXAuc2V0VmlldyggbGF0bG5nLCBzZWxmLm1hcC5nZXRab29tKCkgKTsgLy8ga2VlcCB6b29tLCBtaWdodCBiZSBjb25mdXNpbmcgZWxzZVxuXHRcdFx0XHR9XG5cblx0XHRcdH0pXG5cdFx0XHQuYWRkVG8oIHRoaXMubWFwICk7XG5cblx0XHRcdC8vIHByZXZlbnQgd3AgcG9zdCBmb3JtIGZyb20gYmVpbmcgc3VibWl0dGVkXG5cdFx0XHRMLkRvbUV2ZW50LmFkZExpc3RlbmVyKHRoaXMuZ2VvY29kZXIuX2lucHV0LCAna2V5ZG93bicsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRpZiAoIGUua2V5Q29kZSA9PT0gMTMgKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCB0aGlzLmdlb2NvZGVyICk7XG5cdFx0fSxcblx0XHRnZXRfZmlyc3RfbWFya2VyOmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIG1hcmtlciA9IGZhbHNlO1xuXHRcdFx0dGhpcy5tYXAuZWFjaExheWVyKGZ1bmN0aW9uKGxheWVyKXtcblx0XHRcdFx0aWYgKCBsYXllci5jb25zdHJ1Y3RvciA9PT0gTC5NYXJrZXIgKSB7XG5cdFx0XHRcdFx0bWFya2VyID0gbGF5ZXI7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiBtYXJrZXI7XG5cdFx0fSxcblx0XHR1cGRhdGVfdmlzaWJsZTogZnVuY3Rpb24oKSB7XG5cblx0XHRcdGlmICggdGhpcy52aXNpYmxlID09PSB0aGlzLiRlbC5pcygnOnZpc2libGUnKSApIHtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudmlzaWJsZSA9IHRoaXMuJGVsLmlzKCc6dmlzaWJsZScpO1xuXG5cdFx0XHRpZiAoIHRoaXMudmlzaWJsZSApIHtcblx0XHRcdFx0dGhpcy5tYXAuaW52YWxpZGF0ZVNpemUoKTtcblx0XHRcdFx0dGhpcy5iaW5kX2V2ZW50cygpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH1cblx0XHRcdHRoaXMudW5iaW5kX2V2ZW50cygpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRpbml0X2FjZjogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdHRvZ2dsZV9jYiA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdC8vIG5vIGNoYW5nZVxuXHRcdFx0XHRcdHNlbGYudXBkYXRlX3Zpc2libGUoKTtcblx0XHRcdFx0fTtcblxuXHRcdFx0Ly8gZXhwYW5kL2NvbGxhcHNlIGFjZiBzZXR0aW5nXG5cdFx0XHRhY2YuYWRkQWN0aW9uKCAnc2hvdycsIHRvZ2dsZV9jYiApO1xuXHRcdFx0YWNmLmFkZEFjdGlvbiggJ2hpZGUnLCB0b2dnbGVfY2IgKTtcblx0XHRcdGFjZi5hZGRBY3Rpb24oICdkaXNhYmxlX2ZpZWxkJywgZnVuY3Rpb24oKXtcblx0XHRcdFx0c2VsZi51bmJpbmRfZXZlbnRzKCk7XG5cdFx0XHR9ICk7XG5cblx0XHRcdC8vIGV4cGFuZCB3cCBtZXRhYm94XG5cdFx0XHQkKGRvY3VtZW50KS5vbigncG9zdGJveC10b2dnbGVkJywgdG9nZ2xlX2NiICk7XG5cdFx0XHQkKGRvY3VtZW50KS5vbignY2xpY2snLCcud2lkZ2V0LXRvcCAqJywgdG9nZ2xlX2NiICk7XG5cblxuXG5cdFx0fSxcblx0XHR1bmJpbmRfZXZlbnRzOmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0c2VsZi4kbGF0KCkub2ZmKCdibHVyJyk7XG5cdFx0XHRzZWxmLiRsbmcoKS5vZmYoJ2JsdXInKTtcblx0XHRcdHNlbGYuJHpvb20oKS5vZmYoJ2JsdXInKTtcblx0XHRcdHNlbGYuJHpvb20oKS5vZmYoJ2tleXVwIGZvY3VzJyk7XG5cblx0XHRcdHRoaXMubWFwLm9mZignem9vbWVuZCcsIHRoaXMubWFwX3pvb21lZCwgdGhpcyApO1xuXHRcdFx0dGhpcy5tYXAub2ZmKCdtb3ZlZW5kJywgdGhpcy5tYXBfbW92ZWQsIHRoaXMgKTtcblx0XHR9LFxuXHRcdGJpbmRfZXZlbnRzOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi4kbGF0KCkub24oJ2JsdXInLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRzZWxmLnVwZGF0ZV9tYXAoKTtcblx0XHRcdH0pO1xuXHRcdFx0c2VsZi4kbG5nKCkub24oJ2JsdXInLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRzZWxmLnVwZGF0ZV9tYXAoKTtcblx0XHRcdH0pO1xuXHRcdFx0c2VsZi4kem9vbSgpLm9uKCdibHVyJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0c2VsZi51cGRhdGVfbWFwKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5tYXAub24oJ3pvb21lbmQnLCB0aGlzLm1hcF96b29tZWQsIHRoaXMgKTtcblx0XHRcdHRoaXMubWFwLm9uKCdtb3ZlZW5kJywgdGhpcy5tYXBfbW92ZWQsIHRoaXMgKTtcblx0XHR9LFxuXHRcdHVwZGF0ZV9tYXA6ZnVuY3Rpb24oKSB7XG5cdFx0XHRpZiAoICEgdGhpcy4kbGF0KCkudmFsKCkgfHwgISB0aGlzLiRsbmcoKS52YWwoKSApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0dmFyIGxhdGxuZyA9IEwubGF0TG5nKCB0aGlzLiRsYXQoKS52YWwoKSwgdGhpcy4kbG5nKCkudmFsKCkgKTtcblx0XHRcdHRoaXMubWFwLnNldFZpZXcoIGxhdGxuZywgIHRoaXMuJHpvb20oKS52YWwoKSApO1xuXHRcdH0sXG5cdFx0bWFwX21vdmVkOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dmFyIGNlbnRlciA9IHRoaXMubWFwLmdldENlbnRlcigpO1xuXHRcdFx0dGhpcy4kbGF0KCkudmFsKGNlbnRlci5sYXQpO1xuXHRcdFx0dGhpcy4kbG5nKCkudmFsKGNlbnRlci5sbmcpO1xuXHRcdFx0dGhpcy4kZWwudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0fSxcblx0XHRtYXBfem9vbWVkOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dGhpcy4kem9vbSgpLnZhbCggdGhpcy5tYXAuZ2V0Wm9vbSgpICk7XG5cdFx0XHR0aGlzLiRlbC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHR9XG5cdH0pO1xuXG5cblx0JChkb2N1bWVudClcblx0XHQub24oJ2FjZi1vc20tbWFwLWluaXQnLGZ1bmN0aW9uKCBlLCBtYXAgKSB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHQkKGUudGFyZ2V0KS5kYXRhKCAnX21hcF9lZGl0b3InLCBuZXcgb3NtLmZpZWxkKCB7IGVsOiBlLnRhcmdldCwgbWFwOiBtYXAgfSApICk7XG5cdFx0XHQ7XG5cdFx0fSlcblx0XHQvLyBmaWVsZCBzZXR0aW5nc1xuXHRcdC5vbignY2hhbmdlJywnW2RhdGEtbmFtZT1cInJldHVybl9mb3JtYXRcIl0gaW5wdXQnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0Ly8gZmluZCBtYXAgZmllbGRcblx0XHRcdCQoJ1tkYXRhLW5hbWU9XCJyZXR1cm5fZm9ybWF0XCJdIGlucHV0OmNoZWNrZWQnKS52YWwoKVxuXHRcdFx0dmFyICRtYXAgPSAkKHRoaXMpLmNsb3Nlc3QoJy5hY2YtZmllbGQtb2JqZWN0JykuZmluZCgnW2RhdGEtZWRpdG9yLWNvbmZpZ10nKSxcblx0XHRcdFx0ZWRpdG9yID0gJG1hcC5kYXRhKCAnX21hcF9lZGl0b3InICksXG5cdFx0XHRcdGNvbmYgPSAkbWFwLmRhdGEoJ2VkaXRvci1jb25maWcnKTtcblx0XHRcdC8vIG1hcFxuXHRcdFx0ZWRpdG9yLnJlc2V0X2xheWVycygpO1xuXHRcdFx0aWYgKCAkKHRoaXMpLnZhbCgpID09PSAnb3NtJyApIHtcblx0XHRcdFx0Ly8gc2V0IHByb3ZpZGVyIHJlc3RyaWN0aW9uIHRvIG9zbSBwcm92aWRlcnNcblx0XHRcdFx0Y29uZi5yZXN0cmljdF9wcm92aWRlcnMgPSBPYmplY3QudmFsdWVzKCBlZGl0X2FyZy5vcHRpb25zLm9zbV9sYXllcnMgKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIHNldCBwcm92aWRlciByZXN0cmljdGlvbiB0byBvc20gcHJvdmlkZXJzXG5cdFx0XHRcdGNvbmYucmVzdHJpY3RfcHJvdmlkZXJzID0gT2JqZWN0LnZhbHVlcyggZWRpdF9hcmcub3B0aW9ucy5sZWFmbGV0X2xheWVycyApO1xuXHRcdFx0fVxuXHRcdFx0JG1hcC5kYXRhKCAnZWRpdG9yLWNvbmZpZycsIGNvbmYgKTtcblx0XHRcdGVkaXRvci5pbml0X2xheWVycygpO1xuXHRcdH0pO1xuXG5cdC8vIHdoZW4gZmllbGRzIGdldCBsb2FkZWQgLi4uXG5cdGFjZi5hZGRBY3Rpb24oICdhcHBlbmQnLCBmdW5jdGlvbigpe1xuXHRcdCQuYWNmX2xlYWZsZXQoKTtcblx0fSk7XG5cbn0pKCBqUXVlcnksIGFjZl9vc21fYWRtaW4gKTtcbiJdfQ==
