!function(t){var e=acf_osm.options;console.log("sefsef");var s={};s.field=Backbone.View.extend({$map:null,$zoom:null,$lat:null,$lng:null,$address:null,$tiles:null,marker:null,icon:null,map:null,layers:[],events:{'keyup [data-prop="address"]':"search",'focus [data-prop="address"]':"search","click .osm-result":"click_result","keyup .osm-result":"keyup_result","focus .osm-result":"focus_result"},initialize:function(){this.$map=this.$el.find(".acf-osm-map"),this.$zoom=this.$el.find('[data-prop="zoom"]'),this.$lat=this.$el.find('[data-prop="center_lat"]'),this.$lng=this.$el.find('[data-prop="center_lng"]'),this.$layers=this.$el.find('[data-prop="map_layers"]'),this.$address=this.$el.find('[data-prop="address"]'),this.$results=this.$address.next(".osm-results"),this.icon=L.divIcon({className:"osm-marker",html:"",iconSize:0}),this.map=L.map(this.$map.get(0),{scrollWheelZoom:!1,center:[this.$lat.val(),this.$lng.val()],zoom:this.$zoom.val()}),this.marker=L.marker([this.$lat.val(),this.$lng.val()],{icon:this.icon,title:this.$address.val()}).addTo(this.map),console.log(this.marker),this.layers=[],this.$layers.is("select")&&acf.select2.init(this.$layers,{multiple:!0,ui:!0,allow_null:!1,ajax:!1},this.$el),this.bind_events(),this.update_layers()},bind_events:function(){var t=this;this.listenTo(this.$tiles,"change",this.update_layers),this.map.on("zoomend",function(e){t.map_zoomed.apply(t,[e])}),this.map.on("moveend",function(e){t.map_moved.apply(t,[e])}),this.map.on("click",function(e){t.map_clicked.apply(t,[e])})},map_moved:function(t){var e=this.map.getCenter();this.$lat.val(e.lat),this.$lng.val(e.lng)},map_zoomed:function(t){this.$zoom.val(this.map.getZoom())},map_clicked:function(t){this.fetch_results("https://photon.komoot.de/reverse",{lon:t.latlng.lng,lat:t.latlng.lat},function(t){var e,s=0,a=t.features.length;for(s;s<a;s++){e=this.format_result(t.features[s]);break}this.marker.title=e}),this.set_marker(t.latlng)},set_marker:function(e){t(this.marker._icon).attr("title",this.marker.title),this.marker.setLatLng(e)},update_layers:function(){var s,a,i,l,r=[];if(null!==r){for(this.$layers.each(function(){var e=t(this).val();Array.isArray(r)?r=r.concat(e):r.push(e)});this.layers.length;)this.map.removeLayer(this.layers.pop());for(l=r.length,i=0;i<l;i++)s=r[i],a=e.layer_config[s.split(".")[0]]||{},this.layers.push(L.tileLayer.provider(s,a).addTo(this.map))}},search:function(t){var e=this,s={};if(void 0!==this._wait_address&&(clearTimeout(this._wait_address),delete this._wait_address),!s.g||s.g!==this.$address.val())return 27==t.originalEvent.keyCode?(t.preventDefault(),this.$results.html(""),this.$address.blur(),!1):void(this._wait_address=setTimeout(function(){s={q:e.$address.val(),limit:5,lon:e.$lng.val(),lat:e.$lat.val()},e.fetch_results("https://photon.komoot.de/api/",s,function(t){delete this._wait_address})},666))},clear_results:function(){this.$results.html("")},build_results:function(e){var s=this,a=e.features.length,i=this.$address.val(),l=e.features;this.clear_results(),a&&t.each(l,function(e,a){var l=t('<div tabindex="'+e+'" class="osm-result"></div>'),r=s.format_result(a),n=r.replace(new RegExp("("+i.split(/[^a-z0-9]/).join("|")+")","gi"),"<strong>$1</strong>");n+="<br /><small>("+s.nice_words(a.properties.osm_value)+")</small>",l.data({text:r,bounds:a.properties.extent,coord:a.geometry.coordinates}).html(n).appendTo(s.$results)})},fetch_results:function(e,s,a){var i=this;t.ajax({url:e,method:"get",data:s,success:function(t){i.build_results(t),"function"==typeof a&&a.apply(i,[t])}})},click_result:function(e){var s=t(e.target).data(),a=L.latLng(s.coord[1],s.coord[0]);s.ext?this.map.fitBounds(L.latLngBounds(L.latLng(s.ext[1],s.ext[0]),L.latLng(s.ext[3],s.ext[2]))):this.map.setView(a,this.map.getZoom()),this.$address.val(s.text),this.clear_results(),this.marker.title=s.text,this.set_marker(a)},keyup_result:function(e){40==e.originalEvent.keyCode?(t(e.target).next(".osm-result").focus(),e.preventDefault()):38==e.originalEvent.keyCode&&(t(e.target).prev(".osm-result").focus(),e.preventDefault())},focus_result:function(e){var s=t(e.target).data();s.ext?this.map.fitBounds(L.latLngBounds(L.latLng(s.ext[1],s.ext[0]),L.latLng(s.ext[3],s.ext[2]))):this.map.setView(L.latLng(s.coord[1],s.coord[0]),this.map.getZoom())},format_result:function(t){return this.get_result_words(t).join(", ")},get_result_words:function(e){var s=[],a=["name","street","housenumber","city","postcode","state","country"];return t.each(a,function(t,a){try{e.properties[a]&&s.push(e.properties[a])}catch(t){}}),Array.from(new Set(s))},nice_words:function(t){return t.split(/[\s_]/).map(function(t){return t[0].toUpperCase()+t.substring(1)}).join(" ")}}),void 0!==acf.add_action?acf.add_action("ready append",function(t){acf.get_fields({type:"open_street_map"},t).each(function(){new s.field({el:this})})}):t(document).on("acf/setup_fields",function(e,a){t(a).find('.field[data-field_type="open_street_map"]').each(function(){new s.field({el:this})})})}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1pbnB1dC1vc20uanMiXSwibmFtZXMiOlsiJCIsIm9wdGlvbnMiLCJhY2Zfb3NtIiwiY29uc29sZSIsImxvZyIsIm9zbSIsImZpZWxkIiwiQmFja2JvbmUiLCJWaWV3IiwiZXh0ZW5kIiwiJG1hcCIsIiR6b29tIiwiJGxhdCIsIiRsbmciLCIkYWRkcmVzcyIsIiR0aWxlcyIsIm1hcmtlciIsImljb24iLCJtYXAiLCJsYXllcnMiLCJldmVudHMiLCJrZXl1cCBbZGF0YS1wcm9wPVwiYWRkcmVzc1wiXSIsImZvY3VzIFtkYXRhLXByb3A9XCJhZGRyZXNzXCJdIiwiY2xpY2sgLm9zbS1yZXN1bHQiLCJrZXl1cCAub3NtLXJlc3VsdCIsImZvY3VzIC5vc20tcmVzdWx0IiwiaW5pdGlhbGl6ZSIsInRoaXMiLCIkZWwiLCJmaW5kIiwiJGxheWVycyIsIiRyZXN1bHRzIiwibmV4dCIsIkwiLCJkaXZJY29uIiwiY2xhc3NOYW1lIiwiaHRtbCIsImljb25TaXplIiwiZ2V0Iiwic2Nyb2xsV2hlZWxab29tIiwiY2VudGVyIiwidmFsIiwiem9vbSIsInRpdGxlIiwiYWRkVG8iLCJpcyIsImFjZiIsInNlbGVjdDIiLCJpbml0IiwibXVsdGlwbGUiLCJ1aSIsImFsbG93X251bGwiLCJhamF4IiwiYmluZF9ldmVudHMiLCJ1cGRhdGVfbGF5ZXJzIiwic2VsZiIsImxpc3RlblRvIiwib24iLCJlIiwibWFwX3pvb21lZCIsImFwcGx5IiwibWFwX21vdmVkIiwibWFwX2NsaWNrZWQiLCJnZXRDZW50ZXIiLCJsYXQiLCJsbmciLCJnZXRab29tIiwiZmV0Y2hfcmVzdWx0cyIsImxvbiIsImxhdGxuZyIsInJlc3BvbnNlIiwiZm10IiwiaSIsImxlbiIsImZlYXR1cmVzIiwibGVuZ3RoIiwiZm9ybWF0X3Jlc3VsdCIsInNldF9tYXJrZXIiLCJjb29yZCIsIl9pY29uIiwiYXR0ciIsInNldExhdExuZyIsInByb3ZpZGVyIiwibGF5ZXJfY29uZmlnIiwiZWFjaCIsInYiLCJBcnJheSIsImlzQXJyYXkiLCJjb25jYXQiLCJwdXNoIiwicmVtb3ZlTGF5ZXIiLCJwb3AiLCJzcGxpdCIsInRpbGVMYXllciIsInNlYXJjaCIsImRhdGEiLCJfd2FpdF9hZGRyZXNzIiwiY2xlYXJUaW1lb3V0Iiwib3JpZ2luYWxFdmVudCIsImtleUNvZGUiLCJwcmV2ZW50RGVmYXVsdCIsImJsdXIiLCJzZXRUaW1lb3V0IiwicSIsImxpbWl0IiwiY2xlYXJfcmVzdWx0cyIsImJ1aWxkX3Jlc3VsdHMiLCJmZWF0IiwiZWwiLCIkcmVzIiwicmVwbGFjZSIsIlJlZ0V4cCIsImpvaW4iLCJuaWNlX3dvcmRzIiwicHJvcGVydGllcyIsIm9zbV92YWx1ZSIsInRleHQiLCJib3VuZHMiLCJleHRlbnQiLCJnZW9tZXRyeSIsImNvb3JkaW5hdGVzIiwiYXBwZW5kVG8iLCJ1cmwiLCJjYWxsYmFjayIsIm1ldGhvZCIsInN1Y2Nlc3MiLCJjbGlja19yZXN1bHQiLCJ0YXJnZXQiLCJsYXRMbmciLCJleHQiLCJmaXRCb3VuZHMiLCJsYXRMbmdCb3VuZHMiLCJzZXRWaWV3Iiwia2V5dXBfcmVzdWx0IiwiZm9jdXMiLCJwcmV2IiwiZm9jdXNfcmVzdWx0IiwiaGl0IiwiZ2V0X3Jlc3VsdF93b3JkcyIsImgiLCJwcm9wcyIsInByb3AiLCJlcnIiLCJmcm9tIiwiU2V0Iiwic3RyIiwicyIsInRvVXBwZXJDYXNlIiwic3Vic3RyaW5nIiwiYWRkX2FjdGlvbiIsImdldF9maWVsZHMiLCJ0eXBlIiwiZG9jdW1lbnQiLCJwb3N0Ym94IiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFVQSxHQUNULElBQUlDLEVBQVVDLFFBQVFELFFBQ3RCRSxRQUFRQyxJQUFJLFVBRVosSUFBSUMsS0FFSkEsRUFBSUMsTUFBUUMsU0FBU0MsS0FBS0MsUUFDekJDLEtBQU0sS0FDTkMsTUFBTyxLQUNQQyxLQUFNLEtBQ05DLEtBQU0sS0FDTkMsU0FBVSxLQUNWQyxPQUFRLEtBQ1JDLE9BQVEsS0FDUkMsS0FBSyxLQUNMQyxJQUFLLEtBQ0xDLFVB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LFdBQVksU0FBU2dDLEdBQ3BCLE9BQU9BLEVBQUlyRCxNQUFNLFNBQVMxRSxJQUFJLFNBQVNnSSxHQUFJLE9BQU9BLEVBQUUsR0FBR0MsY0FBZ0JELEVBQUVFLFVBQVUsS0FBT3BDLEtBQUssYUFNbkUsSUFBbkJsRSxJQUFJdUcsV0FnQmR2RyxJQUFJdUcsV0FBVyxlQUFnQixTQUFVekgsR0FHeENrQixJQUFJd0csWUFBYUMsS0FBTyxtQkFBb0IzSCxHQUFLd0QsS0FBSyxXQUVyRCxJQUFJL0UsRUFBSUMsT0FBU3NHLEdBQUlqRixXQXlCdkIzQixFQUFFd0osVUFBVS9GLEdBQUcsbUJBQW9CLFNBQVNDLEVBQUcrRixHQUU5Q3pKLEVBQUV5SixHQUFTNUgsS0FBSyw2Q0FBNkN1RCxLQUFLLFdBRWpFLElBQUkvRSxFQUFJQyxPQUFTc0csR0FBSWpGLFdBMVV6QixDQW9WRytIIiwiZmlsZSI6ImFjZi1pbnB1dC1vc20ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCQpe1xuXHR2YXIgb3B0aW9ucyA9IGFjZl9vc20ub3B0aW9ucztcblx0Y29uc29sZS5sb2coJ3NlZnNlZicpXG5cblx0dmFyIG9zbSA9IHtcblx0fTtcblx0b3NtLmZpZWxkID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXHRcdCRtYXA6IG51bGwsXG5cdFx0JHpvb206IG51bGwsXG5cdFx0JGxhdDogbnVsbCxcblx0XHQkbG5nOiBudWxsLFxuXHRcdCRhZGRyZXNzOiBudWxsLFxuXHRcdCR0aWxlczogbnVsbCxcblx0XHRtYXJrZXI6IG51bGwsXG5cdFx0aWNvbjpudWxsLFxuXHRcdG1hcDogbnVsbCxcblx0XHRsYXllcnM6W10sXG5cdFx0ZXZlbnRzOntcblx0XHRcdCdrZXl1cCBbZGF0YS1wcm9wPVwiYWRkcmVzc1wiXScgOiAnc2VhcmNoJyxcblx0XHRcdCdmb2N1cyBbZGF0YS1wcm9wPVwiYWRkcmVzc1wiXScgOiAnc2VhcmNoJyxcblxuXHRcdFx0J2NsaWNrIC5vc20tcmVzdWx0J1x0OiAnY2xpY2tfcmVzdWx0Jyxcblx0XHRcdCdrZXl1cCAub3NtLXJlc3VsdCdcdDogJ2tleXVwX3Jlc3VsdCcsXG5cdFx0XHQnZm9jdXMgLm9zbS1yZXN1bHQnXHQ6ICdmb2N1c19yZXN1bHQnLFxuXHRcdH0sXG5cdFx0aW5pdGlhbGl6ZTpmdW5jdGlvbigpIHtcblx0XHQvL1x0dGhpcy4kZWxcdFx0PSB0aGlzLmF0dHJpYnV0ZXMuJGVsO1xuXHRcdFx0dGhpcy4kbWFwXHRcdD0gdGhpcy4kZWwuZmluZCgnLmFjZi1vc20tbWFwJyk7XG5cdFx0XHR0aGlzLiR6b29tXHRcdD0gdGhpcy4kZWwuZmluZCgnW2RhdGEtcHJvcD1cInpvb21cIl0nKTtcblx0XHRcdHRoaXMuJGxhdFx0XHQ9IHRoaXMuJGVsLmZpbmQoJ1tkYXRhLXByb3A9XCJjZW50ZXJfbGF0XCJdJyk7XG5cdFx0XHR0aGlzLiRsbmdcdFx0PSB0aGlzLiRlbC5maW5kKCdbZGF0YS1wcm9wPVwiY2VudGVyX2xuZ1wiXScpO1xuXHRcdFx0dGhpcy4kbGF5ZXJzXHQ9IHRoaXMuJGVsLmZpbmQoJ1tkYXRhLXByb3A9XCJtYXBfbGF5ZXJzXCJdJyk7XG5cdFx0XHR0aGlzLiRhZGRyZXNzXHQ9IHRoaXMuJGVsLmZpbmQoJ1tkYXRhLXByb3A9XCJhZGRyZXNzXCJdJyk7XG5cdFx0XHR0aGlzLiRyZXN1bHRzXHQ9IHRoaXMuJGFkZHJlc3MubmV4dCgnLm9zbS1yZXN1bHRzJyk7XG5cdFx0XHR0aGlzLmljb25cdFx0PSBMLmRpdkljb24oIHsgY2xhc3NOYW1lOiAnb3NtLW1hcmtlcicsIGh0bWw6JycsIGljb25TaXplOjAgfSApO1xuXHRcdFx0dGhpcy5tYXBcdFx0PSBMLm1hcCggdGhpcy4kbWFwLmdldCgwKSwge1xuXHRcdFx0XHRzY3JvbGxXaGVlbFpvb206IGZhbHNlLFxuXHRcdFx0XHRjZW50ZXI6IFsgdGhpcy4kbGF0LnZhbCgpLCB0aGlzLiRsbmcudmFsKCkgXSxcblx0XHRcdFx0em9vbTogdGhpcy4kem9vbS52YWwoKVxuXHRcdFx0fSApO1xuXHRcdFx0dGhpcy5tYXJrZXJcdFx0PSBMLm1hcmtlcihcblx0XHRcdFx0WyB0aGlzLiRsYXQudmFsKCksIHRoaXMuJGxuZy52YWwoKSBdLFxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0aWNvbjp0aGlzLmljb24sXG5cdFx0XHRcdFx0dGl0bGU6dGhpcy4kYWRkcmVzcy52YWwoKVxuXHRcdFx0XHR9XG5cdFx0XHQpLmFkZFRvKHRoaXMubWFwKTtcblx0XHRcdGNvbnNvbGUubG9nKHRoaXMubWFya2VyKVxuXHRcdFx0dGhpcy5sYXllcnNcdD0gW107XG5cdFx0XHRpZiAoIHRoaXMuJGxheWVycy5pcygnc2VsZWN0JykgKSB7XG5cdFx0XHRcdGFjZi5zZWxlY3QyLmluaXQoIHRoaXMuJGxheWVycywge1xuXHRcdFx0XHRcdG11bHRpcGxlOiB0cnVlLFxuXHRcdFx0XHRcdHVpOiB0cnVlLFxuXHRcdFx0XHRcdGFsbG93X251bGw6IGZhbHNlLFxuXHRcdFx0XHRcdGFqYXg6ZmFsc2UsXG5cdFx0XHRcdH0sIHRoaXMuJGVsICk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuYmluZF9ldmVudHMoKTtcblxuXHRcdFx0dGhpcy51cGRhdGVfbGF5ZXJzKCk7XG5cdFx0fSxcblx0XHRiaW5kX2V2ZW50czogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cbi8vXHRcdFx0dGhpcy5saXN0ZW5UbyggdGhpcy4kYWRkcmVzcywgJ2tleXVwIGZvY3VzJywgdGhpcy5zZWFyY2ggKTtcblxuXHRcdFx0dGhpcy5saXN0ZW5UbyggdGhpcy4kdGlsZXMsICdjaGFuZ2UnLCB0aGlzLnVwZGF0ZV9sYXllcnMgKTtcblxuXHRcdFx0dGhpcy5tYXAub24oJ3pvb21lbmQnLCBmdW5jdGlvbihlKXsgc2VsZi5tYXBfem9vbWVkLmFwcGx5KHNlbGYsW2VdKTsgfSApO1xuXHRcdFx0dGhpcy5tYXAub24oJ21vdmVlbmQnLCBmdW5jdGlvbihlKXsgc2VsZi5tYXBfbW92ZWQuYXBwbHkoc2VsZixbZV0pOyB9ICApO1xuXHRcdFx0dGhpcy5tYXAub24oJ2NsaWNrJywgICBmdW5jdGlvbihlKXsgc2VsZi5tYXBfY2xpY2tlZC5hcHBseShzZWxmLFtlXSk7IH0gKTtcblxuXHRcdFx0Ly8gdGhpcy4kdGlsZXMub24oJ2NoYW5nZScsIGRvX2xheWVycyApXG5cdFx0XHQvLyBcdC5wcmV2KCdpbnB1dCcpLm9uKCdjaGFuZ2UnLCBkb19sYXllcnMgKTtcblxuXHRcdH0sXG5cblx0XHRtYXBfbW92ZWQ6ZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgY2VudGVyID0gdGhpcy5tYXAuZ2V0Q2VudGVyKCk7XG5cdFx0XHR0aGlzLiRsYXQudmFsKGNlbnRlci5sYXQpO1xuXHRcdFx0dGhpcy4kbG5nLnZhbChjZW50ZXIubG5nKTtcblx0XHR9LFxuXHRcdG1hcF96b29tZWQ6ZnVuY3Rpb24oZSl7XG5cdFx0XHR0aGlzLiR6b29tLnZhbCggdGhpcy5tYXAuZ2V0Wm9vbSgpICk7XG5cdFx0fSxcblx0XHRtYXBfY2xpY2tlZDpmdW5jdGlvbihlKXtcblxuXHRcdFx0dGhpcy5mZXRjaF9yZXN1bHRzKCdodHRwczovL3Bob3Rvbi5rb21vb3QuZGUvcmV2ZXJzZScsIHtcblx0XHRcdFx0bG9uOmUubGF0bG5nLmxuZyxcblx0XHRcdFx0bGF0OmUubGF0bG5nLmxhdCxcblx0XHRcdH0sIGZ1bmN0aW9uKHJlc3BvbnNlKXtcblx0XHRcdFx0dmFyIGk9MCxsZW49cmVzcG9uc2UuZmVhdHVyZXMubGVuZ3RoLGZtdDtcblx0XHRcdFx0Zm9yIChpO2k8bGVuO2krKyl7XG5cdFx0XHRcdFx0Zm10ID0gdGhpcy5mb3JtYXRfcmVzdWx0KCByZXNwb25zZS5mZWF0dXJlc1tpXSApO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHRoaXMubWFya2VyLnRpdGxlID0gZm10O1xuXHRcdFx0fSApO1xuXHRcdFx0dGhpcy5zZXRfbWFya2VyKCBlLmxhdGxuZyApO1xuXHRcdH0sXG5cdFx0c2V0X21hcmtlcjpmdW5jdGlvbihjb29yZCl7XG5cblx0XHRcdCQodGhpcy5tYXJrZXIuX2ljb24pLmF0dHIoICd0aXRsZScsIHRoaXMubWFya2VyLnRpdGxlICk7XG5cdFx0XHR0aGlzLm1hcmtlci5zZXRMYXRMbmcoY29vcmQpO1xuXHRcdH0sXG5cblx0XHR1cGRhdGVfbGF5ZXJzOiBmdW5jdGlvbigpe1xuXHRcdFx0dmFyIHZhbCA9IFtdLFxuXHRcdFx0XHRwcm92aWRlciwgbGF5ZXJfY29uZmlnLCBpLCBsZW47XG5cblx0XHRcdGlmICggbnVsbCA9PT0gdmFsICkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHR0aGlzLiRsYXllcnMuZWFjaChmdW5jdGlvbigpe1xuXHRcdFx0XHR2YXIgdiA9ICQodGhpcykudmFsKCk7XG5cdFx0XHRcdGlmICggQXJyYXkuaXNBcnJheSh2YWwpICkge1xuXHRcdFx0XHRcdHZhbCA9IHZhbC5jb25jYXQodilcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR2YWwucHVzaCh2KVxuXHRcdFx0XHR9XG5cblx0XHRcdH0pO1xuXG5cdFx0XHQvLyByZW1vdmUgbGF5ZXJzXG5cdFx0XHR3aGlsZSAoIHRoaXMubGF5ZXJzLmxlbmd0aCApIHtcblx0XHRcdFx0dGhpcy5tYXAucmVtb3ZlTGF5ZXIoIHRoaXMubGF5ZXJzLnBvcCgpICk7XG5cdFx0XHR9XG5cblx0XHRcdGxlbiA9IHZhbC5sZW5ndGg7XG5cblx0XHRcdGZvciAoIGk9MDtpPGxlbjtpKysgKSB7XG5cdFx0XHRcdHByb3ZpZGVyID0gdmFsW2ldO1xuXHRcdFx0XHRsYXllcl9jb25maWcgPSBvcHRpb25zLmxheWVyX2NvbmZpZ1sgcHJvdmlkZXIuc3BsaXQoJy4nKVswXSBdIHx8IHt9O1xuXHRcdFx0XHR0aGlzLmxheWVycy5wdXNoKCBMLnRpbGVMYXllci5wcm92aWRlciggcHJvdmlkZXIsIGxheWVyX2NvbmZpZyApLmFkZFRvKHRoaXMubWFwKSApO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0c2VhcmNoOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRkYXRhID0ge307XG5cdFx0XHRpZiAoICd1bmRlZmluZWQnICE9PSB0eXBlb2YgdGhpcy5fd2FpdF9hZGRyZXNzICkge1xuXHRcdFx0XHRjbGVhclRpbWVvdXQodGhpcy5fd2FpdF9hZGRyZXNzKTtcblx0XHRcdFx0ZGVsZXRlIHRoaXMuX3dhaXRfYWRkcmVzcztcblx0XHRcdH1cblxuXHRcdFx0aWYgKCEhIGRhdGFbJ2cnXSAmJiBkYXRhWydnJ10gPT09IHRoaXMuJGFkZHJlc3MudmFsKCkgKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCAyNyA9PSBlLm9yaWdpbmFsRXZlbnQua2V5Q29kZSApIHsgLy8gZXNjXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0dGhpcy4kcmVzdWx0cy5odG1sKCcnKTtcblx0XHRcdFx0dGhpcy4kYWRkcmVzcy5ibHVyKCk7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHRcdHRoaXMuX3dhaXRfYWRkcmVzcyA9IHNldFRpbWVvdXQoIGZ1bmN0aW9uKCl7XG5cdFx0XHRcdGRhdGEgPSB7XG5cdFx0XHRcdFx0cTpzZWxmLiRhZGRyZXNzLnZhbCgpLFxuLy9cdFx0XHRcdFx0XHRsYW5nOidkZScsIC3CtC8vIC0+IFdQLUxhbmchXG5cdFx0XHRcdFx0bGltaXQ6NSxcblx0XHRcdFx0XHRsb246c2VsZi4kbG5nLnZhbCgpLFxuXHRcdFx0XHRcdGxhdDpzZWxmLiRsYXQudmFsKCksXG5cdFx0XHRcdH07XG5cdFx0XHRcdHNlbGYuZmV0Y2hfcmVzdWx0cygnaHR0cHM6Ly9waG90b24ua29tb290LmRlL2FwaS8nLGRhdGEsIGZ1bmN0aW9uKHJlc3BvbnNlKXtcblx0XHRcdFx0XHRkZWxldGUgdGhpcy5fd2FpdF9hZGRyZXNzO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0sIDY2NiApO1xuXG5cdFx0fSxcblx0XHRjbGVhcl9yZXN1bHRzOmZ1bmN0aW9uKCl7XG5cdFx0XHR0aGlzLiRyZXN1bHRzLmh0bWwoJycpO1xuXHRcdH0sXG5cdFx0YnVpbGRfcmVzdWx0czpmdW5jdGlvbihyZXNwb25zZSl7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdGk9MCwgbGVuID0gcmVzcG9uc2UuZmVhdHVyZXMubGVuZ3RoLFxuXHRcdFx0XHRxID0gdGhpcy4kYWRkcmVzcy52YWwoKSxcblx0XHRcdFx0ZmVhdCA9IHJlc3BvbnNlLmZlYXR1cmVzOy8vc29ydF9mdXp6eSggcmVzcG9uc2UuZmVhdHVyZXMsIHEgKTtcblxuXHRcdFx0dGhpcy5jbGVhcl9yZXN1bHRzKCk7XG5cblx0XHRcdGlmICggbGVuICkge1xuXHRcdFx0XHQkLmVhY2goIGZlYXQsIGZ1bmN0aW9uKGksZWwpe1xuXHRcdFx0XHRcdHZhciAkcmVzID0gJCgnPGRpdiB0YWJpbmRleD1cIicraSsnXCIgY2xhc3M9XCJvc20tcmVzdWx0XCI+PC9kaXY+JyksXG5cdFx0XHRcdFx0XHQvLyBjb29yZCA9IGVsLmdlb21ldHJ5LmNvb3JkaW5hdGVzLFxuXHRcdFx0XHRcdFx0Ly8gZXh0ID0gZWwucHJvcGVydGllcy5leHRlbnQsXG5cdFx0XHRcdFx0XHRmbXQgPSBzZWxmLmZvcm1hdF9yZXN1bHQoIGVsICksXG5cdFx0XHRcdFx0XHRodG1sID0gZm10LnJlcGxhY2UoIG5ldyBSZWdFeHAoXCIoXCIrcS5zcGxpdCgvW15hLXowLTldLykuam9pbignfCcpK1wiKVwiLCdnaScpLFwiPHN0cm9uZz4kMTwvc3Ryb25nPlwiKTtcblx0XHRcdFx0XHRodG1sICs9ICc8YnIgLz48c21hbGw+KCcgKyBzZWxmLm5pY2Vfd29yZHMoIGVsLnByb3BlcnRpZXMub3NtX3ZhbHVlICkgKyAnKTwvc21hbGw+JztcblxuXHRcdFx0XHRcdCRyZXMuZGF0YSh7XG5cdFx0XHRcdFx0XHR0ZXh0OmZtdCxcblx0XHRcdFx0XHRcdGJvdW5kczplbC5wcm9wZXJ0aWVzLmV4dGVudCxcblx0XHRcdFx0XHRcdGNvb3JkOmVsLmdlb21ldHJ5LmNvb3JkaW5hdGVzLFxuXHRcdFx0XHRcdH0pLmh0bWwoIGh0bWwgKS5hcHBlbmRUbyhzZWxmLiRyZXN1bHRzKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHR9LFxuXHRcdGZldGNoX3Jlc3VsdHM6IGZ1bmN0aW9uKHVybCxkYXRhLCBjYWxsYmFjaykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0JC5hamF4KHtcblx0XHRcdFx0dXJsOnVybCxcblx0XHRcdFx0bWV0aG9kOidnZXQnLFxuXHRcdFx0XHRkYXRhOmRhdGEsXG5cdFx0XHRcdHN1Y2Nlc3M6ZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0XHRzZWxmLmJ1aWxkX3Jlc3VsdHMocmVzcG9uc2UpO1xuXHRcdFx0XHRcdCdmdW5jdGlvbicgPT09IHR5cGVvZiBjYWxsYmFjayAmJiBjYWxsYmFjay5hcHBseShzZWxmLFtyZXNwb25zZV0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdH0sXG5cblx0XHRjbGlja19yZXN1bHQ6ZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgZGF0YSA9ICQoZS50YXJnZXQpLmRhdGEoKSxcblx0XHRcdFx0bGF0bG5nID0gTC5sYXRMbmcoIGRhdGEuY29vcmRbMV0sIGRhdGEuY29vcmRbMF0gKTtcblxuXHRcdFx0aWYgKCBkYXRhLmV4dCApIHtcblxuXHRcdFx0XHR0aGlzLm1hcC5maXRCb3VuZHMoIEwubGF0TG5nQm91bmRzKFxuXHRcdFx0XHRcdEwubGF0TG5nKCBkYXRhLmV4dFsxXSwgZGF0YS5leHRbMF0gKSxcblx0XHRcdFx0XHRMLmxhdExuZyggZGF0YS5leHRbM10sIGRhdGEuZXh0WzJdIClcblx0XHRcdFx0KSApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5tYXAuc2V0VmlldyggbGF0bG5nLCB0aGlzLm1hcC5nZXRab29tKCkgKTtcblx0XHRcdH1cblx0XHRcdHRoaXMuJGFkZHJlc3MudmFsKCBkYXRhLnRleHQgKTtcblx0XHRcdHRoaXMuY2xlYXJfcmVzdWx0cygpO1xuXG5cdFx0XHR0aGlzLm1hcmtlci50aXRsZSA9IGRhdGEudGV4dDtcblx0XHRcdHRoaXMuc2V0X21hcmtlciggbGF0bG5nICk7XG5cdFx0fSxcblxuXHRcdGtleXVwX3Jlc3VsdDpmdW5jdGlvbihlKXtcblx0XHRcdGlmIChlLm9yaWdpbmFsRXZlbnQua2V5Q29kZSA9PSA0MCkgeyAvLyBkb3duXG5cdFx0XHRcdCQoIGUudGFyZ2V0ICkubmV4dCgnLm9zbS1yZXN1bHQnKS5mb2N1cygpO1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KClcblx0XHRcdH0gZWxzZSBpZiAoZS5vcmlnaW5hbEV2ZW50LmtleUNvZGUgPT0gMzgpIHtcblx0XHRcdFx0JCggZS50YXJnZXQgKS5wcmV2KCcub3NtLXJlc3VsdCcpLmZvY3VzKCk7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKVxuXHRcdFx0fVxuXG5cdFx0fSxcblx0XHRmb2N1c19yZXN1bHQ6ZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgZGF0YSA9ICQoZS50YXJnZXQpLmRhdGEoKTtcblxuXHRcdFx0aWYgKCBkYXRhLmV4dCApIHtcblx0XHRcdFx0dGhpcy5tYXAuZml0Qm91bmRzKCBMLmxhdExuZ0JvdW5kcyhcblx0XHRcdFx0XHRMLmxhdExuZyggZGF0YS5leHRbMV0sIGRhdGEuZXh0WzBdICksXG5cdFx0XHRcdFx0TC5sYXRMbmcoIGRhdGEuZXh0WzNdLCBkYXRhLmV4dFsyXSApXG5cdFx0XHRcdCkgKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMubWFwLnNldFZpZXcoIEwubGF0TG5nKCBkYXRhLmNvb3JkWzFdLCBkYXRhLmNvb3JkWzBdICksIHRoaXMubWFwLmdldFpvb20oKSApO1xuXHRcdFx0fVxuXG5cdFx0fSxcblxuXHRcdGZvcm1hdF9yZXN1bHQ6IGZ1bmN0aW9uKCBoaXQgKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5nZXRfcmVzdWx0X3dvcmRzKCBoaXQgKS5qb2luKCcsICcpO1xuXHRcdH0sXG5cblx0XHRnZXRfcmVzdWx0X3dvcmRzOiBmdW5jdGlvbiggaGl0ICkge1xuXG5cdFx0XHR2YXIgaCA9IFtdLFxuXHRcdFx0XHRwcm9wcyA9IFsgJ25hbWUnLCdzdHJlZXQnLCdob3VzZW51bWJlcicsJ2NpdHknLCdwb3N0Y29kZScsJ3N0YXRlJywnY291bnRyeScgXTtcblx0XHRcdCQuZWFjaChwcm9wcywgZnVuY3Rpb24oaSxwcm9wKSB7XG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0aWYgKCAhISBoaXQucHJvcGVydGllc1twcm9wXSApIHtcblx0XHRcdFx0XHRcdGgucHVzaChoaXQucHJvcGVydGllc1twcm9wXSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGNhdGNoKGVycil7fVxuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gQXJyYXkuZnJvbShuZXcgU2V0KGgpKTtcblx0XHR9LFxuXHRcdG5pY2Vfd29yZHM6IGZ1bmN0aW9uKHN0cikge1xuXHRcdFx0cmV0dXJuIHN0ci5zcGxpdCgvW1xcc19dLykubWFwKGZ1bmN0aW9uKHMpeyByZXR1cm4gc1swXS50b1VwcGVyQ2FzZSgpICsgcy5zdWJzdHJpbmcoMSk7IH0pLmpvaW4oJyAnKTtcblx0XHR9XG5cblx0fSk7XG5cblxuXHRpZiggdHlwZW9mIGFjZi5hZGRfYWN0aW9uICE9PSAndW5kZWZpbmVkJyApIHtcblxuXHRcdC8qXG5cdFx0KiAgcmVhZHkgYXBwZW5kIChBQ0Y1KVxuXHRcdCpcblx0XHQqICBUaGVzZSBhcmUgMiBldmVudHMgd2hpY2ggYXJlIGZpcmVkIGR1cmluZyB0aGUgcGFnZSBsb2FkXG5cdFx0KiAgcmVhZHkgPSBvbiBwYWdlIGxvYWQgc2ltaWxhciB0byAkKGRvY3VtZW50KS5yZWFkeSgpXG5cdFx0KiAgYXBwZW5kID0gb24gbmV3IERPTSBlbGVtZW50cyBhcHBlbmRlZCB2aWEgcmVwZWF0ZXIgZmllbGRcblx0XHQqXG5cdFx0KiAgQHR5cGVcdGV2ZW50XG5cdFx0KiAgQGRhdGVcdDIwLzA3LzEzXG5cdFx0KlxuXHRcdCogIEBwYXJhbVx0JGVsIChqUXVlcnkgc2VsZWN0aW9uKSB0aGUgalF1ZXJ5IGVsZW1lbnQgd2hpY2ggY29udGFpbnMgdGhlIEFDRiBmaWVsZHNcblx0XHQqICBAcmV0dXJuXHRuL2Fcblx0XHQqL1xuXG5cdFx0YWNmLmFkZF9hY3Rpb24oJ3JlYWR5IGFwcGVuZCcsIGZ1bmN0aW9uKCAkZWwgKXtcblxuXHRcdFx0Ly8gc2VhcmNoICRlbCBmb3IgZmllbGRzIG9mIHR5cGUgJ0ZJRUxEX05BTUUnXG5cdFx0XHRhY2YuZ2V0X2ZpZWxkcyh7IHR5cGUgOiAnb3Blbl9zdHJlZXRfbWFwJ30sICRlbCkuZWFjaChmdW5jdGlvbigpe1xuXG5cdFx0XHRcdG5ldyBvc20uZmllbGQoIHsgZWw6IHRoaXMgfSApO1xuXG5cdFx0XHR9KTtcblxuXHRcdH0pO1xuXG5cblx0fSBlbHNlIHtcblxuXG5cdFx0Lypcblx0XHQqICBhY2Yvc2V0dXBfZmllbGRzIChBQ0Y0KVxuXHRcdCpcblx0XHQqICBUaGlzIGV2ZW50IGlzIHRyaWdnZXJlZCB3aGVuIEFDRiBhZGRzIGFueSBuZXcgZWxlbWVudHMgdG8gdGhlIERPTS5cblx0XHQqXG5cdFx0KiAgQHR5cGVcdGZ1bmN0aW9uXG5cdFx0KiAgQHNpbmNlXHQxLjAuMFxuXHRcdCogIEBkYXRlXHQwMS8wMS8xMlxuXHRcdCpcblx0XHQqICBAcGFyYW1cdGV2ZW50XHRcdGU6IGFuIGV2ZW50IG9iamVjdC4gVGhpcyBjYW4gYmUgaWdub3JlZFxuXHRcdCogIEBwYXJhbVx0RWxlbWVudFx0XHRwb3N0Ym94OiBBbiBlbGVtZW50IHdoaWNoIGNvbnRhaW5zIHRoZSBuZXcgSFRNTFxuXHRcdCpcblx0XHQqICBAcmV0dXJuXHRuL2Fcblx0XHQqL1xuXG5cdFx0JChkb2N1bWVudCkub24oJ2FjZi9zZXR1cF9maWVsZHMnLCBmdW5jdGlvbihlLCBwb3N0Ym94KXtcblxuXHRcdFx0JChwb3N0Ym94KS5maW5kKCcuZmllbGRbZGF0YS1maWVsZF90eXBlPVwib3Blbl9zdHJlZXRfbWFwXCJdJykuZWFjaChmdW5jdGlvbigpe1xuXG5cdFx0XHRcdG5ldyBvc20uZmllbGQoIHsgZWw6IHRoaXMgfSApO1xuXG5cdFx0XHR9KTtcblxuXHRcdH0pO1xuXG5cblx0fVxuXG5cbn0pKGpRdWVyeSk7XG4iXX0=
