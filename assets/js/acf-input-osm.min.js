!function(e,t,r){var a=(t.options,{});a.MarkerList=Backbone.View.extend({}),a.MarkerEntry=Backbone.View.extend({tagName:"div",className:"osm-marker",events:{'click [data-name="locate-marker"]':"locate_marker",'click [data-name="remove-marker"]':"remove_marker",'change [id$="-marker-label"]':"update_marker_label"},get_label:function(){return this.$el.find('[id$="-marker-label"]').val()},get_default_label:function(){return this.$el.find('[id$="-marker-geocode"]').val()},is_default_label:function(){return this.get_default_label()===this.get_label()},initialize:function(e){return this.template=e.template,this.marker=e.marker,this.marker.osm_controller=this,this},render:function(){var t=this;return this.$el.html(this.template(this)),this._update_values_from_marker(),this.$el.find('[id$="-marker-label"]').on("focus",function(e){t.hilite_marker()}).on("blur",function(e){t.lolite_marker()}),e(this.marker._icon).on("focus",function(e){t.hilite_marker()}).on("blur",function(e){t.lolite_marker()}),this},update_marker_label:function(t){var r=this.get_label();return""===r&&(r=this.get_default_label()),e(t.target).val(r),this.set_marker_label(r)},set_marker_label:function(t){return this.marker.unbindTooltip(),this.marker.bindTooltip(t),this.marker.options.title=t,e(this.marker._icon).attr("title",t),this},update_marker_geocode:function(e){return this.is_default_label()&&this.set_marker_label(e),this.$el.find('[id$="-marker-geocode"]').val(e),this._update_values_from_marker(),this},_update_values_from_marker:function(){var e=this.marker.getLatLng();return this.$el.find('[id$="-marker-lat"]').val(e.lat),this.$el.find('[id$="-marker-lng"]').val(e.lng),this.$el.find('[id$="-marker-label"]').val(this.marker.options.title),this},hilite_marker:function(t){this.$el.addClass("focus"),e(this.marker._icon).addClass("focus")},lolite_marker:function(t){this.$el.removeClass("focus"),e(this.marker._icon).removeClass("focus")},locate_marker:function(){return this.marker._map.flyTo(this.marker.getLatLng()),this},remove_marker:function(e){return e.preventDefault(),this.marker.remove(),this}}),a.field=Backbone.View.extend({map:null,geocoder:null,visible:null,events:{},$parent:function(){return this.$el.closest(".acf-field-settings,.acf-field-open-street-map")},$zoom:function(){return this.$parent().find('input[id$="-zoom"]')},$lat:function(){return this.$parent().find('input[id$="-center_lat"]')},$lng:function(){return this.$parent().find('input[id$="-center_lng"]')},$layerStore:function(){return this.$parent().find(".acf-osm-layers")},$results:function(){return this.$parent().find(".osm-results")},$markers:function(){return this.$parent().find(".osm-markers")},initialize:function(e){return this.map=e.map,this.update_map(),this.init_acf(),this.init_layers(),this.init_markers(),this.update_visible(),this},_get_geocoder_result_label:function(t,r){var a=!1;return t.length?e.each(t,function(e,t){return a=t.html?t.html:t.name,!1}):a=r.lat.toString()+", "+r.lng.toString(),e("<p>"+a+"</p>").text().replace(/^(\s+)/g,"").replace(/(\s+)$/g,"").replace(/(\s+)/g," ")},init_markers:function(){var t=this,r=this.$el.data().editorConfig;this.init_geocode(),0!==r.max_markers&&(this.icon=new L.DivIcon({html:"",className:"osm-marker-icon"}),this.map.on("click",function(e){var a=e.latlng,i=t.$markers().children().not("[data-id]").length;!1!==r.max_markers&&i>=r.max_markers||t.geocoder.options.geocoder.reverse(e.latlng,t.map.getZoom(),function(e){var r=t._get_geocoder_result_label(e,a);t.add_marker(a,r)},t)}),this.map.on("layeradd",function(e){if(e.layer.constructor===L.Marker){var r=t.$markers().find('[data-id="__osm_marker_template__"]').html().split("__osm_marker_template__").join("<%= id %>"),i=new a.MarkerEntry({controller:this,marker:e.layer,id:acf.uniqid(),template:_.template(r)});i.render().$el.appendTo(t.$markers()),t.geocode_marker(i),e.layer.setIcon(t.icon).on("click",function(e){this.remove()}).on("remove",function(e){i.$el.remove()}).on("dragend",function(e){t.geocode_marker(i),t.$el.trigger("change")}).dragging.enable()}}),this.map.on("layerremove",function(e){e.layer.constructor===L.Marker&&t.$el.trigger("change")}),e.each(this.$el.data().mapMarkers,function(e,r){L.marker(L.latLng(1*r.lat,1*r.lng),{title:r.label}).bindTooltip(r.label).addTo(t.map)}))},geocode_marker:function(e){var t=this,r=e,a=r.marker.getLatLng();t.geocoder.options.geocoder.reverse(a,t.map.getZoom(),function(e){var i=t._get_geocoder_result_label(e,a);r.update_marker_geocode(i)},this)},add_marker:function(e,t){L.marker(e,{title:t,icon:this.icon}).bindTooltip(t).addTo(this.map),this.$el.trigger("change")},layer_is_overlay:function(e,t){var r;return!!(t.options.opacity&&t.options.opacity<1)||(r=["^(OpenWeatherMap|OpenSeaMap)","OpenMapSurfer.AdminBounds","Stamen.Toner(Hybrid|Lines|Labels)","Acetate.(foreground|labels|roads)","HillShading","Hydda.RoadsAndLabels","^JusticeMap","OpenInfraMap.(Power|Telecom|Petroleum|Water)","OpenPtMap","OpenRailwayMap","OpenFireMap","SafeCast","CartoDB.DarkMatterOnlyLabels","CartoDB.PositronOnlyLabels"],null!==e.match("("+r.join("|")+")"))},reset_layers:function(){this.map.eachLayer(function(e){e.constructor===L.TileLayer.Provider&&e.remove()}),this.$layerStore().remove(),!!this.layersControl&&this.layersControl.remove()},init_layers:function(){var t=this,r=[],a={},i={},n={},o=this.$el.data().editorConfig,s=function(e){return null===e||!!o.restrict_providers&&-1===o.restrict_providers.indexOf(e)},l=function(o,d){var c;if(_.isObject(o))return e.each(o,l);if(!s(d)){if(n[d])c=n[d],t.map.addLayer(c);else{try{c=L.tileLayer.provider(d)}catch(e){return}c.providerKey=d}t.layer_is_overlay(d,c)?i[d]=c:a[d]=c,-1!==r.indexOf(d)&&t.map.addLayer(c)}};r=this.$el.data().mapLayers,!1!==o.restrict_providers&&_.isArray(o.restrict_providers)&&(r=r.filter(function(e){return-1!==o.restrict_providers.indexOf(e)})),r.length||(r=Object.keys(o.restrict_providers).slice(0,1)),o.allow_providers&&(e('<div class="acf-osm-layers"></div>').insertAfter(this.$el),this.map.on("baselayerchange layeradd layerremove",function(r){if(r.layer.providerKey){var a=t.$layerStore();t.$parent().find('[data-id="__osm_layer_template__"]');a.html(""),t.map.eachLayer(function(r){var i;r.providerKey&&(i=e('<input type="hidden" name="'+o.name_prefix+'[layers][]" />'),i.val(r.providerKey),t.layer_is_overlay(r.providerKey,r)?a.append(i):a.prepend(i))}),t.$el.trigger("change")}})),e.each(o.restrict_providers,l),this.$layerStore().length&&(this.layersControl=L.control.layers(a,i,{collapsed:!0,hideSingleBase:!0}).addTo(this.map))},init_geocode:function(){var t=this;this.$el.data().editorConfig;this.map._controlCorners.above=e('<div class="acf-osm-above"></div>').insertBefore(this.$el).get(0),this.geocoder=L.Control.geocoder({collapsed:!1,position:"above",placeholder:"Search...",errorMessage:"Nothing found...",showResultIcons:!0,suggestMinLength:3,suggestTimeout:250,queryMinLength:3,defaultMarkGeocode:!1}).on("markgeocode",function(e){var r=e.geocode.center,a=t.$el.data().editorConfig,i=t.$markers().children().not("[data-id]").length,n=t._get_geocoder_result_label([e.geocode],r);(!1===i||i<a.max_markers)&&t.add_marker(r,n),1===a.max_markers&&1===i&&(marker=t.get_first_marker(),marker&&(entry=marker.osm_controller,marker.setLatLng(r),entry.update_marker_geocode(n))),0===a.max_markers?t.map.fitBounds(e.geocode.bbox):t.map.setView(r,t.map.getZoom())}).addTo(this.map),L.DomEvent.addListener(this.geocoder._input,"keydown",function(e){13===e.keyCode&&e.preventDefault()},this.geocoder)},get_first_marker:function(){var e=!1;return this.map.eachLayer(function(t){if(t.constructor===L.Marker)return e=t,!1}),e},update_visible:function(){return this.visible===this.$el.is(":visible")?this:(this.visible=this.$el.is(":visible"),this.visible?(this.map.invalidateSize(),this.bind_events(),this):(this.unbind_events(),this))},init_acf:function(){var t=this,r=function(){t.update_visible()};acf.addAction("show",r),acf.addAction("hide",r),acf.addAction("disable_field",function(){t.unbind_events()}),e(document).on("postbox-toggled",r),e(document).on("click",".widget-top *",r)},unbind_events:function(){var e=this;e.$lat().off("blur"),e.$lng().off("blur"),e.$zoom().off("blur"),e.$zoom().off("keyup focus"),this.map.off("zoomend",this.map_zoomed,this),this.map.off("moveend",this.map_moved,this)},bind_events:function(){var e=this;e.$lat().on("blur",function(t){e.update_map()}),e.$lng().on("blur",function(t){e.update_map()}),e.$zoom().on("blur",function(t){e.update_map()}),this.map.on("zoomend",this.map_zoomed,this),this.map.on("moveend",this.map_moved,this)},update_map:function(){if(this.$lat().val()&&this.$lng().val()){var e=L.latLng(this.$lat().val(),this.$lng().val());this.map.setView(e,this.$zoom().val())}},map_moved:function(e){var t=this.map.getCenter();this.$lat().val(t.lat),this.$lng().val(t.lng),this.$el.trigger("change")},map_zoomed:function(e){this.$zoom().val(this.map.getZoom()),this.$el.trigger("change")}}),e(document).on("acf-osm-map-init",function(t,r){e(t.target).is("[data-editor-config]")&&(t.preventDefault(),e(t.target).data("_map_editor",new a.field({el:t.target,map:r})))}).on("change",'[data-name="return_format"] input',function(t){e('[data-name="return_format"] input:checked').val();var r=e(this).closest(".acf-field-object").find("[data-editor-config]"),a=r.data("_map_editor"),i=r.data("editor-config");a.reset_layers(),"osm"===e(this).val()?i.restrict_providers=Object.values((void 0).options.osm_layers):i.restrict_providers=Object.values((void 0).options.leaflet_layers),r.data("editor-config",i),a.init_layers()}),acf.addAction("append",function(){e.acf_leaflet()})}(jQuery,acf_osm_admin);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1pbnB1dC1vc20uanMiXSwibmFtZXMiOlsiJCIsImFyZyIsImVkaXRfYXJnIiwib3NtIiwib3B0aW9ucyIsIk1hcmtlckxpc3QiLCJCYWNrYm9uZSIsIlZpZXciLCJleHRlbmQiLCJNYXJrZXJFbnRyeSIsInRhZ05hbWUiLCJjbGFzc05hbWUiLCJldmVudHMiLCJjbGljayBbZGF0YS1uYW1lPVwibG9jYXRlLW1hcmtlclwiXSIsImNsaWNrIFtkYXRhLW5hbWU9XCJyZW1vdmUtbWFya2VyXCJdIiwiY2hhbmdlIFtpZCQ9XCItbWFya2VyLWxhYmVsXCJdIiwiZ2V0X2xhYmVsIiwidGhpcyIsIiRlbCIsImZpbmQiLCJ2YWwiLCJnZXRfZGVmYXVsdF9sYWJlbCIsImlzX2RlZmF1bHRfbGFiZWwiLCJpbml0aWFsaXplIiwib3B0IiwidGVtcGxhdGUiLCJtYXJrZXIiLCJvc21fY29udHJvbGxlciIsInJlbmRlciIsInNlbGYiLCJodG1sIiwiX3VwZGF0ZV92YWx1ZXNfZnJvbV9tYXJrZXIiLCJvbiIsImUiLCJoaWxpdGVfbWFya2VyIiwibG9saXRlX21hcmtlciIsIl9pY29uIiwidXBkYXRlX21hcmtlcl9sYWJlbCIsImxhYmVsIiwidGFyZ2V0Iiwic2V0X21hcmtlcl9sYWJlbCIsInVuYmluZFRvb2x0aXAiLCJiaW5kVG9vbHRpcCIsInRpdGxlIiwiYXR0ciIsInVwZGF0ZV9tYXJrZXJfZ2VvY29kZSIsImxhdGxuZyIsImdldExhdExuZyIsImxhdCIsImxuZyIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiLCJsb2NhdGVfbWFya2VyIiwiX21hcCIsImZseVRvIiwicmVtb3ZlX21hcmtlciIsInByZXZlbnREZWZhdWx0IiwicmVtb3ZlIiwiZmllbGQiLCJtYXAiLCJnZW9jb2RlciIsInZpc2libGUiLCIkcGFyZW50IiwiY2xvc2VzdCIsIiR6b29tIiwiJGxhdCIsIiRsbmciLCIkbGF5ZXJTdG9yZSIsIiRyZXN1bHRzIiwiJG1hcmtlcnMiLCJjb25mIiwidXBkYXRlX21hcCIsImluaXRfYWNmIiwiaW5pdF9sYXllcnMiLCJpbml0X21hcmtlcnMiLCJ1cGRhdGVfdmlzaWJsZSIsIl9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsIiwibGVuZ3RoIiwiZWFjaCIsImkiLCJyZXN1bHQiLCJuYW1lIiwidG9TdHJpbmciLCJ0ZXh0IiwicmVwbGFjZSIsImVkaXRvcl9jb25maWciLCJkYXRhIiwiZWRpdG9yQ29uZmlnIiwiaW5pdF9nZW9jb2RlIiwibWF4X21hcmtlcnMiLCJpY29uIiwiTCIsIkRpdkljb24iLCJjb3VudF9tYXJrZXJzIiwiY2hpbGRyZW4iLCJub3QiLCJyZXZlcnNlIiwiZ2V0Wm9vbSIsImFkZF9tYXJrZXIiLCJsYXllciIsImNvbnN0cnVjdG9yIiwiTWFya2VyIiwic3BsaXQiLCJqb2luIiwiZW50cnkiLCJjb250cm9sbGVyIiwiaWQiLCJhY2YiLCJ1bmlxaWQiLCJfIiwiYXBwZW5kVG8iLCJnZW9jb2RlX21hcmtlciIsInNldEljb24iLCJ0cmlnZ2VyIiwiZHJhZ2dpbmciLCJlbmFibGUiLCJtYXBNYXJrZXJzIiwibWFya2VyRGF0YSIsImxhdExuZyIsImFkZFRvIiwibWFya2VyX2VudHJ5IiwibG5nbGF0IiwibGF5ZXJfaXNfb3ZlcmxheSIsImtleSIsInBhdHRlcm5zIiwib3BhY2l0eSIsIm1hdGNoIiwicmVzZXRfbGF5ZXJzIiwiZWFjaExheWVyIiwiVGlsZUxheWVyIiwiUHJvdmlkZXIiLCJsYXllcnNDb250cm9sIiwic2VsZWN0ZWRMYXllcnMiLCJiYXNlTGF5ZXJzIiwib3ZlcmxheXMiLCJtYXBMYXllcnMiLCJpc19vbWl0dGVkIiwicmVzdHJpY3RfcHJvdmlkZXJzIiwiaW5kZXhPZiIsInNldHVwTWFwIiwiaXNPYmplY3QiLCJhZGRMYXllciIsInRpbGVMYXllciIsInByb3ZpZGVyIiwiZXgiLCJwcm92aWRlcktleSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJlbCIsIk9iamVjdCIsImtleXMiLCJzbGljZSIsImFsbG93X3Byb3ZpZGVycyIsImluc2VydEFmdGVyIiwiJGxheWVySW5wdXQiLCJuYW1lX3ByZWZpeCIsImFwcGVuZCIsInByZXBlbmQiLCJjb250cm9sIiwibGF5ZXJzIiwiY29sbGFwc2VkIiwiaGlkZVNpbmdsZUJhc2UiLCJfY29udHJvbENvcm5lcnMiLCJpbnNlcnRCZWZvcmUiLCJnZXQiLCJDb250cm9sIiwicG9zaXRpb24iLCJwbGFjZWhvbGRlciIsImVycm9yTWVzc2FnZSIsInNob3dSZXN1bHRJY29ucyIsInN1Z2dlc3RNaW5MZW5ndGgiLCJzdWdnZXN0VGltZW91dCIsInF1ZXJ5TWluTGVuZ3RoIiwiZGVmYXVsdE1hcmtHZW9jb2RlIiwiZ2VvY29kZSIsImNlbnRlciIsImdldF9maXJzdF9tYXJrZXIiLCJzZXRMYXRMbmciLCJmaXRCb3VuZHMiLCJiYm94Iiwic2V0VmlldyIsIkRvbUV2ZW50IiwiYWRkTGlzdGVuZXIiLCJfaW5wdXQiLCJrZXlDb2RlIiwiaXMiLCJpbnZhbGlkYXRlU2l6ZSIsImJpbmRfZXZlbnRzIiwidW5iaW5kX2V2ZW50cyIsInRvZ2dsZV9jYiIsImFkZEFjdGlvbiIsImRvY3VtZW50Iiwib2ZmIiwibWFwX3pvb21lZCIsIm1hcF9tb3ZlZCIsImdldENlbnRlciIsIiRtYXAiLCJlZGl0b3IiLCJ2YWx1ZXMiLCJvc21fbGF5ZXJzIiwibGVhZmxldF9sYXllcnMiLCJhY2ZfbGVhZmxldCIsImpRdWVyeSIsImFjZl9vc21fYWRtaW4iXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEVBQUFDLEdBQ0EsR0FNQUMsSUFOQUYsRUFBQUcsV0FTQUQsR0FBQUUsV0FBQUMsU0FBQUMsS0FBQUMsV0FFQUwsRUFBQU0sWUFBQUgsU0FBQUMsS0FBQUMsUUFDQUUsUUFBQSxNQUNBQyxVQUFBLGFBQ0FDLFFBQ0FDLG9DQUFBLGdCQUNBQyxvQ0FBQSxnQkFDQUMsK0JBQUEsdUJBR0FDLFVBQUEsV0FDQSxNQUFBQyxNQUFBQyxJQUFBQyxLQUFBLHlCQUFBQyxPQUVBQyxrQkFBQSxXQUNBLE1BQUFKLE1BQUFDLElBQUFD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RUFBQW1FLG1CQUFBWSxPQUFBaUQsWUF4bEJBLElBd2xCQWxNLFFBQUFvTSxnQkFFQUosRUFBQTlHLEtBQUEsZ0JBQUFoQixHQUNBK0gsRUFBQTVILGdCQUlBa0MsSUFBQW1GLFVBQUEsU0FBQSxXQUNBOUwsRUFBQXlNLGlCQUdBQyxPQUFBQyIsImZpbGUiOiJhY2YtaW5wdXQtb3NtLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiggJCwgYXJnLCBlZGl0X2FyZyApe1xuXHR2YXIgb3B0aW9ucyA9IGFyZy5vcHRpb25zLFxuXHRcdHJlc3VsdF90cGwgPSAnPGRpdiB0YWJpbmRleD1cIjwlPSBkYXRhLmkgJT5cIiBjbGFzcz1cIm9zbS1yZXN1bHRcIj4nXG5cdFx0XHQrICc8JT0gZGF0YS5yZXN1bHRfdGV4dCAlPidcblx0XHRcdCsgJzxiciAvPjxzbWFsbD48JT0gZGF0YS5wcm9wZXJ0aWVzLm9zbV92YWx1ZSAlPjwvc21hbGw+J1xuXHRcdFx0KyAnPC9kaXY+JztcblxuXHR2YXIgb3NtID0ge1xuXHR9O1xuXG5cdG9zbS5NYXJrZXJMaXN0ID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXHR9KVxuXHRvc20uTWFya2VyRW50cnkgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG5cdFx0dGFnTmFtZTogJ2RpdicsXG5cdFx0Y2xhc3NOYW1lOidvc20tbWFya2VyJyxcblx0XHRldmVudHM6IHtcblx0XHRcdCdjbGljayBbZGF0YS1uYW1lPVwibG9jYXRlLW1hcmtlclwiXScgOiAnbG9jYXRlX21hcmtlcicsXG5cdFx0XHQnY2xpY2sgW2RhdGEtbmFtZT1cInJlbW92ZS1tYXJrZXJcIl0nIDogJ3JlbW92ZV9tYXJrZXInLFxuXHRcdFx0J2NoYW5nZSBbaWQkPVwiLW1hcmtlci1sYWJlbFwiXSdcdFx0OiAndXBkYXRlX21hcmtlcl9sYWJlbCcsXG4vL1x0XHRcdCdmb2N1cyBbdHlwZT1cInRleHRcIl0nXHRcdFx0XHQ6ICdoaWxpdGVfbWFya2VyJ1xuXHRcdH0sXG5cdFx0Z2V0X2xhYmVsOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1sYWJlbFwiXScpLnZhbCgpO1xuXHRcdH0sXG5cdFx0Z2V0X2RlZmF1bHRfbGFiZWw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWdlb2NvZGVcIl0nKS52YWwoKTtcblx0XHR9LFxuXHRcdGlzX2RlZmF1bHRfbGFiZWw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuZ2V0X2RlZmF1bHRfbGFiZWwoKSA9PT0gdGhpcy5nZXRfbGFiZWwoKTtcblx0XHR9LFxuXHRcdGluaXRpYWxpemU6ZnVuY3Rpb24ob3B0KXtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblx0XHRcdHRoaXMudGVtcGxhdGUgPSBvcHQudGVtcGxhdGU7XG5cdFx0XHR0aGlzLm1hcmtlciA9IG9wdC5tYXJrZXI7XG5cdFx0XHR0aGlzLm1hcmtlci5vc21fY29udHJvbGxlciA9IHRoaXM7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0cmVuZGVyOmZ1bmN0aW9uKCl7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHRoaXMuJGVsLmh0bWwoIHRoaXMudGVtcGxhdGUoIHRoaXMgKSApO1xuXHRcdFx0dGhpcy5fdXBkYXRlX3ZhbHVlc19mcm9tX21hcmtlcigpO1xuXG5cdFx0XHR0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1sYWJlbFwiXScpXG5cdFx0XHRcdC5vbignZm9jdXMnLGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHRzZWxmLmhpbGl0ZV9tYXJrZXIoKTtcblx0XHRcdFx0fSlcblx0XHRcdFx0Lm9uKCdibHVyJyxmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0c2VsZi5sb2xpdGVfbWFya2VyKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0JCh0aGlzLm1hcmtlci5faWNvbilcblx0XHRcdFx0Lm9uKCdmb2N1cycsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0c2VsZi5oaWxpdGVfbWFya2VyKCk7XG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5vbignYmx1cicsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0c2VsZi5sb2xpdGVfbWFya2VyKCk7XG5cdFx0XHRcdH0pXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHVwZGF0ZV9tYXJrZXJfbGFiZWw6ZnVuY3Rpb24oZSkge1xuXHRcdFx0dmFyIGxhYmVsID0gdGhpcy5nZXRfbGFiZWwoKTtcblxuXHRcdFx0aWYgKCBsYWJlbCA9PT0gJycgKSB7XG5cdFx0XHRcdGxhYmVsID0gdGhpcy5nZXRfZGVmYXVsdF9sYWJlbCgpO1xuXHRcdFx0fVxuXHRcdFx0Ly8gcmVzdG9yZSBnZW9jb2RlIGRlZmF1bHRcblx0XHRcdCQoZS50YXJnZXQpLnZhbChsYWJlbCk7XG5cblx0XHRcdHJldHVybiB0aGlzLnNldF9tYXJrZXJfbGFiZWwoIGxhYmVsICk7XG5cdFx0fSxcblx0XHRzZXRfbWFya2VyX2xhYmVsOmZ1bmN0aW9uKGxhYmVsKSB7XG5cdFx0XHR0aGlzLm1hcmtlci51bmJpbmRUb29sdGlwKCk7XG5cdFx0XHR0aGlzLm1hcmtlci5iaW5kVG9vbHRpcChsYWJlbCk7XG5cblx0XHRcdHRoaXMubWFya2VyLm9wdGlvbnMudGl0bGUgPSBsYWJlbDtcblx0XHRcdCQoIHRoaXMubWFya2VyLl9pY29uICkuYXR0ciggJ3RpdGxlJywgbGFiZWwgKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0dXBkYXRlX21hcmtlcl9nZW9jb2RlOmZ1bmN0aW9uKCBsYWJlbCApIHtcblxuXHRcdFx0aWYgKCB0aGlzLmlzX2RlZmF1bHRfbGFiZWwoKSApIHtcblx0XHRcdFx0Ly8gdXBkYXRlIG1hcmtlciBsYWJlbHNcblx0XHRcdFx0dGhpcy5zZXRfbWFya2VyX2xhYmVsKCBsYWJlbCApO1xuXHRcdFx0XHQvLyB1cGRhdGUgbWFya2VyIGxhYmVsIGlucHV0XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWdlb2NvZGVcIl0nKS52YWwoIGxhYmVsICk7XG5cblx0XHRcdHRoaXMuX3VwZGF0ZV92YWx1ZXNfZnJvbV9tYXJrZXIoKTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRfdXBkYXRlX3ZhbHVlc19mcm9tX21hcmtlcjogZnVuY3Rpb24oICkge1xuXHRcdFx0dmFyIGxhdGxuZyA9IHRoaXMubWFya2VyLmdldExhdExuZygpO1xuXHRcdFx0dGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItbGF0XCJdJykudmFsKCBsYXRsbmcubGF0ICk7XG5cdFx0XHR0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1sbmdcIl0nKS52YWwoIGxhdGxuZy5sbmcgKTtcblx0XHRcdHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWxhYmVsXCJdJykudmFsKCB0aGlzLm1hcmtlci5vcHRpb25zLnRpdGxlICk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdGhpbGl0ZV9tYXJrZXI6ZnVuY3Rpb24oZSkge1xuXHRcdFx0dGhpcy4kZWwuYWRkQ2xhc3MoJ2ZvY3VzJyk7XG5cdFx0XHQkKCB0aGlzLm1hcmtlci5faWNvbiApLmFkZENsYXNzKCdmb2N1cycpXG5cdFx0fSxcblx0XHRsb2xpdGVfbWFya2VyOmZ1bmN0aW9uKGUpIHtcblx0XHRcdHRoaXMuJGVsLnJlbW92ZUNsYXNzKCdmb2N1cycpO1xuXHRcdFx0JCggdGhpcy5tYXJrZXIuX2ljb24gKS5yZW1vdmVDbGFzcygnZm9jdXMnKVxuXHRcdH0sXG5cdFx0bG9jYXRlX21hcmtlcjpmdW5jdGlvbigpe1xuXHRcdFx0dGhpcy5tYXJrZXIuX21hcC5mbHlUbyggdGhpcy5tYXJrZXIuZ2V0TGF0TG5nKCkgKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0cmVtb3ZlX21hcmtlcjpmdW5jdGlvbihlKSB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KClcblx0XHRcdHRoaXMubWFya2VyLnJlbW92ZSgpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXHR9KTtcblxuXHRvc20uZmllbGQgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG5cblx0XHRtYXA6IG51bGwsXG5cdFx0Z2VvY29kZXI6IG51bGwsXG5cdFx0dmlzaWJsZTogbnVsbCxcblx0XHRldmVudHM6e1xuXHRcdH0sXG5cblx0XHQkcGFyZW50OmZ1bmN0aW9uKCl7XG5cdFx0XHRyZXR1cm4gdGhpcy4kZWwuY2xvc2VzdCgnLmFjZi1maWVsZC1zZXR0aW5ncywuYWNmLWZpZWxkLW9wZW4tc3RyZWV0LW1hcCcpXG5cdFx0fSxcblx0XHQkem9vbSA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJ2lucHV0W2lkJD1cIi16b29tXCJdJyk7XG5cdFx0fSxcblx0XHQkbGF0IDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnaW5wdXRbaWQkPVwiLWNlbnRlcl9sYXRcIl0nKTtcblx0XHR9LFxuXHRcdCRsbmcgOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCdpbnB1dFtpZCQ9XCItY2VudGVyX2xuZ1wiXScpO1xuXHRcdH0sXG5cdFx0JGxheWVyU3RvcmU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJy5hY2Ytb3NtLWxheWVycycpO1xuXHRcdH0sXG5cdFx0JHJlc3VsdHMgOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCcub3NtLXJlc3VsdHMnKTtcblx0XHR9LFxuXHRcdCRtYXJrZXJzOmZ1bmN0aW9uKCl7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnLm9zbS1tYXJrZXJzJyk7XG5cdFx0fSxcblx0XHRpbml0aWFsaXplOmZ1bmN0aW9uKGNvbmYpIHtcblxuXHRcdFx0dGhpcy5tYXBcdFx0PSBjb25mLm1hcDtcblxuXHRcdFx0dGhpcy51cGRhdGVfbWFwKCk7IC8vIHNldCBtYXAgdG8gaW5wdXQgdmFsdWVzXG5cblx0XHRcdHRoaXMuaW5pdF9hY2YoKTtcblxuXHRcdFx0dGhpcy5pbml0X2xheWVycygpO1xuXG5cdFx0XHR0aGlzLmluaXRfbWFya2VycygpO1xuXG5cdFx0XHR0aGlzLnVwZGF0ZV92aXNpYmxlKCk7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0X2dldF9nZW9jb2Rlcl9yZXN1bHRfbGFiZWw6ZnVuY3Rpb24oIGUsIGxhdGxuZyApIHtcblx0XHRcdHZhciBsYWJlbCA9IGZhbHNlO1xuXG5cdFx0XHRpZiAoICEgZS5sZW5ndGggKSB7XG5cdFx0XHRcdGxhYmVsID0gbGF0bG5nLmxhdC50b1N0cmluZygpICsgJywgJyArIGxhdGxuZy5sbmcudG9TdHJpbmcoKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCQuZWFjaCggZSwgZnVuY3Rpb24oIGksIHJlc3VsdCApIHtcblx0XHRcdFx0XHRpZiAoICEhIHJlc3VsdC5odG1sICkge1xuXHRcdFx0XHRcdFx0bGFiZWwgPSByZXN1bHQuaHRtbDtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0bGFiZWwgPSByZXN1bHQubmFtZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRcdHJldHVybiAkKCc8cD4nK2xhYmVsKyc8L3A+JykudGV4dCgpLnJlcGxhY2UoL14oXFxzKykvZywnJykucmVwbGFjZSgvKFxccyspJC9nLCcnKS5yZXBsYWNlKC8oXFxzKykvZywnICcpO1xuXHRcdH0sXG5cdFx0aW5pdF9tYXJrZXJzOmZ1bmN0aW9uKCl7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0ZWRpdG9yX2NvbmZpZyA9IHRoaXMuJGVsLmRhdGEoKS5lZGl0b3JDb25maWc7XG5cblx0XHRcdHRoaXMuaW5pdF9nZW9jb2RlKCk7XG5cblx0XHRcdC8vIG5vIG1hcmtlcnMgYWxsb3dlZCFcblx0XHRcdGlmICggZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyA9PT0gMCApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmljb24gPSBuZXcgTC5EaXZJY29uKHtcblx0XHRcdFx0aHRtbDogJycsXG5cdFx0XHRcdGNsYXNzTmFtZTonb3NtLW1hcmtlci1pY29uJ1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMubWFwLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHR2YXIgbGF0bG5nID0gZS5sYXRsbmcsXG5cdFx0XHRcdFx0Y291bnRfbWFya2VycyA9IHNlbGYuJG1hcmtlcnMoKS5jaGlsZHJlbigpLm5vdCgnW2RhdGEtaWRdJykubGVuZ3RoO1xuXG5cdFx0XHRcdC8vIG5vIG1vcmUgbWFya2Vyc1xuXHRcdFx0XHRpZiAoIGVkaXRvcl9jb25maWcubWF4X21hcmtlcnMgIT09IGZhbHNlICYmIGNvdW50X21hcmtlcnMgPj0gZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyApIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxmLmdlb2NvZGVyLm9wdGlvbnMuZ2VvY29kZXIucmV2ZXJzZShlLmxhdGxuZyxzZWxmLm1hcC5nZXRab29tKCksZnVuY3Rpb24oZSl7XG5cblx0XHRcdFx0XHR2YXIgbGFiZWwgPSBzZWxmLl9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsKCBlLCBsYXRsbmcgKTtcblxuXHRcdFx0XHRcdHNlbGYuYWRkX21hcmtlciggbGF0bG5nLCBsYWJlbCApO1xuXG5cdFx0XHRcdH0sc2VsZik7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5tYXAub24oICdsYXllcmFkZCcsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRpZiAoIGUubGF5ZXIuY29uc3RydWN0b3IgIT09IEwuTWFya2VyICkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0XHQvLyBtYXJrZXIgYWRkZWRcblx0XHRcdFx0dmFyIHRlbXBsYXRlID0gc2VsZi4kbWFya2VycygpLmZpbmQoJ1tkYXRhLWlkPVwiX19vc21fbWFya2VyX3RlbXBsYXRlX19cIl0nKS5odG1sKCkuc3BsaXQoJ19fb3NtX21hcmtlcl90ZW1wbGF0ZV9fJykuam9pbiggJzwlPSBpZCAlPicgKSxcblx0XHRcdFx0XHRlbnRyeSA9IG5ldyBvc20uTWFya2VyRW50cnkoe1xuXHRcdFx0XHRcdFx0Y29udHJvbGxlcjogdGhpcyxcblx0XHRcdFx0XHRcdG1hcmtlcjogZS5sYXllcixcblx0XHRcdFx0XHRcdGlkOiBhY2YudW5pcWlkKCksIC8vc2VsZi4kbWFya2VycygpLmNoaWxkcmVuKCkubGVuZ3RoLFxuXHRcdFx0XHRcdFx0dGVtcGxhdGU6IF8udGVtcGxhdGUoIHRlbXBsYXRlICksXG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0ZW50cnkucmVuZGVyKCkuJGVsLmFwcGVuZFRvKCBzZWxmLiRtYXJrZXJzKCkgKTtcblxuXHRcdFx0XHRzZWxmLmdlb2NvZGVfbWFya2VyKCBlbnRyeSApO1xuXG5cdFx0XHRcdGUubGF5ZXJcblx0XHRcdFx0XHQuc2V0SWNvbiggc2VsZi5pY29uIClcblx0XHRcdFx0XHQub24oJ2NsaWNrJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRcdHRoaXMucmVtb3ZlKCk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQub24oJ3JlbW92ZScsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0XHRlbnRyeS4kZWwucmVtb3ZlKCk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQub24oJ2RyYWdlbmQnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdFx0c2VsZi5nZW9jb2RlX21hcmtlciggZW50cnkgKTtcblx0XHRcdFx0XHRcdHNlbGYuJGVsLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0LmRyYWdnaW5nLmVuYWJsZSgpO1xuXHRcdFx0fSApO1xuXHRcdFx0dGhpcy5tYXAub24oICdsYXllcnJlbW92ZScsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRpZiAoIGUubGF5ZXIuY29uc3RydWN0b3IgIT09IEwuTWFya2VyICkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0XHRzZWxmLiRlbC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdH0gKTtcblx0XHRcdC8vIGFkZCBtYXJrZXJzXG5cdFx0XHQkLmVhY2goIHRoaXMuJGVsLmRhdGEoKS5tYXBNYXJrZXJzLGZ1bmN0aW9uKCBpLCBtYXJrZXJEYXRhICkge1xuXHRcdFx0XHQvLyBhZGQgbWFya2Vyc1xuXHRcdFx0XHR2YXIgbWFya2VyID0gTC5tYXJrZXIoIEwubGF0TG5nKCBtYXJrZXJEYXRhLmxhdCAqIDEsIG1hcmtlckRhdGEubG5nICogMSApLCB7XG5cdFx0XHRcdFx0XHR0aXRsZTogbWFya2VyRGF0YS5sYWJlbFxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0LmJpbmRUb29sdGlwKCBtYXJrZXJEYXRhLmxhYmVsIClcblx0XHRcdFx0XHQuYWRkVG8oIHNlbGYubWFwICk7XG5cblx0XHRcdH0pO1xuXG5cdFx0fSxcblx0XHRnZW9jb2RlX21hcmtlcjpmdW5jdGlvbiggbWFya2VyX2VudHJ5ICkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRlbnRyeSA9IG1hcmtlcl9lbnRyeSxcblx0XHRcdFx0bGF0bG5nID0gZW50cnkubWFya2VyLmdldExhdExuZygpO1xuXG5cdFx0XHRzZWxmLmdlb2NvZGVyLm9wdGlvbnMuZ2VvY29kZXIucmV2ZXJzZSggbGF0bG5nLCBzZWxmLm1hcC5nZXRab29tKCksIGZ1bmN0aW9uKGUpe1xuXG5cdFx0XHRcdHZhciBsYWJlbCA9IHNlbGYuX2dldF9nZW9jb2Rlcl9yZXN1bHRfbGFiZWwoIGUsIGxhdGxuZyApO1xuXG5cdFx0XHRcdGVudHJ5LnVwZGF0ZV9tYXJrZXJfZ2VvY29kZSggbGFiZWwgKTtcblxuXHRcdFx0fSwgdGhpcyApO1xuXG5cdFx0fSxcblx0XHRhZGRfbWFya2VyOmZ1bmN0aW9uKCBsbmdsYXQsIGxhYmVsICl7XG5cdFx0XHRMLm1hcmtlcihsbmdsYXQse1xuXHRcdFx0XHR0aXRsZTogbGFiZWwsXG5cdFx0XHRcdGljb246IHRoaXMuaWNvbixcblx0XHRcdH0pXG5cdFx0XHRcdC5iaW5kVG9vbHRpcCggbGFiZWwgKVxuXHRcdFx0XHQuYWRkVG8oIHRoaXMubWFwICk7XG5cdFx0XHR0aGlzLiRlbC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHR9LFxuXHRcdGxheWVyX2lzX292ZXJsYXk6IGZ1bmN0aW9uKCAga2V5LCBsYXllciApIHtcblx0XHRcdHZhciBwYXR0ZXJucztcblxuXHRcdFx0aWYgKCBsYXllci5vcHRpb25zLm9wYWNpdHkgJiYgbGF5ZXIub3B0aW9ucy5vcGFjaXR5IDwgMSApIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0XHRwYXR0ZXJucyA9IFsnXihPcGVuV2VhdGhlck1hcHxPcGVuU2VhTWFwKScsXG5cdFx0XHRcdCdPcGVuTWFwU3VyZmVyLkFkbWluQm91bmRzJyxcblx0XHRcdFx0J1N0YW1lbi5Ub25lcihIeWJyaWR8TGluZXN8TGFiZWxzKScsXG5cdFx0XHRcdCdBY2V0YXRlLihmb3JlZ3JvdW5kfGxhYmVsc3xyb2FkcyknLFxuXHRcdFx0XHQnSGlsbFNoYWRpbmcnLFxuXHRcdFx0XHQnSHlkZGEuUm9hZHNBbmRMYWJlbHMnLFxuXHRcdFx0XHQnXkp1c3RpY2VNYXAnLFxuXHRcdFx0XHQnT3BlbkluZnJhTWFwLihQb3dlcnxUZWxlY29tfFBldHJvbGV1bXxXYXRlciknLFxuXHRcdFx0XHQnT3BlblB0TWFwJyxcblx0XHRcdFx0J09wZW5SYWlsd2F5TWFwJyxcblx0XHRcdFx0J09wZW5GaXJlTWFwJyxcblx0XHRcdFx0J1NhZmVDYXN0Jyxcblx0XHRcdFx0J0NhcnRvREIuRGFya01hdHRlck9ubHlMYWJlbHMnLFxuXHRcdFx0XHQnQ2FydG9EQi5Qb3NpdHJvbk9ubHlMYWJlbHMnXG5cdFx0XHRdO1xuXHRcdFx0cmV0dXJuIGtleS5tYXRjaCgnKCcgKyBwYXR0ZXJucy5qb2luKCd8JykgKyAnKScpICE9PSBudWxsO1xuXHRcdH0sXG5cdFx0cmVzZXRfbGF5ZXJzOmZ1bmN0aW9uKCkge1xuXHRcdFx0Ly8gc2V0IHRoaXMuJGVsLmRhdGEoKS5tYXBMYXllcnMgc28gaXQgZml0c1xuXHRcdFx0Ly8gcmVtb3ZlIGFsbCBtYXAgbGF5ZXJzXG5cdFx0XHR0aGlzLm1hcC5lYWNoTGF5ZXIoZnVuY3Rpb24obGF5ZXIpe1xuXHRcdFx0XHRpZiAoIGxheWVyLmNvbnN0cnVjdG9yID09PSBMLlRpbGVMYXllci5Qcm92aWRlciApIHtcblx0XHRcdFx0XHRsYXllci5yZW1vdmUoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSlcblx0XHRcdC8vIHJlbW92ZSBsYXllciBzdG9yZVxuXHRcdFx0dGhpcy4kbGF5ZXJTdG9yZSgpLnJlbW92ZSgpO1xuXG5cdFx0XHQvLyByZW1vdmUgbGF5ZXIgY29udHJvbFxuXHRcdFx0ISEgdGhpcy5sYXllcnNDb250cm9sICYmIHRoaXMubGF5ZXJzQ29udHJvbC5yZW1vdmUoKVxuXHRcdH0sXG5cdFx0aW5pdF9sYXllcnM6ZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdHNlbGVjdGVkTGF5ZXJzID0gW10sXG5cdFx0XHRcdGJhc2VMYXllcnMgPSB7fSxcblx0XHRcdFx0b3ZlcmxheXMgPSB7fSxcblx0XHRcdFx0bWFwTGF5ZXJzID0ge30sXG5cdFx0XHRcdGVkaXRvcl9jb25maWcgPSB0aGlzLiRlbC5kYXRhKCkuZWRpdG9yQ29uZmlnLFxuXHRcdFx0XHRpc19vbWl0dGVkID0gZnVuY3Rpb24oa2V5KSB7XG5cblx0XHRcdFx0XHRyZXR1cm4ga2V5ID09PSBudWxsIHx8ICggISEgZWRpdG9yX2NvbmZpZy5yZXN0cmljdF9wcm92aWRlcnMgJiYgZWRpdG9yX2NvbmZpZy5yZXN0cmljdF9wcm92aWRlcnMuaW5kZXhPZigga2V5ICkgPT09IC0xICk7XG5cdFx0XHRcdH0sXG5cdFx0XHRcdHNldHVwTWFwID0gZnVuY3Rpb24oIHZhbCwga2V5ICl7XG5cdFx0XHRcdFx0dmFyIGxheWVyLCBsYXllcl9jb25maWc7XG5cdFx0XHRcdFx0aWYgKCBfLmlzT2JqZWN0KHZhbCkgKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gJC5lYWNoKCB2YWwsIHNldHVwTWFwICk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCBpc19vbWl0dGVkKGtleSkgKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICggISEgbWFwTGF5ZXJzWyBrZXkgXSApIHtcblx0XHRcdFx0XHRcdGxheWVyID0gbWFwTGF5ZXJzWyBrZXkgXTtcblx0XHRcdFx0XHRcdHNlbGYubWFwLmFkZExheWVyKGxheWVyKVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0XHRsYXllciA9IEwudGlsZUxheWVyLnByb3ZpZGVyKCBrZXkgLyosIGxheWVyX2NvbmZpZy5vcHRpb25zKi8gKTtcblx0XHRcdFx0XHRcdH0gY2F0Y2goZXgpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0bGF5ZXIucHJvdmlkZXJLZXkgPSBrZXk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCBzZWxmLmxheWVyX2lzX292ZXJsYXkoIGtleSwgbGF5ZXIgKSApIHtcblx0XHRcdFx0XHRcdG92ZXJsYXlzW2tleV0gPSBsYXllcjtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0YmFzZUxheWVyc1trZXldID0gbGF5ZXI7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCBzZWxlY3RlZExheWVycy5pbmRleE9mKCBrZXkgKSAhPT0gLTEgKSB7XG5cdFx0XHRcdFx0XHRzZWxmLm1hcC5hZGRMYXllcihsYXllcik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9O1xuXG5cdFx0XHRzZWxlY3RlZExheWVycyA9IHRoaXMuJGVsLmRhdGEoKS5tYXBMYXllcnM7IC8vIHNob3VsZCBiZSBsYXllciBzdG9yZSB2YWx1ZVxuXG5cdFx0XHQvLyBmaWx0ZXIgYXZhaWFsYmxlIGxheWVycyBpbiBmaWVsZCB2YWx1ZVxuXHRcdFx0aWYgKCBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycyAhPT0gZmFsc2UgJiYgXy5pc0FycmF5KCBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycyApICkge1xuXHRcdFx0XHRzZWxlY3RlZExheWVycyA9IHNlbGVjdGVkTGF5ZXJzLmZpbHRlciggZnVuY3Rpb24oZWwpIHtcblx0XHRcdFx0XHRyZXR1cm4gZWRpdG9yX2NvbmZpZy5yZXN0cmljdF9wcm92aWRlcnMuaW5kZXhPZiggZWwgKSAhPT0gLTE7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBzZXQgZGVmYXVsdCBsYXllclxuXHRcdFx0aWYgKCAhIHNlbGVjdGVkTGF5ZXJzLmxlbmd0aCApIHtcblxuXHRcdFx0XHRzZWxlY3RlZExheWVycyA9IE9iamVjdC5rZXlzKCBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycyApLnNsaWNlKCAwLCAxICk7XG5cblx0XHRcdH1cblxuXHRcdFx0Ly8gZWRpdGFibGUgbGF5ZXJzIVxuXHRcdFx0aWYgKCBlZGl0b3JfY29uZmlnLmFsbG93X3Byb3ZpZGVycyApIHtcblxuXHRcdFx0XHQkKCc8ZGl2IGNsYXNzPVwiYWNmLW9zbS1sYXllcnNcIj48L2Rpdj4nKS5pbnNlcnRBZnRlciggdGhpcy4kZWwgKTtcblxuXHRcdFx0XHR0aGlzLm1hcC5vbiggJ2Jhc2VsYXllcmNoYW5nZSBsYXllcmFkZCBsYXllcnJlbW92ZScsIGZ1bmN0aW9uKGUpe1xuXG5cdFx0XHRcdFx0aWYgKCAhIGUubGF5ZXIucHJvdmlkZXJLZXkpIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0dmFyICRsYXllclN0b3JlID0gc2VsZi4kbGF5ZXJTdG9yZSgpLFxuXHRcdFx0XHRcdFx0JHRlbXBsYXRlID0gc2VsZi4kcGFyZW50KCkuZmluZCgnW2RhdGEtaWQ9XCJfX29zbV9sYXllcl90ZW1wbGF0ZV9fXCJdJyk7XG5cblx0XHRcdFx0XHQkbGF5ZXJTdG9yZS5odG1sKCcnKTtcblxuXHRcdFx0XHRcdHNlbGYubWFwLmVhY2hMYXllcihmdW5jdGlvbihsYXllcikge1xuXHRcdFx0XHRcdFx0dmFyICRsYXllcklucHV0O1xuXHRcdFx0XHRcdFx0aWYgKCAhIGxheWVyLnByb3ZpZGVyS2V5ICkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHQvKlxuXHRcdFx0XHRcdFx0JGxheWVySW5wdXQgPSAkdGVtcGxhdGUuY2xvbmUoKS5yZW1vdmVBdHRyKCdkYXRhLWlkJyk7XG5cdFx0XHRcdFx0XHQvKi9cblx0XHRcdFx0XHRcdCRsYXllcklucHV0ID0gJCgnPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBuYW1lPVwiJyArIGVkaXRvcl9jb25maWcubmFtZV9wcmVmaXggKyAnW2xheWVyc11bXVwiIC8+Jyk7XG5cdFx0XHRcdFx0XHQvLyovXG5cdFx0XHRcdFx0XHQkbGF5ZXJJbnB1dC52YWwoIGxheWVyLnByb3ZpZGVyS2V5ICk7XG5cblx0XHRcdFx0XHRcdGlmICggc2VsZi5sYXllcl9pc19vdmVybGF5KCBsYXllci5wcm92aWRlcktleSwgbGF5ZXIgKSApIHtcblx0XHRcdFx0XHRcdFx0JGxheWVyU3RvcmUuYXBwZW5kKCAkbGF5ZXJJbnB1dCApO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0JGxheWVyU3RvcmUucHJlcGVuZCggJGxheWVySW5wdXQgKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRzZWxmLiRlbC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdFx0fSApO1xuXHRcdFx0fVxuXG5cblx0XHRcdCQuZWFjaCggZWRpdG9yX2NvbmZpZy5yZXN0cmljdF9wcm92aWRlcnMsIHNldHVwTWFwICk7XG5cblx0XHRcdC8vIC4uLiBubyBsYXllciBlZGl0aW5nIGFsbG93ZWRcblx0XHRcdGlmICggdGhpcy4kbGF5ZXJTdG9yZSgpLmxlbmd0aCApIHtcblx0XHRcdFx0dGhpcy5sYXllcnNDb250cm9sID0gTC5jb250cm9sLmxheWVycyggYmFzZUxheWVycywgb3ZlcmxheXMsIHtcblx0XHRcdFx0XHRjb2xsYXBzZWQ6IHRydWUsXG5cdFx0XHRcdFx0aGlkZVNpbmdsZUJhc2U6IHRydWUsXG5cdFx0XHRcdH0pLmFkZFRvKHRoaXMubWFwKTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdGluaXRfZ2VvY29kZTpmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRlZGl0b3JfY29uZmlnID0gdGhpcy4kZWwuZGF0YSgpLmVkaXRvckNvbmZpZztcblxuXHRcdFx0dGhpcy5tYXAuX2NvbnRyb2xDb3JuZXJzWydhYm92ZSddID0gJCgnPGRpdiBjbGFzcz1cImFjZi1vc20tYWJvdmVcIj48L2Rpdj4nKS5pbnNlcnRCZWZvcmUoIHRoaXMuJGVsICkuZ2V0KDApO1xuXG5cdFx0XHR0aGlzLmdlb2NvZGVyID0gTC5Db250cm9sLmdlb2NvZGVyKHtcblx0XHRcdFx0Y29sbGFwc2VkOiBmYWxzZSxcblx0XHRcdFx0cG9zaXRpb246J2Fib3ZlJyxcblx0XHRcdFx0cGxhY2Vob2xkZXI6J1NlYXJjaC4uLicsXG5cdFx0XHRcdGVycm9yTWVzc2FnZTonTm90aGluZyBmb3VuZC4uLicsXG5cdFx0XHRcdHNob3dSZXN1bHRJY29uczp0cnVlLFxuXHRcdFx0XHRzdWdnZXN0TWluTGVuZ3RoOjMsXG5cdFx0XHRcdHN1Z2dlc3RUaW1lb3V0OjI1MCxcblx0XHRcdFx0cXVlcnlNaW5MZW5ndGg6Myxcblx0XHRcdFx0ZGVmYXVsdE1hcmtHZW9jb2RlOmZhbHNlLFxuXHRcdFx0fSlcblx0XHRcdC5vbignbWFya2dlb2NvZGUnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHR2YXIgbGF0bG5nID0gIGUuZ2VvY29kZS5jZW50ZXIsXG5cdFx0XHRcdFx0ZWRpdG9yX2NvbmZpZyA9IHNlbGYuJGVsLmRhdGEoKS5lZGl0b3JDb25maWcsXG5cdFx0XHRcdFx0Y291bnRfbWFya2VycyA9IHNlbGYuJG1hcmtlcnMoKS5jaGlsZHJlbigpLm5vdCgnW2RhdGEtaWRdJykubGVuZ3RoLFxuXHRcdFx0XHRcdGxhYmVsID0gc2VsZi5fZ2V0X2dlb2NvZGVyX3Jlc3VsdF9sYWJlbCggWyBlLmdlb2NvZGUgXSwgbGF0bG5nICk7XG5cblx0XHRcdFx0aWYgKCBjb3VudF9tYXJrZXJzID09PSBmYWxzZSB8fCBjb3VudF9tYXJrZXJzIDwgZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyApIHtcblx0XHRcdFx0XHQvLyBhZGQgbWFya2VyIGlmIG5vIHJlc3RyaWN0aW9uIG9yIG1heCBtYXJrZXJzIG5vdCBleGNlZWRlZFxuXHRcdFx0XHRcdHNlbGYuYWRkX21hcmtlciggbGF0bG5nLCBsYWJlbCApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmICggZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyA9PT0gMSAmJiBjb3VudF9tYXJrZXJzID09PSAxICkge1xuXHRcdFx0XHRcdC8vIHVwZGF0ZSBzaW5nbGUgbWFya2VyXG5cdFx0XHRcdFx0bWFya2VyID0gc2VsZi5nZXRfZmlyc3RfbWFya2VyKCk7XG5cdFx0XHRcdFx0aWYgKCAhISBtYXJrZXIgKSB7XG5cdFx0XHRcdFx0XHRlbnRyeSA9IG1hcmtlci5vc21fY29udHJvbGxlcjtcblx0XHRcdFx0XHRcdG1hcmtlci5zZXRMYXRMbmcoIGxhdGxuZyApO1xuXHRcdFx0XHRcdFx0ZW50cnkudXBkYXRlX21hcmtlcl9nZW9jb2RlKCBsYWJlbCApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICggZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyA9PT0gMCApIHtcblx0XHRcdFx0XHRzZWxmLm1hcC5maXRCb3VuZHMoIGUuZ2VvY29kZS5iYm94ICk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c2VsZi5tYXAuc2V0VmlldyggbGF0bG5nLCBzZWxmLm1hcC5nZXRab29tKCkgKTsgLy8ga2VlcCB6b29tLCBtaWdodCBiZSBjb25mdXNpbmcgZWxzZVxuXHRcdFx0XHR9XG5cblx0XHRcdH0pXG5cdFx0XHQuYWRkVG8oIHRoaXMubWFwICk7XG5cblx0XHRcdC8vIHByZXZlbnQgd3AgcG9zdCBmb3JtIGZyb20gYmVpbmcgc3VibWl0dGVkXG5cdFx0XHRMLkRvbUV2ZW50LmFkZExpc3RlbmVyKHRoaXMuZ2VvY29kZXIuX2lucHV0LCAna2V5ZG93bicsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRpZiAoIGUua2V5Q29kZSA9PT0gMTMgKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCB0aGlzLmdlb2NvZGVyICk7XG5cdFx0fSxcblx0XHRnZXRfZmlyc3RfbWFya2VyOmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIG1hcmtlciA9IGZhbHNlO1xuXHRcdFx0dGhpcy5tYXAuZWFjaExheWVyKGZ1bmN0aW9uKGxheWVyKXtcblx0XHRcdFx0aWYgKCBsYXllci5jb25zdHJ1Y3RvciA9PT0gTC5NYXJrZXIgKSB7XG5cdFx0XHRcdFx0bWFya2VyID0gbGF5ZXI7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiBtYXJrZXI7XG5cdFx0fSxcblx0XHR1cGRhdGVfdmlzaWJsZTogZnVuY3Rpb24oKSB7XG5cblx0XHRcdGlmICggdGhpcy52aXNpYmxlID09PSB0aGlzLiRlbC5pcygnOnZpc2libGUnKSApIHtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudmlzaWJsZSA9IHRoaXMuJGVsLmlzKCc6dmlzaWJsZScpO1xuXG5cdFx0XHRpZiAoIHRoaXMudmlzaWJsZSApIHtcblx0XHRcdFx0dGhpcy5tYXAuaW52YWxpZGF0ZVNpemUoKTtcblx0XHRcdFx0dGhpcy5iaW5kX2V2ZW50cygpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH1cblx0XHRcdHRoaXMudW5iaW5kX2V2ZW50cygpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRpbml0X2FjZjogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdHRvZ2dsZV9jYiA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdC8vIG5vIGNoYW5nZVxuXHRcdFx0XHRcdHNlbGYudXBkYXRlX3Zpc2libGUoKTtcblx0XHRcdFx0fTtcblxuXHRcdFx0Ly8gZXhwYW5kL2NvbGxhcHNlIGFjZiBzZXR0aW5nXG5cdFx0XHRhY2YuYWRkQWN0aW9uKCAnc2hvdycsIHRvZ2dsZV9jYiApO1xuXHRcdFx0YWNmLmFkZEFjdGlvbiggJ2hpZGUnLCB0b2dnbGVfY2IgKTtcblx0XHRcdGFjZi5hZGRBY3Rpb24oICdkaXNhYmxlX2ZpZWxkJywgZnVuY3Rpb24oKXtcblx0XHRcdFx0c2VsZi51bmJpbmRfZXZlbnRzKCk7XG5cdFx0XHR9ICk7XG5cblx0XHRcdC8vIGV4cGFuZCB3cCBtZXRhYm94XG5cdFx0XHQkKGRvY3VtZW50KS5vbigncG9zdGJveC10b2dnbGVkJywgdG9nZ2xlX2NiICk7XG5cdFx0XHQkKGRvY3VtZW50KS5vbignY2xpY2snLCcud2lkZ2V0LXRvcCAqJywgdG9nZ2xlX2NiICk7XG5cblxuXG5cdFx0fSxcblx0XHR1bmJpbmRfZXZlbnRzOmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0c2VsZi4kbGF0KCkub2ZmKCdibHVyJyk7XG5cdFx0XHRzZWxmLiRsbmcoKS5vZmYoJ2JsdXInKTtcblx0XHRcdHNlbGYuJHpvb20oKS5vZmYoJ2JsdXInKTtcblx0XHRcdHNlbGYuJHpvb20oKS5vZmYoJ2tleXVwIGZvY3VzJyk7XG5cblx0XHRcdHRoaXMubWFwLm9mZignem9vbWVuZCcsIHRoaXMubWFwX3pvb21lZCwgdGhpcyApO1xuXHRcdFx0dGhpcy5tYXAub2ZmKCdtb3ZlZW5kJywgdGhpcy5tYXBfbW92ZWQsIHRoaXMgKTtcblx0XHR9LFxuXHRcdGJpbmRfZXZlbnRzOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi4kbGF0KCkub24oJ2JsdXInLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRzZWxmLnVwZGF0ZV9tYXAoKTtcblx0XHRcdH0pO1xuXHRcdFx0c2VsZi4kbG5nKCkub24oJ2JsdXInLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRzZWxmLnVwZGF0ZV9tYXAoKTtcblx0XHRcdH0pO1xuXHRcdFx0c2VsZi4kem9vbSgpLm9uKCdibHVyJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0c2VsZi51cGRhdGVfbWFwKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5tYXAub24oJ3pvb21lbmQnLCB0aGlzLm1hcF96b29tZWQsIHRoaXMgKTtcblx0XHRcdHRoaXMubWFwLm9uKCdtb3ZlZW5kJywgdGhpcy5tYXBfbW92ZWQsIHRoaXMgKTtcblx0XHR9LFxuXHRcdHVwZGF0ZV9tYXA6ZnVuY3Rpb24oKSB7XG5cdFx0XHRpZiAoICEgdGhpcy4kbGF0KCkudmFsKCkgfHwgISB0aGlzLiRsbmcoKS52YWwoKSApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0dmFyIGxhdGxuZyA9IEwubGF0TG5nKCB0aGlzLiRsYXQoKS52YWwoKSwgdGhpcy4kbG5nKCkudmFsKCkgKTtcblx0XHRcdHRoaXMubWFwLnNldFZpZXcoIGxhdGxuZywgIHRoaXMuJHpvb20oKS52YWwoKSApO1xuXHRcdH0sXG5cdFx0bWFwX21vdmVkOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dmFyIGNlbnRlciA9IHRoaXMubWFwLmdldENlbnRlcigpO1xuXHRcdFx0dGhpcy4kbGF0KCkudmFsKGNlbnRlci5sYXQpO1xuXHRcdFx0dGhpcy4kbG5nKCkudmFsKGNlbnRlci5sbmcpO1xuXHRcdFx0dGhpcy4kZWwudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0fSxcblx0XHRtYXBfem9vbWVkOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dGhpcy4kem9vbSgpLnZhbCggdGhpcy5tYXAuZ2V0Wm9vbSgpICk7XG5cdFx0XHR0aGlzLiRlbC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHR9XG5cdH0pO1xuXG5cblx0JChkb2N1bWVudClcblx0XHQub24oJ2FjZi1vc20tbWFwLWluaXQnLGZ1bmN0aW9uKCBlLCBtYXAgKSB7XG5cdFx0XHRpZiAoICQoZS50YXJnZXQpLmlzKCdbZGF0YS1lZGl0b3ItY29uZmlnXScpICkge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdCQoZS50YXJnZXQpLmRhdGEoICdfbWFwX2VkaXRvcicsIG5ldyBvc20uZmllbGQoIHsgZWw6IGUudGFyZ2V0LCBtYXA6IG1hcCB9ICkgKTtcdFx0XHRcdFxuXHRcdFx0fVxuXHRcdH0pXG5cdFx0Ly8gZmllbGQgc2V0dGluZ3Ncblx0XHQub24oJ2NoYW5nZScsJ1tkYXRhLW5hbWU9XCJyZXR1cm5fZm9ybWF0XCJdIGlucHV0JyxmdW5jdGlvbihlKXtcblx0XHRcdC8vIGZpbmQgbWFwIGZpZWxkXG5cdFx0XHQkKCdbZGF0YS1uYW1lPVwicmV0dXJuX2Zvcm1hdFwiXSBpbnB1dDpjaGVja2VkJykudmFsKClcblx0XHRcdHZhciAkbWFwID0gJCh0aGlzKS5jbG9zZXN0KCcuYWNmLWZpZWxkLW9iamVjdCcpLmZpbmQoJ1tkYXRhLWVkaXRvci1jb25maWddJyksXG5cdFx0XHRcdGVkaXRvciA9ICRtYXAuZGF0YSggJ19tYXBfZWRpdG9yJyApLFxuXHRcdFx0XHRjb25mID0gJG1hcC5kYXRhKCdlZGl0b3ItY29uZmlnJyk7XG5cdFx0XHQvLyBtYXBcblx0XHRcdGVkaXRvci5yZXNldF9sYXllcnMoKTtcblx0XHRcdGlmICggJCh0aGlzKS52YWwoKSA9PT0gJ29zbScgKSB7XG5cdFx0XHRcdC8vIHNldCBwcm92aWRlciByZXN0cmljdGlvbiB0byBvc20gcHJvdmlkZXJzXG5cdFx0XHRcdGNvbmYucmVzdHJpY3RfcHJvdmlkZXJzID0gT2JqZWN0LnZhbHVlcyggZWRpdF9hcmcub3B0aW9ucy5vc21fbGF5ZXJzICk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBzZXQgcHJvdmlkZXIgcmVzdHJpY3Rpb24gdG8gb3NtIHByb3ZpZGVyc1xuXHRcdFx0XHRjb25mLnJlc3RyaWN0X3Byb3ZpZGVycyA9IE9iamVjdC52YWx1ZXMoIGVkaXRfYXJnLm9wdGlvbnMubGVhZmxldF9sYXllcnMgKTtcblx0XHRcdH1cblx0XHRcdCRtYXAuZGF0YSggJ2VkaXRvci1jb25maWcnLCBjb25mICk7XG5cdFx0XHRlZGl0b3IuaW5pdF9sYXllcnMoKTtcblx0XHR9KTtcblxuXHQvLyB3aGVuIGZpZWxkcyBnZXQgbG9hZGVkIC4uLlxuXHRhY2YuYWRkQWN0aW9uKCAnYXBwZW5kJywgZnVuY3Rpb24oKXtcblx0XHQkLmFjZl9sZWFmbGV0KCk7XG5cdH0pO1xuXG59KSggalF1ZXJ5LCBhY2Zfb3NtX2FkbWluICk7XG4iXX0=
