!function(e,t){var r=t.options,a={};a.MarkerList=Backbone.View.extend({}),a.MarkerEntry=Backbone.View.extend({tagName:"div",className:"osm-marker",events:{'click [data-name="locate-marker"]':"locate_marker",'click [data-name="remove-marker"]':"remove_marker",'change [id$="-marker-label"]':"update_marker_label"},get_label:function(){return this.$el.find('[id$="-marker-label"]').val()},get_default_label:function(){return this.$el.find('[id$="-marker-geocode"]').val()},is_default_label:function(){return this.get_default_label()===this.get_label()},initialize:function(e){return this.template=e.template,this.marker=e.marker,this.marker.osm_controller=this,this},render:function(){return this.$el.html(this.template(this)),this._update_values_from_marker(),this},update_marker_label:function(t){var r=this.get_label();return""===r&&(r=this.get_default_label()),e(t.target).val(r),this.set_marker_label(r)},set_marker_label:function(t){return this.marker.unbindTooltip(),this.marker.bindTooltip(t),this.marker.options.title=t,e(this.marker._icon).attr("title",t),this},update_marker_geocode:function(e){return this.is_default_label()&&this.set_marker_label(e),this.$el.find('[id$="-marker-geocode"]').val(e),this._update_values_from_marker(),this},_update_values_from_marker:function(){var e=this.marker.getLatLng();return this.$el.find('[id$="-marker-lat"]').val(e.lat),this.$el.find('[id$="-marker-lng"]').val(e.lng),this.$el.find('[id$="-marker-label"]').val(this.marker.options.title),this},locate_marker:function(){return this.marker._map.flyTo(this.marker.getLatLng()),e(this.marker._icon).focus(),this},remove_marker:function(e){return e.preventDefault(),this.marker.remove(),this}}),a.field=Backbone.View.extend({map:null,geocoder:null,visible:null,events:{},$parent:function(){return this.$el.closest(".acf-field-settings,.acf-field-open-street-map")},$zoom:function(){return this.$parent().find('input[id$="-zoom"]')},$lat:function(){return this.$parent().find('input[id$="-center_lat"]')},$lng:function(){return this.$parent().find('input[id$="-center_lng"]')},$layerStore:function(){return this.$parent().find(".acf-osm-layers")},$results:function(){return this.$parent().find(".osm-results")},$markers:function(){return this.$parent().find(".osm-markers")},initialize:function(e){return this.map=e.map,this.update_map(),this.init_acf(),this.init_layers(),this.init_markers(),this.update_visible(),this},_get_geocoder_result_label:function(t,r){var a=!1;return t.length?e.each(t,function(e,t){return a=t.html?t.html:t.name,!1}):a=r.lat.toString()+", "+r.lng.toString(),e(a).text().replace(/^(\s+)/g,"").replace(/(\s+)$/g,"").replace(/(\s+)/g," ")},init_markers:function(){var t=this,r=this.$el.data().editorConfig;this.init_geocode(),0!==r.max_markers&&(this.icon=new L.DivIcon({html:"",className:"osm-marker-icon"}),this.map.on("click",function(e){var a=e.latlng,i=t.$markers().children().not("[data-id]").length;!1!==r.max_markers&&i>=r.max_markers||t.geocoder.options.geocoder.reverse(e.latlng,t.map.getZoom(),function(e){var r=t._get_geocoder_result_label(e,a);t.add_marker(a,r)},t)}),this.map.on("layeradd",function(e){if(e.layer.constructor===L.Marker){var r=t.$markers().find('[data-id="__osm_marker_template__"]').html().split("__osm_marker_template__").join("<%= id %>"),i=new a.MarkerEntry({controller:this,marker:e.layer,id:acf.uniqid(),template:_.template(r)});i.render().$el.prependTo(t.$markers()),t.geocode_marker(i),e.layer.setIcon(t.icon).on("click",function(e){this.remove()}).on("remove",function(e){i.$el.remove()}).on("dragend",function(e){t.geocode_marker(i)}).dragging.enable()}}),e.each(this.$el.data().mapMarkers,function(e,r){L.marker(L.latLng(1*r.lat,1*r.lng),{title:r.label}).bindTooltip(r.label).addTo(t.map)}))},geocode_marker:function(e){var t=this,r=e,a=r.marker.getLatLng();t.geocoder.options.geocoder.reverse(a,t.map.getZoom(),function(e){var i=t._get_geocoder_result_label(e,a);r.update_marker_geocode(i)},this)},add_marker:function(e,t){L.marker(e,{title:t,icon:this.icon}).bindTooltip(t).addTo(this.map)},layer_is_overlay:function(e,t){var r;return!!(t.options.opacity&&t.options.opacity<1)||(r=["^(OpenWeatherMap|OpenSeaMap)","OpenMapSurfer.AdminBounds","Stamen.Toner(Hybrid|Lines|Labels)","Acetate.(foreground|labels|roads)","HillShading","Hydda.RoadsAndLabels","^JusticeMap","OpenInfraMap.(Power|Telecom|Petroleum|Water)","OpenPtMap","OpenRailwayMap","OpenFireMap","SafeCast","CartoDB.DarkMatterOnlyLabels","CartoDB.PositronOnlyLabels"],null!==e.match("("+r.join("|")+")"))},reset_layers:function(){this.map.eachLayer(function(e){e.constructor===L.TileLayer.Provider&&e.remove()}),this.$layerStore().remove(),!!this.layersControl&&this.layersControl.remove()},init_layers:function(){var t=this,a=[],i={},n={},o={},s=this.$el.data().editorConfig,l=function(e){return null===e||!!s.restrict_providers&&-1===s.restrict_providers.indexOf(e)},d=function(s,m){var c,u;if(_.isObject(m))return e.each(m,d);l(s)||(o[s]?(c=o[s],t.map.addLayer(c)):(u=r.layer_config[s.split(".")[0]]||{options:{}},c=L.tileLayer.provider(s,u.options),c.providerKey=s),t.layer_is_overlay(s,c)?n[s]=c:i[s]=c,-1!==a.indexOf(s)&&t.map.addLayer(c))};a=this.$el.data().mapLayers,!1!==s.restrict_providers&&_.isArray(s.restrict_providers)&&(a=a.filter(function(e){return-1!==s.restrict_providers.indexOf(e)})),a.length||(a=Object.keys(r.providers).slice(0,1)),s.allow_providers&&(e('<div class="acf-osm-layers"></div>').insertAfter(this.$el),this.map.on("baselayerchange layeradd layerremove",function(r){if(r.layer.providerKey){var a=t.$layerStore();t.$parent().find('[data-id="__osm_layer_template__"]');a.html(""),t.map.eachLayer(function(r){var i;r.providerKey&&(i=e('<input type="hidden" name="'+s.name_prefix+'[layers][]" />'),i.val(r.providerKey),t.layer_is_overlay(r.providerKey,r)?a.append(i):a.prepend(i))})}})),e.each(r.providers,d),this.$layerStore().length&&(this.layersControl=L.control.layers(i,n,{collapsed:!0,hideSingleBase:!0}).addTo(this.map))},init_geocode:function(){var t=this;this.$el.data().editorConfig;this.map._controlCorners.above=e('<div class="acf-osm-above"></div>').insertBefore(this.$el).get(0),this.geocoder=L.Control.geocoder({collapsed:!1,position:"above",placeholder:"Search...",errorMessage:"Nothing found...",showResultIcons:!0,suggestMinLength:3,suggestTimeout:250,queryMinLength:3,defaultMarkGeocode:!1}).on("markgeocode",function(e){var r=e.geocode.center,a=t.$el.data().editorConfig,i=t.$markers().children().not("[data-id]").length,n=t._get_geocoder_result_label([e.geocode],r);(!1===i||i<a.max_markers)&&t.add_marker(r,n),1===a.max_markers&&1===i&&(marker=t.get_first_marker(),marker&&(entry=marker.osm_controller,marker.setLatLng(r),entry.update_marker_geocode(n))),0===a.max_markers?t.map.fitBounds(e.geocode.bbox):t.map.setView(r,t.map.getZoom())}).addTo(this.map),L.DomEvent.addListener(this.geocoder._input,"keydown",function(e){13===e.keyCode&&e.preventDefault()},this.geocoder)},get_first_marker:function(){var e=!1;return this.map.eachLayer(function(t){if(t.constructor===L.Marker)return e=t,!1}),e},update_visible:function(){return this.visible===this.$el.is(":visible")?this:(this.visible=this.$el.is(":visible"),this.visible?(this.map.invalidateSize(),this.bind_events(),this):(this.unbind_events(),this))},init_acf:function(){var t=this,r=function(){t.update_visible()};acf.addAction("show",r),acf.addAction("hide",r),acf.addAction("disable_field",function(){t.unbind_events()}),e(document).on("postbox-toggled",r),this.map.on("zoomend",function(e){t.map_zoomed.apply(t,[e])}),this.map.on("moveend",function(e){t.map_moved.apply(t,[e])})},unbind_events:function(){var e=this;e.$lat().off("blur"),e.$lng().off("blur"),e.$zoom().off("blur"),e.$zoom().off("keyup focus")},bind_events:function(){var e=this;e.$lat().on("blur",function(t){e.update_map()}),e.$lng().on("blur",function(t){e.update_map()}),e.$zoom().on("blur",function(t){e.update_map()})},update_map:function(){if(this.$lat().val()&&this.$lng().val()){var e=L.latLng(this.$lat().val(),this.$lng().val());this.map.setView(e,this.$zoom().val())}},map_moved:function(e){var t=this.map.getCenter();this.$lat().val(t.lat),this.$lng().val(t.lng)},map_zoomed:function(e){this.$zoom().val(this.map.getZoom())}}),e(document).on("acf-osm-map-init",function(t,r){t.preventDefault(),e(t.target).data("_map_editor",new a.field({el:t.target,map:r}))}).on("change",'[data-name="return_format"] input',function(r){e('[data-name="return_format"] input:checked').val();var a=e(this).closest(".acf-field-object").find("[data-editor-config]"),i=a.data("_map_editor"),n=a.data("editor-config");i.reset_layers(),"osm"===e(this).val()?n.restrict_providers=Object.values(t.options.osm_layers):n.restrict_providers=!1,a.data("editor-config",n),i.init_layers()}),acf.addAction("append",function(){e.acf_leaflet()})}(jQuery,acf_osm_admin);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1pbnB1dC1vc20uanMiXSwibmFtZXMiOlsiJCIsImFyZyIsIm9wdGlvbnMiLCJvc20iLCJNYXJrZXJMaXN0IiwiQmFja2JvbmUiLCJWaWV3IiwiZXh0ZW5kIiwiTWFya2VyRW50cnkiLCJ0YWdOYW1lIiwiY2xhc3NOYW1lIiwiZXZlbnRzIiwiY2xpY2sgW2RhdGEtbmFtZT1cImxvY2F0ZS1tYXJrZXJcIl0iLCJjbGljayBbZGF0YS1uYW1lPVwicmVtb3ZlLW1hcmtlclwiXSIsImNoYW5nZSBbaWQkPVwiLW1hcmtlci1sYWJlbFwiXSIsImdldF9sYWJlbCIsInRoaXMiLCIkZWwiLCJmaW5kIiwidmFsIiwiZ2V0X2RlZmF1bHRfbGFiZWwiLCJpc19kZWZhdWx0X2xhYmVsIiwiaW5pdGlhbGl6ZSIsIm9wdCIsInRlbXBsYXRlIiwibWFya2VyIiwib3NtX2NvbnRyb2xsZXIiLCJyZW5kZXIiLCJodG1sIiwiX3VwZGF0ZV92YWx1ZXNfZnJvbV9tYXJrZXIiLCJ1cGRhdGVfbWFya2VyX2xhYmVsIiwiZSIsImxhYmVsIiwidGFyZ2V0Iiwic2V0X21hcmtlcl9sYWJlbCIsInVuYmluZFRvb2x0aXAiLCJiaW5kVG9vbHRpcCIsInRpdGxlIiwiX2ljb24iLCJhdHRyIiwidXBkYXRlX21hcmtlcl9nZW9jb2RlIiwibGF0bG5nIiwiZ2V0TGF0TG5nIiwibGF0IiwibG5nIiwibG9jYXRlX21hcmtlciIsIl9tYXAiLCJmbHlUbyIsImZvY3VzIiwicmVtb3ZlX21hcmtlciIsInByZXZlbnREZWZhdWx0IiwicmVtb3ZlIiwiZmllbGQiLCJtYXAiLCJnZW9jb2RlciIsInZpc2libGUiLCIkcGFyZW50IiwiY2xvc2VzdCIsIiR6b29tIiwiJGxhdCIsIiRsbmciLCIkbGF5ZXJTdG9yZSIsIiRyZXN1bHRzIiwiJG1hcmtlcnMiLCJjb25mIiwidXBkYXRlX21hcCIsImluaXRfYWNmIiwiaW5pdF9sYXllcnMiLCJpbml0X21hcmtlcnMiLCJ1cGRhdGVfdmlzaWJsZSIsIl9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsIiwibGVuZ3RoIiwiZWFjaCIsImkiLCJyZXN1bHQiLCJuYW1lIiwidG9TdHJpbmciLCJ0ZXh0IiwicmVwbGFjZSIsInNlbGYiLCJlZGl0b3JfY29uZmlnIiwiZGF0YSIsImVkaXRvckNvbmZpZyIsImluaXRfZ2VvY29kZSIsIm1heF9tYXJrZXJzIiwiaWNvbiIsIkwiLCJEaXZJY29uIiwib24iLCJjb3VudF9tYXJrZXJzIiwiY2hpbGRyZW4iLCJub3QiLCJyZXZlcnNlIiwiZ2V0Wm9vbSIsImFkZF9tYXJrZXIiLCJsYXllciIsImNvbnN0cnVjdG9yIiwiTWFya2VyIiwic3BsaXQiLCJqb2luIiwiZW50cnkiLCJjb250cm9sbGVyIiwiaWQiLCJhY2YiLCJ1bmlxaWQiLCJfIiwicHJlcGVuZFRvIiwiZ2VvY29kZV9tYXJrZXIiLCJzZXRJY29uIiwiZHJhZ2dpbmciLCJlbmFibGUiLCJtYXBNYXJrZXJzIiwibWFya2VyRGF0YSIsImxhdExuZyIsImFkZFRvIiwibWFya2VyX2VudHJ5IiwibG5nbGF0IiwibGF5ZXJfaXNfb3ZlcmxheSIsImtleSIsInBhdHRlcm5zIiwib3BhY2l0eSIsIm1hdGNoIiwicmVzZXRfbGF5ZXJzIiwiZWFjaExheWVyIiwiVGlsZUxheWVyIiwiUHJvdmlkZXIiLCJsYXllcnNDb250cm9sIiwic2VsZWN0ZWRMYXllcnMiLCJiYXNlTGF5ZXJzIiwib3ZlcmxheXMiLCJtYXBMYXllcnMiLCJpc19vbWl0dGVkIiwicmVzdHJpY3RfcHJvdmlkZXJzIiwiaW5kZXhPZiIsInNldHVwTWFwIiwibGF5ZXJfY29uZmlnIiwiaXNPYmplY3QiLCJhZGRMYXllciIsInRpbGVMYXllciIsInByb3ZpZGVyIiwicHJvdmlkZXJLZXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiZWwiLCJPYmplY3QiLCJrZXlzIiwicHJvdmlkZXJzIiwic2xpY2UiLCJhbGxvd19wcm92aWRlcnMiLCJpbnNlcnRBZnRlciIsIiRsYXllcklucHV0IiwibmFtZV9wcmVmaXgiLCJhcHBlbmQiLCJwcmVwZW5kIiwiY29udHJvbCIsImxheWVycyIsImNvbGxhcHNlZCIsImhpZGVTaW5nbGVCYXNlIiwiX2NvbnRyb2xDb3JuZXJzIiwiaW5zZXJ0QmVmb3JlIiwiZ2V0IiwiQ29udHJvbCIsInBvc2l0aW9uIiwicGxhY2Vob2xkZXIiLCJlcnJvck1lc3NhZ2UiLCJzaG93UmVzdWx0SWNvbnMiLCJzdWdnZXN0TWluTGVuZ3RoIiwic3VnZ2VzdFRpbWVvdXQiLCJxdWVyeU1pbkxlbmd0aCIsImRlZmF1bHRNYXJrR2VvY29kZSIsImdlb2NvZGUiLCJjZW50ZXIiLCJnZXRfZmlyc3RfbWFya2VyIiwic2V0TGF0TG5nIiwiZml0Qm91bmRzIiwiYmJveCIsInNldFZpZXciLCJEb21FdmVudCIsImFkZExpc3RlbmVyIiwiX2lucHV0Iiwia2V5Q29kZSIsImlzIiwiaW52YWxpZGF0ZVNpemUiLCJiaW5kX2V2ZW50cyIsInVuYmluZF9ldmVudHMiLCJ0b2dnbGVfY2IiLCJhZGRBY3Rpb24iLCJkb2N1bWVudCIsIm1hcF96b29tZWQiLCJhcHBseSIsIm1hcF9tb3ZlZCIsIm9mZiIsImdldENlbnRlciIsIiRtYXAiLCJlZGl0b3IiLCJ2YWx1ZXMiLCJvc21fbGF5ZXJzIiwiYWNmX2xlYWZsZXQiLCJqUXVlcnkiLCJhY2Zfb3NtX2FkbWluIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFBQSxFQUFBQyxHQUNBLEdBQUFDLEdBQUFELEVBQUFDLFFBTUFDLElBR0FBLEdBQUFDLFdBQUFDLFNBQUFDLEtBQUFDLFdBRUFKLEVBQUFLLFlBQUFILFNBQUFDLEtBQUFDLFFBQ0FFLFFBQUEsTUFDQUMsVUFBQSxhQUNBQyxRQUNBQyxvQ0FBQSxnQkFDQUMsb0NBQUEsZ0JBQ0FDLCtCQUFBLHVCQUVBQyxVQUFBLFdBQ0EsTUFBQUMsTUFBQUMsSUFBQUMsS0FBQSx5QkFBQUMsT0FFQUMsa0JBQUEsV0FDQSxNQUFBSixNQUFBQyxJQUFBQyxLQUFBLDJCQUFBQyxPQUVBRSxpQkFBQSxXQUNBLE1BQUFMLE1BQUFJLHNCQUFBSixLQUFBRCxh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bUIsS0FDQSxJQUFBOEssR0FBQWpNLEVBQUFnQixNQUFBeUMsUUFBQSxxQkFBQXZDLEtBQUEsd0JBQ0FnTCxFQUFBRCxFQUFBaEgsS0FBQSxlQUNBakIsRUFBQWlJLEVBQUFoSCxLQUFBLGdCQUVBaUgsR0FBQXhFLGVBQ0EsUUFBQTFILEVBQUFnQixNQUFBRyxNQUVBNkMsRUFBQW9FLG1CQUFBWSxPQUFBbUQsT0FBQWxNLEVBQUFDLFFBQUFrTSxZQUdBcEksRUFBQW9FLG9CQUFBLEVBRUE2RCxFQUFBaEgsS0FBQSxnQkFBQWpCLEdBQ0FrSSxFQUFBL0gsZ0JBS0FvQyxJQUFBbUYsVUFBQSxTQUFBLFdBQ0ExTCxFQUFBcU0saUJBR0FDLE9BQUFDIiwiZmlsZSI6ImFjZi1pbnB1dC1vc20ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCAkLCBhcmcgKXtcblx0dmFyIG9wdGlvbnMgPSBhcmcub3B0aW9ucyxcblx0XHRyZXN1bHRfdHBsID0gJzxkaXYgdGFiaW5kZXg9XCI8JT0gZGF0YS5pICU+XCIgY2xhc3M9XCJvc20tcmVzdWx0XCI+J1xuXHRcdFx0KyAnPCU9IGRhdGEucmVzdWx0X3RleHQgJT4nXG5cdFx0XHQrICc8YnIgLz48c21hbGw+PCU9IGRhdGEucHJvcGVydGllcy5vc21fdmFsdWUgJT48L3NtYWxsPidcblx0XHRcdCsgJzwvZGl2Pic7XG5cblx0dmFyIG9zbSA9IHtcblx0fTtcblxuXHRvc20uTWFya2VyTGlzdCA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcblx0fSlcblx0b3NtLk1hcmtlckVudHJ5ID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXHRcdHRhZ05hbWU6ICdkaXYnLFxuXHRcdGNsYXNzTmFtZTonb3NtLW1hcmtlcicsXG5cdFx0ZXZlbnRzOiB7XG5cdFx0XHQnY2xpY2sgW2RhdGEtbmFtZT1cImxvY2F0ZS1tYXJrZXJcIl0nIDogJ2xvY2F0ZV9tYXJrZXInLFxuXHRcdFx0J2NsaWNrIFtkYXRhLW5hbWU9XCJyZW1vdmUtbWFya2VyXCJdJyA6ICdyZW1vdmVfbWFya2VyJyxcblx0XHRcdCdjaGFuZ2UgW2lkJD1cIi1tYXJrZXItbGFiZWxcIl0nXHRcdDogJ3VwZGF0ZV9tYXJrZXJfbGFiZWwnLFxuXHRcdH0sXG5cdFx0Z2V0X2xhYmVsOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1sYWJlbFwiXScpLnZhbCgpO1xuXHRcdH0sXG5cdFx0Z2V0X2RlZmF1bHRfbGFiZWw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWdlb2NvZGVcIl0nKS52YWwoKTtcblx0XHR9LFxuXHRcdGlzX2RlZmF1bHRfbGFiZWw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuZ2V0X2RlZmF1bHRfbGFiZWwoKSA9PT0gdGhpcy5nZXRfbGFiZWwoKTtcblx0XHR9LFxuXHRcdGluaXRpYWxpemU6ZnVuY3Rpb24ob3B0KXtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblx0XHRcdHRoaXMudGVtcGxhdGUgPSBvcHQudGVtcGxhdGU7XG5cdFx0XHR0aGlzLm1hcmtlciA9IG9wdC5tYXJrZXI7XG5cdFx0XHR0aGlzLm1hcmtlci5vc21fY29udHJvbGxlciA9IHRoaXM7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0cmVuZGVyOmZ1bmN0aW9uKCl7XG5cdFx0XHR0aGlzLiRlbC5odG1sKCB0aGlzLnRlbXBsYXRlKCB0aGlzICkgKTtcblx0XHRcdHRoaXMuX3VwZGF0ZV92YWx1ZXNfZnJvbV9tYXJrZXIoKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0dXBkYXRlX21hcmtlcl9sYWJlbDpmdW5jdGlvbihlKSB7XG5cdFx0XHR2YXIgbGFiZWwgPSB0aGlzLmdldF9sYWJlbCgpO1xuXG5cdFx0XHRpZiAoIGxhYmVsID09PSAnJyApIHtcblx0XHRcdFx0bGFiZWwgPSB0aGlzLmdldF9kZWZhdWx0X2xhYmVsKCk7XG5cdFx0XHR9XG5cdFx0XHQvLyByZXN0b3JlIGdlb2NvZGUgZGVmYXVsdFxuXHRcdFx0JChlLnRhcmdldCkudmFsKGxhYmVsKTtcblxuXHRcdFx0cmV0dXJuIHRoaXMuc2V0X21hcmtlcl9sYWJlbCggbGFiZWwgKTtcblx0XHR9LFxuXHRcdHNldF9tYXJrZXJfbGFiZWw6ZnVuY3Rpb24obGFiZWwpIHtcblx0XHRcdHRoaXMubWFya2VyLnVuYmluZFRvb2x0aXAoKTtcblx0XHRcdHRoaXMubWFya2VyLmJpbmRUb29sdGlwKGxhYmVsKTtcblxuXHRcdFx0dGhpcy5tYXJrZXIub3B0aW9ucy50aXRsZSA9IGxhYmVsO1xuXHRcdFx0JCggdGhpcy5tYXJrZXIuX2ljb24gKS5hdHRyKCAndGl0bGUnLCBsYWJlbCApO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHR1cGRhdGVfbWFya2VyX2dlb2NvZGU6ZnVuY3Rpb24oIGxhYmVsICkge1xuXG5cdFx0XHRpZiAoIHRoaXMuaXNfZGVmYXVsdF9sYWJlbCgpICkge1xuXHRcdFx0XHQvLyB1cGRhdGUgbWFya2VyIGxhYmVsc1xuXHRcdFx0XHR0aGlzLnNldF9tYXJrZXJfbGFiZWwoIGxhYmVsICk7XG5cdFx0XHRcdC8vIHVwZGF0ZSBtYXJrZXIgbGFiZWwgaW5wdXRcblx0XHRcdH1cblxuXG5cdFx0XHR0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1nZW9jb2RlXCJdJykudmFsKCBsYWJlbCApO1xuXG5cdFx0XHR0aGlzLl91cGRhdGVfdmFsdWVzX2Zyb21fbWFya2VyKCk7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0X3VwZGF0ZV92YWx1ZXNfZnJvbV9tYXJrZXI6IGZ1bmN0aW9uKCApIHtcblx0XHRcdHZhciBsYXRsbmcgPSB0aGlzLm1hcmtlci5nZXRMYXRMbmcoKTtcblx0XHRcdHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWxhdFwiXScpLnZhbCggbGF0bG5nLmxhdCApO1xuXHRcdFx0dGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItbG5nXCJdJykudmFsKCBsYXRsbmcubG5nICk7XG5cdFx0XHR0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1sYWJlbFwiXScpLnZhbCggdGhpcy5tYXJrZXIub3B0aW9ucy50aXRsZSApO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblxuXHRcdGxvY2F0ZV9tYXJrZXI6ZnVuY3Rpb24oKXtcblx0XHRcdHRoaXMubWFya2VyLl9tYXAuZmx5VG8oIHRoaXMubWFya2VyLmdldExhdExuZygpICk7XG5cdFx0XHQkKHRoaXMubWFya2VyLl9pY29uKS5mb2N1cygpXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHJlbW92ZV9tYXJrZXI6ZnVuY3Rpb24oZSkge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpXG5cdFx0XHR0aGlzLm1hcmtlci5yZW1vdmUoKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblx0fSk7XG5cblx0b3NtLmZpZWxkID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXG5cdFx0bWFwOiBudWxsLFxuXHRcdGdlb2NvZGVyOiBudWxsLFxuXHRcdHZpc2libGU6IG51bGwsXG5cdFx0ZXZlbnRzOntcblx0XHR9LFxuXG5cdFx0JHBhcmVudDpmdW5jdGlvbigpe1xuXHRcdFx0cmV0dXJuIHRoaXMuJGVsLmNsb3Nlc3QoJy5hY2YtZmllbGQtc2V0dGluZ3MsLmFjZi1maWVsZC1vcGVuLXN0cmVldC1tYXAnKVxuXHRcdH0sXG5cdFx0JHpvb20gOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCdpbnB1dFtpZCQ9XCItem9vbVwiXScpO1xuXHRcdH0sXG5cdFx0JGxhdCA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJ2lucHV0W2lkJD1cIi1jZW50ZXJfbGF0XCJdJyk7XG5cdFx0fSxcblx0XHQkbG5nIDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnaW5wdXRbaWQkPVwiLWNlbnRlcl9sbmdcIl0nKTtcblx0XHR9LFxuXHRcdCRsYXllclN0b3JlOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCcuYWNmLW9zbS1sYXllcnMnKTtcblx0XHR9LFxuXHRcdCRyZXN1bHRzIDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnLm9zbS1yZXN1bHRzJyk7XG5cdFx0fSxcblx0XHQkbWFya2VyczpmdW5jdGlvbigpe1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJy5vc20tbWFya2VycycpO1xuXHRcdH0sXG5cdFx0aW5pdGlhbGl6ZTpmdW5jdGlvbihjb25mKSB7XG5cblx0XHRcdHRoaXMubWFwXHRcdD0gY29uZi5tYXA7XG5cblx0XHRcdHRoaXMudXBkYXRlX21hcCgpOyAvLyBzZXQgbWFwIHRvIGlucHV0IHZhbHVlc1xuXG5cdFx0XHR0aGlzLmluaXRfYWNmKCk7XG5cblx0XHRcdHRoaXMuaW5pdF9sYXllcnMoKTtcblxuXHRcdFx0dGhpcy5pbml0X21hcmtlcnMoKTtcblxuXHRcdFx0dGhpcy51cGRhdGVfdmlzaWJsZSgpO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdF9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsOmZ1bmN0aW9uKCBlLCBsYXRsbmcgKSB7XG5cdFx0XHR2YXIgbGFiZWwgPSBmYWxzZTtcblxuXHRcdFx0aWYgKCAhIGUubGVuZ3RoICkge1xuXHRcdFx0XHRsYWJlbCA9IGxhdGxuZy5sYXQudG9TdHJpbmcoKSArICcsICcgKyBsYXRsbmcubG5nLnRvU3RyaW5nKCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQkLmVhY2goIGUsIGZ1bmN0aW9uKCBpLCByZXN1bHQgKSB7XG5cdFx0XHRcdFx0aWYgKCAhISByZXN1bHQuaHRtbCApIHtcblx0XHRcdFx0XHRcdGxhYmVsID0gcmVzdWx0Lmh0bWw7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGxhYmVsID0gcmVzdWx0Lm5hbWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gJChsYWJlbCkudGV4dCgpLnJlcGxhY2UoL14oXFxzKykvZywnJykucmVwbGFjZSgvKFxccyspJC9nLCcnKS5yZXBsYWNlKC8oXFxzKykvZywnICcpO1xuXHRcdH0sXG5cdFx0aW5pdF9tYXJrZXJzOmZ1bmN0aW9uKCl7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0ZWRpdG9yX2NvbmZpZyA9IHRoaXMuJGVsLmRhdGEoKS5lZGl0b3JDb25maWc7XG5cblx0XHRcdHRoaXMuaW5pdF9nZW9jb2RlKCk7XG5cblx0XHRcdC8vIG5vIG1hcmtlcnMgYWxsb3dlZCFcblx0XHRcdGlmICggZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyA9PT0gMCApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmljb24gPSBuZXcgTC5EaXZJY29uKHtcblx0XHRcdFx0aHRtbDogJycsXG5cdFx0XHRcdGNsYXNzTmFtZTonb3NtLW1hcmtlci1pY29uJ1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMubWFwLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHR2YXIgbGF0bG5nID0gZS5sYXRsbmcsXG5cdFx0XHRcdFx0Y291bnRfbWFya2VycyA9IHNlbGYuJG1hcmtlcnMoKS5jaGlsZHJlbigpLm5vdCgnW2RhdGEtaWRdJykubGVuZ3RoO1xuXG5cdFx0XHRcdC8vIG5vIG1vcmUgbWFya2Vyc1xuXHRcdFx0XHRpZiAoIGVkaXRvcl9jb25maWcubWF4X21hcmtlcnMgIT09IGZhbHNlICYmIGNvdW50X21hcmtlcnMgPj0gZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyApIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxmLmdlb2NvZGVyLm9wdGlvbnMuZ2VvY29kZXIucmV2ZXJzZShlLmxhdGxuZyxzZWxmLm1hcC5nZXRab29tKCksZnVuY3Rpb24oZSl7XG5cblx0XHRcdFx0XHR2YXIgbGFiZWwgPSBzZWxmLl9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsKCBlLCBsYXRsbmcgKTtcblxuXHRcdFx0XHRcdHNlbGYuYWRkX21hcmtlciggbGF0bG5nLCBsYWJlbCApO1xuXG5cdFx0XHRcdH0sc2VsZik7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5tYXAub24oICdsYXllcmFkZCcsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRpZiAoIGUubGF5ZXIuY29uc3RydWN0b3IgIT09IEwuTWFya2VyICkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0XHQvLyBtYXJrZXIgYWRkZWRcblx0XHRcdFx0dmFyIHRlbXBsYXRlID0gc2VsZi4kbWFya2VycygpLmZpbmQoJ1tkYXRhLWlkPVwiX19vc21fbWFya2VyX3RlbXBsYXRlX19cIl0nKS5odG1sKCkuc3BsaXQoJ19fb3NtX21hcmtlcl90ZW1wbGF0ZV9fJykuam9pbiggJzwlPSBpZCAlPicgKSxcblx0XHRcdFx0XHRlbnRyeSA9IG5ldyBvc20uTWFya2VyRW50cnkoe1xuXHRcdFx0XHRcdFx0Y29udHJvbGxlcjogdGhpcyxcblx0XHRcdFx0XHRcdG1hcmtlcjogZS5sYXllcixcblx0XHRcdFx0XHRcdGlkOiBhY2YudW5pcWlkKCksIC8vc2VsZi4kbWFya2VycygpLmNoaWxkcmVuKCkubGVuZ3RoLFxuXHRcdFx0XHRcdFx0dGVtcGxhdGU6IF8udGVtcGxhdGUoIHRlbXBsYXRlICksXG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0ZW50cnkucmVuZGVyKCkuJGVsLnByZXBlbmRUbyggc2VsZi4kbWFya2VycygpICk7XG5cblx0XHRcdFx0c2VsZi5nZW9jb2RlX21hcmtlciggZW50cnkgKTtcblxuXHRcdFx0XHRlLmxheWVyXG5cdFx0XHRcdFx0LnNldEljb24oIHNlbGYuaWNvbiApXG5cdFx0XHRcdFx0Lm9uKCdjbGljaycsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0XHR0aGlzLnJlbW92ZSgpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0Lm9uKCdyZW1vdmUnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdFx0ZW50cnkuJGVsLnJlbW92ZSgpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0Lm9uKCdkcmFnZW5kJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRcdHNlbGYuZ2VvY29kZV9tYXJrZXIoIGVudHJ5ICk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQuZHJhZ2dpbmcuZW5hYmxlKCk7XG5cdFx0XHR9ICk7XG5cdFx0XHQvLyBhZGQgbWFya2Vyc1xuXHRcdFx0JC5lYWNoKCB0aGlzLiRlbC5kYXRhKCkubWFwTWFya2VycyxmdW5jdGlvbiggaSwgbWFya2VyRGF0YSApIHtcblx0XHRcdFx0Ly8gYWRkIG1hcmtlcnNcblx0XHRcdFx0dmFyIG1hcmtlciA9IEwubWFya2VyKCBMLmxhdExuZyggbWFya2VyRGF0YS5sYXQgKiAxLCBtYXJrZXJEYXRhLmxuZyAqIDEgKSwge1xuXHRcdFx0XHRcdFx0dGl0bGU6IG1hcmtlckRhdGEubGFiZWxcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5iaW5kVG9vbHRpcCggbWFya2VyRGF0YS5sYWJlbCApXG5cdFx0XHRcdFx0LmFkZFRvKCBzZWxmLm1hcCApO1xuXG5cdFx0XHR9KTtcblxuXHRcdH0sXG5cdFx0Z2VvY29kZV9tYXJrZXI6ZnVuY3Rpb24oIG1hcmtlcl9lbnRyeSApIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0ZW50cnkgPSBtYXJrZXJfZW50cnksXG5cdFx0XHRcdGxhdGxuZyA9IGVudHJ5Lm1hcmtlci5nZXRMYXRMbmcoKTtcblxuXHRcdFx0c2VsZi5nZW9jb2Rlci5vcHRpb25zLmdlb2NvZGVyLnJldmVyc2UoIGxhdGxuZywgc2VsZi5tYXAuZ2V0Wm9vbSgpLCBmdW5jdGlvbihlKXtcblxuXHRcdFx0XHR2YXIgbGFiZWwgPSBzZWxmLl9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsKCBlLCBsYXRsbmcgKTtcblxuXHRcdFx0XHRlbnRyeS51cGRhdGVfbWFya2VyX2dlb2NvZGUoIGxhYmVsICk7XG5cblx0XHRcdH0sIHRoaXMgKTtcblxuXHRcdH0sXG5cdFx0YWRkX21hcmtlcjpmdW5jdGlvbiggbG5nbGF0LCBsYWJlbCApe1xuXHRcdFx0TC5tYXJrZXIobG5nbGF0LHtcblx0XHRcdFx0dGl0bGU6IGxhYmVsLFxuXHRcdFx0XHRpY29uOiB0aGlzLmljb24sXG5cdFx0XHR9KVxuXHRcdFx0XHQuYmluZFRvb2x0aXAoIGxhYmVsIClcblx0XHRcdFx0LmFkZFRvKCB0aGlzLm1hcCApO1xuXHRcdH0sXG5cdFx0bGF5ZXJfaXNfb3ZlcmxheTogZnVuY3Rpb24oICBrZXksIGxheWVyICkge1xuXHRcdFx0dmFyIHBhdHRlcm5zO1xuXG5cdFx0XHRpZiAoIGxheWVyLm9wdGlvbnMub3BhY2l0eSAmJiBsYXllci5vcHRpb25zLm9wYWNpdHkgPCAxICkge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdHBhdHRlcm5zID0gWydeKE9wZW5XZWF0aGVyTWFwfE9wZW5TZWFNYXApJyxcblx0XHRcdFx0J09wZW5NYXBTdXJmZXIuQWRtaW5Cb3VuZHMnLFxuXHRcdFx0XHQnU3RhbWVuLlRvbmVyKEh5YnJpZHxMaW5lc3xMYWJlbHMpJyxcblx0XHRcdFx0J0FjZXRhdGUuKGZvcmVncm91bmR8bGFiZWxzfHJvYWRzKScsXG5cdFx0XHRcdCdIaWxsU2hhZGluZycsXG5cdFx0XHRcdCdIeWRkYS5Sb2Fkc0FuZExhYmVscycsXG5cdFx0XHRcdCdeSnVzdGljZU1hcCcsXG5cdFx0XHRcdCdPcGVuSW5mcmFNYXAuKFBvd2VyfFRlbGVjb218UGV0cm9sZXVtfFdhdGVyKScsXG5cdFx0XHRcdCdPcGVuUHRNYXAnLFxuXHRcdFx0XHQnT3BlblJhaWx3YXlNYXAnLFxuXHRcdFx0XHQnT3BlbkZpcmVNYXAnLFxuXHRcdFx0XHQnU2FmZUNhc3QnLFxuXHRcdFx0XHQnQ2FydG9EQi5EYXJrTWF0dGVyT25seUxhYmVscycsXG5cdFx0XHRcdCdDYXJ0b0RCLlBvc2l0cm9uT25seUxhYmVscydcblx0XHRcdF07XG5cdFx0XHRyZXR1cm4ga2V5Lm1hdGNoKCcoJyArIHBhdHRlcm5zLmpvaW4oJ3wnKSArICcpJykgIT09IG51bGw7XG5cdFx0fSxcblx0XHRyZXNldF9sYXllcnM6ZnVuY3Rpb24oKSB7XG5cdFx0XHQvLyBzZXQgdGhpcy4kZWwuZGF0YSgpLm1hcExheWVycyBzbyBpdCBmaXRzXG5cdFx0XHQvLyByZW1vdmUgYWxsIG1hcCBsYXllcnNcblx0XHRcdHRoaXMubWFwLmVhY2hMYXllcihmdW5jdGlvbihsYXllcil7XG5cdFx0XHRcdGlmICggbGF5ZXIuY29uc3RydWN0b3IgPT09IEwuVGlsZUxheWVyLlByb3ZpZGVyICkge1xuXHRcdFx0XHRcdGxheWVyLnJlbW92ZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KVxuXHRcdFx0Ly8gcmVtb3ZlIGxheWVyIHN0b3JlXG5cdFx0XHR0aGlzLiRsYXllclN0b3JlKCkucmVtb3ZlKCk7XG5cblx0XHRcdC8vIHJlbW92ZSBsYXllciBjb250cm9sXG5cdFx0XHQhISB0aGlzLmxheWVyc0NvbnRyb2wgJiYgdGhpcy5sYXllcnNDb250cm9sLnJlbW92ZSgpXG5cdFx0fSxcblx0XHRpbml0X2xheWVyczpmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0c2VsZWN0ZWRMYXllcnMgPSBbXSxcblx0XHRcdFx0YmFzZUxheWVycyA9IHt9LFxuXHRcdFx0XHRvdmVybGF5cyA9IHt9LFxuXHRcdFx0XHRtYXBMYXllcnMgPSB7fSxcblx0XHRcdFx0ZWRpdG9yX2NvbmZpZyA9IHRoaXMuJGVsLmRhdGEoKS5lZGl0b3JDb25maWcsXG5cdFx0XHRcdGlzX29taXR0ZWQgPSBmdW5jdGlvbihrZXkpIHtcblxuXHRcdFx0XHRcdHJldHVybiBrZXkgPT09IG51bGwgfHwgKCAhISBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycyAmJiBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycy5pbmRleE9mKCBrZXkgKSA9PT0gLTEgKTtcblx0XHRcdFx0fSxcblx0XHRcdFx0c2V0dXBNYXAgPSBmdW5jdGlvbigga2V5LCB2YWwgKXtcblx0XHRcdFx0XHR2YXIgbGF5ZXIsIGxheWVyX2NvbmZpZztcblx0XHRcdFx0XHRpZiAoIF8uaXNPYmplY3QodmFsKSApIHtcblx0XHRcdFx0XHRcdHJldHVybiAkLmVhY2goIHZhbCwgc2V0dXBNYXAgKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIGlzX29taXR0ZWQoa2V5KSApIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKCAhISBtYXBMYXllcnNbIGtleSBdICkge1xuXHRcdFx0XHRcdFx0bGF5ZXIgPSBtYXBMYXllcnNbIGtleSBdO1xuXHRcdFx0XHRcdFx0c2VsZi5tYXAuYWRkTGF5ZXIobGF5ZXIpXG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGxheWVyX2NvbmZpZyA9IG9wdGlvbnMubGF5ZXJfY29uZmlnWyBrZXkuc3BsaXQoJy4nKVswXSBdIHx8IHtvcHRpb25zOnt9fTtcblx0XHRcdFx0XHRcdGxheWVyID0gTC50aWxlTGF5ZXIucHJvdmlkZXIoIGtleSwgbGF5ZXJfY29uZmlnLm9wdGlvbnMgKTtcblx0XHRcdFx0XHRcdGxheWVyLnByb3ZpZGVyS2V5ID0ga2V5O1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICggc2VsZi5sYXllcl9pc19vdmVybGF5KCBrZXksIGxheWVyICkgKSB7XG5cdFx0XHRcdFx0XHRvdmVybGF5c1trZXldID0gbGF5ZXI7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGJhc2VMYXllcnNba2V5XSA9IGxheWVyO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICggc2VsZWN0ZWRMYXllcnMuaW5kZXhPZigga2V5ICkgIT09IC0xICkge1xuXHRcdFx0XHRcdFx0c2VsZi5tYXAuYWRkTGF5ZXIobGF5ZXIpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fTtcblxuXHRcdFx0c2VsZWN0ZWRMYXllcnMgPSB0aGlzLiRlbC5kYXRhKCkubWFwTGF5ZXJzOyAvLyBzaG91bGQgYmUgbGF5ZXIgc3RvcmUgdmFsdWVcblxuXHRcdFx0Ly8gZmlsdGVyIGF2YWlhbGJsZSBsYXllcnMgaW4gZmllbGQgdmFsdWVcblx0XHRcdGlmICggZWRpdG9yX2NvbmZpZy5yZXN0cmljdF9wcm92aWRlcnMgIT09IGZhbHNlICYmIF8uaXNBcnJheSggZWRpdG9yX2NvbmZpZy5yZXN0cmljdF9wcm92aWRlcnMgKSApIHtcblx0XHRcdFx0c2VsZWN0ZWRMYXllcnMgPSBzZWxlY3RlZExheWVycy5maWx0ZXIoIGZ1bmN0aW9uKGVsKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGVkaXRvcl9jb25maWcucmVzdHJpY3RfcHJvdmlkZXJzLmluZGV4T2YoIGVsICkgIT09IC0xO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gc2V0IGRlZmF1bHQgbGF5ZXJcblx0XHRcdGlmICggISBzZWxlY3RlZExheWVycy5sZW5ndGggKSB7XG5cblx0XHRcdFx0c2VsZWN0ZWRMYXllcnMgPSBPYmplY3Qua2V5cyggb3B0aW9ucy5wcm92aWRlcnMgKS5zbGljZSggMCwgMSApO1xuXG5cdFx0XHR9XG5cblx0XHRcdC8vIGVkaXRhYmxlIGxheWVycyFcblx0XHRcdGlmICggZWRpdG9yX2NvbmZpZy5hbGxvd19wcm92aWRlcnMgKSB7XG5cblx0XHRcdFx0JCgnPGRpdiBjbGFzcz1cImFjZi1vc20tbGF5ZXJzXCI+PC9kaXY+JykuaW5zZXJ0QWZ0ZXIoIHRoaXMuJGVsICk7XG5cblx0XHRcdFx0dGhpcy5tYXAub24oICdiYXNlbGF5ZXJjaGFuZ2UgbGF5ZXJhZGQgbGF5ZXJyZW1vdmUnLCBmdW5jdGlvbihlKXtcblxuXHRcdFx0XHRcdGlmICggISBlLmxheWVyLnByb3ZpZGVyS2V5KSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHZhciAkbGF5ZXJTdG9yZSA9IHNlbGYuJGxheWVyU3RvcmUoKSxcblx0XHRcdFx0XHRcdCR0ZW1wbGF0ZSA9IHNlbGYuJHBhcmVudCgpLmZpbmQoJ1tkYXRhLWlkPVwiX19vc21fbGF5ZXJfdGVtcGxhdGVfX1wiXScpO1xuXG5cdFx0XHRcdFx0JGxheWVyU3RvcmUuaHRtbCgnJyk7XG5cblx0XHRcdFx0XHRzZWxmLm1hcC5lYWNoTGF5ZXIoZnVuY3Rpb24obGF5ZXIpIHtcblx0XHRcdFx0XHRcdHZhciAkbGF5ZXJJbnB1dDtcblx0XHRcdFx0XHRcdGlmICggISBsYXllci5wcm92aWRlcktleSApIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0Lypcblx0XHRcdFx0XHRcdCRsYXllcklucHV0ID0gJHRlbXBsYXRlLmNsb25lKCkucmVtb3ZlQXR0cignZGF0YS1pZCcpO1xuXHRcdFx0XHRcdFx0LyovXG5cdFx0XHRcdFx0XHQkbGF5ZXJJbnB1dCA9ICQoJzxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgbmFtZT1cIicgKyBlZGl0b3JfY29uZmlnLm5hbWVfcHJlZml4ICsgJ1tsYXllcnNdW11cIiAvPicpO1xuXHRcdFx0XHRcdFx0Ly8qL1xuXHRcdFx0XHRcdFx0JGxheWVySW5wdXQudmFsKCBsYXllci5wcm92aWRlcktleSApO1xuXG5cdFx0XHRcdFx0XHRpZiAoIHNlbGYubGF5ZXJfaXNfb3ZlcmxheSggbGF5ZXIucHJvdmlkZXJLZXksIGxheWVyICkgKSB7XG5cdFx0XHRcdFx0XHRcdCRsYXllclN0b3JlLmFwcGVuZCggJGxheWVySW5wdXQgKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdCRsYXllclN0b3JlLnByZXBlbmQoICRsYXllcklucHV0ICk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0fSApO1xuXHRcdFx0fVxuXG5cblx0XHRcdCQuZWFjaCggb3B0aW9ucy5wcm92aWRlcnMsIHNldHVwTWFwICk7XG5cblx0XHRcdC8vIC4uLiBubyBsYXllciBlZGl0aW5nIGFsbG93ZWRcblx0XHRcdGlmICggdGhpcy4kbGF5ZXJTdG9yZSgpLmxlbmd0aCApIHtcblx0XHRcdFx0dGhpcy5sYXllcnNDb250cm9sID0gTC5jb250cm9sLmxheWVycyggYmFzZUxheWVycywgb3ZlcmxheXMsIHtcblx0XHRcdFx0XHRjb2xsYXBzZWQ6IHRydWUsXG5cdFx0XHRcdFx0aGlkZVNpbmdsZUJhc2U6IHRydWUsXG5cdFx0XHRcdH0pLmFkZFRvKHRoaXMubWFwKTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdGluaXRfZ2VvY29kZTpmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRlZGl0b3JfY29uZmlnID0gdGhpcy4kZWwuZGF0YSgpLmVkaXRvckNvbmZpZztcblxuXHRcdFx0dGhpcy5tYXAuX2NvbnRyb2xDb3JuZXJzWydhYm92ZSddID0gJCgnPGRpdiBjbGFzcz1cImFjZi1vc20tYWJvdmVcIj48L2Rpdj4nKS5pbnNlcnRCZWZvcmUoIHRoaXMuJGVsICkuZ2V0KDApO1xuXG5cdFx0XHR0aGlzLmdlb2NvZGVyID0gTC5Db250cm9sLmdlb2NvZGVyKHtcblx0XHRcdFx0Y29sbGFwc2VkOiBmYWxzZSxcblx0XHRcdFx0cG9zaXRpb246J2Fib3ZlJyxcblx0XHRcdFx0cGxhY2Vob2xkZXI6J1NlYXJjaC4uLicsXG5cdFx0XHRcdGVycm9yTWVzc2FnZTonTm90aGluZyBmb3VuZC4uLicsXG5cdFx0XHRcdHNob3dSZXN1bHRJY29uczp0cnVlLFxuXHRcdFx0XHRzdWdnZXN0TWluTGVuZ3RoOjMsXG5cdFx0XHRcdHN1Z2dlc3RUaW1lb3V0OjI1MCxcblx0XHRcdFx0cXVlcnlNaW5MZW5ndGg6Myxcblx0XHRcdFx0ZGVmYXVsdE1hcmtHZW9jb2RlOmZhbHNlLFxuXHRcdFx0fSlcblx0XHRcdC5vbignbWFya2dlb2NvZGUnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHR2YXIgbGF0bG5nID0gIGUuZ2VvY29kZS5jZW50ZXIsXG5cdFx0XHRcdFx0ZWRpdG9yX2NvbmZpZyA9IHNlbGYuJGVsLmRhdGEoKS5lZGl0b3JDb25maWcsXG5cdFx0XHRcdFx0Y291bnRfbWFya2VycyA9IHNlbGYuJG1hcmtlcnMoKS5jaGlsZHJlbigpLm5vdCgnW2RhdGEtaWRdJykubGVuZ3RoLFxuXHRcdFx0XHRcdGxhYmVsID0gc2VsZi5fZ2V0X2dlb2NvZGVyX3Jlc3VsdF9sYWJlbCggWyBlLmdlb2NvZGUgXSwgbGF0bG5nICk7XG5cblx0XHRcdFx0aWYgKCBjb3VudF9tYXJrZXJzID09PSBmYWxzZSB8fCBjb3VudF9tYXJrZXJzIDwgZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyApIHtcblx0XHRcdFx0XHQvLyBhZGQgbWFya2VyIGlmIG5vIHJlc3RyaWN0aW9uIG9yIG1heCBtYXJrZXJzIG5vdCBleGNlZWRlZFxuXHRcdFx0XHRcdHNlbGYuYWRkX21hcmtlciggbGF0bG5nLCBsYWJlbCApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmICggZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyA9PT0gMSAmJiBjb3VudF9tYXJrZXJzID09PSAxICkge1xuXHRcdFx0XHRcdC8vIHVwZGF0ZSBzaW5nbGUgbWFya2VyXG5cdFx0XHRcdFx0bWFya2VyID0gc2VsZi5nZXRfZmlyc3RfbWFya2VyKCk7XG5cdFx0XHRcdFx0aWYgKCAhISBtYXJrZXIgKSB7XG5cdFx0XHRcdFx0XHRlbnRyeSA9IG1hcmtlci5vc21fY29udHJvbGxlcjtcblx0XHRcdFx0XHRcdG1hcmtlci5zZXRMYXRMbmcoIGxhdGxuZyApO1xuXHRcdFx0XHRcdFx0ZW50cnkudXBkYXRlX21hcmtlcl9nZW9jb2RlKCBsYWJlbCApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICggZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyA9PT0gMCApIHtcblx0XHRcdFx0XHRzZWxmLm1hcC5maXRCb3VuZHMoIGUuZ2VvY29kZS5iYm94ICk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c2VsZi5tYXAuc2V0VmlldyggbGF0bG5nLCBzZWxmLm1hcC5nZXRab29tKCkgKTsgLy8ga2VlcCB6b29tLCBtaWdodCBiZSBjb25mdXNpbmcgZWxzZVxuXHRcdFx0XHR9XG5cblx0XHRcdH0pXG5cdFx0XHQuYWRkVG8oIHRoaXMubWFwICk7XG5cblx0XHRcdC8vIHByZXZlbnQgd3AgcG9zdCBmb3JtIGZyb20gYmVpbmcgc3VibWl0dGVkXG5cdFx0XHRMLkRvbUV2ZW50LmFkZExpc3RlbmVyKHRoaXMuZ2VvY29kZXIuX2lucHV0LCAna2V5ZG93bicsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRpZiAoIGUua2V5Q29kZSA9PT0gMTMgKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCB0aGlzLmdlb2NvZGVyICk7XG5cdFx0fSxcblx0XHRnZXRfZmlyc3RfbWFya2VyOmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIG1hcmtlciA9IGZhbHNlO1xuXHRcdFx0dGhpcy5tYXAuZWFjaExheWVyKGZ1bmN0aW9uKGxheWVyKXtcblx0XHRcdFx0aWYgKCBsYXllci5jb25zdHJ1Y3RvciA9PT0gTC5NYXJrZXIgKSB7XG5cdFx0XHRcdFx0bWFya2VyID0gbGF5ZXI7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiBtYXJrZXI7XG5cdFx0fSxcblx0XHR1cGRhdGVfdmlzaWJsZTogZnVuY3Rpb24oKSB7XG5cblx0XHRcdGlmICggdGhpcy52aXNpYmxlID09PSB0aGlzLiRlbC5pcygnOnZpc2libGUnKSApIHtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudmlzaWJsZSA9IHRoaXMuJGVsLmlzKCc6dmlzaWJsZScpO1xuXG5cdFx0XHRpZiAoIHRoaXMudmlzaWJsZSApIHtcblx0XHRcdFx0dGhpcy5tYXAuaW52YWxpZGF0ZVNpemUoKTtcblx0XHRcdFx0dGhpcy5iaW5kX2V2ZW50cygpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH1cblx0XHRcdHRoaXMudW5iaW5kX2V2ZW50cygpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRpbml0X2FjZjogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdHRvZ2dsZV9jYiA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdC8vIG5vIGNoYW5nZVxuXHRcdFx0XHRcdHNlbGYudXBkYXRlX3Zpc2libGUoKTtcblx0XHRcdFx0fTtcblxuXHRcdFx0Ly8gZXhwYW5kL2NvbGxhcHNlIGFjZiBzZXR0aW5nXG5cdFx0XHRhY2YuYWRkQWN0aW9uKCAnc2hvdycsIHRvZ2dsZV9jYiApO1xuXHRcdFx0YWNmLmFkZEFjdGlvbiggJ2hpZGUnLCB0b2dnbGVfY2IgKTtcblx0XHRcdGFjZi5hZGRBY3Rpb24oICdkaXNhYmxlX2ZpZWxkJywgZnVuY3Rpb24oKXtcblx0XHRcdFx0c2VsZi51bmJpbmRfZXZlbnRzKCk7XG5cdFx0XHR9ICk7XG5cblx0XHRcdC8vIGV4cGFuZCB3cCBtZXRhYm94XG5cdFx0XHQkKGRvY3VtZW50KS5vbigncG9zdGJveC10b2dnbGVkJyx0b2dnbGVfY2IpO1xuXG5cblx0XHRcdHRoaXMubWFwLm9uKCd6b29tZW5kJywgZnVuY3Rpb24oZSl7IHNlbGYubWFwX3pvb21lZC5hcHBseSggc2VsZiwgW2VdICk7IH0gKTtcblx0XHRcdHRoaXMubWFwLm9uKCdtb3ZlZW5kJywgZnVuY3Rpb24oZSl7IHNlbGYubWFwX21vdmVkLmFwcGx5KCBzZWxmLCBbZV0gKTsgfSApO1xuXG5cdFx0fSxcblx0XHR1bmJpbmRfZXZlbnRzOmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0c2VsZi4kbGF0KCkub2ZmKCdibHVyJyk7XG5cdFx0XHRzZWxmLiRsbmcoKS5vZmYoJ2JsdXInKTtcblx0XHRcdHNlbGYuJHpvb20oKS5vZmYoJ2JsdXInKTtcblx0XHRcdHNlbGYuJHpvb20oKS5vZmYoJ2tleXVwIGZvY3VzJyk7XG5cdFx0fSxcblx0XHRiaW5kX2V2ZW50czogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNlbGYuJGxhdCgpLm9uKCdibHVyJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0c2VsZi51cGRhdGVfbWFwKCk7XG5cdFx0XHR9KTtcblx0XHRcdHNlbGYuJGxuZygpLm9uKCdibHVyJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0c2VsZi51cGRhdGVfbWFwKCk7XG5cdFx0XHR9KTtcblx0XHRcdHNlbGYuJHpvb20oKS5vbignYmx1cicsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHNlbGYudXBkYXRlX21hcCgpO1xuXHRcdFx0fSk7XG5cdFx0fSxcblx0XHR1cGRhdGVfbWFwOmZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKCAhIHRoaXMuJGxhdCgpLnZhbCgpIHx8ICEgdGhpcy4kbG5nKCkudmFsKCkgKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdHZhciBsYXRsbmcgPSBMLmxhdExuZyggdGhpcy4kbGF0KCkudmFsKCksIHRoaXMuJGxuZygpLnZhbCgpICk7XG5cdFx0XHR0aGlzLm1hcC5zZXRWaWV3KCBsYXRsbmcsICB0aGlzLiR6b29tKCkudmFsKCkgKTtcblx0XHR9LFxuXHRcdG1hcF9tb3ZlZDpmdW5jdGlvbihlKXtcblx0XHRcdHZhciBjZW50ZXIgPSB0aGlzLm1hcC5nZXRDZW50ZXIoKTtcblx0XHRcdHRoaXMuJGxhdCgpLnZhbChjZW50ZXIubGF0KTtcblx0XHRcdHRoaXMuJGxuZygpLnZhbChjZW50ZXIubG5nKTtcblx0XHR9LFxuXHRcdG1hcF96b29tZWQ6ZnVuY3Rpb24oZSl7XG5cdFx0XHR0aGlzLiR6b29tKCkudmFsKCB0aGlzLm1hcC5nZXRab29tKCkgKTtcblx0XHR9LFxuXHR9KTtcblxuXG5cdCQoZG9jdW1lbnQpXG5cdFx0Lm9uKCdhY2Ytb3NtLW1hcC1pbml0JyxmdW5jdGlvbiggZSwgbWFwICkge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0JChlLnRhcmdldCkuZGF0YSggJ19tYXBfZWRpdG9yJywgbmV3IG9zbS5maWVsZCggeyBlbDogZS50YXJnZXQsIG1hcDogbWFwIH0gKSApO1xuXHRcdFx0O1xuXHRcdH0pXG5cdFx0Ly8gZmllbGQgc2V0dGluZ3Ncblx0XHQub24oJ2NoYW5nZScsJ1tkYXRhLW5hbWU9XCJyZXR1cm5fZm9ybWF0XCJdIGlucHV0JyxmdW5jdGlvbihlKXtcblx0XHRcdC8vIGZpbmQgbWFwIGZpZWxkXG5cdFx0XHQkKCdbZGF0YS1uYW1lPVwicmV0dXJuX2Zvcm1hdFwiXSBpbnB1dDpjaGVja2VkJykudmFsKClcblx0XHRcdHZhciAkbWFwID0gJCh0aGlzKS5jbG9zZXN0KCcuYWNmLWZpZWxkLW9iamVjdCcpLmZpbmQoJ1tkYXRhLWVkaXRvci1jb25maWddJyksXG5cdFx0XHRcdGVkaXRvciA9ICRtYXAuZGF0YSggJ19tYXBfZWRpdG9yJyApLFxuXHRcdFx0XHRjb25mID0gJG1hcC5kYXRhKCdlZGl0b3ItY29uZmlnJyk7XG5cdFx0XHQvLyBtYXBcblx0XHRcdGVkaXRvci5yZXNldF9sYXllcnMoKTtcblx0XHRcdGlmICggJCh0aGlzKS52YWwoKSA9PT0gJ29zbScgKSB7XG5cdFx0XHRcdC8vIHNldCBwcm92aWRlciByZXN0cmljdGlvbiB0byBvc20gcHJvdmlkZXJzXG5cdFx0XHRcdGNvbmYucmVzdHJpY3RfcHJvdmlkZXJzID0gT2JqZWN0LnZhbHVlcyggYXJnLm9wdGlvbnMub3NtX2xheWVycyApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gc2V0IHByb3ZpZGVyIHJlc3RyaWN0aW9uIHRvIG9zbSBwcm92aWRlcnNcblx0XHRcdFx0Y29uZi5yZXN0cmljdF9wcm92aWRlcnMgPSBmYWxzZTtcblx0XHRcdH1cblx0XHRcdCRtYXAuZGF0YSggJ2VkaXRvci1jb25maWcnLCBjb25mICk7XG5cdFx0XHRlZGl0b3IuaW5pdF9sYXllcnMoKTtcblx0XHRcdC8vY29uc29sZS5sb2coZmllbGQuZWwpXG5cdFx0fSk7XG5cblx0Ly8gd2hlbiBmaWVsZHMgZ2V0IGxvYWRlZCAuLi5cblx0YWNmLmFkZEFjdGlvbiggJ2FwcGVuZCcsIGZ1bmN0aW9uKCl7XG5cdFx0JC5hY2ZfbGVhZmxldCgpO1xuXHR9KTtcblxufSkoIGpRdWVyeSwgYWNmX29zbV9hZG1pbiApO1xuIl19
