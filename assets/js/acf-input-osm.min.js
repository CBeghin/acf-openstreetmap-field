!function(e,t){var r=t.options,a={};a.MarkerList=Backbone.View.extend({}),a.MarkerEntry=Backbone.View.extend({tagName:"div",className:"osm-marker",events:{'click [data-name="locate-marker"]':"locate_marker",'click [data-name="remove-marker"]':"remove_marker",'change [id$="-marker-label"]':"update_marker_label"},get_label:function(){return this.$el.find('[id$="-marker-label"]').val()},get_default_label:function(){return this.$el.find('[id$="-marker-geocode"]').val()},is_default_label:function(){return this.get_default_label()===this.get_label()},initialize:function(e){return this.template=e.template,this.marker=e.marker,this.marker.osm_controller=this,this},render:function(){return this.$el.html(this.template(this)),this._update_values_from_marker(),this},update_marker_label:function(t){var r=this.get_label();return""===r&&(r=this.get_default_label()),e(t.target).val(r),this.set_marker_label(r)},set_marker_label:function(t){return this.marker.unbindTooltip(),this.marker.bindTooltip(t),this.marker.options.title=t,e(this.marker._icon).attr("title",t),this},update_marker_geocode:function(e){return this.is_default_label()&&this.set_marker_label(e),this.$el.find('[id$="-marker-geocode"]').val(e),this._update_values_from_marker(),this},_update_values_from_marker:function(){var e=this.marker.getLatLng();return this.$el.find('[id$="-marker-lat"]').val(e.lat),this.$el.find('[id$="-marker-lng"]').val(e.lng),this.$el.find('[id$="-marker-label"]').val(this.marker.options.title),this},locate_marker:function(){return this.marker._map.flyTo(this.marker.getLatLng()),e(this.marker._icon).focus(),this},remove_marker:function(e){return e.preventDefault(),this.marker.remove(),this}}),a.field=Backbone.View.extend({map:null,geocoder:null,visible:null,events:{},$parent:function(){return this.$el.closest(".acf-field-settings,.acf-field-open-street-map")},$zoom:function(){return this.$parent().find('input[id$="-zoom"]')},$lat:function(){return this.$parent().find('input[id$="-center_lat"]')},$lng:function(){return this.$parent().find('input[id$="-center_lng"]')},$layerStore:function(){return this.$parent().find(".acf-osm-layers")},$results:function(){return this.$parent().find(".osm-results")},$markers:function(){return this.$parent().find(".osm-markers")},initialize:function(e){return this.map=e.map,this.update_map(),this.init_acf(),this.init_layers(),this.init_markers(),this.update_visible(),this},_get_geocoder_result_label:function(t,r){var a=!1;return t.length?e.each(t,function(e,t){return a=t.html?t.html:t.name,!1}):a=r.lat.toString()+", "+r.lng.toString(),e(a).text().replace(/^(\s+)/g,"").replace(/(\s+)$/g,"").replace(/(\s+)/g," ")},init_markers:function(){var t=this,r=this.$el.data().editorConfig;this.init_geocode(),0!==r.max_markers&&(this.icon=new L.DivIcon({html:"",className:"osm-marker-icon"}),this.map.on("click",function(e){var a=e.latlng,i=t.$markers().children().not("[data-id]").length;!1!==r.max_markers&&i>=r.max_markers||t.geocoder.options.geocoder.reverse(e.latlng,t.map.getZoom(),function(e){var r=t._get_geocoder_result_label(e,a);t.add_marker(a,r)},t)}),this.map.on("layeradd",function(e){if(e.layer.constructor===L.Marker){var r=t.$markers().find('[data-id="__osm_marker_template__"]').html().split("__osm_marker_template__").join("<%= id %>"),i=new a.MarkerEntry({controller:this,marker:e.layer,id:acf.uniqid(),template:_.template(r)});i.render().$el.prependTo(t.$markers()),t.geocode_marker(i),e.layer.setIcon(t.icon).on("click",function(e){this.remove()}).on("remove",function(e){i.$el.remove()}).on("dragend",function(e){t.geocode_marker(i)}).dragging.enable()}}),e.each(this.$el.data().mapMarkers,function(e,r){L.marker(L.latLng(1*r.lat,1*r.lng),{title:r.label}).bindTooltip(r.label).addTo(t.map)}))},geocode_marker:function(e){var t=this,r=e,a=r.marker.getLatLng();t.geocoder.options.geocoder.reverse(a,t.map.getZoom(),function(e){var i=t._get_geocoder_result_label(e,a);r.update_marker_geocode(i)},this)},add_marker:function(e,t){L.marker(e,{title:t,icon:this.icon}).bindTooltip(t).addTo(this.map)},layer_is_overlay:function(e,t){var r;return!!(t.options.opacity&&t.options.opacity<1)||(r=["^(OpenWeatherMap|OpenSeaMap)","OpenMapSurfer.AdminBounds","Stamen.Toner(Hybrid|Lines|Labels)","Acetate.(foreground|labels|roads)","HillShading","Hydda.RoadsAndLabels","^JusticeMap","OpenInfraMap.(Power|Telecom|Petroleum|Water)","OpenPtMap","OpenRailwayMap","OpenFireMap","SafeCast","CartoDB.DarkMatterOnlyLabels","CartoDB.PositronOnlyLabels"],null!==e.match("("+r.join("|")+")"))},init_layers:function(){var t=this,a=[],i={},n={},o={},l=this.$el.data().editorConfig,s=function(e){return null===e||!!l.restrict_providers&&-1===l.restrict_providers.indexOf(e)},d=function(l,m){var c,u;if(_.isObject(m))return e.each(m,d);s(l)||(o[l]?(c=o[l],t.map.addLayer(c)):(u=r.layer_config[l.split(".")[0]]||{options:{}},c=L.tileLayer.provider(l,u.options),c.providerKey=l),t.layer_is_overlay(l,c)?n[l]=c:i[l]=c,-1!==a.indexOf(l)&&t.map.addLayer(c))};a=this.$el.data().mapLayers,this.$layerStore().length&&this.map.on("baselayerchange layeradd layerremove",function(e){if(e.layer.providerKey){var r=t.$layerStore(),a=t.$parent().find('[data-id="__osm_layer_template__"]');r.html(""),t.map.eachLayer(function(e){if(e.providerKey){var i=a.clone().removeAttr("data-id");i.val(e.providerKey),t.layer_is_overlay(e.providerKey,e)?r.append(i):r.prepend(i)}})}}),e.each(r.providers,d),this.$layerStore().length&&(this.layersControl=L.control.layers(i,n,{collapsed:!0,hideSingleBase:!0}).addTo(this.map))},init_geocode:function(){var t=this;this.$el.data().editorConfig;this.map._controlCorners.above=e('<div class="acf-osm-above"></div>').insertBefore(this.$el).get(0),this.geocoder=L.Control.geocoder({collapsed:!1,position:"above",placeholder:"Search...",errorMessage:"Nothing found...",showResultIcons:!0,suggestMinLength:3,suggestTimeout:250,queryMinLength:3,defaultMarkGeocode:!1}).on("markgeocode",function(e){var r=e.geocode.center,a=t.$el.data().editorConfig,i=t.$markers().children().not("[data-id]").length,n=t._get_geocoder_result_label([e.geocode],r);(!1===i||i<a.max_markers)&&t.add_marker(r,n),1===a.max_markers&&1===i&&(marker=t.get_first_marker(),marker&&(entry=marker.osm_controller,marker.setLatLng(r),entry.update_marker_geocode(n))),console.log(e.geocode),0===a.max_markers?t.map.fitBounds(e.geocode.bbox):t.map.setView(r,t.map.getZoom())}).addTo(this.map),L.DomEvent.addListener(this.geocoder._input,"keydown",function(e){13===e.keyCode&&e.preventDefault()},this.geocoder)},get_first_marker:function(){var e=!1;return this.map.eachLayer(function(t){if(t.constructor===L.Marker)return e=t,!1}),e},update_visible:function(){return this.visible===this.$el.is(":visible")?this:(this.visible=this.$el.is(":visible"),this.visible?(this.map.invalidateSize(),this.bind_events(),this):(this.unbind_events(),this))},init_acf:function(){var t=this,r=function(){t.update_visible()};acf.addAction("show",r),acf.addAction("hide",r),e(document).on("postbox-toggled",r),this.map.on("zoomend",function(e){t.map_zoomed.apply(t,[e])}),this.map.on("moveend",function(e){t.map_moved.apply(t,[e])})},unbind_events:function(){var e=this;e.$lat().off("blur"),e.$lng().off("blur"),e.$zoom().off("blur"),e.$zoom().off("keyup focus")},bind_events:function(){var e=this;e.$lat().on("blur",function(t){e.update_map()}),e.$lng().on("blur",function(t){e.update_map()}),e.$zoom().on("blur",function(t){e.update_map()})},update_map:function(){if(this.$lat().val()&&this.$lng().val()){var e=L.latLng(this.$lat().val(),this.$lng().val());this.map.setView(e,this.$zoom().val())}},map_moved:function(e){var t=this.map.getCenter();this.$lat().val(t.lat),this.$lng().val(t.lng)},map_zoomed:function(e){this.$zoom().val(this.map.getZoom())}}),e(document).on("acf-osm-map-init",function(e,t){e.preventDefault(),new a.field({el:e.target,map:t})})}(jQuery,acf_osm_admin);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1pbnB1dC1vc20uanMiXSwibmFtZXMiOlsiJCIsImFyZyIsIm9wdGlvbnMiLCJvc20iLCJNYXJrZXJMaXN0IiwiQmFja2JvbmUiLCJWaWV3IiwiZXh0ZW5kIiwiTWFya2VyRW50cnkiLCJ0YWdOYW1lIiwiY2xhc3NOYW1lIiwiZXZlbnRzIiwiY2xpY2sgW2RhdGEtbmFtZT1cImxvY2F0ZS1tYXJrZXJcIl0iLCJjbGljayBbZGF0YS1uYW1lPVwicmVtb3ZlLW1hcmtlclwiXSIsImNoYW5nZSBbaWQkPVwiLW1hcmtlci1sYWJlbFwiXSIsImdldF9sYWJlbCIsInRoaXMiLCIkZWwiLCJmaW5kIiwidmFsIiwiZ2V0X2RlZmF1bHRfbGFiZWwiLCJpc19kZWZhdWx0X2xhYmVsIiwiaW5pdGlhbGl6ZSIsIm9wdCIsInRlbXBsYXRlIiwibWFya2VyIiwib3NtX2NvbnRyb2xsZXIiLCJyZW5kZXIiLCJodG1sIiwiX3VwZGF0ZV92YWx1ZXNfZnJvbV9tYXJrZXIiLCJ1cGRhdGVfbWFya2VyX2xhYmVsIiwiZSIsImxhYmVsIiwidGFyZ2V0Iiwic2V0X21hcmtlcl9sYWJlbCIsInVuYmluZFRvb2x0aXAiLCJiaW5kVG9vbHRpcCIsInRpdGxlIiwiX2ljb24iLCJhdHRyIiwidXBkYXRlX21hcmtlcl9nZW9jb2RlIiwibGF0bG5nIiwiZ2V0TGF0TG5nIiwibGF0IiwibG5nIiwibG9jYXRlX21hcmtlciIsIl9tYXAiLCJmbHlUbyIsImZvY3VzIiwicmVtb3ZlX21hcmtlciIsInByZXZlbnREZWZhdWx0IiwicmVtb3ZlIiwiZmllbGQiLCJtYXAiLCJnZW9jb2RlciIsInZpc2libGUiLCIkcGFyZW50IiwiY2xvc2VzdCIsIiR6b29tIiwiJGxhdCIsIiRsbmciLCIkbGF5ZXJTdG9yZSIsIiRyZXN1bHRzIiwiJG1hcmtlcnMiLCJjb25mIiwidXBkYXRlX21hcCIsImluaXRfYWNmIiwiaW5pdF9sYXllcnMiLCJpbml0X21hcmtlcnMiLCJ1cGRhdGVfdmlzaWJsZSIsIl9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsIiwibGVuZ3RoIiwiZWFjaCIsImkiLCJyZXN1bHQiLCJuYW1lIiwidG9TdHJpbmciLCJ0ZXh0IiwicmVwbGFjZSIsInNlbGYiLCJlZGl0b3JfY29uZmlnIiwiZGF0YSIsImVkaXRvckNvbmZpZyIsImluaXRfZ2VvY29kZSIsIm1heF9tYXJrZXJzIiwiaWNvbiIsIkwiLCJEaXZJY29uIiwib24iLCJjb3VudF9tYXJrZXJzIiwiY2hpbGRyZW4iLCJub3QiLCJyZXZlcnNlIiwiZ2V0Wm9vbSIsImFkZF9tYXJrZXIiLCJsYXllciIsImNvbnN0cnVjdG9yIiwiTWFya2VyIiwic3BsaXQiLCJqb2luIiwiZW50cnkiLCJjb250cm9sbGVyIiwiaWQiLCJhY2YiLCJ1bmlxaWQiLCJfIiwicHJlcGVuZFRvIiwiZ2VvY29kZV9tYXJrZXIiLCJzZXRJY29uIiwiZHJhZ2dpbmciLCJlbmFibGUiLCJtYXBNYXJrZXJzIiwibWFya2VyRGF0YSIsImxhdExuZyIsImFkZFRvIiwibWFya2VyX2VudHJ5IiwibG5nbGF0IiwibGF5ZXJfaXNfb3ZlcmxheSIsImtleSIsInBhdHRlcm5zIiwib3BhY2l0eSIsIm1hdGNoIiwic2VsZWN0ZWRMYXllcnMiLCJiYXNlTGF5ZXJzIiwib3ZlcmxheXMiLCJtYXBMYXllcnMiLCJpc19vbWl0dGVkIiwicmVzdHJpY3RfcHJvdmlkZXJzIiwiaW5kZXhPZiIsInNldHVwTWFwIiwibGF5ZXJfY29uZmlnIiwiaXNPYmplY3QiLCJhZGRMYXllciIsInRpbGVMYXllciIsInByb3ZpZGVyIiwicHJvdmlkZXJLZXkiLCIkdGVtcGxhdGUiLCJlYWNoTGF5ZXIiLCIkbGF5ZXJJbnB1dCIsImNsb25lIiwicmVtb3ZlQXR0ciIsImFwcGVuZCIsInByZXBlbmQiLCJwcm92aWRlcnMiLCJsYXllcnNDb250cm9sIiwiY29udHJvbCIsImxheWVycyIsImNvbGxhcHNlZCIsImhpZGVTaW5nbGVCYXNlIiwiX2NvbnRyb2xDb3JuZXJzIiwiaW5zZXJ0QmVmb3JlIiwiZ2V0IiwiQ29udHJvbCIsInBvc2l0aW9uIiwicGxhY2Vob2xkZXIiLCJlcnJvck1lc3NhZ2UiLCJzaG93UmVzdWx0SWNvbnMiLCJzdWdnZXN0TWluTGVuZ3RoIiwic3VnZ2VzdFRpbWVvdXQiLCJxdWVyeU1pbkxlbmd0aCIsImRlZmF1bHRNYXJrR2VvY29kZSIsImdlb2NvZGUiLCJjZW50ZXIiLCJnZXRfZmlyc3RfbWFya2VyIiwic2V0TGF0TG5nIiwiY29uc29sZSIsImxvZyIsImZpdEJvdW5kcyIsImJib3giLCJzZXRWaWV3IiwiRG9tRXZlbnQiLCJhZGRMaXN0ZW5lciIsIl9pbnB1dCIsImtleUNvZGUiLCJpcyIsImludmFsaWRhdGVTaXplIiwiYmluZF9ldmVudHMiLCJ1bmJpbmRfZXZlbnRzIiwidG9nZ2xlX2NiIiwiYWRkQWN0aW9uIiwiZG9jdW1lbnQiLCJtYXBfem9vbWVkIiwiYXBwbHkiLCJtYXBfbW92ZWQiLCJvZmYiLCJnZXRDZW50ZXIiLCJlbCIsImpRdWVyeSIsImFjZl9vc21fYWRtaW4iXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBQ0EsR0FBQUMsR0FBQUQsRUFBQUMsUUFNQUMsSUFHQUEsR0FBQUMsV0FBQUMsU0FBQUMsS0FBQUMsV0FFQUosRUFBQUssWUFBQUgsU0FBQUMsS0FBQUMsUUFDQUUsUUFBQSxNQUNBQyxVQUFBLGFBQ0FDLFFBQ0FDLG9DQUFBLGdCQUNBQyxvQ0FBQSxnQkFDQUMsK0JBQUEsdUJBRUFDLFVBQUEsV0FDQSxNQUFBQyxNQUFBQyxJQUFBQyxLQUFBLHlCQUFBQyxPQUVBQyxrQkFBQSxXQUNBLE1BQUFKLE1BQUFDLElBQUFDLEtBQUEsMkJBQUFDLE9BRUFFLGlCQUFBLFdBQ0EsTUFBQUwsTUFBQUksc0JBQUFKLEtBQUFELGFBRUFPLFdBQUEsU0FBQUMsR0FNQSxNQUpBUCxNQUFBUSxTQUFBRCxFQUFBQyxTQUNBUixLQUFBUyxPQUFBRixFQUFBRSxPQUNBVCxLQUFBUyxPQUFBQyxlQUFBVixLQUVBQSxNQUVBVyxPQUFBLFdBR0EsTUFGQVgsTUFBQUMsSUFB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UUFBQWhJLEVBQUF6QixLQUFBMEMsUUFBQXZDLFNBRUFvSyxVQUFBLFNBQUF4SixHQUNBLEdBQUFtSSxHQUFBbEosS0FBQXFDLElBQUFvSSxXQUNBekssTUFBQTJDLE9BQUF4QyxJQUFBK0ksRUFBQXZILEtBQ0EzQixLQUFBNEMsT0FBQXpDLElBQUErSSxFQUFBdEgsTUFFQXlJLFdBQUEsU0FBQXRKLEdBQ0FmLEtBQUEwQyxRQUFBdkMsSUFBQUgsS0FBQXFDLElBQUF3QyxjQWlCQTdGLEVBQUFvTCxVQUFBNUYsR0FBQSxtQkFBQSxTQUFBekQsRUFBQXNCLEdBQ0F0QixFQUFBbUIsaUJBQ0EsR0FBQS9DLEdBQUFpRCxPQUFBc0ksR0FBQTNKLEVBQUFFLE9BQUFvQixJQUFBQSxPQUlBc0ksT0FBQUMiLCJmaWxlIjoiYWNmLWlucHV0LW9zbS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oICQsIGFyZyApe1xuXHR2YXIgb3B0aW9ucyA9IGFyZy5vcHRpb25zLFxuXHRcdHJlc3VsdF90cGwgPSAnPGRpdiB0YWJpbmRleD1cIjwlPSBkYXRhLmkgJT5cIiBjbGFzcz1cIm9zbS1yZXN1bHRcIj4nXG5cdFx0XHQrICc8JT0gZGF0YS5yZXN1bHRfdGV4dCAlPidcblx0XHRcdCsgJzxiciAvPjxzbWFsbD48JT0gZGF0YS5wcm9wZXJ0aWVzLm9zbV92YWx1ZSAlPjwvc21hbGw+J1xuXHRcdFx0KyAnPC9kaXY+JztcblxuXHR2YXIgb3NtID0ge1xuXHR9O1xuXG5cdG9zbS5NYXJrZXJMaXN0ID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXHR9KVxuXHRvc20uTWFya2VyRW50cnkgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG5cdFx0dGFnTmFtZTogJ2RpdicsXG5cdFx0Y2xhc3NOYW1lOidvc20tbWFya2VyJyxcblx0XHRldmVudHM6IHtcblx0XHRcdCdjbGljayBbZGF0YS1uYW1lPVwibG9jYXRlLW1hcmtlclwiXScgOiAnbG9jYXRlX21hcmtlcicsXG5cdFx0XHQnY2xpY2sgW2RhdGEtbmFtZT1cInJlbW92ZS1tYXJrZXJcIl0nIDogJ3JlbW92ZV9tYXJrZXInLFxuXHRcdFx0J2NoYW5nZSBbaWQkPVwiLW1hcmtlci1sYWJlbFwiXSdcdFx0OiAndXBkYXRlX21hcmtlcl9sYWJlbCcsXG5cdFx0fSxcblx0XHRnZXRfbGFiZWw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWxhYmVsXCJdJykudmFsKCk7XG5cdFx0fSxcblx0XHRnZXRfZGVmYXVsdF9sYWJlbDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItZ2VvY29kZVwiXScpLnZhbCgpO1xuXHRcdH0sXG5cdFx0aXNfZGVmYXVsdF9sYWJlbDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5nZXRfZGVmYXVsdF9sYWJlbCgpID09PSB0aGlzLmdldF9sYWJlbCgpO1xuXHRcdH0sXG5cdFx0aW5pdGlhbGl6ZTpmdW5jdGlvbihvcHQpe1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0dGhpcy50ZW1wbGF0ZSA9IG9wdC50ZW1wbGF0ZTtcblx0XHRcdHRoaXMubWFya2VyID0gb3B0Lm1hcmtlcjtcblx0XHRcdHRoaXMubWFya2VyLm9zbV9jb250cm9sbGVyID0gdGhpcztcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRyZW5kZXI6ZnVuY3Rpb24oKXtcblx0XHRcdHRoaXMuJGVsLmh0bWwoIHRoaXMudGVtcGxhdGUoIHRoaXMgKSApO1xuXHRcdFx0dGhpcy5fdXBkYXRlX3ZhbHVlc19mcm9tX21hcmtlcigpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHR1cGRhdGVfbWFya2VyX2xhYmVsOmZ1bmN0aW9uKGUpIHtcblx0XHRcdHZhciBsYWJlbCA9IHRoaXMuZ2V0X2xhYmVsKCk7XG5cblx0XHRcdGlmICggbGFiZWwgPT09ICcnICkge1xuXHRcdFx0XHRsYWJlbCA9IHRoaXMuZ2V0X2RlZmF1bHRfbGFiZWwoKTtcblx0XHRcdH1cblx0XHRcdC8vIHJlc3RvcmUgZ2VvY29kZSBkZWZhdWx0XG5cdFx0XHQkKGUudGFyZ2V0KS52YWwobGFiZWwpO1xuXG5cdFx0XHRyZXR1cm4gdGhpcy5zZXRfbWFya2VyX2xhYmVsKCBsYWJlbCApO1xuXHRcdH0sXG5cdFx0c2V0X21hcmtlcl9sYWJlbDpmdW5jdGlvbihsYWJlbCkge1xuXHRcdFx0dGhpcy5tYXJrZXIudW5iaW5kVG9vbHRpcCgpO1xuXHRcdFx0dGhpcy5tYXJrZXIuYmluZFRvb2x0aXAobGFiZWwpO1xuXG5cdFx0XHR0aGlzLm1hcmtlci5vcHRpb25zLnRpdGxlID0gbGFiZWw7XG5cdFx0XHQkKCB0aGlzLm1hcmtlci5faWNvbiApLmF0dHIoICd0aXRsZScsIGxhYmVsICk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHVwZGF0ZV9tYXJrZXJfZ2VvY29kZTpmdW5jdGlvbiggbGFiZWwgKSB7XG5cblx0XHRcdGlmICggdGhpcy5pc19kZWZhdWx0X2xhYmVsKCkgKSB7XG5cdFx0XHRcdC8vIHVwZGF0ZSBtYXJrZXIgbGFiZWxzXG5cdFx0XHRcdHRoaXMuc2V0X21hcmtlcl9sYWJlbCggbGFiZWwgKTtcblx0XHRcdFx0Ly8gdXBkYXRlIG1hcmtlciBsYWJlbCBpbnB1dFxuXHRcdFx0fVxuXG5cblx0XHRcdHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWdlb2NvZGVcIl0nKS52YWwoIGxhYmVsICk7XG5cblx0XHRcdHRoaXMuX3VwZGF0ZV92YWx1ZXNfZnJvbV9tYXJrZXIoKTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRfdXBkYXRlX3ZhbHVlc19mcm9tX21hcmtlcjogZnVuY3Rpb24oICkge1xuXHRcdFx0dmFyIGxhdGxuZyA9IHRoaXMubWFya2VyLmdldExhdExuZygpO1xuXHRcdFx0dGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItbGF0XCJdJykudmFsKCBsYXRsbmcubGF0ICk7XG5cdFx0XHR0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1sbmdcIl0nKS52YWwoIGxhdGxuZy5sbmcgKTtcblx0XHRcdHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWxhYmVsXCJdJykudmFsKCB0aGlzLm1hcmtlci5vcHRpb25zLnRpdGxlICk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0bG9jYXRlX21hcmtlcjpmdW5jdGlvbigpe1xuXHRcdFx0dGhpcy5tYXJrZXIuX21hcC5mbHlUbyggdGhpcy5tYXJrZXIuZ2V0TGF0TG5nKCkgKTtcblx0XHRcdCQodGhpcy5tYXJrZXIuX2ljb24pLmZvY3VzKClcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0cmVtb3ZlX21hcmtlcjpmdW5jdGlvbihlKSB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KClcblx0XHRcdHRoaXMubWFya2VyLnJlbW92ZSgpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXHR9KTtcblxuXHRvc20uZmllbGQgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG5cdFx0Lypcblx0XHR0b2RvOlxuXHRcdC0gTWFwIExheWVyIHNlbGVjdG9yXG5cdFx0LSBzZXQgLyB1bnNldCBtYXJrZXJcblx0XHQqL1xuXG5cdFx0bWFwOiBudWxsLFxuXHRcdGdlb2NvZGVyOiBudWxsLFxuXHRcdHZpc2libGU6IG51bGwsXG5cdFx0ZXZlbnRzOntcblx0XHR9LFxuXG5cdFx0JHBhcmVudDpmdW5jdGlvbigpe1xuXHRcdFx0cmV0dXJuIHRoaXMuJGVsLmNsb3Nlc3QoJy5hY2YtZmllbGQtc2V0dGluZ3MsLmFjZi1maWVsZC1vcGVuLXN0cmVldC1tYXAnKVxuXHRcdH0sXG5cdFx0JHpvb20gOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCdpbnB1dFtpZCQ9XCItem9vbVwiXScpO1xuXHRcdH0sXG5cdFx0JGxhdCA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJ2lucHV0W2lkJD1cIi1jZW50ZXJfbGF0XCJdJyk7XG5cdFx0fSxcblx0XHQkbG5nIDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnaW5wdXRbaWQkPVwiLWNlbnRlcl9sbmdcIl0nKTtcblx0XHR9LFxuXHRcdCRsYXllclN0b3JlOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCcuYWNmLW9zbS1sYXllcnMnKTtcblx0XHR9LFxuXHRcdCRyZXN1bHRzIDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnLm9zbS1yZXN1bHRzJyk7XG5cdFx0fSxcblx0XHQkbWFya2VyczpmdW5jdGlvbigpe1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJy5vc20tbWFya2VycycpO1xuXHRcdH0sXG5cdFx0aW5pdGlhbGl6ZTpmdW5jdGlvbihjb25mKSB7XG5cblx0XHRcdHRoaXMubWFwXHRcdD0gY29uZi5tYXA7XG5cblx0XHRcdHRoaXMudXBkYXRlX21hcCgpOyAvLyBzZXQgbWFwIHRvIGlucHV0IHZhbHVlc1xuXG5cdFx0XHR0aGlzLmluaXRfYWNmKCk7XG5cblx0XHRcdHRoaXMuaW5pdF9sYXllcnMoKTtcblxuXHRcdFx0dGhpcy5pbml0X21hcmtlcnMoKTtcblxuXHRcdFx0dGhpcy51cGRhdGVfdmlzaWJsZSgpO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdF9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsOmZ1bmN0aW9uKCBlLCBsYXRsbmcgKSB7XG5cdFx0XHR2YXIgbGFiZWwgPSBmYWxzZTtcblxuXHRcdFx0aWYgKCAhIGUubGVuZ3RoICkge1xuXHRcdFx0XHRsYWJlbCA9IGxhdGxuZy5sYXQudG9TdHJpbmcoKSArICcsICcgKyBsYXRsbmcubG5nLnRvU3RyaW5nKCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQkLmVhY2goIGUsIGZ1bmN0aW9uKCBpLCByZXN1bHQgKSB7XG5cdFx0XHRcdFx0aWYgKCAhISByZXN1bHQuaHRtbCApIHtcblx0XHRcdFx0XHRcdGxhYmVsID0gcmVzdWx0Lmh0bWw7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGxhYmVsID0gcmVzdWx0Lm5hbWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gJChsYWJlbCkudGV4dCgpLnJlcGxhY2UoL14oXFxzKykvZywnJykucmVwbGFjZSgvKFxccyspJC9nLCcnKS5yZXBsYWNlKC8oXFxzKykvZywnICcpO1xuXHRcdH0sXG5cdFx0aW5pdF9tYXJrZXJzOmZ1bmN0aW9uKCl7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0ZWRpdG9yX2NvbmZpZyA9IHRoaXMuJGVsLmRhdGEoKS5lZGl0b3JDb25maWc7XG5cblx0XHRcdHRoaXMuaW5pdF9nZW9jb2RlKCk7XG5cblx0XHRcdC8vIG5vIG1hcmtlcnMgYWxsb3dlZCFcblx0XHRcdGlmICggZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyA9PT0gMCApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmljb24gPSBuZXcgTC5EaXZJY29uKHtcblx0XHRcdFx0aHRtbDogJycsXG5cdFx0XHRcdGNsYXNzTmFtZTonb3NtLW1hcmtlci1pY29uJ1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMubWFwLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHR2YXIgbGF0bG5nID0gZS5sYXRsbmcsXG5cdFx0XHRcdFx0Y291bnRfbWFya2VycyA9IHNlbGYuJG1hcmtlcnMoKS5jaGlsZHJlbigpLm5vdCgnW2RhdGEtaWRdJykubGVuZ3RoO1xuXG5cdFx0XHRcdC8vIG5vIG1vcmUgbWFya2Vyc1xuXHRcdFx0XHRpZiAoIGVkaXRvcl9jb25maWcubWF4X21hcmtlcnMgIT09IGZhbHNlICYmIGNvdW50X21hcmtlcnMgPj0gZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyApIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBUSEVSRSBJUyBBIEJFVFRFUiBXQVkhXG5cdFx0XHRcdHNlbGYuZ2VvY29kZXIub3B0aW9ucy5nZW9jb2Rlci5yZXZlcnNlKGUubGF0bG5nLHNlbGYubWFwLmdldFpvb20oKSxmdW5jdGlvbihlKXtcblxuXHRcdFx0XHRcdHZhciBsYWJlbCA9IHNlbGYuX2dldF9nZW9jb2Rlcl9yZXN1bHRfbGFiZWwoIGUsIGxhdGxuZyApO1xuXG5cdFx0XHRcdFx0c2VsZi5hZGRfbWFya2VyKCBsYXRsbmcsIGxhYmVsICk7XG5cblx0XHRcdFx0fSxzZWxmKTtcblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLm1hcC5vbiggJ2xheWVyYWRkJywgZnVuY3Rpb24oZSl7XG5cdFx0XHRcdGlmICggZS5sYXllci5jb25zdHJ1Y3RvciAhPT0gTC5NYXJrZXIgKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHRcdC8vIG1hcmtlciBhZGRlZFxuXHRcdFx0XHR2YXIgdGVtcGxhdGUgPSBzZWxmLiRtYXJrZXJzKCkuZmluZCgnW2RhdGEtaWQ9XCJfX29zbV9tYXJrZXJfdGVtcGxhdGVfX1wiXScpLmh0bWwoKS5zcGxpdCgnX19vc21fbWFya2VyX3RlbXBsYXRlX18nKS5qb2luKCAnPCU9IGlkICU+JyApLFxuXHRcdFx0XHRcdGVudHJ5ID0gbmV3IG9zbS5NYXJrZXJFbnRyeSh7XG5cdFx0XHRcdFx0XHRjb250cm9sbGVyOiB0aGlzLFxuXHRcdFx0XHRcdFx0bWFya2VyOiBlLmxheWVyLFxuXHRcdFx0XHRcdFx0aWQ6IGFjZi51bmlxaWQoKSwgLy9zZWxmLiRtYXJrZXJzKCkuY2hpbGRyZW4oKS5sZW5ndGgsXG5cdFx0XHRcdFx0XHR0ZW1wbGF0ZTogXy50ZW1wbGF0ZSggdGVtcGxhdGUgKSxcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRlbnRyeS5yZW5kZXIoKS4kZWwucHJlcGVuZFRvKCBzZWxmLiRtYXJrZXJzKCkgKTtcblxuXHRcdFx0XHRzZWxmLmdlb2NvZGVfbWFya2VyKCBlbnRyeSApO1xuXG5cdFx0XHRcdGUubGF5ZXJcblx0XHRcdFx0XHQuc2V0SWNvbiggc2VsZi5pY29uIClcblx0XHRcdFx0XHQub24oJ2NsaWNrJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRcdHRoaXMucmVtb3ZlKCk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQub24oJ3JlbW92ZScsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0XHRlbnRyeS4kZWwucmVtb3ZlKCk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQub24oJ2RyYWdlbmQnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdFx0c2VsZi5nZW9jb2RlX21hcmtlciggZW50cnkgKTtcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5kcmFnZ2luZy5lbmFibGUoKTtcblx0XHRcdH0gKTtcblx0XHRcdC8vIGFkZCBtYXJrZXJzXG5cdFx0XHQkLmVhY2goIHRoaXMuJGVsLmRhdGEoKS5tYXBNYXJrZXJzLGZ1bmN0aW9uKCBpLCBtYXJrZXJEYXRhICkge1xuXHRcdFx0XHQvLyBhZGQgbWFya2Vyc1xuXHRcdFx0XHR2YXIgbWFya2VyID0gTC5tYXJrZXIoIEwubGF0TG5nKCBtYXJrZXJEYXRhLmxhdCAqIDEsIG1hcmtlckRhdGEubG5nICogMSApLCB7XG5cdFx0XHRcdFx0XHR0aXRsZTogbWFya2VyRGF0YS5sYWJlbFxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0LmJpbmRUb29sdGlwKCBtYXJrZXJEYXRhLmxhYmVsIClcblx0XHRcdFx0XHQuYWRkVG8oIHNlbGYubWFwICk7XG5cblx0XHRcdH0pO1xuXG5cdFx0fSxcblx0XHRnZW9jb2RlX21hcmtlcjpmdW5jdGlvbiggbWFya2VyX2VudHJ5ICkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRlbnRyeSA9IG1hcmtlcl9lbnRyeSxcblx0XHRcdFx0bGF0bG5nID0gZW50cnkubWFya2VyLmdldExhdExuZygpO1xuXG5cdFx0XHRzZWxmLmdlb2NvZGVyLm9wdGlvbnMuZ2VvY29kZXIucmV2ZXJzZSggbGF0bG5nLCBzZWxmLm1hcC5nZXRab29tKCksIGZ1bmN0aW9uKGUpe1xuXG5cdFx0XHRcdHZhciBsYWJlbCA9IHNlbGYuX2dldF9nZW9jb2Rlcl9yZXN1bHRfbGFiZWwoIGUsIGxhdGxuZyApO1xuXG5cdFx0XHRcdGVudHJ5LnVwZGF0ZV9tYXJrZXJfZ2VvY29kZSggbGFiZWwgKTtcblxuXHRcdFx0fSwgdGhpcyApO1xuXG5cdFx0fSxcblx0XHRhZGRfbWFya2VyOmZ1bmN0aW9uKCBsbmdsYXQsIGxhYmVsICl7XG5cdFx0XHRMLm1hcmtlcihsbmdsYXQse1xuXHRcdFx0XHR0aXRsZTogbGFiZWwsXG5cdFx0XHRcdGljb246IHRoaXMuaWNvbixcblx0XHRcdH0pXG5cdFx0XHRcdC5iaW5kVG9vbHRpcCggbGFiZWwgKVxuXHRcdFx0XHQuYWRkVG8oIHRoaXMubWFwICk7XG5cdFx0fSxcblx0XHRsYXllcl9pc19vdmVybGF5OiBmdW5jdGlvbiggIGtleSwgbGF5ZXIgKSB7XG5cdFx0XHR2YXIgcGF0dGVybnM7XG5cblx0XHRcdGlmICggbGF5ZXIub3B0aW9ucy5vcGFjaXR5ICYmIGxheWVyLm9wdGlvbnMub3BhY2l0eSA8IDEgKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0cGF0dGVybnMgPSBbJ14oT3BlbldlYXRoZXJNYXB8T3BlblNlYU1hcCknLFxuXHRcdFx0XHQnT3Blbk1hcFN1cmZlci5BZG1pbkJvdW5kcycsXG5cdFx0XHRcdCdTdGFtZW4uVG9uZXIoSHlicmlkfExpbmVzfExhYmVscyknLFxuXHRcdFx0XHQnQWNldGF0ZS4oZm9yZWdyb3VuZHxsYWJlbHN8cm9hZHMpJyxcblx0XHRcdFx0J0hpbGxTaGFkaW5nJyxcblx0XHRcdFx0J0h5ZGRhLlJvYWRzQW5kTGFiZWxzJyxcblx0XHRcdFx0J15KdXN0aWNlTWFwJyxcblx0XHRcdFx0J09wZW5JbmZyYU1hcC4oUG93ZXJ8VGVsZWNvbXxQZXRyb2xldW18V2F0ZXIpJyxcblx0XHRcdFx0J09wZW5QdE1hcCcsXG5cdFx0XHRcdCdPcGVuUmFpbHdheU1hcCcsXG5cdFx0XHRcdCdPcGVuRmlyZU1hcCcsXG5cdFx0XHRcdCdTYWZlQ2FzdCcsXG5cdFx0XHRcdCdDYXJ0b0RCLkRhcmtNYXR0ZXJPbmx5TGFiZWxzJyxcblx0XHRcdFx0J0NhcnRvREIuUG9zaXRyb25Pbmx5TGFiZWxzJ1xuXHRcdFx0XTtcblx0XHRcdHJldHVybiBrZXkubWF0Y2goJygnICsgcGF0dGVybnMuam9pbignfCcpICsgJyknKSAhPT0gbnVsbDtcblx0XHR9LFxuXHRcdGluaXRfbGF5ZXJzOmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRzZWxlY3RlZExheWVycyA9IFtdLFxuXHRcdFx0XHRiYXNlTGF5ZXJzID0ge30sXG5cdFx0XHRcdG92ZXJsYXlzID0ge30sXG5cdFx0XHRcdG1hcExheWVycyA9IHt9LFxuXHRcdFx0XHRlZGl0b3JfY29uZmlnID0gdGhpcy4kZWwuZGF0YSgpLmVkaXRvckNvbmZpZyxcblx0XHRcdFx0aXNfb21pdHRlZCA9IGZ1bmN0aW9uKGtleSkge1xuXG5cdFx0XHRcdFx0cmV0dXJuIGtleSA9PT0gbnVsbCB8fCAoICEhIGVkaXRvcl9jb25maWcucmVzdHJpY3RfcHJvdmlkZXJzICYmIGVkaXRvcl9jb25maWcucmVzdHJpY3RfcHJvdmlkZXJzLmluZGV4T2YoIGtleSApID09PSAtMSApO1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRzZXR1cE1hcCA9IGZ1bmN0aW9uKCBrZXksIHZhbCApe1xuXHRcdFx0XHRcdHZhciBsYXllciwgbGF5ZXJfY29uZmlnO1xuXHRcdFx0XHRcdGlmICggXy5pc09iamVjdCh2YWwpICkge1xuXHRcdFx0XHRcdFx0cmV0dXJuICQuZWFjaCggdmFsLCBzZXR1cE1hcCApO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICggaXNfb21pdHRlZChrZXkpICkge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAoICEhIG1hcExheWVyc1sga2V5IF0gKSB7XG5cdFx0XHRcdFx0XHRsYXllciA9IG1hcExheWVyc1sga2V5IF07XG5cdFx0XHRcdFx0XHRzZWxmLm1hcC5hZGRMYXllcihsYXllcilcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0bGF5ZXJfY29uZmlnID0gb3B0aW9ucy5sYXllcl9jb25maWdbIGtleS5zcGxpdCgnLicpWzBdIF0gfHwge29wdGlvbnM6e319O1xuXHRcdFx0XHRcdFx0bGF5ZXIgPSBMLnRpbGVMYXllci5wcm92aWRlcigga2V5LCBsYXllcl9jb25maWcub3B0aW9ucyApO1xuXHRcdFx0XHRcdFx0bGF5ZXIucHJvdmlkZXJLZXkgPSBrZXk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCBzZWxmLmxheWVyX2lzX292ZXJsYXkoIGtleSwgbGF5ZXIgKSApIHtcblx0XHRcdFx0XHRcdG92ZXJsYXlzW2tleV0gPSBsYXllcjtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0YmFzZUxheWVyc1trZXldID0gbGF5ZXI7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCBzZWxlY3RlZExheWVycy5pbmRleE9mKCBrZXkgKSAhPT0gLTEgKSB7XG5cdFx0XHRcdFx0XHRzZWxmLm1hcC5hZGRMYXllcihsYXllcik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9O1xuXG5cdFx0XHRzZWxlY3RlZExheWVycyA9IHRoaXMuJGVsLmRhdGEoKS5tYXBMYXllcnM7XG5cblx0XHRcdC8vIGVkaXRhYmxlIGxheWVycyFcblx0XHRcdGlmICggdGhpcy4kbGF5ZXJTdG9yZSgpLmxlbmd0aCApIHtcblx0XHRcdFx0dGhpcy5tYXAub24oICdiYXNlbGF5ZXJjaGFuZ2UgbGF5ZXJhZGQgbGF5ZXJyZW1vdmUnLCBmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRpZiAoICEgZS5sYXllci5wcm92aWRlcktleSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHR2YXIgJGxheWVyU3RvcmUgPSBzZWxmLiRsYXllclN0b3JlKCksXG5cdFx0XHRcdFx0XHQkdGVtcGxhdGUgPSBzZWxmLiRwYXJlbnQoKS5maW5kKCdbZGF0YS1pZD1cIl9fb3NtX2xheWVyX3RlbXBsYXRlX19cIl0nKTtcblxuXHRcdFx0XHRcdCRsYXllclN0b3JlLmh0bWwoJycpO1xuXG5cdFx0XHRcdFx0c2VsZi5tYXAuZWFjaExheWVyKGZ1bmN0aW9uKGxheWVyKSB7XG5cdFx0XHRcdFx0XHRpZiAoICEgbGF5ZXIucHJvdmlkZXJLZXkgKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHZhciAkbGF5ZXJJbnB1dCA9ICR0ZW1wbGF0ZS5jbG9uZSgpLnJlbW92ZUF0dHIoJ2RhdGEtaWQnKTtcblx0XHRcdFx0XHRcdCRsYXllcklucHV0LnZhbCggbGF5ZXIucHJvdmlkZXJLZXkgKTtcblxuXHRcdFx0XHRcdFx0aWYgKCBzZWxmLmxheWVyX2lzX292ZXJsYXkoIGxheWVyLnByb3ZpZGVyS2V5LCBsYXllciApICkge1xuXHRcdFx0XHRcdFx0XHQkbGF5ZXJTdG9yZS5hcHBlbmQoICRsYXllcklucHV0ICk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHQkbGF5ZXJTdG9yZS5wcmVwZW5kKCAkbGF5ZXJJbnB1dCApO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdH0gKTtcblx0XHRcdH1cblxuXG5cdFx0XHQkLmVhY2goIG9wdGlvbnMucHJvdmlkZXJzLCBzZXR1cE1hcCApO1xuXG5cdFx0XHQvLyAuLi4gbm8gbGF5ZXIgZWRpdGluZyBhbGxvd2VkXG5cdFx0XHRpZiAoIHRoaXMuJGxheWVyU3RvcmUoKS5sZW5ndGggKSB7XG5cdFx0XHRcdHRoaXMubGF5ZXJzQ29udHJvbCA9IEwuY29udHJvbC5sYXllcnMoIGJhc2VMYXllcnMsIG92ZXJsYXlzLCB7XG5cdFx0XHRcdFx0Y29sbGFwc2VkOiB0cnVlLFxuXHRcdFx0XHRcdGhpZGVTaW5nbGVCYXNlOiB0cnVlLFxuXHRcdFx0XHR9KS5hZGRUbyh0aGlzLm1hcCk7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRpbml0X2dlb2NvZGU6ZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0ZWRpdG9yX2NvbmZpZyA9IHRoaXMuJGVsLmRhdGEoKS5lZGl0b3JDb25maWc7XG5cblx0XHRcdHRoaXMubWFwLl9jb250cm9sQ29ybmVyc1snYWJvdmUnXSA9ICQoJzxkaXYgY2xhc3M9XCJhY2Ytb3NtLWFib3ZlXCI+PC9kaXY+JykuaW5zZXJ0QmVmb3JlKCB0aGlzLiRlbCApLmdldCgwKTtcblxuXHRcdFx0dGhpcy5nZW9jb2RlciA9IEwuQ29udHJvbC5nZW9jb2Rlcih7XG5cdFx0XHRcdGNvbGxhcHNlZDogZmFsc2UsXG5cdFx0XHRcdHBvc2l0aW9uOidhYm92ZScsXG5cdFx0XHRcdHBsYWNlaG9sZGVyOidTZWFyY2guLi4nLFxuXHRcdFx0XHRlcnJvck1lc3NhZ2U6J05vdGhpbmcgZm91bmQuLi4nLFxuXHRcdFx0XHRzaG93UmVzdWx0SWNvbnM6dHJ1ZSxcblx0XHRcdFx0c3VnZ2VzdE1pbkxlbmd0aDozLFxuXHRcdFx0XHRzdWdnZXN0VGltZW91dDoyNTAsXG5cdFx0XHRcdHF1ZXJ5TWluTGVuZ3RoOjMsXG5cdFx0XHRcdGRlZmF1bHRNYXJrR2VvY29kZTpmYWxzZSxcblx0XHRcdH0pXG5cdFx0XHQub24oJ21hcmtnZW9jb2RlJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0dmFyIGxhdGxuZyA9ICBlLmdlb2NvZGUuY2VudGVyLFxuXHRcdFx0XHRcdGVkaXRvcl9jb25maWcgPSBzZWxmLiRlbC5kYXRhKCkuZWRpdG9yQ29uZmlnLFxuXHRcdFx0XHRcdGNvdW50X21hcmtlcnMgPSBzZWxmLiRtYXJrZXJzKCkuY2hpbGRyZW4oKS5ub3QoJ1tkYXRhLWlkXScpLmxlbmd0aCxcblx0XHRcdFx0XHRsYWJlbCA9IHNlbGYuX2dldF9nZW9jb2Rlcl9yZXN1bHRfbGFiZWwoIFsgZS5nZW9jb2RlIF0sIGxhdGxuZyApO1xuXG5cdFx0XHRcdGlmICggY291bnRfbWFya2VycyA9PT0gZmFsc2UgfHwgY291bnRfbWFya2VycyA8IGVkaXRvcl9jb25maWcubWF4X21hcmtlcnMgKSB7XG5cdFx0XHRcdFx0Ly8gYWRkIG1hcmtlciBpZiBubyByZXN0cmljdGlvbiBvciBtYXggbWFya2VycyBub3QgZXhjZWVkZWRcblx0XHRcdFx0XHRzZWxmLmFkZF9tYXJrZXIoIGxhdGxuZywgbGFiZWwgKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRpZiAoIGVkaXRvcl9jb25maWcubWF4X21hcmtlcnMgPT09IDEgJiYgY291bnRfbWFya2VycyA9PT0gMSApIHtcblx0XHRcdFx0XHQvLyB1cGRhdGUgc2luZ2xlIG1hcmtlclxuXHRcdFx0XHRcdG1hcmtlciA9IHNlbGYuZ2V0X2ZpcnN0X21hcmtlcigpO1xuXHRcdFx0XHRcdGlmICggISEgbWFya2VyICkge1xuXHRcdFx0XHRcdFx0ZW50cnkgPSBtYXJrZXIub3NtX2NvbnRyb2xsZXI7XG5cdFx0XHRcdFx0XHRtYXJrZXIuc2V0TGF0TG5nKCBsYXRsbmcgKTtcblx0XHRcdFx0XHRcdGVudHJ5LnVwZGF0ZV9tYXJrZXJfZ2VvY29kZSggbGFiZWwgKTtcblx0XHRcdFx0XHR9XG5cbi8vXHRcdFx0XHRcdHNlbGYuYWRkX21hcmtlciggbGF0bG5nLCBsYWJlbCApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGNvbnNvbGUubG9nKGUuZ2VvY29kZSlcblx0XHRcdFx0Ly8gMS4gYWRkIGFtcmtlcjogaWZcblx0XHRcdFx0Ly8gMi4gdXBkYXRlIHNpbmdsZSBtYXJrZXJcblx0XHRcdFx0Ly8gMy5cblx0XHRcdFx0Lypcblx0XHRcdFx0c2VsZi5tYXAuZmx5VG9Cb3VuZHMoZS5nZW9jb2RlLmJib3gpO1xuXHRcdFx0XHQvKi9cblx0XHRcdFx0aWYgKCBlZGl0b3JfY29uZmlnLm1heF9tYXJrZXJzID09PSAwICkge1xuXHRcdFx0XHRcdHNlbGYubWFwLmZpdEJvdW5kcyggZS5nZW9jb2RlLmJib3ggKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRzZWxmLm1hcC5zZXRWaWV3KCBsYXRsbmcsIHNlbGYubWFwLmdldFpvb20oKSApOyAvLyBrZWVwIHpvb20sIG1pZ2h0IGJlIGNvbmZ1c2luZyBlbHNlXG5cdFx0XHRcdH1cblx0XHRcdFx0Ly8qL1xuXG5cblxuXG4vL1x0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0fSlcblx0XHRcdC5hZGRUbyggdGhpcy5tYXAgKTtcblxuXHRcdFx0Ly8gcHJldmVudCB3cCBwb3N0IGZvcm0gZnJvbSBiZWluZyBzdWJtaXR0ZWRcblx0XHRcdEwuRG9tRXZlbnQuYWRkTGlzdGVuZXIodGhpcy5nZW9jb2Rlci5faW5wdXQsICdrZXlkb3duJywgZnVuY3Rpb24oZSl7XG5cdFx0XHRcdGlmICggZS5rZXlDb2RlID09PSAxMyApIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdH1cblx0XHRcdH0sIHRoaXMuZ2VvY29kZXIgKTtcblx0XHR9LFxuXHRcdGdldF9maXJzdF9tYXJrZXI6ZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgbWFya2VyID0gZmFsc2U7XG5cdFx0XHR0aGlzLm1hcC5lYWNoTGF5ZXIoZnVuY3Rpb24obGF5ZXIpe1xuXHRcdFx0XHRpZiAoIGxheWVyLmNvbnN0cnVjdG9yID09PSBMLk1hcmtlciApIHtcblx0XHRcdFx0XHRtYXJrZXIgPSBsYXllcjtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIG1hcmtlcjtcblx0XHR9LFxuXHRcdHVwZGF0ZV92aXNpYmxlOiBmdW5jdGlvbigpIHtcblxuXHRcdFx0aWYgKCB0aGlzLnZpc2libGUgPT09IHRoaXMuJGVsLmlzKCc6dmlzaWJsZScpICkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH1cblxuXHRcdFx0dGhpcy52aXNpYmxlID0gdGhpcy4kZWwuaXMoJzp2aXNpYmxlJyk7XG5cblx0XHRcdGlmICggdGhpcy52aXNpYmxlICkge1xuXHRcdFx0XHR0aGlzLm1hcC5pbnZhbGlkYXRlU2l6ZSgpO1xuXHRcdFx0XHR0aGlzLmJpbmRfZXZlbnRzKCk7XG5cdFx0XHRcdHJldHVybiB0aGlzO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy51bmJpbmRfZXZlbnRzKCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdGluaXRfYWNmOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0dG9nZ2xlX2NiID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0Ly8gbm8gY2hhbmdlXG5cdFx0XHRcdFx0c2VsZi51cGRhdGVfdmlzaWJsZSgpO1xuXHRcdFx0XHR9O1xuXG5cdFx0XHQvLyBleHBhbmQvY29sbGFwc2UgYWNmIHNldHRpbmdcblx0XHRcdGFjZi5hZGRBY3Rpb24oICdzaG93JywgdG9nZ2xlX2NiICk7XG5cdFx0XHRhY2YuYWRkQWN0aW9uKCAnaGlkZScsIHRvZ2dsZV9jYiApO1xuXG5cblxuXHRcdFx0Ly8gZXhwYW5kIGFjZiByZXBlYXRlclxuXHRcdFx0Ly8gLi4uXG5cblx0XHRcdC8vIGV4cGFuZCBhY2YgbGF5b3V0XG5cdFx0XHQvLyAuLi5cblxuXHRcdFx0Ly8gZXhwYW5kIHdwIG1ldGFib3hcblx0XHRcdCQoZG9jdW1lbnQpLm9uKCdwb3N0Ym94LXRvZ2dsZWQnLHRvZ2dsZV9jYilcblxuXG5cdFx0XHR0aGlzLm1hcC5vbignem9vbWVuZCcsIGZ1bmN0aW9uKGUpeyBzZWxmLm1hcF96b29tZWQuYXBwbHkoIHNlbGYsIFtlXSApOyB9ICk7XG5cdFx0XHR0aGlzLm1hcC5vbignbW92ZWVuZCcsIGZ1bmN0aW9uKGUpeyBzZWxmLm1hcF9tb3ZlZC5hcHBseSggc2VsZiwgW2VdICk7IH0gKTtcblxuXHRcdH0sXG5cdFx0dW5iaW5kX2V2ZW50czpmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblx0XHRcdHNlbGYuJGxhdCgpLm9mZignYmx1cicpO1xuXHRcdFx0c2VsZi4kbG5nKCkub2ZmKCdibHVyJyk7XG5cdFx0XHRzZWxmLiR6b29tKCkub2ZmKCdibHVyJyk7XG5cdFx0XHRzZWxmLiR6b29tKCkub2ZmKCdrZXl1cCBmb2N1cycpO1xuXHRcdH0sXG5cdFx0YmluZF9ldmVudHM6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLiRsYXQoKS5vbignYmx1cicsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHNlbGYudXBkYXRlX21hcCgpO1xuXHRcdFx0fSk7XG5cdFx0XHRzZWxmLiRsbmcoKS5vbignYmx1cicsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHNlbGYudXBkYXRlX21hcCgpO1xuXHRcdFx0fSk7XG5cdFx0XHRzZWxmLiR6b29tKCkub24oJ2JsdXInLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRzZWxmLnVwZGF0ZV9tYXAoKTtcblx0XHRcdH0pO1xuXHRcdFx0Ly8gc2VsZi4kYWRkcmVzcygpLm9uKCdrZXl1cCBmb2N1cycsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0Ly8gXHRzZWxmLnNlYXJjaChlKTtcblx0XHRcdC8vIH0gKTtcblxuXG4vL1x0XHRcdHRoaXMubGlzdGVuVG8oIHRoaXMuJGFkZHJlc3MsICdrZXl1cCBmb2N1cycsIHRoaXMuc2VhcmNoICk7XG5cblx0XHRcdC8vIHRoaXMuJHRpbGVzLm9uKCdjaGFuZ2UnLCBkb19sYXllcnMgKVxuXHRcdFx0Ly8gXHQucHJldignaW5wdXQnKS5vbignY2hhbmdlJywgZG9fbGF5ZXJzICk7XG5cblx0XHR9LFxuXHRcdHVwZGF0ZV9tYXA6ZnVuY3Rpb24oKSB7XG5cdFx0XHRpZiAoICEgdGhpcy4kbGF0KCkudmFsKCkgfHwgISB0aGlzLiRsbmcoKS52YWwoKSApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0dmFyIGxhdGxuZyA9IEwubGF0TG5nKCB0aGlzLiRsYXQoKS52YWwoKSwgdGhpcy4kbG5nKCkudmFsKCkgKTtcblx0XHRcdHRoaXMubWFwLnNldFZpZXcoIGxhdGxuZywgIHRoaXMuJHpvb20oKS52YWwoKSApO1xuXHRcdH0sXG5cdFx0bWFwX21vdmVkOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dmFyIGNlbnRlciA9IHRoaXMubWFwLmdldENlbnRlcigpO1xuXHRcdFx0dGhpcy4kbGF0KCkudmFsKGNlbnRlci5sYXQpO1xuXHRcdFx0dGhpcy4kbG5nKCkudmFsKGNlbnRlci5sbmcpO1xuXHRcdH0sXG5cdFx0bWFwX3pvb21lZDpmdW5jdGlvbihlKXtcblx0XHRcdHRoaXMuJHpvb20oKS52YWwoIHRoaXMubWFwLmdldFpvb20oKSApO1xuXHRcdH0sXG5cdH0pO1xuXG5cdC8qXG5cdCAqICByZWFkeSBhcHBlbmQgKEFDRjUpXG5cdCAqXG5cdCAqICBUaGVzZSBhcmUgMiBldmVudHMgd2hpY2ggYXJlIGZpcmVkIGR1cmluZyB0aGUgcGFnZSBsb2FkXG5cdCAqICByZWFkeSA9IG9uIHBhZ2UgbG9hZCBzaW1pbGFyIHRvICQoZG9jdW1lbnQpLnJlYWR5KClcblx0ICogIGFwcGVuZCA9IG9uIG5ldyBET00gZWxlbWVudHMgYXBwZW5kZWQgdmlhIHJlcGVhdGVyIGZpZWxkXG5cdCAqXG5cdCAqICBAdHlwZVx0ZXZlbnRcblx0ICogIEBkYXRlXHQyMC8wNy8xM1xuXHQgKlxuXHQgKiAgQHBhcmFtXHQkZWwgKGpRdWVyeSBzZWxlY3Rpb24pIHRoZSBqUXVlcnkgZWxlbWVudCB3aGljaCBjb250YWlucyB0aGUgQUNGIGZpZWxkc1xuXHQgKiAgQHJldHVyblx0bi9hXG5cdCAqL1xuXHQkKGRvY3VtZW50KS5vbignYWNmLW9zbS1tYXAtaW5pdCcsZnVuY3Rpb24oIGUsIG1hcCApIHtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0bmV3IG9zbS5maWVsZCggeyBlbDogZS50YXJnZXQsIG1hcDogbWFwIH0gKTtcblx0fSk7XG5cblxufSkoIGpRdWVyeSwgYWNmX29zbV9hZG1pbiApO1xuIl19
