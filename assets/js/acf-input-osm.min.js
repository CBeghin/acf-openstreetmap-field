!function(e,t){var a=t.options,r={};r.MarkerList=Backbone.View.extend({}),r.MarkerEntry=Backbone.View.extend({tagName:"div",className:"osm-marker",events:{'click [data-name="locate-marker"]':"locate_marker",'click [data-name="remove-marker"]':"remove_marker",'change [id$="-marker-label"]':"update_marker_label"},is_default_label:function(){var e=this.$el.find('[id$="-marker-default-label"]').val();return this.$el.find('[id$="-marker-label"]').val()===e},initialize:function(e){return this.template=e.template,this.marker=e.marker,this},render:function(){return this.$el.html(this.template(this)),this._update_values_from_marker(),this},update_marker_label:function(t){return this.set_marker_label(e(t.target).val())},set_marker_label:function(t){return this.marker.unbindTooltip(),this.marker.bindTooltip(t),this.marker.options.title=t,e(this.marker._icon).attr("title",t),this},update_marker:function(e,t){return this.is_default_label()&&this.set_marker_label(t),this.$el.find('[id$="-marker-default-label"]').val(t),this._update_values_from_marker(),this},_update_values_from_marker:function(){var e=this.marker.getLatLng();return this.$el.find('[id$="-marker-lat"]').val(e.lat),this.$el.find('[id$="-marker-lng"]').val(e.lng),this.$el.find('[id$="-marker-label"]').val(this.marker.options.title),this},locate_marker:function(){return this.marker._map.flyTo(this.marker.getLatLng()),e(this.marker._icon).focus(),this},remove_marker:function(e){return e.preventDefault(),this.marker.remove(),this}}),r.field=Backbone.View.extend({map:null,geocoder:null,visible:null,events:{},$parent:function(){return this.$el.closest(".acf-field-settings,.acf-field-open-street-map")},$zoom:function(){return this.$parent().find('input[id$="-zoom"]')},$lat:function(){return this.$parent().find('input[id$="-center_lat"]')},$lng:function(){return this.$parent().find('input[id$="-center_lng"]')},$layerStore:function(){return this.$parent().find(".acf-osm-layers")},$results:function(){return this.$parent().find(".osm-results")},$markers:function(){return this.$parent().find(".osm-markers")},initialize:function(e){return this.map=e.map,this.update_map(),this.init_acf(),this.init_layers(),this.init_markers(),this.update_visible(),this},_get_geocoder_result_label:function(t,a){var r=!1;return t.length?e.each(t,function(e,t){return r=t.html?t.html:t.name,!1}):r=a.lat.toString()+", "+a.lng.toString(),e(r).text().replace(/^(\s+)/g,"").replace(/(\s+)$/g,"")},init_markers:function(){var t=this,a="osm"===this.$el.data().returnFormat;this.icon=new L.DivIcon({html:"",className:"osm-marker-icon"}),this.init_geocode(),this.map.on("click",function(e){var r=e.latlng;t.geocoder.options.geocoder.reverse(e.latlng,t.map.getZoom(),function(e){var i=t._get_geocoder_result_label(e,r);if(a){var n;if(t.map.eachLayer(function(e){if(e.constructor===L.Marker)return n=e,!1}),n)return n.setLatLng(r),void console.log("marker",n)}t.add_marker(r,i)},t)}),this.map.on("layeradd",function(e){if(e.layer.constructor===L.Marker){var a=t.$markers().find('[data-id="__osm_marker_template__"]').html().split("__osm_marker_template__").join("<%= id %>"),i=new r.MarkerEntry({controller:this,marker:e.layer,id:acf.uniqid(),template:_.template(a)});i.render().$el.prependTo(t.$markers()),e.layer.setIcon(t.icon).on("click",function(e){this.remove()}).on("remove",function(e){i.$el.remove()}).on("dragend",function(e){t.geocoder.options.geocoder.reverse(this.getLatLng(),t.map.getZoom(),function(e){var a=this.getLatLng(),r=t._get_geocoder_result_label(e,a);i.update_marker(a,r)},this)}).dragging.enable()}}),e.each(this.$el.data().mapMarkers,function(e,a){L.marker(L.latLng(1*a.lat,1*a.lng),{title:a.label}).bindTooltip(a.label).addTo(t.map)})},add_marker:function(e,t){L.marker(e,{title:t,icon:this.icon}).bindTooltip(t).addTo(this.map)},layer_is_overlay:function(e,t){var a;return!!(t.options.opacity&&t.options.opacity<1)||(a=["^(OpenWeatherMap|OpenSeaMap)","OpenMapSurfer.AdminBounds","Stamen.Toner(Hybrid|Lines|Labels)","Acetate.(foreground|labels|roads)","HillShading","Hydda.RoadsAndLabels","^JusticeMap","OpenInfraMap.(Power|Telecom|Petroleum|Water)","OpenPtMap","OpenRailwayMap","OpenFireMap","SafeCast","CartoDB.DarkMatterOnlyLabels","CartoDB.PositronOnlyLabels"],null!==e.match("("+a.join("|")+")"))},init_layers:function(){var t=this,r=[],i={},n={},o={},l=this.$el.data().editorConfig,s=function(e){return null===e||!!l["restrict-providers"]&&-1===l["restrict-providers"].indexOf(e)},d=function(l,m){var c,u;if(_.isObject(m))return e.each(m,d);s(l)||(o[l]?(c=o[l],t.map.addLayer(c)):(u=a.layer_config[l.split(".")[0]]||{options:{}},c=L.tileLayer.provider(l,u.options),c.providerKey=l),t.layer_is_overlay(l,c)?n[l]=c:i[l]=c,-1!==r.indexOf(l)&&t.map.addLayer(c))};r=this.$el.data().mapLayers,this.$layerStore().length&&this.map.on("baselayerchange layeradd layerremove",function(e){if(e.layer.providerKey){var a=t.$layerStore(),r=t.$parent().find('[data-id="__osm_layer_template__"]');a.html(""),t.map.eachLayer(function(e){if(e.providerKey){var i=r.clone().removeAttr("data-id");i.val(e.providerKey),t.layer_is_overlay(e.providerKey,e)?a.append(i):a.prepend(i)}})}}),e.each(a.providers,d),this.$layerStore().length&&(this.layersControl=L.control.layers(i,n,{collapsed:!0,hideSingleBase:!0}).addTo(this.map))},init_geocode:function(){var t=this;this.map._controlCorners.above=e('<div class="acf-osm-above"></div>').insertBefore(this.$el).get(0),this.geocoder=L.Control.geocoder({collapsed:!1,position:"above",placeholder:"Search...",errorMessage:"Nothing found...",showResultIcons:!0,suggestMinLength:3,suggestTimeout:250,queryMinLength:3,defaultMarkGeocode:!1}).on("markgeocode",function(e){var a=t._get_geocoder_result_label([e.geocode],e.geocode.center);t.add_marker(e.geocode.center,a),t.map.fitBounds(e.geocode.bbox)}).addTo(this.map),L.DomEvent.addListener(this.geocoder._input,"keydown",function(e){13===e.keyCode&&e.preventDefault()},this.geocoder)},update_visible:function(){return this.visible===this.$el.is(":visible")?this:(this.visible=this.$el.is(":visible"),this.visible?(this.map.invalidateSize(),this.bind_events(),this):(this.unbind_events(),this))},init_acf:function(){var t=this,a=function(){t.update_visible()};acf.addAction("show",a),acf.addAction("hide",a),e(document).on("postbox-toggled",a),this.map.on("zoomend",function(e){t.map_zoomed.apply(t,[e])}),this.map.on("moveend",function(e){t.map_moved.apply(t,[e])})},unbind_events:function(){var e=this;e.$lat().off("blur"),e.$lng().off("blur"),e.$zoom().off("blur"),e.$zoom().off("keyup focus")},bind_events:function(){var e=this;e.$lat().on("blur",function(t){e.update_map()}),e.$lng().on("blur",function(t){e.update_map()}),e.$zoom().on("blur",function(t){e.update_map()})},update_map:function(){if(this.$lat().val()&&this.$lng().val()){var e=L.latLng(this.$lat().val(),this.$lng().val());this.map.setView(e,this.$zoom().val())}},map_moved:function(e){var t=this.map.getCenter();this.$lat().val(t.lat),this.$lng().val(t.lng)},map_zoomed:function(e){this.$zoom().val(this.map.getZoom())}}),e(document).on("acf-osm-map-init",function(e,t){e.preventDefault(),new r.field({el:e.target,map:t})})}(jQuery,acf_osm_admin);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1pbnB1dC1vc20uanMiXSwibmFtZXMiOlsiJCIsImFyZyIsIm9wdGlvbnMiLCJvc20iLCJNYXJrZXJMaXN0IiwiQmFja2JvbmUiLCJWaWV3IiwiZXh0ZW5kIiwiTWFya2VyRW50cnkiLCJ0YWdOYW1lIiwiY2xhc3NOYW1lIiwiZXZlbnRzIiwiY2xpY2sgW2RhdGEtbmFtZT1cImxvY2F0ZS1tYXJrZXJcIl0iLCJjbGljayBbZGF0YS1uYW1lPVwicmVtb3ZlLW1hcmtlclwiXSIsImNoYW5nZSBbaWQkPVwiLW1hcmtlci1sYWJlbFwiXSIsImlzX2RlZmF1bHRfbGFiZWwiLCJkZWZhdWx0X3ZhbCIsInRoaXMiLCIkZWwiLCJmaW5kIiwidmFsIiwiaW5pdGlhbGl6ZSIsIm9wdCIsInRlbXBsYXRlIiwibWFya2VyIiwicmVuZGVyIiwiaHRtbCIsIl91cGRhdGVfdmFsdWVzX2Zyb21fbWFya2VyIiwidXBkYXRlX21hcmtlcl9sYWJlbCIsImUiLCJzZXRfbWFya2VyX2xhYmVsIiwidGFyZ2V0IiwibGFiZWwiLCJ1bmJpbmRUb29sdGlwIiwiYmluZFRvb2x0aXAiLCJ0aXRsZSIsIl9pY29uIiwiYXR0ciIsInVwZGF0ZV9tYXJrZXIiLCJsYXRsbmciLCJnZXRMYXRMbmciLCJsYXQiLCJsbmciLCJsb2NhdGVfbWFya2VyIiwiX21hcCIsImZseVRvIiwiZm9jdXMiLCJyZW1vdmVfbWFya2VyIiwicHJldmVudERlZmF1bHQiLCJyZW1vdmUiLCJmaWVsZCIsIm1hcCIsImdlb2NvZGVyIiwidmlzaWJsZSIsIiRwYXJlbnQiLCJjbG9zZXN0IiwiJHpvb20iLCIkbGF0IiwiJGxuZyIsIiRsYXllclN0b3JlIiwiJHJlc3VsdHMiLCIkbWFya2VycyIsImNvbmYiLCJ1cGRhdGVfbWFwIiwiaW5pdF9hY2YiLCJpbml0X2xheWVycyIsImluaXRfbWFya2VycyIsInVwZGF0ZV92aXNpYmxlIiwiX2dldF9nZW9jb2Rlcl9yZXN1bHRfbGFiZWwiLCJsZW5ndGgiLCJlYWNoIiwiaSIsInJlc3VsdCIsIm5hbWUiLCJ0b1N0cmluZyIsInRleHQiLCJyZXBsYWNlIiwic2VsZiIsImlzX29zbSIsImRhdGEiLCJyZXR1cm5Gb3JtYXQiLCJpY29uIiwiTCIsIkRpdkljb24iLCJpbml0X2dlb2NvZGUiLCJvbiIsInJldmVyc2UiLCJnZXRab29tIiwiZWFjaExheWVyIiwibGF5ZXIiLCJjb25zdHJ1Y3RvciIsIk1hcmtlciIsInNldExhdExuZyIsImNvbnNvbGUiLCJsb2ciLCJhZGRfbWFya2VyIiwic3BsaXQiLCJqb2luIiwiZW50cnkiLCJjb250cm9sbGVyIiwiaWQiLCJhY2YiLCJ1bmlxaWQiLCJfIiwicHJlcGVuZFRvIiwic2V0SWNvbiIsImRyYWdnaW5nIiwiZW5hYmxlIiwibWFwTWFya2VycyIsIm1hcmtlckRhdGEiLCJsYXRMbmciLCJhZGRUbyIsImxuZ2xhdCIsImxheWVyX2lzX292ZXJsYXkiLCJrZXkiLCJwYXR0ZXJucyIsIm9wYWNpdHkiLCJtYXRjaCIsInNlbGVjdGVkTGF5ZXJzIiwiYmFzZUxheWVycyIsIm92ZXJsYXlzIiwibWFwTGF5ZXJzIiwiZWRpdG9yX2NvbmZpZyIsImVkaXRvckNvbmZpZyIsImlzX29taXR0ZWQiLCJpbmRleE9mIiwic2V0dXBNYXAiLCJsYXllcl9jb25maWciLCJpc09iamVjdCIsImFkZExheWVyIiwidGlsZUxheWVyIiwicHJvdmlkZXIiLCJwcm92aWRlcktleSIsIiR0ZW1wbGF0ZSIsIiRsYXllcklucHV0IiwiY2xvbmUiLCJyZW1vdmVBdHRyIiwiYXBwZW5kIiwicHJlcGVuZCIsInByb3ZpZGVycyIsImxheWVyc0NvbnRyb2wiLCJjb250cm9sIiwibGF5ZXJzIiwiY29sbGFwc2VkIiwiaGlkZVNpbmdsZUJhc2UiLCJfY29udHJvbENvcm5lcnMiLCJpbnNlcnRCZWZvcmUiLCJnZXQiLCJDb250cm9sIiwicG9zaXRpb24iLCJwbGFjZWhvbGRlciIsImVycm9yTWVzc2FnZSIsInNob3dSZXN1bHRJY29ucyIsInN1Z2dlc3RNaW5MZW5ndGgiLCJzdWdnZXN0VGltZW91dCIsInF1ZXJ5TWluTGVuZ3RoIiwiZGVmYXVsdE1hcmtHZW9jb2RlIiwiZ2VvY29kZSIsImNlbnRlciIsImZpdEJvdW5kcyIsImJib3giLCJEb21FdmVudCIsImFkZExpc3RlbmVyIiwiX2lucHV0Iiwia2V5Q29kZSIsImlzIiwiaW52YWxpZGF0ZVNpemUiLCJiaW5kX2V2ZW50cyIsInVuYmluZF9ldmVudHMiLCJ0b2dnbGVfY2IiLCJhZGRBY3Rpb24iLCJkb2N1bWVudCIsIm1hcF96b29tZWQiLCJhcHBseSIsIm1hcF9tb3ZlZCIsIm9mZiIsInNldFZpZXciLCJnZXRDZW50ZXIiLCJlbCIsImpRdWVyeSIsImFjZl9vc21fYWRtaW4iXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBQ0EsR0FBQUMsR0FBQUQsRUFBQUMsUUFNQUMsSUFHQUEsR0FBQUMsV0FBQUMsU0FBQUMsS0FBQUMsV0FFQUosRUFBQUssWUFBQUgsU0FBQUMsS0FBQUMsUUFDQUUsUUFBQSxNQUNBQyxVQUFBLGFBQ0FDLFFBQ0FDLG9DQUFBLGdCQUNBQyxvQ0FBQSxnQkFDQUMsK0JBQUEsdUJBRUFDLGlCQUFBLFdBQ0EsR0FBQUMsR0FBQUMsS0FBQUMsSUFBQUMsS0FBQSxpQ0FBQUMsS0FHQSxPQUZBSCxNQUFBQyxJQUFBQyxLQUFBLHlCQUFBQyxRQUVBSixHQUVBSyxXQUFBLFNBQUFDLEdBS0EsTUFIQUwsTUFBQU0sU0FBQUQsRUFBQUMsU0FDQU4sS0FBQU8sT0FBQUYsRUFBQUUsT0FFQVAsTUFFQVEsT0FBQSxXQUdBLE1BRkFSLE1BQUFDLElBQUFRLEtBQUFULEtBQUFNLFNBQUFOLE9BQ0FBLEtBQUFVLDZCQUNBVixNQUVBVyxvQkFBQSxTQUFBQyxHQUNBLE1BQUFaLE1BQUFhLGlCQUFBOUIsRUFBQTZCLEVBQUFFLFFBQUFYLFFBRUFVLGlCQUFBLFNBQUFFLEdBTUEsTUFMQWYsTUFBQU8sT0FBQVMsZ0JBQ0FoQixLQUFBTyxPQUFBVSxZQUFBRixHQUVBZixLQUFBTyxPQUFBdEIsUUFBQWlDLE1BQUFILEVB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QUFBOUMsS0FBQXdDLE9BQUFyQyxPQUFBSCxLQUFBeUMsT0FBQXRDLE1BQUEsQ0FHQSxHQUFBbUIsR0FBQTJDLEVBQUE0QixPQUFBN0YsS0FBQXdDLE9BQUFyQyxNQUFBSCxLQUFBeUMsT0FBQXRDLE1BQ0FILE1BQUFrQyxJQUFBNkgsUUFBQXpJLEVBQUF0QixLQUFBdUMsUUFBQXBDLFNBRUEwSixVQUFBLFNBQUFqSixHQUNBLEdBQUFpSSxHQUFBN0ksS0FBQWtDLElBQUE4SCxXQUNBaEssTUFBQXdDLE9BQUFyQyxJQUFBMEksRUFBQXJILEtBQ0F4QixLQUFBeUMsT0FBQXRDLElBQUEwSSxFQUFBcEgsTUFFQWtJLFdBQUEsU0FBQS9JLEdBQ0FaLEtBQUF1QyxRQUFBcEMsSUFBQUgsS0FBQWtDLElBQUFvQyxjQWlCQXZGLEVBQUEySyxVQUFBdEYsR0FBQSxtQkFBQSxTQUFBeEQsRUFBQXNCLEdBQ0F0QixFQUFBbUIsaUJBQ0EsR0FBQTdDLEdBQUErQyxPQUFBZ0ksR0FBQXJKLEVBQUFFLE9BQUFvQixJQUFBQSxPQUlBZ0ksT0FBQUMiLCJmaWxlIjoiYWNmLWlucHV0LW9zbS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oICQsIGFyZyApe1xuXHR2YXIgb3B0aW9ucyA9IGFyZy5vcHRpb25zLFxuXHRcdHJlc3VsdF90cGwgPSAnPGRpdiB0YWJpbmRleD1cIjwlPSBkYXRhLmkgJT5cIiBjbGFzcz1cIm9zbS1yZXN1bHRcIj4nXG5cdFx0XHQrICc8JT0gZGF0YS5yZXN1bHRfdGV4dCAlPidcblx0XHRcdCsgJzxiciAvPjxzbWFsbD48JT0gZGF0YS5wcm9wZXJ0aWVzLm9zbV92YWx1ZSAlPjwvc21hbGw+J1xuXHRcdFx0KyAnPC9kaXY+JztcblxuXHR2YXIgb3NtID0ge1xuXHR9O1xuXG5cdG9zbS5NYXJrZXJMaXN0ID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXHR9KVxuXHRvc20uTWFya2VyRW50cnkgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG5cdFx0dGFnTmFtZTogJ2RpdicsXG5cdFx0Y2xhc3NOYW1lOidvc20tbWFya2VyJyxcblx0XHRldmVudHM6IHtcblx0XHRcdCdjbGljayBbZGF0YS1uYW1lPVwibG9jYXRlLW1hcmtlclwiXScgOiAnbG9jYXRlX21hcmtlcicsXG5cdFx0XHQnY2xpY2sgW2RhdGEtbmFtZT1cInJlbW92ZS1tYXJrZXJcIl0nIDogJ3JlbW92ZV9tYXJrZXInLFxuXHRcdFx0J2NoYW5nZSBbaWQkPVwiLW1hcmtlci1sYWJlbFwiXSdcdFx0OiAndXBkYXRlX21hcmtlcl9sYWJlbCcsXG5cdFx0fSxcblx0XHRpc19kZWZhdWx0X2xhYmVsOiBmdW5jdGlvbigpe1xuXHRcdFx0dmFyIGRlZmF1bHRfdmFsID0gdGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItZGVmYXVsdC1sYWJlbFwiXScpLnZhbCgpLFxuXHRcdFx0XHRjdXJyZW50X3ZhbCA9IHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWxhYmVsXCJdJykudmFsKCk7XG5cblx0XHRcdHJldHVybiBjdXJyZW50X3ZhbCA9PT0gZGVmYXVsdF92YWw7XG5cdFx0fSxcblx0XHRpbml0aWFsaXplOmZ1bmN0aW9uKG9wdCl7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cdFx0XHR0aGlzLnRlbXBsYXRlID0gb3B0LnRlbXBsYXRlO1xuXHRcdFx0dGhpcy5tYXJrZXIgPSBvcHQubWFya2VyO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHJlbmRlcjpmdW5jdGlvbigpe1xuXHRcdFx0dGhpcy4kZWwuaHRtbCggdGhpcy50ZW1wbGF0ZSggdGhpcyApICk7XG5cdFx0XHR0aGlzLl91cGRhdGVfdmFsdWVzX2Zyb21fbWFya2VyKCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHVwZGF0ZV9tYXJrZXJfbGFiZWw6ZnVuY3Rpb24oZSkge1xuXHRcdFx0cmV0dXJuIHRoaXMuc2V0X21hcmtlcl9sYWJlbCggJChlLnRhcmdldCkudmFsKCkgKTtcblx0XHR9LFxuXHRcdHNldF9tYXJrZXJfbGFiZWw6ZnVuY3Rpb24obGFiZWwpIHtcblx0XHRcdHRoaXMubWFya2VyLnVuYmluZFRvb2x0aXAoKTtcblx0XHRcdHRoaXMubWFya2VyLmJpbmRUb29sdGlwKGxhYmVsKTtcblxuXHRcdFx0dGhpcy5tYXJrZXIub3B0aW9ucy50aXRsZSA9IGxhYmVsO1xuXHRcdFx0JCggdGhpcy5tYXJrZXIuX2ljb24gKS5hdHRyKCAndGl0bGUnLCBsYWJlbCApO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHR1cGRhdGVfbWFya2VyOmZ1bmN0aW9uKCBsYXRsbmcsIGxhYmVsICkge1xuXG5cdFx0XHRpZiAoIHRoaXMuaXNfZGVmYXVsdF9sYWJlbCgpICkge1xuXHRcdFx0XHQvLyB1cGRhdGUgbWFya2VyIGxhYmVsc1xuXHRcdFx0XHR0aGlzLnNldF9tYXJrZXJfbGFiZWwoIGxhYmVsICk7XG5cdFx0XHRcdC8vIHVwZGF0ZSBtYXJrZXIgbGFiZWwgaW5wdXRcblx0XHRcdH1cblxuXG5cdFx0XHR0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1kZWZhdWx0LWxhYmVsXCJdJykudmFsKCBsYWJlbCApO1xuXG5cdFx0XHR0aGlzLl91cGRhdGVfdmFsdWVzX2Zyb21fbWFya2VyKCk7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0X3VwZGF0ZV92YWx1ZXNfZnJvbV9tYXJrZXI6IGZ1bmN0aW9uKCApIHtcblx0XHRcdHZhciBsYXRsbmcgPSB0aGlzLm1hcmtlci5nZXRMYXRMbmcoKTtcblx0XHRcdHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWxhdFwiXScpLnZhbCggbGF0bG5nLmxhdCApO1xuXHRcdFx0dGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItbG5nXCJdJykudmFsKCBsYXRsbmcubG5nICk7XG5cdFx0XHR0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1sYWJlbFwiXScpLnZhbCggdGhpcy5tYXJrZXIub3B0aW9ucy50aXRsZSApO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblxuXHRcdGxvY2F0ZV9tYXJrZXI6ZnVuY3Rpb24oKXtcblx0XHRcdHRoaXMubWFya2VyLl9tYXAuZmx5VG8oIHRoaXMubWFya2VyLmdldExhdExuZygpICk7XG5cdFx0XHQkKHRoaXMubWFya2VyLl9pY29uKS5mb2N1cygpXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHJlbW92ZV9tYXJrZXI6ZnVuY3Rpb24oZSkge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpXG5cdFx0XHR0aGlzLm1hcmtlci5yZW1vdmUoKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblx0fSk7XG5cblx0b3NtLmZpZWxkID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXHRcdC8qXG5cdFx0dG9kbzpcblx0XHQtIE1hcCBMYXllciBzZWxlY3RvclxuXHRcdC0gc2V0IC8gdW5zZXQgbWFya2VyXG5cdFx0Ki9cblxuXHRcdG1hcDogbnVsbCxcblx0XHRnZW9jb2RlcjogbnVsbCxcblx0XHR2aXNpYmxlOiBudWxsLFxuXHRcdGV2ZW50czp7XG5cdFx0fSxcblxuXHRcdCRwYXJlbnQ6ZnVuY3Rpb24oKXtcblx0XHRcdHJldHVybiB0aGlzLiRlbC5jbG9zZXN0KCcuYWNmLWZpZWxkLXNldHRpbmdzLC5hY2YtZmllbGQtb3Blbi1zdHJlZXQtbWFwJylcblx0XHR9LFxuXHRcdCR6b29tIDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnaW5wdXRbaWQkPVwiLXpvb21cIl0nKTtcblx0XHR9LFxuXHRcdCRsYXQgOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCdpbnB1dFtpZCQ9XCItY2VudGVyX2xhdFwiXScpO1xuXHRcdH0sXG5cdFx0JGxuZyA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJ2lucHV0W2lkJD1cIi1jZW50ZXJfbG5nXCJdJyk7XG5cdFx0fSxcblx0XHQkbGF5ZXJTdG9yZTogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnLmFjZi1vc20tbGF5ZXJzJyk7XG5cdFx0fSxcblx0XHQkcmVzdWx0cyA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJy5vc20tcmVzdWx0cycpO1xuXHRcdH0sXG5cdFx0JG1hcmtlcnM6ZnVuY3Rpb24oKXtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCcub3NtLW1hcmtlcnMnKTtcblx0XHR9LFxuXHRcdGluaXRpYWxpemU6ZnVuY3Rpb24oY29uZikge1xuXG5cdFx0XHR0aGlzLm1hcFx0XHQ9IGNvbmYubWFwO1xuXG5cdFx0XHR0aGlzLnVwZGF0ZV9tYXAoKTsgLy8gc2V0IG1hcCB0byBpbnB1dCB2YWx1ZXNcblxuXHRcdFx0dGhpcy5pbml0X2FjZigpO1xuXG5cdFx0XHR0aGlzLmluaXRfbGF5ZXJzKCk7XG5cblx0XHRcdHRoaXMuaW5pdF9tYXJrZXJzKCk7XG5cblx0XHRcdHRoaXMudXBkYXRlX3Zpc2libGUoKTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRfZ2V0X2dlb2NvZGVyX3Jlc3VsdF9sYWJlbDpmdW5jdGlvbiggZSwgbGF0bG5nICkge1xuXHRcdFx0dmFyIGxhYmVsID0gZmFsc2U7XG5cblx0XHRcdGlmICggISBlLmxlbmd0aCApIHtcblx0XHRcdFx0bGFiZWwgPSBsYXRsbmcubGF0LnRvU3RyaW5nKCkgKyAnLCAnICsgbGF0bG5nLmxuZy50b1N0cmluZygpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0JC5lYWNoKCBlLCBmdW5jdGlvbiggaSwgcmVzdWx0ICkge1xuXHRcdFx0XHRcdGlmICggISEgcmVzdWx0Lmh0bWwgKSB7XG5cdFx0XHRcdFx0XHRsYWJlbCA9IHJlc3VsdC5odG1sO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRsYWJlbCA9IHJlc3VsdC5uYW1lO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuICQobGFiZWwpLnRleHQoKS5yZXBsYWNlKC9eKFxccyspL2csJycpLnJlcGxhY2UoLyhcXHMrKSQvZywnJyk7XG5cdFx0fSxcblx0XHRpbml0X21hcmtlcnM6ZnVuY3Rpb24oKXtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRpc19vc20gPSB0aGlzLiRlbC5kYXRhKCkucmV0dXJuRm9ybWF0ID09PSAnb3NtJztcblxuXHRcdFx0dGhpcy5pY29uID0gbmV3IEwuRGl2SWNvbih7XG5cdFx0XHRcdGh0bWw6ICcnLFxuXHRcdFx0XHRjbGFzc05hbWU6J29zbS1tYXJrZXItaWNvbidcblx0XHRcdH0pO1xuXG5cblx0XHRcdHRoaXMuaW5pdF9nZW9jb2RlKCk7XG5cblx0XHRcdHRoaXMubWFwLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHR2YXIgbGF0bG5nID0gZS5sYXRsbmc7XG5cdFx0XHRcdC8vIFRIRVJFIElTIEEgQkVUVEVSIFdBWSFcblx0XHRcdFx0c2VsZi5nZW9jb2Rlci5vcHRpb25zLmdlb2NvZGVyLnJldmVyc2UoZS5sYXRsbmcsc2VsZi5tYXAuZ2V0Wm9vbSgpLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdHZhciBsYWJlbCA9IHNlbGYuX2dldF9nZW9jb2Rlcl9yZXN1bHRfbGFiZWwoIGUsIGxhdGxuZyApO1xuXHRcdFx0XHRcdGlmICggaXNfb3NtICkge1xuXHRcdFx0XHRcdFx0Ly8gbW92ZSBtYXJrZXJcblx0XHRcdFx0XHRcdHZhciBtYXJrZXI7XG5cdFx0XHRcdFx0XHRzZWxmLm1hcC5lYWNoTGF5ZXIoZnVuY3Rpb24obGF5ZXIpe1xuXHRcdFx0XHRcdFx0XHRpZiAoIGxheWVyLmNvbnN0cnVjdG9yID09PSBMLk1hcmtlciApIHtcblx0XHRcdFx0XHRcdFx0XHRtYXJrZXIgPSBsYXllcjtcblx0XHRcdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0aWYgKCAhISBtYXJrZXIgKSB7XG5cdFx0XHRcdFx0XHRcdG1hcmtlci5zZXRMYXRMbmcoIGxhdGxuZyApO1xuXHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZygnbWFya2VyJyxtYXJrZXIpXG5cdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0c2VsZi5hZGRfbWFya2VyKCBsYXRsbmcsIGxhYmVsICk7XG5cdFx0XHRcdH0sc2VsZik7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5tYXAub24oICdsYXllcmFkZCcsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRpZiAoIGUubGF5ZXIuY29uc3RydWN0b3IgIT09IEwuTWFya2VyICkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0XHQvLyBtYXJrZXIgYWRkZWRcblx0XHRcdFx0dmFyIHRlbXBsYXRlID0gc2VsZi4kbWFya2VycygpLmZpbmQoJ1tkYXRhLWlkPVwiX19vc21fbWFya2VyX3RlbXBsYXRlX19cIl0nKS5odG1sKCkuc3BsaXQoJ19fb3NtX21hcmtlcl90ZW1wbGF0ZV9fJykuam9pbiggJzwlPSBpZCAlPicgKSxcblx0XHRcdFx0XHRlbnRyeSA9IG5ldyBvc20uTWFya2VyRW50cnkoe1xuXHRcdFx0XHRcdFx0Y29udHJvbGxlcjogdGhpcyxcblx0XHRcdFx0XHRcdG1hcmtlcjogZS5sYXllcixcblx0XHRcdFx0XHRcdGlkOiBhY2YudW5pcWlkKCksIC8vc2VsZi4kbWFya2VycygpLmNoaWxkcmVuKCkubGVuZ3RoLFxuXHRcdFx0XHRcdFx0dGVtcGxhdGU6IF8udGVtcGxhdGUoIHRlbXBsYXRlICksXG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0ZW50cnkucmVuZGVyKCkuJGVsLnByZXBlbmRUbyggc2VsZi4kbWFya2VycygpICk7XG5cblx0XHRcdFx0ZS5sYXllclxuXHRcdFx0XHRcdC5zZXRJY29uKCBzZWxmLmljb24gKVxuXHRcdFx0XHRcdC5vbignY2xpY2snLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdFx0dGhpcy5yZW1vdmUoKTtcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5vbigncmVtb3ZlJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRcdGVudHJ5LiRlbC5yZW1vdmUoKTtcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5vbignZHJhZ2VuZCcsZnVuY3Rpb24oZSl7XG5cblx0XHRcdFx0XHRcdHNlbGYuZ2VvY29kZXIub3B0aW9ucy5nZW9jb2Rlci5yZXZlcnNlKHRoaXMuZ2V0TGF0TG5nKCksc2VsZi5tYXAuZ2V0Wm9vbSgpLGZ1bmN0aW9uKGUpe1xuXG5cdFx0XHRcdFx0XHRcdHZhciBsYXRsbmcgPSB0aGlzLmdldExhdExuZygpLFxuXHRcdFx0XHRcdFx0XHRcdGxhYmVsID0gc2VsZi5fZ2V0X2dlb2NvZGVyX3Jlc3VsdF9sYWJlbCggZSwgbGF0bG5nICk7XG5cdFx0XHRcdFx0XHRcdGVudHJ5LnVwZGF0ZV9tYXJrZXIoIGxhdGxuZywgbGFiZWwgKTtcblxuXHRcdFx0XHRcdFx0fSwgdGhpcyApO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0LmRyYWdnaW5nLmVuYWJsZSgpO1xuXHRcdFx0fSApO1xuXG5cdFx0XHQkLmVhY2goIHRoaXMuJGVsLmRhdGEoKS5tYXBNYXJrZXJzLGZ1bmN0aW9uKCBpLCBtYXJrZXJEYXRhICkge1xuXHRcdFx0XHQvLyBhZGQgbWFya2Vyc1xuXHRcdFx0XHR2YXIgbWFya2VyID0gTC5tYXJrZXIoIEwubGF0TG5nKCBtYXJrZXJEYXRhLmxhdCAqIDEsIG1hcmtlckRhdGEubG5nICogMSApLCB7XG5cdFx0XHRcdFx0XHR0aXRsZTogbWFya2VyRGF0YS5sYWJlbFxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0LmJpbmRUb29sdGlwKCBtYXJrZXJEYXRhLmxhYmVsIClcblx0XHRcdFx0XHQuYWRkVG8oIHNlbGYubWFwICk7XG5cblx0XHRcdH0pO1xuXG5cdFx0fSxcblx0XHRhZGRfbWFya2VyOmZ1bmN0aW9uKCBsbmdsYXQsIGxhYmVsICl7XG5cdFx0XHRMLm1hcmtlcihsbmdsYXQse1xuXHRcdFx0XHR0aXRsZTogbGFiZWwsXG5cdFx0XHRcdGljb246IHRoaXMuaWNvbixcblx0XHRcdH0pXG5cdFx0XHRcdC5iaW5kVG9vbHRpcCggbGFiZWwgKVxuXHRcdFx0XHQuYWRkVG8oIHRoaXMubWFwICk7XG5cdFx0fSxcblx0XHRsYXllcl9pc19vdmVybGF5OiBmdW5jdGlvbiggIGtleSwgbGF5ZXIgKSB7XG5cdFx0XHR2YXIgcGF0dGVybnM7XG5cblx0XHRcdGlmICggbGF5ZXIub3B0aW9ucy5vcGFjaXR5ICYmIGxheWVyLm9wdGlvbnMub3BhY2l0eSA8IDEgKSB7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0cGF0dGVybnMgPSBbJ14oT3BlbldlYXRoZXJNYXB8T3BlblNlYU1hcCknLFxuXHRcdFx0XHQnT3Blbk1hcFN1cmZlci5BZG1pbkJvdW5kcycsXG5cdFx0XHRcdCdTdGFtZW4uVG9uZXIoSHlicmlkfExpbmVzfExhYmVscyknLFxuXHRcdFx0XHQnQWNldGF0ZS4oZm9yZWdyb3VuZHxsYWJlbHN8cm9hZHMpJyxcblx0XHRcdFx0J0hpbGxTaGFkaW5nJyxcblx0XHRcdFx0J0h5ZGRhLlJvYWRzQW5kTGFiZWxzJyxcblx0XHRcdFx0J15KdXN0aWNlTWFwJyxcblx0XHRcdFx0J09wZW5JbmZyYU1hcC4oUG93ZXJ8VGVsZWNvbXxQZXRyb2xldW18V2F0ZXIpJyxcblx0XHRcdFx0J09wZW5QdE1hcCcsXG5cdFx0XHRcdCdPcGVuUmFpbHdheU1hcCcsXG5cdFx0XHRcdCdPcGVuRmlyZU1hcCcsXG5cdFx0XHRcdCdTYWZlQ2FzdCcsXG5cdFx0XHRcdCdDYXJ0b0RCLkRhcmtNYXR0ZXJPbmx5TGFiZWxzJyxcblx0XHRcdFx0J0NhcnRvREIuUG9zaXRyb25Pbmx5TGFiZWxzJ1xuXHRcdFx0XTtcblx0XHRcdHJldHVybiBrZXkubWF0Y2goJygnICsgcGF0dGVybnMuam9pbignfCcpICsgJyknKSAhPT0gbnVsbDtcblx0XHR9LFxuXHRcdGluaXRfbGF5ZXJzOmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRzZWxlY3RlZExheWVycyA9IFtdLFxuXHRcdFx0XHRiYXNlTGF5ZXJzID0ge30sXG5cdFx0XHRcdG92ZXJsYXlzID0ge30sXG5cdFx0XHRcdG1hcExheWVycyA9IHt9LFxuXHRcdFx0XHRlZGl0b3JfY29uZmlnID0gdGhpcy4kZWwuZGF0YSgpLmVkaXRvckNvbmZpZyxcblx0XHRcdFx0aXNfb21pdHRlZCA9IGZ1bmN0aW9uKGtleSkge1xuXG5cdFx0XHRcdFx0cmV0dXJuIGtleSA9PT0gbnVsbCB8fCAoICEhIGVkaXRvcl9jb25maWdbJ3Jlc3RyaWN0LXByb3ZpZGVycyddICYmIGVkaXRvcl9jb25maWdbJ3Jlc3RyaWN0LXByb3ZpZGVycyddLmluZGV4T2YoIGtleSApID09PSAtMSApO1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRzZXR1cE1hcCA9IGZ1bmN0aW9uKCBrZXksIHZhbCApe1xuXHRcdFx0XHRcdHZhciBsYXllciwgbGF5ZXJfY29uZmlnO1xuXHRcdFx0XHRcdGlmICggXy5pc09iamVjdCh2YWwpICkge1xuXHRcdFx0XHRcdFx0cmV0dXJuICQuZWFjaCggdmFsLCBzZXR1cE1hcCApO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICggaXNfb21pdHRlZChrZXkpICkge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAoICEhIG1hcExheWVyc1sga2V5IF0gKSB7XG5cdFx0XHRcdFx0XHRsYXllciA9IG1hcExheWVyc1sga2V5IF07XG5cdFx0XHRcdFx0XHRzZWxmLm1hcC5hZGRMYXllcihsYXllcilcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0bGF5ZXJfY29uZmlnID0gb3B0aW9ucy5sYXllcl9jb25maWdbIGtleS5zcGxpdCgnLicpWzBdIF0gfHwge29wdGlvbnM6e319O1xuXHRcdFx0XHRcdFx0bGF5ZXIgPSBMLnRpbGVMYXllci5wcm92aWRlcigga2V5LCBsYXllcl9jb25maWcub3B0aW9ucyApO1xuXHRcdFx0XHRcdFx0bGF5ZXIucHJvdmlkZXJLZXkgPSBrZXk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCBzZWxmLmxheWVyX2lzX292ZXJsYXkoIGtleSwgbGF5ZXIgKSApIHtcblx0XHRcdFx0XHRcdG92ZXJsYXlzW2tleV0gPSBsYXllcjtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0YmFzZUxheWVyc1trZXldID0gbGF5ZXI7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCBzZWxlY3RlZExheWVycy5pbmRleE9mKCBrZXkgKSAhPT0gLTEgKSB7XG5cdFx0XHRcdFx0XHRzZWxmLm1hcC5hZGRMYXllcihsYXllcik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9O1xuXG5cdFx0XHRzZWxlY3RlZExheWVycyA9IHRoaXMuJGVsLmRhdGEoKS5tYXBMYXllcnM7XG5cblxuXHRcdFx0aWYgKCB0aGlzLiRsYXllclN0b3JlKCkubGVuZ3RoICkge1xuXHRcdFx0XHR0aGlzLm1hcC5vbiggJ2Jhc2VsYXllcmNoYW5nZSBsYXllcmFkZCBsYXllcnJlbW92ZScsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdGlmICggISBlLmxheWVyLnByb3ZpZGVyS2V5KSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHZhciAkbGF5ZXJTdG9yZSA9IHNlbGYuJGxheWVyU3RvcmUoKSxcblx0XHRcdFx0XHRcdCR0ZW1wbGF0ZSA9IHNlbGYuJHBhcmVudCgpLmZpbmQoJ1tkYXRhLWlkPVwiX19vc21fbGF5ZXJfdGVtcGxhdGVfX1wiXScpO1xuXG5cdFx0XHRcdFx0JGxheWVyU3RvcmUuaHRtbCgnJyk7XG5cblx0XHRcdFx0XHRzZWxmLm1hcC5lYWNoTGF5ZXIoZnVuY3Rpb24obGF5ZXIpIHtcblx0XHRcdFx0XHRcdGlmICggISBsYXllci5wcm92aWRlcktleSApIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0dmFyICRsYXllcklucHV0ID0gJHRlbXBsYXRlLmNsb25lKCkucmVtb3ZlQXR0cignZGF0YS1pZCcpO1xuXHRcdFx0XHRcdFx0JGxheWVySW5wdXQudmFsKCBsYXllci5wcm92aWRlcktleSApO1xuXG5cdFx0XHRcdFx0XHRpZiAoIHNlbGYubGF5ZXJfaXNfb3ZlcmxheSggbGF5ZXIucHJvdmlkZXJLZXksIGxheWVyICkgKSB7XG5cdFx0XHRcdFx0XHRcdCRsYXllclN0b3JlLmFwcGVuZCggJGxheWVySW5wdXQgKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdCRsYXllclN0b3JlLnByZXBlbmQoICRsYXllcklucHV0ICk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0fSApO1xuXHRcdFx0fVxuXG5cblx0XHRcdCQuZWFjaCggb3B0aW9ucy5wcm92aWRlcnMsIHNldHVwTWFwICk7XG5cblx0XHRcdC8vIC4uLiBubyBsYXllciBlZGl0aW5nIGFsbG93ZWRcblx0XHRcdGlmICggdGhpcy4kbGF5ZXJTdG9yZSgpLmxlbmd0aCApIHtcblx0XHRcdFx0dGhpcy5sYXllcnNDb250cm9sID0gTC5jb250cm9sLmxheWVycyggYmFzZUxheWVycywgb3ZlcmxheXMsIHtcblx0XHRcdFx0XHRjb2xsYXBzZWQ6IHRydWUsXG5cdFx0XHRcdFx0aGlkZVNpbmdsZUJhc2U6IHRydWUsXG5cdFx0XHRcdH0pLmFkZFRvKHRoaXMubWFwKTtcblx0XHRcdH1cblxuXG5cdFx0fSxcblx0XHRpbml0X2dlb2NvZGU6ZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0dGhpcy5tYXAuX2NvbnRyb2xDb3JuZXJzWydhYm92ZSddID0gJCgnPGRpdiBjbGFzcz1cImFjZi1vc20tYWJvdmVcIj48L2Rpdj4nKS5pbnNlcnRCZWZvcmUoIHRoaXMuJGVsICkuZ2V0KDApO1xuXG5cdFx0XHR0aGlzLmdlb2NvZGVyID0gTC5Db250cm9sLmdlb2NvZGVyKHtcblx0XHRcdFx0Y29sbGFwc2VkOiBmYWxzZSxcblx0XHRcdFx0cG9zaXRpb246J2Fib3ZlJyxcblx0XHRcdFx0cGxhY2Vob2xkZXI6J1NlYXJjaC4uLicsXG5cdFx0XHRcdGVycm9yTWVzc2FnZTonTm90aGluZyBmb3VuZC4uLicsXG5cdFx0XHRcdHNob3dSZXN1bHRJY29uczp0cnVlLFxuXHRcdFx0XHRzdWdnZXN0TWluTGVuZ3RoOjMsXG5cdFx0XHRcdHN1Z2dlc3RUaW1lb3V0OjI1MCxcblx0XHRcdFx0cXVlcnlNaW5MZW5ndGg6Myxcblx0XHRcdFx0ZGVmYXVsdE1hcmtHZW9jb2RlOmZhbHNlLFxuXHRcdFx0fSlcblx0XHRcdC5vbignbWFya2dlb2NvZGUnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHQvL2NvbnNvbGUubG9nKGUuZ2VvY29kZS5jbmV0ZXIpO3JldHVybjtcblx0XHRcdFx0dmFyIGxhYmVsID0gc2VsZi5fZ2V0X2dlb2NvZGVyX3Jlc3VsdF9sYWJlbCggW2UuZ2VvY29kZV0sIGUuZ2VvY29kZS5jZW50ZXIgKTtcblxuXHRcdFx0XHRzZWxmLmFkZF9tYXJrZXIoIGUuZ2VvY29kZS5jZW50ZXIsIGxhYmVsICk7XG5cdFx0XHRcdC8qXG5cdFx0XHRcdHNlbGYubWFwLmZseVRvQm91bmRzKGUuZ2VvY29kZS5iYm94KTtcblx0XHRcdFx0LyovXG5cdFx0XHRcdHNlbGYubWFwLmZpdEJvdW5kcyhlLmdlb2NvZGUuYmJveCk7XG5cdFx0XHRcdC8vKi9cblxuLy9cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdH0pXG5cdFx0XHQuYWRkVG8oIHRoaXMubWFwICk7XG5cblx0XHRcdC8vIHByZXZlbnQgd3AgcG9zdCBmb3JtIGZyb20gYmVpbmcgc3VibWl0dGVkXG5cdFx0XHRMLkRvbUV2ZW50LmFkZExpc3RlbmVyKHRoaXMuZ2VvY29kZXIuX2lucHV0LCAna2V5ZG93bicsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRpZiAoIGUua2V5Q29kZSA9PT0gMTMgKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCB0aGlzLmdlb2NvZGVyICk7XG5cdFx0fSxcblx0XHR1cGRhdGVfdmlzaWJsZTogZnVuY3Rpb24oKSB7XG5cblx0XHRcdGlmICggdGhpcy52aXNpYmxlID09PSB0aGlzLiRlbC5pcygnOnZpc2libGUnKSApIHtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudmlzaWJsZSA9IHRoaXMuJGVsLmlzKCc6dmlzaWJsZScpO1xuXG5cdFx0XHRpZiAoIHRoaXMudmlzaWJsZSApIHtcblx0XHRcdFx0dGhpcy5tYXAuaW52YWxpZGF0ZVNpemUoKTtcblx0XHRcdFx0dGhpcy5iaW5kX2V2ZW50cygpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH1cblx0XHRcdHRoaXMudW5iaW5kX2V2ZW50cygpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRpbml0X2FjZjogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdHRvZ2dsZV9jYiA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdC8vIG5vIGNoYW5nZVxuXHRcdFx0XHRcdHNlbGYudXBkYXRlX3Zpc2libGUoKTtcblx0XHRcdFx0fTtcblxuXHRcdFx0Ly8gZXhwYW5kL2NvbGxhcHNlIGFjZiBzZXR0aW5nXG5cdFx0XHRhY2YuYWRkQWN0aW9uKCAnc2hvdycsIHRvZ2dsZV9jYiApO1xuXHRcdFx0YWNmLmFkZEFjdGlvbiggJ2hpZGUnLCB0b2dnbGVfY2IgKTtcblxuXG5cblx0XHRcdC8vIGV4cGFuZCBhY2YgcmVwZWF0ZXJcblx0XHRcdC8vIC4uLlxuXG5cdFx0XHQvLyBleHBhbmQgYWNmIGxheW91dFxuXHRcdFx0Ly8gLi4uXG5cblx0XHRcdC8vIGV4cGFuZCB3cCBtZXRhYm94XG5cdFx0XHQkKGRvY3VtZW50KS5vbigncG9zdGJveC10b2dnbGVkJyx0b2dnbGVfY2IpXG5cblxuXHRcdFx0dGhpcy5tYXAub24oJ3pvb21lbmQnLCBmdW5jdGlvbihlKXsgc2VsZi5tYXBfem9vbWVkLmFwcGx5KCBzZWxmLCBbZV0gKTsgfSApO1xuXHRcdFx0dGhpcy5tYXAub24oJ21vdmVlbmQnLCBmdW5jdGlvbihlKXsgc2VsZi5tYXBfbW92ZWQuYXBwbHkoIHNlbGYsIFtlXSApOyB9ICk7XG5cblx0XHR9LFxuXHRcdHVuYmluZF9ldmVudHM6ZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cdFx0XHRzZWxmLiRsYXQoKS5vZmYoJ2JsdXInKTtcblx0XHRcdHNlbGYuJGxuZygpLm9mZignYmx1cicpO1xuXHRcdFx0c2VsZi4kem9vbSgpLm9mZignYmx1cicpO1xuXHRcdFx0c2VsZi4kem9vbSgpLm9mZigna2V5dXAgZm9jdXMnKTtcblx0XHR9LFxuXHRcdGJpbmRfZXZlbnRzOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi4kbGF0KCkub24oJ2JsdXInLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRzZWxmLnVwZGF0ZV9tYXAoKTtcblx0XHRcdH0pO1xuXHRcdFx0c2VsZi4kbG5nKCkub24oJ2JsdXInLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRzZWxmLnVwZGF0ZV9tYXAoKTtcblx0XHRcdH0pO1xuXHRcdFx0c2VsZi4kem9vbSgpLm9uKCdibHVyJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0c2VsZi51cGRhdGVfbWFwKCk7XG5cdFx0XHR9KTtcblx0XHRcdC8vIHNlbGYuJGFkZHJlc3MoKS5vbigna2V5dXAgZm9jdXMnLCBmdW5jdGlvbihlKXtcblx0XHRcdC8vIFx0c2VsZi5zZWFyY2goZSk7XG5cdFx0XHQvLyB9ICk7XG5cblxuLy9cdFx0XHR0aGlzLmxpc3RlblRvKCB0aGlzLiRhZGRyZXNzLCAna2V5dXAgZm9jdXMnLCB0aGlzLnNlYXJjaCApO1xuXG5cdFx0XHQvLyB0aGlzLiR0aWxlcy5vbignY2hhbmdlJywgZG9fbGF5ZXJzIClcblx0XHRcdC8vIFx0LnByZXYoJ2lucHV0Jykub24oJ2NoYW5nZScsIGRvX2xheWVycyApO1xuXG5cdFx0fSxcblx0XHR1cGRhdGVfbWFwOmZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKCAhIHRoaXMuJGxhdCgpLnZhbCgpIHx8ICEgdGhpcy4kbG5nKCkudmFsKCkgKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdHZhciBsYXRsbmcgPSBMLmxhdExuZyggdGhpcy4kbGF0KCkudmFsKCksIHRoaXMuJGxuZygpLnZhbCgpICk7XG5cdFx0XHR0aGlzLm1hcC5zZXRWaWV3KCBsYXRsbmcsICB0aGlzLiR6b29tKCkudmFsKCkgKTtcblx0XHR9LFxuXHRcdG1hcF9tb3ZlZDpmdW5jdGlvbihlKXtcblx0XHRcdHZhciBjZW50ZXIgPSB0aGlzLm1hcC5nZXRDZW50ZXIoKTtcblx0XHRcdHRoaXMuJGxhdCgpLnZhbChjZW50ZXIubGF0KTtcblx0XHRcdHRoaXMuJGxuZygpLnZhbChjZW50ZXIubG5nKTtcblx0XHR9LFxuXHRcdG1hcF96b29tZWQ6ZnVuY3Rpb24oZSl7XG5cdFx0XHR0aGlzLiR6b29tKCkudmFsKCB0aGlzLm1hcC5nZXRab29tKCkgKTtcblx0XHR9LFxuXHR9KTtcblxuXHQvKlxuXHQgKiAgcmVhZHkgYXBwZW5kIChBQ0Y1KVxuXHQgKlxuXHQgKiAgVGhlc2UgYXJlIDIgZXZlbnRzIHdoaWNoIGFyZSBmaXJlZCBkdXJpbmcgdGhlIHBhZ2UgbG9hZFxuXHQgKiAgcmVhZHkgPSBvbiBwYWdlIGxvYWQgc2ltaWxhciB0byAkKGRvY3VtZW50KS5yZWFkeSgpXG5cdCAqICBhcHBlbmQgPSBvbiBuZXcgRE9NIGVsZW1lbnRzIGFwcGVuZGVkIHZpYSByZXBlYXRlciBmaWVsZFxuXHQgKlxuXHQgKiAgQHR5cGVcdGV2ZW50XG5cdCAqICBAZGF0ZVx0MjAvMDcvMTNcblx0ICpcblx0ICogIEBwYXJhbVx0JGVsIChqUXVlcnkgc2VsZWN0aW9uKSB0aGUgalF1ZXJ5IGVsZW1lbnQgd2hpY2ggY29udGFpbnMgdGhlIEFDRiBmaWVsZHNcblx0ICogIEByZXR1cm5cdG4vYVxuXHQgKi9cblx0JChkb2N1bWVudCkub24oJ2FjZi1vc20tbWFwLWluaXQnLGZ1bmN0aW9uKCBlLCBtYXAgKSB7XG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdG5ldyBvc20uZmllbGQoIHsgZWw6IGUudGFyZ2V0LCBtYXA6IG1hcCB9ICk7XG5cdH0pO1xuXG5cbn0pKCBqUXVlcnksIGFjZl9vc21fYWRtaW4gKTtcbiJdfQ==
