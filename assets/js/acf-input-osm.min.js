!function(e,t){var r=t.options,a={};a.MarkerList=Backbone.View.extend({}),a.MarkerEntry=Backbone.View.extend({tagName:"div",className:"osm-marker",events:{'click [data-name="locate-marker"]':"locate_marker",'click [data-name="remove-marker"]':"remove_marker",'change [id$="-marker-label"]':"update_marker_label"},get_label:function(){return this.$el.find('[id$="-marker-label"]').val()},get_default_label:function(){return this.$el.find('[id$="-marker-geocode"]').val()},is_default_label:function(){return this.get_default_label()===this.get_label()},initialize:function(e){return this.template=e.template,this.marker=e.marker,this.marker.osm_controller=this,this},render:function(){return this.$el.html(this.template(this)),this._update_values_from_marker(),this},update_marker_label:function(t){var r=this.get_label();return""===r&&(r=this.get_default_label()),e(t.target).val(r),this.set_marker_label(r)},set_marker_label:function(t){return this.marker.unbindTooltip(),this.marker.bindTooltip(t),this.marker.options.title=t,e(this.marker._icon).attr("title",t),this},update_marker_geocode:function(e){return this.is_default_label()&&this.set_marker_label(e),this.$el.find('[id$="-marker-geocode"]').val(e),this._update_values_from_marker(),this},_update_values_from_marker:function(){var e=this.marker.getLatLng();return this.$el.find('[id$="-marker-lat"]').val(e.lat),this.$el.find('[id$="-marker-lng"]').val(e.lng),this.$el.find('[id$="-marker-label"]').val(this.marker.options.title),this},locate_marker:function(){return this.marker._map.flyTo(this.marker.getLatLng()),e(this.marker._icon).focus(),this},remove_marker:function(e){return e.preventDefault(),this.marker.remove(),this}}),a.field=Backbone.View.extend({map:null,geocoder:null,visible:null,events:{},$parent:function(){return this.$el.closest(".acf-field-settings,.acf-field-open-street-map")},$zoom:function(){return this.$parent().find('input[id$="-zoom"]')},$lat:function(){return this.$parent().find('input[id$="-center_lat"]')},$lng:function(){return this.$parent().find('input[id$="-center_lng"]')},$layerStore:function(){return this.$parent().find(".acf-osm-layers")},$results:function(){return this.$parent().find(".osm-results")},$markers:function(){return this.$parent().find(".osm-markers")},initialize:function(e){return this.map=e.map,this.update_map(),this.init_acf(),this.init_layers(),this.init_markers(),this.update_visible(),this},_get_geocoder_result_label:function(t,r){var a=!1;return t.length?e.each(t,function(e,t){return a=t.html?t.html:t.name,!1}):a=r.lat.toString()+", "+r.lng.toString(),e(a).text().replace(/^(\s+)/g,"").replace(/(\s+)$/g,"").replace(/(\s+)/g," ")},init_markers:function(){var t=this,r=this.$el.data().editorConfig;this.init_geocode(),0!==r.max_markers&&(this.icon=new L.DivIcon({html:"",className:"osm-marker-icon"}),this.map.on("click",function(e){var a=e.latlng,i=t.$markers().children().not("[data-id]").length;!1!==r.max_markers&&i>=r.max_markers||t.geocoder.options.geocoder.reverse(e.latlng,t.map.getZoom(),function(e){var r=t._get_geocoder_result_label(e,a);t.add_marker(a,r)},t)}),this.map.on("layeradd",function(e){if(e.layer.constructor===L.Marker){var r=t.$markers().find('[data-id="__osm_marker_template__"]').html().split("__osm_marker_template__").join("<%= id %>"),i=new a.MarkerEntry({controller:this,marker:e.layer,id:acf.uniqid(),template:_.template(r)});i.render().$el.prependTo(t.$markers()),t.geocode_marker(i),e.layer.setIcon(t.icon).on("click",function(e){this.remove()}).on("remove",function(e){i.$el.remove()}).on("dragend",function(e){t.geocode_marker(i),t.$el.trigger("change")}).dragging.enable()}}),e.each(this.$el.data().mapMarkers,function(e,r){L.marker(L.latLng(1*r.lat,1*r.lng),{title:r.label}).bindTooltip(r.label).addTo(t.map)}))},geocode_marker:function(e){var t=this,r=e,a=r.marker.getLatLng();t.geocoder.options.geocoder.reverse(a,t.map.getZoom(),function(e){var i=t._get_geocoder_result_label(e,a);r.update_marker_geocode(i)},this)},add_marker:function(e,t){L.marker(e,{title:t,icon:this.icon}).bindTooltip(t).addTo(this.map),this.$el.trigger("change")},layer_is_overlay:function(e,t){var r;return!!(t.options.opacity&&t.options.opacity<1)||(r=["^(OpenWeatherMap|OpenSeaMap)","OpenMapSurfer.AdminBounds","Stamen.Toner(Hybrid|Lines|Labels)","Acetate.(foreground|labels|roads)","HillShading","Hydda.RoadsAndLabels","^JusticeMap","OpenInfraMap.(Power|Telecom|Petroleum|Water)","OpenPtMap","OpenRailwayMap","OpenFireMap","SafeCast","CartoDB.DarkMatterOnlyLabels","CartoDB.PositronOnlyLabels"],null!==e.match("("+r.join("|")+")"))},reset_layers:function(){this.map.eachLayer(function(e){e.constructor===L.TileLayer.Provider&&e.remove()}),this.$layerStore().remove(),!!this.layersControl&&this.layersControl.remove()},init_layers:function(){var t=this,a=[],i={},n={},o={},s=this.$el.data().editorConfig,l=function(e){return null===e||!!s.restrict_providers&&-1===s.restrict_providers.indexOf(e)},d=function(s,m){var c,u;if(_.isObject(m))return e.each(m,d);l(s)||(o[s]?(c=o[s],t.map.addLayer(c)):(u=r.layer_config[s.split(".")[0]]||{options:{}},c=L.tileLayer.provider(s,u.options),c.providerKey=s),t.layer_is_overlay(s,c)?n[s]=c:i[s]=c,-1!==a.indexOf(s)&&t.map.addLayer(c))};a=this.$el.data().mapLayers,!1!==s.restrict_providers&&_.isArray(s.restrict_providers)&&(a=a.filter(function(e){return-1!==s.restrict_providers.indexOf(e)})),a.length||(a=Object.keys(r.providers).slice(0,1)),s.allow_providers&&(e('<div class="acf-osm-layers"></div>').insertAfter(this.$el),this.map.on("baselayerchange layeradd layerremove",function(r){if(r.layer.providerKey){var a=t.$layerStore();t.$parent().find('[data-id="__osm_layer_template__"]');a.html(""),t.map.eachLayer(function(r){var i;r.providerKey&&(i=e('<input type="hidden" name="'+s.name_prefix+'[layers][]" />'),i.val(r.providerKey),t.layer_is_overlay(r.providerKey,r)?a.append(i):a.prepend(i))}),t.$el.trigger("change")}})),e.each(r.providers,d),this.$layerStore().length&&(this.layersControl=L.control.layers(i,n,{collapsed:!0,hideSingleBase:!0}).addTo(this.map))},init_geocode:function(){var t=this;this.$el.data().editorConfig;this.map._controlCorners.above=e('<div class="acf-osm-above"></div>').insertBefore(this.$el).get(0),this.geocoder=L.Control.geocoder({collapsed:!1,position:"above",placeholder:"Search...",errorMessage:"Nothing found...",showResultIcons:!0,suggestMinLength:3,suggestTimeout:250,queryMinLength:3,defaultMarkGeocode:!1}).on("markgeocode",function(e){var r=e.geocode.center,a=t.$el.data().editorConfig,i=t.$markers().children().not("[data-id]").length,n=t._get_geocoder_result_label([e.geocode],r);(!1===i||i<a.max_markers)&&t.add_marker(r,n),1===a.max_markers&&1===i&&(marker=t.get_first_marker(),marker&&(entry=marker.osm_controller,marker.setLatLng(r),entry.update_marker_geocode(n))),0===a.max_markers?t.map.fitBounds(e.geocode.bbox):t.map.setView(r,t.map.getZoom())}).addTo(this.map),L.DomEvent.addListener(this.geocoder._input,"keydown",function(e){13===e.keyCode&&e.preventDefault()},this.geocoder)},get_first_marker:function(){var e=!1;return this.map.eachLayer(function(t){if(t.constructor===L.Marker)return e=t,!1}),e},update_visible:function(){return this.visible===this.$el.is(":visible")?this:(this.visible=this.$el.is(":visible"),this.visible?(this.map.invalidateSize(),this.bind_events(),this):(this.unbind_events(),this))},init_acf:function(){var t=this,r=function(){t.update_visible()};acf.addAction("show",r),acf.addAction("hide",r),acf.addAction("disable_field",function(){t.unbind_events()}),e(document).on("postbox-toggled",r),e(document).on("click",".widget-top *",r)},unbind_events:function(){var e=this;e.$lat().off("blur"),e.$lng().off("blur"),e.$zoom().off("blur"),e.$zoom().off("keyup focus"),this.map.off("zoomend",this.map_zoomed,this),this.map.off("moveend",this.map_moved,this)},bind_events:function(){var e=this;e.$lat().on("blur",function(t){e.update_map()}),e.$lng().on("blur",function(t){e.update_map()}),e.$zoom().on("blur",function(t){e.update_map()}),this.map.on("zoomend",this.map_zoomed,this),this.map.on("moveend",this.map_moved,this)},update_map:function(){if(this.$lat().val()&&this.$lng().val()){var e=L.latLng(this.$lat().val(),this.$lng().val());this.map.setView(e,this.$zoom().val())}},map_moved:function(e){var t=this.map.getCenter();this.$lat().val(t.lat),this.$lng().val(t.lng),this.$el.trigger("change")},map_zoomed:function(e){this.$zoom().val(this.map.getZoom()),this.$el.trigger("change")}}),e(document).on("acf-osm-map-init",function(t,r){t.preventDefault(),e(t.target).data("_map_editor",new a.field({el:t.target,map:r}))}).on("change",'[data-name="return_format"] input',function(r){e('[data-name="return_format"] input:checked').val();var a=e(this).closest(".acf-field-object").find("[data-editor-config]"),i=a.data("_map_editor"),n=a.data("editor-config");i.reset_layers(),"osm"===e(this).val()?n.restrict_providers=Object.values(t.options.osm_layers):n.restrict_providers=!1,a.data("editor-config",n),i.init_layers()}),acf.addAction("append",function(){e.acf_leaflet()})}(jQuery,acf_osm_admin);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1pbnB1dC1vc20uanMiXSwibmFtZXMiOlsiJCIsImFyZyIsIm9wdGlvbnMiLCJvc20iLCJNYXJrZXJMaXN0IiwiQmFja2JvbmUiLCJWaWV3IiwiZXh0ZW5kIiwiTWFya2VyRW50cnkiLCJ0YWdOYW1lIiwiY2xhc3NOYW1lIiwiZXZlbnRzIiwiY2xpY2sgW2RhdGEtbmFtZT1cImxvY2F0ZS1tYXJrZXJcIl0iLCJjbGljayBbZGF0YS1uYW1lPVwicmVtb3ZlLW1hcmtlclwiXSIsImNoYW5nZSBbaWQkPVwiLW1hcmtlci1sYWJlbFwiXSIsImdldF9sYWJlbCIsInRoaXMiLCIkZWwiLCJmaW5kIiwidmFsIiwiZ2V0X2RlZmF1bHRfbGFiZWwiLCJpc19kZWZhdWx0X2xhYmVsIiwiaW5pdGlhbGl6ZSIsIm9wdCIsInRlbXBsYXRlIiwibWFya2VyIiwib3NtX2NvbnRyb2xsZXIiLCJyZW5kZXIiLCJodG1sIiwiX3VwZGF0ZV92YWx1ZXNfZnJvbV9tYXJrZXIiLCJ1cGRhdGVfbWFya2VyX2xhYmVsIiwiZSIsImxhYmVsIiwidGFyZ2V0Iiwic2V0X21hcmtlcl9sYWJlbCIsInVuYmluZFRvb2x0aXAiLCJiaW5kVG9vbHRpcCIsInRpdGxlIiwiX2ljb24iLCJhdHRyIiwidXBkYXRlX21hcmtlcl9nZW9jb2RlIiwibGF0bG5nIiwiZ2V0TGF0TG5nIiwibGF0IiwibG5nIiwibG9jYXRlX21hcmtlciIsIl9tYXAiLCJmbHlUbyIsImZvY3VzIiwicmVtb3ZlX21hcmtlciIsInByZXZlbnREZWZhdWx0IiwicmVtb3ZlIiwiZmllbGQiLCJtYXAiLCJnZW9jb2RlciIsInZpc2libGUiLCIkcGFyZW50IiwiY2xvc2VzdCIsIiR6b29tIiwiJGxhdCIsIiRsbmciLCIkbGF5ZXJTdG9yZSIsIiRyZXN1bHRzIiwiJG1hcmtlcnMiLCJjb25mIiwidXBkYXRlX21hcCIsImluaXRfYWNmIiwiaW5pdF9sYXllcnMiLCJpbml0X21hcmtlcnMiLCJ1cGRhdGVfdmlzaWJsZSIsIl9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsIiwibGVuZ3RoIiwiZWFjaCIsImkiLCJyZXN1bHQiLCJuYW1lIiwidG9TdHJpbmciLCJ0ZXh0IiwicmVwbGFjZSIsInNlbGYiLCJlZGl0b3JfY29uZmlnIiwiZGF0YSIsImVkaXRvckNvbmZpZyIsImluaXRfZ2VvY29kZSIsIm1heF9tYXJrZXJzIiwiaWNvbiIsIkwiLCJEaXZJY29uIiwib24iLCJjb3VudF9tYXJrZXJzIiwiY2hpbGRyZW4iLCJub3QiLCJyZXZlcnNlIiwiZ2V0Wm9vbSIsImFkZF9tYXJrZXIiLCJsYXllciIsImNvbnN0cnVjdG9yIiwiTWFya2VyIiwic3BsaXQiLCJqb2luIiwiZW50cnkiLCJjb250cm9sbGVyIiwiaWQiLCJhY2YiLCJ1bmlxaWQiLCJfIiwicHJlcGVuZFRvIiwiZ2VvY29kZV9tYXJrZXIiLCJzZXRJY29uIiwidHJpZ2dlciIsImRyYWdnaW5nIiwiZW5hYmxlIiwibWFwTWFya2VycyIsIm1hcmtlckRhdGEiLCJsYXRMbmciLCJhZGRUbyIsIm1hcmtlcl9lbnRyeSIsImxuZ2xhdCIsImxheWVyX2lzX292ZXJsYXkiLCJrZXkiLCJwYXR0ZXJucyIsIm9wYWNpdHkiLCJtYXRjaCIsInJlc2V0X2xheWVycyIsImVhY2hMYXllciIsIlRpbGVMYXllciIsIlByb3ZpZGVyIiwibGF5ZXJzQ29udHJvbCIsInNlbGVjdGVkTGF5ZXJzIiwiYmFzZUxheWVycyIsIm92ZXJsYXlzIiwibWFwTGF5ZXJzIiwiaXNfb21pdHRlZCIsInJlc3RyaWN0X3Byb3ZpZGVycyIsImluZGV4T2YiLCJzZXR1cE1hcCIsImxheWVyX2NvbmZpZyIsImlzT2JqZWN0IiwiYWRkTGF5ZXIiLCJ0aWxlTGF5ZXIiLCJwcm92aWRlciIsInByb3ZpZGVyS2V5IiwiaXNBcnJheSIsImZpbHRlciIsImVsIiwiT2JqZWN0Iiwia2V5cyIsInByb3ZpZGVycyIsInNsaWNlIiwiYWxsb3dfcHJvdmlkZXJzIiwiaW5zZXJ0QWZ0ZXIiLCIkbGF5ZXJJbnB1dCIsIm5hbWVfcHJlZml4IiwiYXBwZW5kIiwicHJlcGVuZCIsImNvbnRyb2wiLCJsYXllcnMiLCJjb2xsYXBzZWQiLCJoaWRlU2luZ2xlQmFzZSIsIl9jb250cm9sQ29ybmVycyIsImluc2VydEJlZm9yZSIsImdldCIsIkNvbnRyb2wiLCJwb3NpdGlvbiIsInBsYWNlaG9sZGVyIiwiZXJyb3JNZXNzYWdlIiwic2hvd1Jlc3VsdEljb25zIiwic3VnZ2VzdE1pbkxlbmd0aCIsInN1Z2dlc3RUaW1lb3V0IiwicXVlcnlNaW5MZW5ndGgiLCJkZWZhdWx0TWFya0dlb2NvZGUiLCJnZW9jb2RlIiwiY2VudGVyIiwiZ2V0X2ZpcnN0X21hcmtlciIsInNldExhdExuZyIsImZpdEJvdW5kcyIsImJib3giLCJzZXRWaWV3IiwiRG9tRXZlbnQiLCJhZGRMaXN0ZW5lciIsIl9pbnB1dCIsImtleUNvZGUiLCJpcyIsImludmFsaWRhdGVTaXplIiwiYmluZF9ldmVudHMiLCJ1bmJpbmRfZXZlbnRzIiwidG9nZ2xlX2NiIiwiYWRkQWN0aW9uIiwiZG9jdW1lbnQiLCJvZmYiLCJtYXBfem9vbWVkIiwibWFwX21vdmVkIiwiZ2V0Q2VudGVyIiwiJG1hcCIsImVkaXRvciIsInZhbHVlcyIsIm9zbV9sYXllcnMiLCJhY2ZfbGVhZmxldCIsImpRdWVyeSIsImFjZl9vc21fYWRtaW4iXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBQ0EsR0FBQUMsR0FBQUQsRUFBQUMsUUFNQUMsSUFHQUEsR0FBQUMsV0FBQUMsU0FBQUMsS0FBQUMsV0FFQUosRUFBQUssWUFBQUgsU0FBQUMsS0FBQUMsUUFDQUUsUUFBQSxNQUNBQyxVQUFBLGFBQ0FDLFFBQ0FDLG9DQUFBLGdCQUNBQyxvQ0FBQSxnQkFDQUMsK0JBQUEsdUJBRUFDLFVBQUEsV0FDQSxNQUFBQyxNQUFBQyxJQUFBQyxLQUFBLHlCQUFBQyxPQUVBQyxrQkFBQSxXQUNBLE1BQUFKLE1BQUFDLElBQUFDLEtBQUEsMkJBQUFDLE9BRUFFLGlCQUFBLFdBQ0EsTUFBQUwsTUFBQUksc0JBQUFKLEtBQUFE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S0FBQUMsSUFBQTRGLFFBQUEsYUFLQTdHLEVBQUE0TCxVQUNBcEcsR0FBQSxtQkFBQSxTQUFBekQsRUFBQXNCLEdBQ0F0QixFQUFBbUIsaUJBQ0FsRCxFQUFBK0IsRUFBQUUsUUFBQWdELEtBQUEsY0FBQSxHQUFBOUUsR0FBQWlELE9BQUE0RixHQUFBakgsRUFBQUUsT0FBQW9CLElBQUFBLE9BSUFtQyxHQUFBLFNBQUEsb0NBQUEsU0FBQXpELEdBRUEvQixFQUFBLDZDQUFBbUIsS0FDQSxJQUFBOEssR0FBQWpNLEVBQUFnQixNQUFBeUMsUUFBQSxxQkFBQXZDLEtBQUEsd0JBQ0FnTCxFQUFBRCxFQUFBaEgsS0FBQSxlQUNBakIsRUFBQWlJLEVBQUFoSCxLQUFBLGdCQUVBaUgsR0FBQXZFLGVBQ0EsUUFBQTNILEVBQUFnQixNQUFBRyxNQUVBNkMsRUFBQXFFLG1CQUFBWSxPQUFBa0QsT0FBQWxNLEVBQUFDLFFBQUFrTSxZQUdBcEksRUFBQXFFLG9CQUFBLEVBRUE0RCxFQUFBaEgsS0FBQSxnQkFBQWpCLEdBQ0FrSSxFQUFBL0gsZ0JBSUFvQyxJQUFBb0YsVUFBQSxTQUFBLFdBQ0EzTCxFQUFBcU0saUJBR0FDLE9BQUFDIiwiZmlsZSI6ImFjZi1pbnB1dC1vc20ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCAkLCBhcmcgKXtcblx0dmFyIG9wdGlvbnMgPSBhcmcub3B0aW9ucyxcblx0XHRyZXN1bHRfdHBsID0gJzxkaXYgdGFiaW5kZXg9XCI8JT0gZGF0YS5pICU+XCIgY2xhc3M9XCJvc20tcmVzdWx0XCI+J1xuXHRcdFx0KyAnPCU9IGRhdGEucmVzdWx0X3RleHQgJT4nXG5cdFx0XHQrICc8YnIgLz48c21hbGw+PCU9IGRhdGEucHJvcGVydGllcy5vc21fdmFsdWUgJT48L3NtYWxsPidcblx0XHRcdCsgJzwvZGl2Pic7XG5cblx0dmFyIG9zbSA9IHtcblx0fTtcblxuXHRvc20uTWFya2VyTGlzdCA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcblx0fSlcblx0b3NtLk1hcmtlckVudHJ5ID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXHRcdHRhZ05hbWU6ICdkaXYnLFxuXHRcdGNsYXNzTmFtZTonb3NtLW1hcmtlcicsXG5cdFx0ZXZlbnRzOiB7XG5cdFx0XHQnY2xpY2sgW2RhdGEtbmFtZT1cImxvY2F0ZS1tYXJrZXJcIl0nIDogJ2xvY2F0ZV9tYXJrZXInLFxuXHRcdFx0J2NsaWNrIFtkYXRhLW5hbWU9XCJyZW1vdmUtbWFya2VyXCJdJyA6ICdyZW1vdmVfbWFya2VyJyxcblx0XHRcdCdjaGFuZ2UgW2lkJD1cIi1tYXJrZXItbGFiZWxcIl0nXHRcdDogJ3VwZGF0ZV9tYXJrZXJfbGFiZWwnLFxuXHRcdH0sXG5cdFx0Z2V0X2xhYmVsOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1sYWJlbFwiXScpLnZhbCgpO1xuXHRcdH0sXG5cdFx0Z2V0X2RlZmF1bHRfbGFiZWw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWdlb2NvZGVcIl0nKS52YWwoKTtcblx0XHR9LFxuXHRcdGlzX2RlZmF1bHRfbGFiZWw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuZ2V0X2RlZmF1bHRfbGFiZWwoKSA9PT0gdGhpcy5nZXRfbGFiZWwoKTtcblx0XHR9LFxuXHRcdGluaXRpYWxpemU6ZnVuY3Rpb24ob3B0KXtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblx0XHRcdHRoaXMudGVtcGxhdGUgPSBvcHQudGVtcGxhdGU7XG5cdFx0XHR0aGlzLm1hcmtlciA9IG9wdC5tYXJrZXI7XG5cdFx0XHR0aGlzLm1hcmtlci5vc21fY29udHJvbGxlciA9IHRoaXM7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0cmVuZGVyOmZ1bmN0aW9uKCl7XG5cdFx0XHR0aGlzLiRlbC5odG1sKCB0aGlzLnRlbXBsYXRlKCB0aGlzICkgKTtcblx0XHRcdHRoaXMuX3VwZGF0ZV92YWx1ZXNfZnJvbV9tYXJrZXIoKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0dXBkYXRlX21hcmtlcl9sYWJlbDpmdW5jdGlvbihlKSB7XG5cdFx0XHR2YXIgbGFiZWwgPSB0aGlzLmdldF9sYWJlbCgpO1xuXG5cdFx0XHRpZiAoIGxhYmVsID09PSAnJyApIHtcblx0XHRcdFx0bGFiZWwgPSB0aGlzLmdldF9kZWZhdWx0X2xhYmVsKCk7XG5cdFx0XHR9XG5cdFx0XHQvLyByZXN0b3JlIGdlb2NvZGUgZGVmYXVsdFxuXHRcdFx0JChlLnRhcmdldCkudmFsKGxhYmVsKTtcblxuXHRcdFx0cmV0dXJuIHRoaXMuc2V0X21hcmtlcl9sYWJlbCggbGFiZWwgKTtcblx0XHR9LFxuXHRcdHNldF9tYXJrZXJfbGFiZWw6ZnVuY3Rpb24obGFiZWwpIHtcblx0XHRcdHRoaXMubWFya2VyLnVuYmluZFRvb2x0aXAoKTtcblx0XHRcdHRoaXMubWFya2VyLmJpbmRUb29sdGlwKGxhYmVsKTtcblxuXHRcdFx0dGhpcy5tYXJrZXIub3B0aW9ucy50aXRsZSA9IGxhYmVsO1xuXHRcdFx0JCggdGhpcy5tYXJrZXIuX2ljb24gKS5hdHRyKCAndGl0bGUnLCBsYWJlbCApO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHR1cGRhdGVfbWFya2VyX2dlb2NvZGU6ZnVuY3Rpb24oIGxhYmVsICkge1xuXG5cdFx0XHRpZiAoIHRoaXMuaXNfZGVmYXVsdF9sYWJlbCgpICkge1xuXHRcdFx0XHQvLyB1cGRhdGUgbWFya2VyIGxhYmVsc1xuXHRcdFx0XHR0aGlzLnNldF9tYXJrZXJfbGFiZWwoIGxhYmVsICk7XG5cdFx0XHRcdC8vIHVwZGF0ZSBtYXJrZXIgbGFiZWwgaW5wdXRcblx0XHRcdH1cblxuXG5cdFx0XHR0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1nZW9jb2RlXCJdJykudmFsKCBsYWJlbCApO1xuXG5cdFx0XHR0aGlzLl91cGRhdGVfdmFsdWVzX2Zyb21fbWFya2VyKCk7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0X3VwZGF0ZV92YWx1ZXNfZnJvbV9tYXJrZXI6IGZ1bmN0aW9uKCApIHtcblx0XHRcdHZhciBsYXRsbmcgPSB0aGlzLm1hcmtlci5nZXRMYXRMbmcoKTtcblx0XHRcdHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWxhdFwiXScpLnZhbCggbGF0bG5nLmxhdCApO1xuXHRcdFx0dGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItbG5nXCJdJykudmFsKCBsYXRsbmcubG5nICk7XG5cdFx0XHR0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1sYWJlbFwiXScpLnZhbCggdGhpcy5tYXJrZXIub3B0aW9ucy50aXRsZSApO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblxuXHRcdGxvY2F0ZV9tYXJrZXI6ZnVuY3Rpb24oKXtcblx0XHRcdHRoaXMubWFya2VyLl9tYXAuZmx5VG8oIHRoaXMubWFya2VyLmdldExhdExuZygpICk7XG5cdFx0XHQkKHRoaXMubWFya2VyLl9pY29uKS5mb2N1cygpXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHJlbW92ZV9tYXJrZXI6ZnVuY3Rpb24oZSkge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpXG5cdFx0XHR0aGlzLm1hcmtlci5yZW1vdmUoKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblx0fSk7XG5cblx0b3NtLmZpZWxkID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXG5cdFx0bWFwOiBudWxsLFxuXHRcdGdlb2NvZGVyOiBudWxsLFxuXHRcdHZpc2libGU6IG51bGwsXG5cdFx0ZXZlbnRzOntcblx0XHR9LFxuXG5cdFx0JHBhcmVudDpmdW5jdGlvbigpe1xuXHRcdFx0cmV0dXJuIHRoaXMuJGVsLmNsb3Nlc3QoJy5hY2YtZmllbGQtc2V0dGluZ3MsLmFjZi1maWVsZC1vcGVuLXN0cmVldC1tYXAnKVxuXHRcdH0sXG5cdFx0JHpvb20gOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCdpbnB1dFtpZCQ9XCItem9vbVwiXScpO1xuXHRcdH0sXG5cdFx0JGxhdCA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJ2lucHV0W2lkJD1cIi1jZW50ZXJfbGF0XCJdJyk7XG5cdFx0fSxcblx0XHQkbG5nIDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnaW5wdXRbaWQkPVwiLWNlbnRlcl9sbmdcIl0nKTtcblx0XHR9LFxuXHRcdCRsYXllclN0b3JlOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCcuYWNmLW9zbS1sYXllcnMnKTtcblx0XHR9LFxuXHRcdCRyZXN1bHRzIDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnLm9zbS1yZXN1bHRzJyk7XG5cdFx0fSxcblx0XHQkbWFya2VyczpmdW5jdGlvbigpe1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJy5vc20tbWFya2VycycpO1xuXHRcdH0sXG5cdFx0aW5pdGlhbGl6ZTpmdW5jdGlvbihjb25mKSB7XG5cblx0XHRcdHRoaXMubWFwXHRcdD0gY29uZi5tYXA7XG5cblx0XHRcdHRoaXMudXBkYXRlX21hcCgpOyAvLyBzZXQgbWFwIHRvIGlucHV0IHZhbHVlc1xuXG5cdFx0XHR0aGlzLmluaXRfYWNmKCk7XG5cblx0XHRcdHRoaXMuaW5pdF9sYXllcnMoKTtcblxuXHRcdFx0dGhpcy5pbml0X21hcmtlcnMoKTtcblxuXHRcdFx0dGhpcy51cGRhdGVfdmlzaWJsZSgpO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdF9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsOmZ1bmN0aW9uKCBlLCBsYXRsbmcgKSB7XG5cdFx0XHR2YXIgbGFiZWwgPSBmYWxzZTtcblxuXHRcdFx0aWYgKCAhIGUubGVuZ3RoICkge1xuXHRcdFx0XHRsYWJlbCA9IGxhdGxuZy5sYXQudG9TdHJpbmcoKSArICcsICcgKyBsYXRsbmcubG5nLnRvU3RyaW5nKCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQkLmVhY2goIGUsIGZ1bmN0aW9uKCBpLCByZXN1bHQgKSB7XG5cdFx0XHRcdFx0aWYgKCAhISByZXN1bHQuaHRtbCApIHtcblx0XHRcdFx0XHRcdGxhYmVsID0gcmVzdWx0Lmh0bWw7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGxhYmVsID0gcmVzdWx0Lm5hbWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gJChsYWJlbCkudGV4dCgpLnJlcGxhY2UoL14oXFxzKykvZywnJykucmVwbGFjZSgvKFxccyspJC9nLCcnKS5yZXBsYWNlKC8oXFxzKykvZywnICcpO1xuXHRcdH0sXG5cdFx0aW5pdF9tYXJrZXJzOmZ1bmN0aW9uKCl7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0ZWRpdG9yX2NvbmZpZyA9IHRoaXMuJGVsLmRhdGEoKS5lZGl0b3JDb25maWc7XG5cblx0XHRcdHRoaXMuaW5pdF9nZW9jb2RlKCk7XG5cblx0XHRcdC8vIG5vIG1hcmtlcnMgYWxsb3dlZCFcblx0XHRcdGlmICggZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyA9PT0gMCApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmljb24gPSBuZXcgTC5EaXZJY29uKHtcblx0XHRcdFx0aHRtbDogJycsXG5cdFx0XHRcdGNsYXNzTmFtZTonb3NtLW1hcmtlci1pY29uJ1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMubWFwLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHR2YXIgbGF0bG5nID0gZS5sYXRsbmcsXG5cdFx0XHRcdFx0Y291bnRfbWFya2VycyA9IHNlbGYuJG1hcmtlcnMoKS5jaGlsZHJlbigpLm5vdCgnW2RhdGEtaWRdJykubGVuZ3RoO1xuXG5cdFx0XHRcdC8vIG5vIG1vcmUgbWFya2Vyc1xuXHRcdFx0XHRpZiAoIGVkaXRvcl9jb25maWcubWF4X21hcmtlcnMgIT09IGZhbHNlICYmIGNvdW50X21hcmtlcnMgPj0gZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyApIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxmLmdlb2NvZGVyLm9wdGlvbnMuZ2VvY29kZXIucmV2ZXJzZShlLmxhdGxuZyxzZWxmLm1hcC5nZXRab29tKCksZnVuY3Rpb24oZSl7XG5cblx0XHRcdFx0XHR2YXIgbGFiZWwgPSBzZWxmLl9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsKCBlLCBsYXRsbmcgKTtcblxuXHRcdFx0XHRcdHNlbGYuYWRkX21hcmtlciggbGF0bG5nLCBsYWJlbCApO1xuXG5cdFx0XHRcdH0sc2VsZik7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5tYXAub24oICdsYXllcmFkZCcsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRpZiAoIGUubGF5ZXIuY29uc3RydWN0b3IgIT09IEwuTWFya2VyICkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0XHQvLyBtYXJrZXIgYWRkZWRcblx0XHRcdFx0dmFyIHRlbXBsYXRlID0gc2VsZi4kbWFya2VycygpLmZpbmQoJ1tkYXRhLWlkPVwiX19vc21fbWFya2VyX3RlbXBsYXRlX19cIl0nKS5odG1sKCkuc3BsaXQoJ19fb3NtX21hcmtlcl90ZW1wbGF0ZV9fJykuam9pbiggJzwlPSBpZCAlPicgKSxcblx0XHRcdFx0XHRlbnRyeSA9IG5ldyBvc20uTWFya2VyRW50cnkoe1xuXHRcdFx0XHRcdFx0Y29udHJvbGxlcjogdGhpcyxcblx0XHRcdFx0XHRcdG1hcmtlcjogZS5sYXllcixcblx0XHRcdFx0XHRcdGlkOiBhY2YudW5pcWlkKCksIC8vc2VsZi4kbWFya2VycygpLmNoaWxkcmVuKCkubGVuZ3RoLFxuXHRcdFx0XHRcdFx0dGVtcGxhdGU6IF8udGVtcGxhdGUoIHRlbXBsYXRlICksXG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0ZW50cnkucmVuZGVyKCkuJGVsLnByZXBlbmRUbyggc2VsZi4kbWFya2VycygpICk7XG5cblx0XHRcdFx0c2VsZi5nZW9jb2RlX21hcmtlciggZW50cnkgKTtcblxuXHRcdFx0XHRlLmxheWVyXG5cdFx0XHRcdFx0LnNldEljb24oIHNlbGYuaWNvbiApXG5cdFx0XHRcdFx0Lm9uKCdjbGljaycsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0XHR0aGlzLnJlbW92ZSgpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0Lm9uKCdyZW1vdmUnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdFx0ZW50cnkuJGVsLnJlbW92ZSgpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0Lm9uKCdkcmFnZW5kJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRcdHNlbGYuZ2VvY29kZV9tYXJrZXIoIGVudHJ5ICk7XG5cdFx0XHRcdFx0XHRzZWxmLiRlbC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5kcmFnZ2luZy5lbmFibGUoKTtcblx0XHRcdH0gKTtcblx0XHRcdC8vIGFkZCBtYXJrZXJzXG5cdFx0XHQkLmVhY2goIHRoaXMuJGVsLmRhdGEoKS5tYXBNYXJrZXJzLGZ1bmN0aW9uKCBpLCBtYXJrZXJEYXRhICkge1xuXHRcdFx0XHQvLyBhZGQgbWFya2Vyc1xuXHRcdFx0XHR2YXIgbWFya2VyID0gTC5tYXJrZXIoIEwubGF0TG5nKCBtYXJrZXJEYXRhLmxhdCAqIDEsIG1hcmtlckRhdGEubG5nICogMSApLCB7XG5cdFx0XHRcdFx0XHR0aXRsZTogbWFya2VyRGF0YS5sYWJlbFxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0LmJpbmRUb29sdGlwKCBtYXJrZXJEYXRhLmxhYmVsIClcblx0XHRcdFx0XHQuYWRkVG8oIHNlbGYubWFwICk7XG5cblx0XHRcdH0pO1xuXG5cdFx0fSxcblx0XHRnZW9jb2RlX21hcmtlcjpmdW5jdGlvbiggbWFya2VyX2VudHJ5ICkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRlbnRyeSA9IG1hcmtlcl9lbnRyeSxcblx0XHRcdFx0bGF0bG5nID0gZW50cnkubWFya2VyLmdldExhdExuZygpO1xuXG5cdFx0XHRzZWxmLmdlb2NvZGVyLm9wdGlvbnMuZ2VvY29kZXIucmV2ZXJzZSggbGF0bG5nLCBzZWxmLm1hcC5nZXRab29tKCksIGZ1bmN0aW9uKGUpe1xuXG5cdFx0XHRcdHZhciBsYWJlbCA9IHNlbGYuX2dldF9nZW9jb2Rlcl9yZXN1bHRfbGFiZWwoIGUsIGxhdGxuZyApO1xuXG5cdFx0XHRcdGVudHJ5LnVwZGF0ZV9tYXJrZXJfZ2VvY29kZSggbGFiZWwgKTtcblxuXHRcdFx0fSwgdGhpcyApO1xuXG5cdFx0fSxcblx0XHRhZGRfbWFya2VyOmZ1bmN0aW9uKCBsbmdsYXQsIGxhYmVsICl7XG5cdFx0XHRMLm1hcmtlcihsbmdsYXQse1xuXHRcdFx0XHR0aXRsZTogbGFiZWwsXG5cdFx0XHRcdGljb246IHRoaXMuaWNvbixcblx0XHRcdH0pXG5cdFx0XHRcdC5iaW5kVG9vbHRpcCggbGFiZWwgKVxuXHRcdFx0XHQuYWRkVG8oIHRoaXMubWFwICk7XG5cdFx0XHR0aGlzLiRlbC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHR9LFxuXHRcdGxheWVyX2lzX292ZXJsYXk6IGZ1bmN0aW9uKCAga2V5LCBsYXllciApIHtcblx0XHRcdHZhciBwYXR0ZXJucztcblxuXHRcdFx0aWYgKCBsYXllci5vcHRpb25zLm9wYWNpdHkgJiYgbGF5ZXIub3B0aW9ucy5vcGFjaXR5IDwgMSApIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0XHRwYXR0ZXJucyA9IFsnXihPcGVuV2VhdGhlck1hcHxPcGVuU2VhTWFwKScsXG5cdFx0XHRcdCdPcGVuTWFwU3VyZmVyLkFkbWluQm91bmRzJyxcblx0XHRcdFx0J1N0YW1lbi5Ub25lcihIeWJyaWR8TGluZXN8TGFiZWxzKScsXG5cdFx0XHRcdCdBY2V0YXRlLihmb3JlZ3JvdW5kfGxhYmVsc3xyb2FkcyknLFxuXHRcdFx0XHQnSGlsbFNoYWRpbmcnLFxuXHRcdFx0XHQnSHlkZGEuUm9hZHNBbmRMYWJlbHMnLFxuXHRcdFx0XHQnXkp1c3RpY2VNYXAnLFxuXHRcdFx0XHQnT3BlbkluZnJhTWFwLihQb3dlcnxUZWxlY29tfFBldHJvbGV1bXxXYXRlciknLFxuXHRcdFx0XHQnT3BlblB0TWFwJyxcblx0XHRcdFx0J09wZW5SYWlsd2F5TWFwJyxcblx0XHRcdFx0J09wZW5GaXJlTWFwJyxcblx0XHRcdFx0J1NhZmVDYXN0Jyxcblx0XHRcdFx0J0NhcnRvREIuRGFya01hdHRlck9ubHlMYWJlbHMnLFxuXHRcdFx0XHQnQ2FydG9EQi5Qb3NpdHJvbk9ubHlMYWJlbHMnXG5cdFx0XHRdO1xuXHRcdFx0cmV0dXJuIGtleS5tYXRjaCgnKCcgKyBwYXR0ZXJucy5qb2luKCd8JykgKyAnKScpICE9PSBudWxsO1xuXHRcdH0sXG5cdFx0cmVzZXRfbGF5ZXJzOmZ1bmN0aW9uKCkge1xuXHRcdFx0Ly8gc2V0IHRoaXMuJGVsLmRhdGEoKS5tYXBMYXllcnMgc28gaXQgZml0c1xuXHRcdFx0Ly8gcmVtb3ZlIGFsbCBtYXAgbGF5ZXJzXG5cdFx0XHR0aGlzLm1hcC5lYWNoTGF5ZXIoZnVuY3Rpb24obGF5ZXIpe1xuXHRcdFx0XHRpZiAoIGxheWVyLmNvbnN0cnVjdG9yID09PSBMLlRpbGVMYXllci5Qcm92aWRlciApIHtcblx0XHRcdFx0XHRsYXllci5yZW1vdmUoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSlcblx0XHRcdC8vIHJlbW92ZSBsYXllciBzdG9yZVxuXHRcdFx0dGhpcy4kbGF5ZXJTdG9yZSgpLnJlbW92ZSgpO1xuXG5cdFx0XHQvLyByZW1vdmUgbGF5ZXIgY29udHJvbFxuXHRcdFx0ISEgdGhpcy5sYXllcnNDb250cm9sICYmIHRoaXMubGF5ZXJzQ29udHJvbC5yZW1vdmUoKVxuXHRcdH0sXG5cdFx0aW5pdF9sYXllcnM6ZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdHNlbGVjdGVkTGF5ZXJzID0gW10sXG5cdFx0XHRcdGJhc2VMYXllcnMgPSB7fSxcblx0XHRcdFx0b3ZlcmxheXMgPSB7fSxcblx0XHRcdFx0bWFwTGF5ZXJzID0ge30sXG5cdFx0XHRcdGVkaXRvcl9jb25maWcgPSB0aGlzLiRlbC5kYXRhKCkuZWRpdG9yQ29uZmlnLFxuXHRcdFx0XHRpc19vbWl0dGVkID0gZnVuY3Rpb24oa2V5KSB7XG5cblx0XHRcdFx0XHRyZXR1cm4ga2V5ID09PSBudWxsIHx8ICggISEgZWRpdG9yX2NvbmZpZy5yZXN0cmljdF9wcm92aWRlcnMgJiYgZWRpdG9yX2NvbmZpZy5yZXN0cmljdF9wcm92aWRlcnMuaW5kZXhPZigga2V5ICkgPT09IC0xICk7XG5cdFx0XHRcdH0sXG5cdFx0XHRcdHNldHVwTWFwID0gZnVuY3Rpb24oIGtleSwgdmFsICl7XG5cdFx0XHRcdFx0dmFyIGxheWVyLCBsYXllcl9jb25maWc7XG5cdFx0XHRcdFx0aWYgKCBfLmlzT2JqZWN0KHZhbCkgKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gJC5lYWNoKCB2YWwsIHNldHVwTWFwICk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCBpc19vbWl0dGVkKGtleSkgKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICggISEgbWFwTGF5ZXJzWyBrZXkgXSApIHtcblx0XHRcdFx0XHRcdGxheWVyID0gbWFwTGF5ZXJzWyBrZXkgXTtcblx0XHRcdFx0XHRcdHNlbGYubWFwLmFkZExheWVyKGxheWVyKVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRsYXllcl9jb25maWcgPSBvcHRpb25zLmxheWVyX2NvbmZpZ1sga2V5LnNwbGl0KCcuJylbMF0gXSB8fCB7b3B0aW9uczp7fX07XG5cdFx0XHRcdFx0XHRsYXllciA9IEwudGlsZUxheWVyLnByb3ZpZGVyKCBrZXksIGxheWVyX2NvbmZpZy5vcHRpb25zICk7XG5cdFx0XHRcdFx0XHRsYXllci5wcm92aWRlcktleSA9IGtleTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIHNlbGYubGF5ZXJfaXNfb3ZlcmxheSgga2V5LCBsYXllciApICkge1xuXHRcdFx0XHRcdFx0b3ZlcmxheXNba2V5XSA9IGxheWVyO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRiYXNlTGF5ZXJzW2tleV0gPSBsYXllcjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIHNlbGVjdGVkTGF5ZXJzLmluZGV4T2YoIGtleSApICE9PSAtMSApIHtcblx0XHRcdFx0XHRcdHNlbGYubWFwLmFkZExheWVyKGxheWVyKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH07XG5cblx0XHRcdHNlbGVjdGVkTGF5ZXJzID0gdGhpcy4kZWwuZGF0YSgpLm1hcExheWVyczsgLy8gc2hvdWxkIGJlIGxheWVyIHN0b3JlIHZhbHVlXG5cblx0XHRcdC8vIGZpbHRlciBhdmFpYWxibGUgbGF5ZXJzIGluIGZpZWxkIHZhbHVlXG5cdFx0XHRpZiAoIGVkaXRvcl9jb25maWcucmVzdHJpY3RfcHJvdmlkZXJzICE9PSBmYWxzZSAmJiBfLmlzQXJyYXkoIGVkaXRvcl9jb25maWcucmVzdHJpY3RfcHJvdmlkZXJzICkgKSB7XG5cdFx0XHRcdHNlbGVjdGVkTGF5ZXJzID0gc2VsZWN0ZWRMYXllcnMuZmlsdGVyKCBmdW5jdGlvbihlbCkge1xuXHRcdFx0XHRcdHJldHVybiBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycy5pbmRleE9mKCBlbCApICE9PSAtMTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIHNldCBkZWZhdWx0IGxheWVyXG5cdFx0XHRpZiAoICEgc2VsZWN0ZWRMYXllcnMubGVuZ3RoICkge1xuXG5cdFx0XHRcdHNlbGVjdGVkTGF5ZXJzID0gT2JqZWN0LmtleXMoIG9wdGlvbnMucHJvdmlkZXJzICkuc2xpY2UoIDAsIDEgKTtcblxuXHRcdFx0fVxuXG5cdFx0XHQvLyBlZGl0YWJsZSBsYXllcnMhXG5cdFx0XHRpZiAoIGVkaXRvcl9jb25maWcuYWxsb3dfcHJvdmlkZXJzICkge1xuXG5cdFx0XHRcdCQoJzxkaXYgY2xhc3M9XCJhY2Ytb3NtLWxheWVyc1wiPjwvZGl2PicpLmluc2VydEFmdGVyKCB0aGlzLiRlbCApO1xuXG5cdFx0XHRcdHRoaXMubWFwLm9uKCAnYmFzZWxheWVyY2hhbmdlIGxheWVyYWRkIGxheWVycmVtb3ZlJywgZnVuY3Rpb24oZSl7XG5cblx0XHRcdFx0XHRpZiAoICEgZS5sYXllci5wcm92aWRlcktleSkge1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHR2YXIgJGxheWVyU3RvcmUgPSBzZWxmLiRsYXllclN0b3JlKCksXG5cdFx0XHRcdFx0XHQkdGVtcGxhdGUgPSBzZWxmLiRwYXJlbnQoKS5maW5kKCdbZGF0YS1pZD1cIl9fb3NtX2xheWVyX3RlbXBsYXRlX19cIl0nKTtcblxuXHRcdFx0XHRcdCRsYXllclN0b3JlLmh0bWwoJycpO1xuXG5cdFx0XHRcdFx0c2VsZi5tYXAuZWFjaExheWVyKGZ1bmN0aW9uKGxheWVyKSB7XG5cdFx0XHRcdFx0XHR2YXIgJGxheWVySW5wdXQ7XG5cdFx0XHRcdFx0XHRpZiAoICEgbGF5ZXIucHJvdmlkZXJLZXkgKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdC8qXG5cdFx0XHRcdFx0XHQkbGF5ZXJJbnB1dCA9ICR0ZW1wbGF0ZS5jbG9uZSgpLnJlbW92ZUF0dHIoJ2RhdGEtaWQnKTtcblx0XHRcdFx0XHRcdC8qL1xuXHRcdFx0XHRcdFx0JGxheWVySW5wdXQgPSAkKCc8aW5wdXQgdHlwZT1cImhpZGRlblwiIG5hbWU9XCInICsgZWRpdG9yX2NvbmZpZy5uYW1lX3ByZWZpeCArICdbbGF5ZXJzXVtdXCIgLz4nKTtcblx0XHRcdFx0XHRcdC8vKi9cblx0XHRcdFx0XHRcdCRsYXllcklucHV0LnZhbCggbGF5ZXIucHJvdmlkZXJLZXkgKTtcblxuXHRcdFx0XHRcdFx0aWYgKCBzZWxmLmxheWVyX2lzX292ZXJsYXkoIGxheWVyLnByb3ZpZGVyS2V5LCBsYXllciApICkge1xuXHRcdFx0XHRcdFx0XHQkbGF5ZXJTdG9yZS5hcHBlbmQoICRsYXllcklucHV0ICk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHQkbGF5ZXJTdG9yZS5wcmVwZW5kKCAkbGF5ZXJJbnB1dCApO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdHNlbGYuJGVsLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0XHR9ICk7XG5cdFx0XHR9XG5cblxuXHRcdFx0JC5lYWNoKCBvcHRpb25zLnByb3ZpZGVycywgc2V0dXBNYXAgKTtcblxuXHRcdFx0Ly8gLi4uIG5vIGxheWVyIGVkaXRpbmcgYWxsb3dlZFxuXHRcdFx0aWYgKCB0aGlzLiRsYXllclN0b3JlKCkubGVuZ3RoICkge1xuXHRcdFx0XHR0aGlzLmxheWVyc0NvbnRyb2wgPSBMLmNvbnRyb2wubGF5ZXJzKCBiYXNlTGF5ZXJzLCBvdmVybGF5cywge1xuXHRcdFx0XHRcdGNvbGxhcHNlZDogdHJ1ZSxcblx0XHRcdFx0XHRoaWRlU2luZ2xlQmFzZTogdHJ1ZSxcblx0XHRcdFx0fSkuYWRkVG8odGhpcy5tYXApO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0aW5pdF9nZW9jb2RlOmZ1bmN0aW9uKCkge1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdGVkaXRvcl9jb25maWcgPSB0aGlzLiRlbC5kYXRhKCkuZWRpdG9yQ29uZmlnO1xuXG5cdFx0XHR0aGlzLm1hcC5fY29udHJvbENvcm5lcnNbJ2Fib3ZlJ10gPSAkKCc8ZGl2IGNsYXNzPVwiYWNmLW9zbS1hYm92ZVwiPjwvZGl2PicpLmluc2VydEJlZm9yZSggdGhpcy4kZWwgKS5nZXQoMCk7XG5cblx0XHRcdHRoaXMuZ2VvY29kZXIgPSBMLkNvbnRyb2wuZ2VvY29kZXIoe1xuXHRcdFx0XHRjb2xsYXBzZWQ6IGZhbHNlLFxuXHRcdFx0XHRwb3NpdGlvbjonYWJvdmUnLFxuXHRcdFx0XHRwbGFjZWhvbGRlcjonU2VhcmNoLi4uJyxcblx0XHRcdFx0ZXJyb3JNZXNzYWdlOidOb3RoaW5nIGZvdW5kLi4uJyxcblx0XHRcdFx0c2hvd1Jlc3VsdEljb25zOnRydWUsXG5cdFx0XHRcdHN1Z2dlc3RNaW5MZW5ndGg6Myxcblx0XHRcdFx0c3VnZ2VzdFRpbWVvdXQ6MjUwLFxuXHRcdFx0XHRxdWVyeU1pbkxlbmd0aDozLFxuXHRcdFx0XHRkZWZhdWx0TWFya0dlb2NvZGU6ZmFsc2UsXG5cdFx0XHR9KVxuXHRcdFx0Lm9uKCdtYXJrZ2VvY29kZScsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHZhciBsYXRsbmcgPSAgZS5nZW9jb2RlLmNlbnRlcixcblx0XHRcdFx0XHRlZGl0b3JfY29uZmlnID0gc2VsZi4kZWwuZGF0YSgpLmVkaXRvckNvbmZpZyxcblx0XHRcdFx0XHRjb3VudF9tYXJrZXJzID0gc2VsZi4kbWFya2VycygpLmNoaWxkcmVuKCkubm90KCdbZGF0YS1pZF0nKS5sZW5ndGgsXG5cdFx0XHRcdFx0bGFiZWwgPSBzZWxmLl9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsKCBbIGUuZ2VvY29kZSBdLCBsYXRsbmcgKTtcblxuXHRcdFx0XHRpZiAoIGNvdW50X21hcmtlcnMgPT09IGZhbHNlIHx8IGNvdW50X21hcmtlcnMgPCBlZGl0b3JfY29uZmlnLm1heF9tYXJrZXJzICkge1xuXHRcdFx0XHRcdC8vIGFkZCBtYXJrZXIgaWYgbm8gcmVzdHJpY3Rpb24gb3IgbWF4IG1hcmtlcnMgbm90IGV4Y2VlZGVkXG5cdFx0XHRcdFx0c2VsZi5hZGRfbWFya2VyKCBsYXRsbmcsIGxhYmVsICk7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKCBlZGl0b3JfY29uZmlnLm1heF9tYXJrZXJzID09PSAxICYmIGNvdW50X21hcmtlcnMgPT09IDEgKSB7XG5cdFx0XHRcdFx0Ly8gdXBkYXRlIHNpbmdsZSBtYXJrZXJcblx0XHRcdFx0XHRtYXJrZXIgPSBzZWxmLmdldF9maXJzdF9tYXJrZXIoKTtcblx0XHRcdFx0XHRpZiAoICEhIG1hcmtlciApIHtcblx0XHRcdFx0XHRcdGVudHJ5ID0gbWFya2VyLm9zbV9jb250cm9sbGVyO1xuXHRcdFx0XHRcdFx0bWFya2VyLnNldExhdExuZyggbGF0bG5nICk7XG5cdFx0XHRcdFx0XHRlbnRyeS51cGRhdGVfbWFya2VyX2dlb2NvZGUoIGxhYmVsICk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCBlZGl0b3JfY29uZmlnLm1heF9tYXJrZXJzID09PSAwICkge1xuXHRcdFx0XHRcdHNlbGYubWFwLmZpdEJvdW5kcyggZS5nZW9jb2RlLmJib3ggKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRzZWxmLm1hcC5zZXRWaWV3KCBsYXRsbmcsIHNlbGYubWFwLmdldFpvb20oKSApOyAvLyBrZWVwIHpvb20sIG1pZ2h0IGJlIGNvbmZ1c2luZyBlbHNlXG5cdFx0XHRcdH1cblxuXHRcdFx0fSlcblx0XHRcdC5hZGRUbyggdGhpcy5tYXAgKTtcblxuXHRcdFx0Ly8gcHJldmVudCB3cCBwb3N0IGZvcm0gZnJvbSBiZWluZyBzdWJtaXR0ZWRcblx0XHRcdEwuRG9tRXZlbnQuYWRkTGlzdGVuZXIodGhpcy5nZW9jb2Rlci5faW5wdXQsICdrZXlkb3duJywgZnVuY3Rpb24oZSl7XG5cdFx0XHRcdGlmICggZS5rZXlDb2RlID09PSAxMyApIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdH1cblx0XHRcdH0sIHRoaXMuZ2VvY29kZXIgKTtcblx0XHR9LFxuXHRcdGdldF9maXJzdF9tYXJrZXI6ZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgbWFya2VyID0gZmFsc2U7XG5cdFx0XHR0aGlzLm1hcC5lYWNoTGF5ZXIoZnVuY3Rpb24obGF5ZXIpe1xuXHRcdFx0XHRpZiAoIGxheWVyLmNvbnN0cnVjdG9yID09PSBMLk1hcmtlciApIHtcblx0XHRcdFx0XHRtYXJrZXIgPSBsYXllcjtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIG1hcmtlcjtcblx0XHR9LFxuXHRcdHVwZGF0ZV92aXNpYmxlOiBmdW5jdGlvbigpIHtcblxuXHRcdFx0aWYgKCB0aGlzLnZpc2libGUgPT09IHRoaXMuJGVsLmlzKCc6dmlzaWJsZScpICkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH1cblxuXHRcdFx0dGhpcy52aXNpYmxlID0gdGhpcy4kZWwuaXMoJzp2aXNpYmxlJyk7XG5cblx0XHRcdGlmICggdGhpcy52aXNpYmxlICkge1xuXHRcdFx0XHR0aGlzLm1hcC5pbnZhbGlkYXRlU2l6ZSgpO1xuXHRcdFx0XHR0aGlzLmJpbmRfZXZlbnRzKCk7XG5cdFx0XHRcdHJldHVybiB0aGlzO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy51bmJpbmRfZXZlbnRzKCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdGluaXRfYWNmOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0dG9nZ2xlX2NiID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0Ly8gbm8gY2hhbmdlXG5cdFx0XHRcdFx0c2VsZi51cGRhdGVfdmlzaWJsZSgpO1xuXHRcdFx0XHR9O1xuXG5cdFx0XHQvLyBleHBhbmQvY29sbGFwc2UgYWNmIHNldHRpbmdcblx0XHRcdGFjZi5hZGRBY3Rpb24oICdzaG93JywgdG9nZ2xlX2NiICk7XG5cdFx0XHRhY2YuYWRkQWN0aW9uKCAnaGlkZScsIHRvZ2dsZV9jYiApO1xuXHRcdFx0YWNmLmFkZEFjdGlvbiggJ2Rpc2FibGVfZmllbGQnLCBmdW5jdGlvbigpe1xuXHRcdFx0XHRzZWxmLnVuYmluZF9ldmVudHMoKTtcblx0XHRcdH0gKTtcblxuXHRcdFx0Ly8gZXhwYW5kIHdwIG1ldGFib3hcblx0XHRcdCQoZG9jdW1lbnQpLm9uKCdwb3N0Ym94LXRvZ2dsZWQnLCB0b2dnbGVfY2IgKTtcblx0XHRcdCQoZG9jdW1lbnQpLm9uKCdjbGljaycsJy53aWRnZXQtdG9wIConLCB0b2dnbGVfY2IgKTtcblxuXG5cblx0XHR9LFxuXHRcdHVuYmluZF9ldmVudHM6ZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cdFx0XHRzZWxmLiRsYXQoKS5vZmYoJ2JsdXInKTtcblx0XHRcdHNlbGYuJGxuZygpLm9mZignYmx1cicpO1xuXHRcdFx0c2VsZi4kem9vbSgpLm9mZignYmx1cicpO1xuXHRcdFx0c2VsZi4kem9vbSgpLm9mZigna2V5dXAgZm9jdXMnKTtcblxuXHRcdFx0dGhpcy5tYXAub2ZmKCd6b29tZW5kJywgdGhpcy5tYXBfem9vbWVkLCB0aGlzICk7XG5cdFx0XHR0aGlzLm1hcC5vZmYoJ21vdmVlbmQnLCB0aGlzLm1hcF9tb3ZlZCwgdGhpcyApO1xuXHRcdH0sXG5cdFx0YmluZF9ldmVudHM6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLiRsYXQoKS5vbignYmx1cicsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHNlbGYudXBkYXRlX21hcCgpO1xuXHRcdFx0fSk7XG5cdFx0XHRzZWxmLiRsbmcoKS5vbignYmx1cicsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHNlbGYudXBkYXRlX21hcCgpO1xuXHRcdFx0fSk7XG5cdFx0XHRzZWxmLiR6b29tKCkub24oJ2JsdXInLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRzZWxmLnVwZGF0ZV9tYXAoKTtcblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLm1hcC5vbignem9vbWVuZCcsIHRoaXMubWFwX3pvb21lZCwgdGhpcyApO1xuXHRcdFx0dGhpcy5tYXAub24oJ21vdmVlbmQnLCB0aGlzLm1hcF9tb3ZlZCwgdGhpcyApO1xuXHRcdH0sXG5cdFx0dXBkYXRlX21hcDpmdW5jdGlvbigpIHtcblx0XHRcdGlmICggISB0aGlzLiRsYXQoKS52YWwoKSB8fCAhIHRoaXMuJGxuZygpLnZhbCgpICkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHR2YXIgbGF0bG5nID0gTC5sYXRMbmcoIHRoaXMuJGxhdCgpLnZhbCgpLCB0aGlzLiRsbmcoKS52YWwoKSApO1xuXHRcdFx0dGhpcy5tYXAuc2V0VmlldyggbGF0bG5nLCAgdGhpcy4kem9vbSgpLnZhbCgpICk7XG5cdFx0fSxcblx0XHRtYXBfbW92ZWQ6ZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgY2VudGVyID0gdGhpcy5tYXAuZ2V0Q2VudGVyKCk7XG5cdFx0XHR0aGlzLiRsYXQoKS52YWwoY2VudGVyLmxhdCk7XG5cdFx0XHR0aGlzLiRsbmcoKS52YWwoY2VudGVyLmxuZyk7XG5cdFx0XHR0aGlzLiRlbC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHR9LFxuXHRcdG1hcF96b29tZWQ6ZnVuY3Rpb24oZSl7XG5cdFx0XHR0aGlzLiR6b29tKCkudmFsKCB0aGlzLm1hcC5nZXRab29tKCkgKTtcblx0XHRcdHRoaXMuJGVsLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdH1cblx0fSk7XG5cblxuXHQkKGRvY3VtZW50KVxuXHRcdC5vbignYWNmLW9zbS1tYXAtaW5pdCcsZnVuY3Rpb24oIGUsIG1hcCApIHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdCQoZS50YXJnZXQpLmRhdGEoICdfbWFwX2VkaXRvcicsIG5ldyBvc20uZmllbGQoIHsgZWw6IGUudGFyZ2V0LCBtYXA6IG1hcCB9ICkgKTtcblx0XHRcdDtcblx0XHR9KVxuXHRcdC8vIGZpZWxkIHNldHRpbmdzXG5cdFx0Lm9uKCdjaGFuZ2UnLCdbZGF0YS1uYW1lPVwicmV0dXJuX2Zvcm1hdFwiXSBpbnB1dCcsZnVuY3Rpb24oZSl7XG5cdFx0XHQvLyBmaW5kIG1hcCBmaWVsZFxuXHRcdFx0JCgnW2RhdGEtbmFtZT1cInJldHVybl9mb3JtYXRcIl0gaW5wdXQ6Y2hlY2tlZCcpLnZhbCgpXG5cdFx0XHR2YXIgJG1hcCA9ICQodGhpcykuY2xvc2VzdCgnLmFjZi1maWVsZC1vYmplY3QnKS5maW5kKCdbZGF0YS1lZGl0b3ItY29uZmlnXScpLFxuXHRcdFx0XHRlZGl0b3IgPSAkbWFwLmRhdGEoICdfbWFwX2VkaXRvcicgKSxcblx0XHRcdFx0Y29uZiA9ICRtYXAuZGF0YSgnZWRpdG9yLWNvbmZpZycpO1xuXHRcdFx0Ly8gbWFwXG5cdFx0XHRlZGl0b3IucmVzZXRfbGF5ZXJzKCk7XG5cdFx0XHRpZiAoICQodGhpcykudmFsKCkgPT09ICdvc20nICkge1xuXHRcdFx0XHQvLyBzZXQgcHJvdmlkZXIgcmVzdHJpY3Rpb24gdG8gb3NtIHByb3ZpZGVyc1xuXHRcdFx0XHRjb25mLnJlc3RyaWN0X3Byb3ZpZGVycyA9IE9iamVjdC52YWx1ZXMoIGFyZy5vcHRpb25zLm9zbV9sYXllcnMgKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIHNldCBwcm92aWRlciByZXN0cmljdGlvbiB0byBvc20gcHJvdmlkZXJzXG5cdFx0XHRcdGNvbmYucmVzdHJpY3RfcHJvdmlkZXJzID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0XHQkbWFwLmRhdGEoICdlZGl0b3ItY29uZmlnJywgY29uZiApO1xuXHRcdFx0ZWRpdG9yLmluaXRfbGF5ZXJzKCk7XG5cdFx0fSk7XG5cblx0Ly8gd2hlbiBmaWVsZHMgZ2V0IGxvYWRlZCAuLi5cblx0YWNmLmFkZEFjdGlvbiggJ2FwcGVuZCcsIGZ1bmN0aW9uKCl7XG5cdFx0JC5hY2ZfbGVhZmxldCgpO1xuXHR9KTtcblxufSkoIGpRdWVyeSwgYWNmX29zbV9hZG1pbiApO1xuIl19
