!function(t){var e=acf_osm.options;console.log("input js");var s={};s.field=Backbone.View.extend({$map:null,$zoom:null,$lat:null,$lng:null,$address:null,$layers:null,marker:null,icon:null,map:null,layers:[],events:{'keyup [data-prop="address"]':"search",'focus [data-prop="address"]':"search","click .osm-result":"click_result","keyup .osm-result":"keyup_result","focus .osm-result":"focus_result"},initialize:function(){this.$map=this.$el.find(".acf-osm-map"),this.$zoom=this.$el.find('[data-prop="zoom"]'),this.$lat=this.$el.find('[data-prop="center_lat"]'),this.$lng=this.$el.find('[data-prop="center_lng"]'),this.$layers=this.$el.find('[data-prop="leaflet_layers"]'),this.$address=this.$el.find('[data-prop="address"]'),this.$results=this.$address.next(".osm-results"),this.icon=L.divIcon({className:"osm-marker",html:"",iconSize:0}),this.map=L.map(this.$map.get(0),{scrollWheelZoom:!1,center:[this.$lat.val(),this.$lng.val()],zoom:this.$zoom.val()}),this.marker=L.marker([this.$lat.val(),this.$lng.val()],{icon:this.icon,title:this.$address.val()}).addTo(this.map),this.layers=[],this.$layers.is("select")&&acf.select2.init(this.$layers,{multiple:!0,ui:!0,allow_null:!1,ajax:!1},this.$el),this.bind_events(),this.update_layers()},bind_events:function(){var t=this;this.listenTo(this.$layers,"change",this.update_layers),this.map.on("zoomend",function(e){t.map_zoomed.apply(t,[e])}),this.map.on("moveend",function(e){t.map_moved.apply(t,[e])}),this.map.on("click",function(e){t.map_clicked.apply(t,[e])})},map_moved:function(t){var e=this.map.getCenter();this.$lat.val(e.lat),this.$lng.val(e.lng)},map_zoomed:function(t){this.$zoom.val(this.map.getZoom())},map_clicked:function(t){var e=t.latlng;this.fetch_results("https://photon.komoot.de/reverse",{lon:e.lng,lat:e.lat},function(t){var s,a=0,i=t.features.length;for(a;a<i;a++){s=this.format_result(t.features[a]),this.marker.title=s,this.set_marker(e);break}}),this.set_marker(t.latlng)},set_marker:function(e){t(this.marker._icon).attr("title",this.marker.title),this.marker.setLatLng(e)},update_layers:function(){var s,a,i,r,l=[];if(null!==l){for(this.$layers.each(function(){var e=t(this).val();Array.isArray(l)?l=l.concat(e):l.push(e)});this.layers.length;)this.map.removeLayer(this.layers.pop());for(r=l.length,i=0;i<r;i++)s=l[i],a=e.layer_config[s.split(".")[0]]||{},console.log(a),this.layers.push(L.tileLayer.provider(s,a.options).addTo(this.map))}},search:function(t){var e=this,s={};if(void 0!==this._wait_address&&(clearTimeout(this._wait_address),delete this._wait_address),!s.g||s.g!==this.$address.val())return 27==t.originalEvent.keyCode?(t.preventDefault(),this.$results.html(""),this.$address.blur(),!1):void(this._wait_address=setTimeout(function(){s={q:e.$address.val(),limit:5,lon:e.$lng.val(),lat:e.$lat.val()},e.fetch_results("https://photon.komoot.de/api/",s,function(t){delete this._wait_address})},666))},clear_results:function(){this.$results.html("")},build_results:function(e){var s=this,a=e.features.length,i=this.$address.val(),r=e.features;this.clear_results(),a&&t.each(r,function(e,a){var r=t('<div tabindex="'+e+'" class="osm-result"></div>'),l=s.format_result(a),n=l.replace(new RegExp("("+i.split(/[^a-z0-9]/).join("|")+")","gi"),"<strong>$1</strong>");n+="<br /><small>("+s.nice_words(a.properties.osm_value)+")</small>",r.data({text:l,bounds:a.properties.extent,coord:a.geometry.coordinates}).html(n).appendTo(s.$results)})},fetch_results:function(e,s,a){var i=this;t.ajax({url:e,method:"get",data:s,success:function(t){i.build_results(t),"function"==typeof a&&a.apply(i,[t])}})},click_result:function(e){var s=t(e.target).data(),a=L.latLng(s.coord[1],s.coord[0]);s.ext?this.map.fitBounds(L.latLngBounds(L.latLng(s.ext[1],s.ext[0]),L.latLng(s.ext[3],s.ext[2]))):this.map.setView(a,this.map.getZoom()),this.$address.val(s.text),this.clear_results(),this.marker.title=s.text,this.set_marker(a)},keyup_result:function(e){40==e.originalEvent.keyCode?(t(e.target).next(".osm-result").focus(),e.preventDefault()):38==e.originalEvent.keyCode&&(t(e.target).prev(".osm-result").focus(),e.preventDefault())},focus_result:function(e){var s=t(e.target).data();s.ext?this.map.fitBounds(L.latLngBounds(L.latLng(s.ext[1],s.ext[0]),L.latLng(s.ext[3],s.ext[2]))):this.map.setView(L.latLng(s.coord[1],s.coord[0]),this.map.getZoom())},format_result:function(t){return this.get_result_words(t).join(", ")},get_result_words:function(e){var s=[],a=["name","street","housenumber","city","postcode","state","country"];return t.each(a,function(t,a){try{e.properties[a]&&s.push(e.properties[a])}catch(t){}}),Array.from(new Set(s))},nice_words:function(t){return t.split(/[\s_]/).map(function(t){return t[0].toUpperCase()+t.substring(1)}).join(" ")}}),void 0!==acf.add_action?acf.add_action("ready append",function(t){acf.get_fields({type:"open_street_map"},t).each(function(){new s.field({el:this})})}):t(document).on("acf/setup_fields",function(e,a){t(a).find('.field[data-field_type="open_street_map"]').each(function(){new s.field({el:this})})})}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1pbnB1dC1vc20uanMiXSwibmFtZXMiOlsiJCIsIm9wdGlvbnMiLCJhY2Zfb3NtIiwiY29uc29sZSIsImxvZyIsIm9zbSIsImZpZWxkIiwiQmFja2JvbmUiLCJWaWV3IiwiZXh0ZW5kIiwiJG1hcCIsIiR6b29tIiwiJGxhdCIsIiRsbmciLCIkYWRkcmVzcyIsIiRsYXllcnMiLCJtYXJrZXIiLCJpY29uIiwibWFwIiwibGF5ZXJzIiwiZXZlbnRzIiwia2V5dXAgW2RhdGEtcHJvcD1cImFkZHJlc3NcIl0iLCJmb2N1cyBbZGF0YS1wcm9wPVwiYWRkcmVzc1wiXSIsImNsaWNrIC5vc20tcmVzdWx0Iiwia2V5dXAgLm9zbS1yZXN1bHQiLCJmb2N1cyAub3NtLXJlc3VsdCIsImluaXRpYWxpemUiLCJ0aGlzIiwiJGVsIiwiZmluZCIsIiRyZXN1bHRzIiwibmV4dCIsIkwiLCJkaXZJY29uIiwiY2xhc3NOYW1lIiwiaHRtbCIsImljb25TaXplIiwiZ2V0Iiwic2Nyb2xsV2hlZWxab29tIiwiY2VudGVyIiwidmFsIiwiem9vbSIsInRpdGxlIiwiYWRkVG8iLCJpcyIsImFjZiIsInNlbGVjdDIiLCJpbml0IiwibXVsdGlwbGUiLCJ1aSIsImFsbG93X251bGwiLCJhamF4IiwiYmluZF9ldmVudHMiLCJ1cGRhdGVfbGF5ZXJzIiwic2VsZiIsImxpc3RlblRvIiwib24iLCJlIiwibWFwX3pvb21lZCIsImFwcGx5IiwibWFwX21vdmVkIiwibWFwX2NsaWNrZWQiLCJnZXRDZW50ZXIiLCJsYXQiLCJsbmciLCJnZXRab29tIiwiY29vcmQiLCJsYXRsbmciLCJmZXRjaF9yZXN1bHRzIiwibG9uIiwicmVzcG9uc2UiLCJmbXQiLCJpIiwibGVuIiwiZmVhdHVyZXMiLCJsZW5ndGgiLCJmb3JtYXRfcmVzdWx0Iiwic2V0X21hcmtlciIsIl9pY29uIiwiYXR0ciIsInNldExhdExuZyIsInByb3ZpZGVyIiwibGF5ZXJfY29uZmlnIiwiZWFjaCIsInYiLCJBcnJheSIsImlzQXJyYXkiLCJjb25jYXQiLCJwdXNoIiwicmVtb3ZlTGF5ZXIiLCJwb3AiLCJzcGxpdCIsInRpbGVMYXllciIsInNlYXJjaCIsImRhdGEiLCJfd2FpdF9hZGRyZXNzIiwiY2xlYXJUaW1lb3V0Iiwib3JpZ2luYWxFdmVudCIsImtleUNvZGUiLCJwcmV2ZW50RGVmYXVsdCIsImJsdXIiLCJzZXRUaW1lb3V0IiwicSIsImxpbWl0IiwiY2xlYXJfcmVzdWx0cyIsImJ1aWxkX3Jlc3VsdHMiLCJmZWF0IiwiZWwiLCIkcmVzIiwicmVwbGFjZSIsIlJlZ0V4cCIsImpvaW4iLCJuaWNlX3dvcmRzIiwicHJvcGVydGllcyIsIm9zbV92YWx1ZSIsInRleHQiLCJib3VuZHMiLCJleHRlbnQiLCJnZW9tZXRyeSIsImNvb3JkaW5hdGVzIiwiYXBwZW5kVG8iLCJ1cmwiLCJjYWxsYmFjayIsIm1ldGhvZCIsInN1Y2Nlc3MiLCJjbGlja19yZXN1bHQiLCJ0YXJnZXQiLCJsYXRMbmciLCJleHQiLCJmaXRCb3VuZHMiLCJsYXRMbmdCb3VuZHMiLCJzZXRWaWV3Iiwia2V5dXBfcmVzdWx0IiwiZm9jdXMiLCJwcmV2IiwiZm9jdXNfcmVzdWx0IiwiaGl0IiwiZ2V0X3Jlc3VsdF93b3JkcyIsImgiLCJwcm9wcyIsInByb3AiLCJlcnIiLCJmcm9tIiwiU2V0Iiwic3RyIiwicyIsInRvVXBwZXJDYXNlIiwic3Vic3RyaW5nIiwiYWRkX2FjdGlvbiIsImdldF9maWVsZHMiLCJ0eXBlIiwiZG9jdW1lbnQiLCJwb3N0Ym94IiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFVQSxHQUNULElBQUlDLEVBQVVDLFFBQVFELFFBQ3RCRSxRQUFRQyxJQUFJLFlBRVosSUFBSUMsS0FFSkEsRUFBSUMsTUFBUUMsU0FBU0MsS0FBS0MsUUFDekJDLEtBQU0sS0FDTkMsTUFBTyxLQUNQQyxLQUFNLEtBQ05DLEtBQU0sS0FDTkMsU0FBVSxLQUNWQyxRQUFTLEtBQ1RDLE9BQVEsS0FDUkMsS0FBSyxLQUNMQyxJQUFLLEtBQ0xDLFVBQ0FDLFFBQ0ND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S0FBSyxJQUFJQyxJQUFJTCxLQUUzQjFCLFdBQVksU0FBU2dDLEdBQ3BCLE9BQU9BLEVBQUlyRCxNQUFNLFNBQVN6RSxJQUFJLFNBQVMrSCxHQUFJLE9BQU9BLEVBQUUsR0FBR0MsY0FBZ0JELEVBQUVFLFVBQVUsS0FBT3BDLEtBQUssYUFNbkUsSUFBbkJsRSxJQUFJdUcsV0FnQmR2RyxJQUFJdUcsV0FBVyxlQUFnQixTQUFVeEgsR0FHeENpQixJQUFJd0csWUFBYUMsS0FBTyxtQkFBb0IxSCxHQUFLdUQsS0FBSyxXQUVyRCxJQUFJOUUsRUFBSUMsT0FBU3FHLEdBQUloRixXQXdCdkIzQixFQUFFdUosVUFBVS9GLEdBQUcsbUJBQW9CLFNBQVNDLEVBQUcrRixHQUU5Q3hKLEVBQUV3SixHQUFTM0gsS0FBSyw2Q0FBNkNzRCxLQUFLLFdBRWpFLElBQUk5RSxFQUFJQyxPQUFTcUcsR0FBSWhGLFdBaFZ6QixDQTBWRzhIIiwiZmlsZSI6ImFjZi1pbnB1dC1vc20ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCQpe1xuXHR2YXIgb3B0aW9ucyA9IGFjZl9vc20ub3B0aW9ucztcblx0Y29uc29sZS5sb2coJ2lucHV0IGpzJylcblxuXHR2YXIgb3NtID0ge1xuXHR9O1xuXHRvc20uZmllbGQgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG5cdFx0JG1hcDogbnVsbCxcblx0XHQkem9vbTogbnVsbCxcblx0XHQkbGF0OiBudWxsLFxuXHRcdCRsbmc6IG51bGwsXG5cdFx0JGFkZHJlc3M6IG51bGwsXG5cdFx0JGxheWVyczogbnVsbCxcblx0XHRtYXJrZXI6IG51bGwsXG5cdFx0aWNvbjpudWxsLFxuXHRcdG1hcDogbnVsbCxcblx0XHRsYXllcnM6W10sXG5cdFx0ZXZlbnRzOntcblx0XHRcdCdrZXl1cCBbZGF0YS1wcm9wPVwiYWRkcmVzc1wiXScgOiAnc2VhcmNoJyxcblx0XHRcdCdmb2N1cyBbZGF0YS1wcm9wPVwiYWRkcmVzc1wiXScgOiAnc2VhcmNoJyxcblxuXHRcdFx0J2NsaWNrIC5vc20tcmVzdWx0J1x0OiAnY2xpY2tfcmVzdWx0Jyxcblx0XHRcdCdrZXl1cCAub3NtLXJlc3VsdCdcdDogJ2tleXVwX3Jlc3VsdCcsXG5cdFx0XHQnZm9jdXMgLm9zbS1yZXN1bHQnXHQ6ICdmb2N1c19yZXN1bHQnLFxuXHRcdH0sXG5cdFx0aW5pdGlhbGl6ZTpmdW5jdGlvbigpIHtcblx0XHQvL1x0dGhpcy4kZWxcdFx0PSB0aGlzLmF0dHJpYnV0ZXMuJGVsO1xuXHRcdFx0dGhpcy4kbWFwXHRcdD0gdGhpcy4kZWwuZmluZCgnLmFjZi1vc20tbWFwJyk7XG5cdFx0XHR0aGlzLiR6b29tXHRcdD0gdGhpcy4kZWwuZmluZCgnW2RhdGEtcHJvcD1cInpvb21cIl0nKTtcblx0XHRcdHRoaXMuJGxhdFx0XHQ9IHRoaXMuJGVsLmZpbmQoJ1tkYXRhLXByb3A9XCJjZW50ZXJfbGF0XCJdJyk7XG5cdFx0XHR0aGlzLiRsbmdcdFx0PSB0aGlzLiRlbC5maW5kKCdbZGF0YS1wcm9wPVwiY2VudGVyX2xuZ1wiXScpO1xuXHRcdFx0dGhpcy4kbGF5ZXJzXHQ9IHRoaXMuJGVsLmZpbmQoJ1tkYXRhLXByb3A9XCJsZWFmbGV0X2xheWVyc1wiXScpO1xuXHRcdFx0dGhpcy4kYWRkcmVzc1x0PSB0aGlzLiRlbC5maW5kKCdbZGF0YS1wcm9wPVwiYWRkcmVzc1wiXScpO1xuXHRcdFx0dGhpcy4kcmVzdWx0c1x0PSB0aGlzLiRhZGRyZXNzLm5leHQoJy5vc20tcmVzdWx0cycpO1xuXHRcdFx0dGhpcy5pY29uXHRcdD0gTC5kaXZJY29uKCB7IGNsYXNzTmFtZTogJ29zbS1tYXJrZXInLCBodG1sOicnLCBpY29uU2l6ZTowIH0gKTtcblx0XHRcdHRoaXMubWFwXHRcdD0gTC5tYXAoIHRoaXMuJG1hcC5nZXQoMCksIHtcblx0XHRcdFx0c2Nyb2xsV2hlZWxab29tOiBmYWxzZSxcblx0XHRcdFx0Y2VudGVyOiBbIHRoaXMuJGxhdC52YWwoKSwgdGhpcy4kbG5nLnZhbCgpIF0sXG5cdFx0XHRcdHpvb206IHRoaXMuJHpvb20udmFsKClcblx0XHRcdH0gKTtcblx0XHRcdHRoaXMubWFya2VyXHRcdD0gTC5tYXJrZXIoXG5cdFx0XHRcdFsgdGhpcy4kbGF0LnZhbCgpLCB0aGlzLiRsbmcudmFsKCkgXSxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGljb246dGhpcy5pY29uLFxuXHRcdFx0XHRcdHRpdGxlOnRoaXMuJGFkZHJlc3MudmFsKClcblx0XHRcdFx0fVxuXHRcdFx0KS5hZGRUbyh0aGlzLm1hcCk7XG5cblx0XHRcdHRoaXMubGF5ZXJzXHQ9IFtdO1xuXHRcdFx0aWYgKCB0aGlzLiRsYXllcnMuaXMoJ3NlbGVjdCcpICkge1xuXHRcdFx0XHRhY2Yuc2VsZWN0Mi5pbml0KCB0aGlzLiRsYXllcnMsIHtcblx0XHRcdFx0XHRtdWx0aXBsZTogdHJ1ZSxcblx0XHRcdFx0XHR1aTogdHJ1ZSxcblx0XHRcdFx0XHRhbGxvd19udWxsOiBmYWxzZSxcblx0XHRcdFx0XHRhamF4OmZhbHNlLFxuXHRcdFx0XHR9LCB0aGlzLiRlbCApO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmJpbmRfZXZlbnRzKCk7XG5cblx0XHRcdHRoaXMudXBkYXRlX2xheWVycygpO1xuXHRcdH0sXG5cdFx0YmluZF9ldmVudHM6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG4vL1x0XHRcdHRoaXMubGlzdGVuVG8oIHRoaXMuJGFkZHJlc3MsICdrZXl1cCBmb2N1cycsIHRoaXMuc2VhcmNoICk7XG5cblx0XHRcdHRoaXMubGlzdGVuVG8oIHRoaXMuJGxheWVycywgJ2NoYW5nZScsIHRoaXMudXBkYXRlX2xheWVycyApO1xuXG5cdFx0XHR0aGlzLm1hcC5vbignem9vbWVuZCcsIGZ1bmN0aW9uKGUpeyBzZWxmLm1hcF96b29tZWQuYXBwbHkoc2VsZixbZV0pOyB9ICk7XG5cdFx0XHR0aGlzLm1hcC5vbignbW92ZWVuZCcsIGZ1bmN0aW9uKGUpeyBzZWxmLm1hcF9tb3ZlZC5hcHBseShzZWxmLFtlXSk7IH0gICk7XG5cdFx0XHR0aGlzLm1hcC5vbignY2xpY2snLCAgIGZ1bmN0aW9uKGUpeyBzZWxmLm1hcF9jbGlja2VkLmFwcGx5KHNlbGYsW2VdKTsgfSApO1xuXG5cdFx0XHQvLyB0aGlzLiR0aWxlcy5vbignY2hhbmdlJywgZG9fbGF5ZXJzIClcblx0XHRcdC8vIFx0LnByZXYoJ2lucHV0Jykub24oJ2NoYW5nZScsIGRvX2xheWVycyApO1xuXG5cdFx0fSxcblxuXHRcdG1hcF9tb3ZlZDpmdW5jdGlvbihlKXtcblx0XHRcdHZhciBjZW50ZXIgPSB0aGlzLm1hcC5nZXRDZW50ZXIoKTtcblx0XHRcdHRoaXMuJGxhdC52YWwoY2VudGVyLmxhdCk7XG5cdFx0XHR0aGlzLiRsbmcudmFsKGNlbnRlci5sbmcpO1xuXHRcdH0sXG5cdFx0bWFwX3pvb21lZDpmdW5jdGlvbihlKXtcblx0XHRcdHRoaXMuJHpvb20udmFsKCB0aGlzLm1hcC5nZXRab29tKCkgKTtcblx0XHR9LFxuXHRcdG1hcF9jbGlja2VkOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dmFyIGNvb3JkID0gZS5sYXRsbmc7XG5cblx0XHRcdHRoaXMuZmV0Y2hfcmVzdWx0cygnaHR0cHM6Ly9waG90b24ua29tb290LmRlL3JldmVyc2UnLCB7XG5cdFx0XHRcdGxvbjpjb29yZC5sbmcsXG5cdFx0XHRcdGxhdDpjb29yZC5sYXQsXG5cdFx0XHR9LCBmdW5jdGlvbihyZXNwb25zZSl7XG5cdFx0XHRcdHZhciBpPTAsbGVuPXJlc3BvbnNlLmZlYXR1cmVzLmxlbmd0aCxmbXQ7XG5cdFx0XHRcdGZvciAoaTtpPGxlbjtpKyspe1xuXHRcdFx0XHRcdGZtdCA9IHRoaXMuZm9ybWF0X3Jlc3VsdCggcmVzcG9uc2UuZmVhdHVyZXNbaV0gKTtcblx0XHRcdFx0XHR0aGlzLm1hcmtlci50aXRsZSA9IGZtdDtcblx0XHRcdFx0XHQvKlxuXHRcdFx0XHRcdHRoaXMuc2V0X21hcmtlciggTC5sYXRMbmcoIHJlc3BvbnNlLmZlYXR1cmVzW2ldLmdlb21ldHJ5LmNvb3JkaW5hdGVzWzFdLCByZXNwb25zZS5mZWF0dXJlc1tpXS5nZW9tZXRyeS5jb29yZGluYXRlc1swXSApICApO1xuXHRcdFx0XHRcdC8qL1xuXHRcdFx0XHRcdHRoaXMuc2V0X21hcmtlciggY29vcmQgKTtcblx0XHRcdFx0XHQvLyovXG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH0gKTtcblx0XHRcdHRoaXMuc2V0X21hcmtlciggZS5sYXRsbmcgKTtcblx0XHR9LFxuXHRcdHNldF9tYXJrZXI6ZnVuY3Rpb24oY29vcmQpe1xuXG5cdFx0XHQkKHRoaXMubWFya2VyLl9pY29uKS5hdHRyKCAndGl0bGUnLCB0aGlzLm1hcmtlci50aXRsZSApO1xuXHRcdFx0dGhpcy5tYXJrZXIuc2V0TGF0TG5nKGNvb3JkKTtcblx0XHR9LFxuXG5cdFx0dXBkYXRlX2xheWVyczogZnVuY3Rpb24oKXtcblx0XHRcdHZhciB2YWwgPSBbXSxcblx0XHRcdFx0cHJvdmlkZXIsIGxheWVyX2NvbmZpZywgaSwgbGVuO1xuXG5cdFx0XHRpZiAoIG51bGwgPT09IHZhbCApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy4kbGF5ZXJzLmVhY2goZnVuY3Rpb24oKXtcblx0XHRcdFx0dmFyIHYgPSAkKHRoaXMpLnZhbCgpO1xuXHRcdFx0XHRpZiAoIEFycmF5LmlzQXJyYXkodmFsKSApIHtcblx0XHRcdFx0XHR2YWwgPSB2YWwuY29uY2F0KHYpXG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dmFsLnB1c2godilcblx0XHRcdFx0fVxuXG5cdFx0XHR9KTtcblxuXHRcdFx0Ly8gcmVtb3ZlIGxheWVyc1xuXHRcdFx0d2hpbGUgKCB0aGlzLmxheWVycy5sZW5ndGggKSB7XG5cdFx0XHRcdHRoaXMubWFwLnJlbW92ZUxheWVyKCB0aGlzLmxheWVycy5wb3AoKSApO1xuXHRcdFx0fVxuXG5cdFx0XHRsZW4gPSB2YWwubGVuZ3RoO1xuXHRcdFx0Zm9yICggaT0wO2k8bGVuO2krKyApIHtcblx0XHRcdFx0cHJvdmlkZXIgPSB2YWxbaV07XG5cdFx0XHRcdGxheWVyX2NvbmZpZyA9IG9wdGlvbnMubGF5ZXJfY29uZmlnWyBwcm92aWRlci5zcGxpdCgnLicpWzBdIF0gfHwge307XG5cdFx0XHRcdGNvbnNvbGUubG9nKGxheWVyX2NvbmZpZyk7XG5cdFx0XHRcdHRoaXMubGF5ZXJzLnB1c2goIEwudGlsZUxheWVyLnByb3ZpZGVyKCBwcm92aWRlciwgbGF5ZXJfY29uZmlnLm9wdGlvbnMgKS5hZGRUbyh0aGlzLm1hcCkgKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0c2VhcmNoOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRkYXRhID0ge307XG5cdFx0XHRpZiAoICd1bmRlZmluZWQnICE9PSB0eXBlb2YgdGhpcy5fd2FpdF9hZGRyZXNzICkge1xuXHRcdFx0XHRjbGVhclRpbWVvdXQodGhpcy5fd2FpdF9hZGRyZXNzKTtcblx0XHRcdFx0ZGVsZXRlIHRoaXMuX3dhaXRfYWRkcmVzcztcblx0XHRcdH1cblxuXHRcdFx0aWYgKCEhIGRhdGFbJ2cnXSAmJiBkYXRhWydnJ10gPT09IHRoaXMuJGFkZHJlc3MudmFsKCkgKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCAyNyA9PSBlLm9yaWdpbmFsRXZlbnQua2V5Q29kZSApIHsgLy8gZXNjXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0dGhpcy4kcmVzdWx0cy5odG1sKCcnKTtcblx0XHRcdFx0dGhpcy4kYWRkcmVzcy5ibHVyKCk7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHRcdHRoaXMuX3dhaXRfYWRkcmVzcyA9IHNldFRpbWVvdXQoIGZ1bmN0aW9uKCl7XG5cdFx0XHRcdGRhdGEgPSB7XG5cdFx0XHRcdFx0cTpzZWxmLiRhZGRyZXNzLnZhbCgpLFxuLy9cdFx0XHRcdFx0XHRsYW5nOidkZScsIC3CtC8vIC0+IFdQLUxhbmchXG5cdFx0XHRcdFx0bGltaXQ6NSxcblx0XHRcdFx0XHRsb246c2VsZi4kbG5nLnZhbCgpLFxuXHRcdFx0XHRcdGxhdDpzZWxmLiRsYXQudmFsKCksXG5cdFx0XHRcdH07XG5cdFx0XHRcdHNlbGYuZmV0Y2hfcmVzdWx0cygnaHR0cHM6Ly9waG90b24ua29tb290LmRlL2FwaS8nLGRhdGEsIGZ1bmN0aW9uKHJlc3BvbnNlKXtcblx0XHRcdFx0XHRkZWxldGUgdGhpcy5fd2FpdF9hZGRyZXNzO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0sIDY2NiApO1xuXG5cdFx0fSxcblx0XHRjbGVhcl9yZXN1bHRzOmZ1bmN0aW9uKCl7XG5cdFx0XHR0aGlzLiRyZXN1bHRzLmh0bWwoJycpO1xuXHRcdH0sXG5cdFx0YnVpbGRfcmVzdWx0czpmdW5jdGlvbihyZXNwb25zZSl7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdGk9MCwgbGVuID0gcmVzcG9uc2UuZmVhdHVyZXMubGVuZ3RoLFxuXHRcdFx0XHRxID0gdGhpcy4kYWRkcmVzcy52YWwoKSxcblx0XHRcdFx0ZmVhdCA9IHJlc3BvbnNlLmZlYXR1cmVzOy8vc29ydF9mdXp6eSggcmVzcG9uc2UuZmVhdHVyZXMsIHEgKTtcblxuXHRcdFx0dGhpcy5jbGVhcl9yZXN1bHRzKCk7XG5cblx0XHRcdGlmICggbGVuICkge1xuXHRcdFx0XHQkLmVhY2goIGZlYXQsIGZ1bmN0aW9uKGksZWwpe1xuXHRcdFx0XHRcdHZhciAkcmVzID0gJCgnPGRpdiB0YWJpbmRleD1cIicraSsnXCIgY2xhc3M9XCJvc20tcmVzdWx0XCI+PC9kaXY+JyksXG5cdFx0XHRcdFx0XHQvLyBjb29yZCA9IGVsLmdlb21ldHJ5LmNvb3JkaW5hdGVzLFxuXHRcdFx0XHRcdFx0Ly8gZXh0ID0gZWwucHJvcGVydGllcy5leHRlbnQsXG5cdFx0XHRcdFx0XHRmbXQgPSBzZWxmLmZvcm1hdF9yZXN1bHQoIGVsICksXG5cdFx0XHRcdFx0XHRodG1sID0gZm10LnJlcGxhY2UoIG5ldyBSZWdFeHAoXCIoXCIrcS5zcGxpdCgvW15hLXowLTldLykuam9pbignfCcpK1wiKVwiLCdnaScpLFwiPHN0cm9uZz4kMTwvc3Ryb25nPlwiKTtcblx0XHRcdFx0XHRodG1sICs9ICc8YnIgLz48c21hbGw+KCcgKyBzZWxmLm5pY2Vfd29yZHMoIGVsLnByb3BlcnRpZXMub3NtX3ZhbHVlICkgKyAnKTwvc21hbGw+JztcblxuXHRcdFx0XHRcdCRyZXMuZGF0YSh7XG5cdFx0XHRcdFx0XHR0ZXh0OmZtdCxcblx0XHRcdFx0XHRcdGJvdW5kczplbC5wcm9wZXJ0aWVzLmV4dGVudCxcblx0XHRcdFx0XHRcdGNvb3JkOmVsLmdlb21ldHJ5LmNvb3JkaW5hdGVzLFxuXHRcdFx0XHRcdH0pLmh0bWwoIGh0bWwgKS5hcHBlbmRUbyhzZWxmLiRyZXN1bHRzKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHR9LFxuXHRcdGZldGNoX3Jlc3VsdHM6IGZ1bmN0aW9uKHVybCxkYXRhLCBjYWxsYmFjaykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0JC5hamF4KHtcblx0XHRcdFx0dXJsOnVybCxcblx0XHRcdFx0bWV0aG9kOidnZXQnLFxuXHRcdFx0XHRkYXRhOmRhdGEsXG5cdFx0XHRcdHN1Y2Nlc3M6ZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0XHRzZWxmLmJ1aWxkX3Jlc3VsdHMocmVzcG9uc2UpO1xuXHRcdFx0XHRcdCdmdW5jdGlvbicgPT09IHR5cGVvZiBjYWxsYmFjayAmJiBjYWxsYmFjay5hcHBseShzZWxmLFtyZXNwb25zZV0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdH0sXG5cblx0XHRjbGlja19yZXN1bHQ6ZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgZGF0YSA9ICQoZS50YXJnZXQpLmRhdGEoKSxcblx0XHRcdFx0bGF0bG5nID0gTC5sYXRMbmcoIGRhdGEuY29vcmRbMV0sIGRhdGEuY29vcmRbMF0gKTtcblxuXHRcdFx0aWYgKCBkYXRhLmV4dCApIHtcblxuXHRcdFx0XHR0aGlzLm1hcC5maXRCb3VuZHMoIEwubGF0TG5nQm91bmRzKFxuXHRcdFx0XHRcdEwubGF0TG5nKCBkYXRhLmV4dFsxXSwgZGF0YS5leHRbMF0gKSxcblx0XHRcdFx0XHRMLmxhdExuZyggZGF0YS5leHRbM10sIGRhdGEuZXh0WzJdIClcblx0XHRcdFx0KSApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5tYXAuc2V0VmlldyggbGF0bG5nLCB0aGlzLm1hcC5nZXRab29tKCkgKTtcblx0XHRcdH1cblx0XHRcdHRoaXMuJGFkZHJlc3MudmFsKCBkYXRhLnRleHQgKTtcblx0XHRcdHRoaXMuY2xlYXJfcmVzdWx0cygpO1xuXG5cdFx0XHR0aGlzLm1hcmtlci50aXRsZSA9IGRhdGEudGV4dDtcblx0XHRcdHRoaXMuc2V0X21hcmtlciggbGF0bG5nICk7XG5cdFx0fSxcblxuXHRcdGtleXVwX3Jlc3VsdDpmdW5jdGlvbihlKXtcblx0XHRcdGlmIChlLm9yaWdpbmFsRXZlbnQua2V5Q29kZSA9PSA0MCkgeyAvLyBkb3duXG5cdFx0XHRcdCQoIGUudGFyZ2V0ICkubmV4dCgnLm9zbS1yZXN1bHQnKS5mb2N1cygpO1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KClcblx0XHRcdH0gZWxzZSBpZiAoZS5vcmlnaW5hbEV2ZW50LmtleUNvZGUgPT0gMzgpIHtcblx0XHRcdFx0JCggZS50YXJnZXQgKS5wcmV2KCcub3NtLXJlc3VsdCcpLmZvY3VzKCk7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKVxuXHRcdFx0fVxuXG5cdFx0fSxcblx0XHRmb2N1c19yZXN1bHQ6ZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgZGF0YSA9ICQoZS50YXJnZXQpLmRhdGEoKTtcblxuXHRcdFx0aWYgKCBkYXRhLmV4dCApIHtcblx0XHRcdFx0dGhpcy5tYXAuZml0Qm91bmRzKCBMLmxhdExuZ0JvdW5kcyhcblx0XHRcdFx0XHRMLmxhdExuZyggZGF0YS5leHRbMV0sIGRhdGEuZXh0WzBdICksXG5cdFx0XHRcdFx0TC5sYXRMbmcoIGRhdGEuZXh0WzNdLCBkYXRhLmV4dFsyXSApXG5cdFx0XHRcdCkgKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMubWFwLnNldFZpZXcoIEwubGF0TG5nKCBkYXRhLmNvb3JkWzFdLCBkYXRhLmNvb3JkWzBdICksIHRoaXMubWFwLmdldFpvb20oKSApO1xuXHRcdFx0fVxuXG5cdFx0fSxcblxuXHRcdGZvcm1hdF9yZXN1bHQ6IGZ1bmN0aW9uKCBoaXQgKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5nZXRfcmVzdWx0X3dvcmRzKCBoaXQgKS5qb2luKCcsICcpO1xuXHRcdH0sXG5cblx0XHRnZXRfcmVzdWx0X3dvcmRzOiBmdW5jdGlvbiggaGl0ICkge1xuXG5cdFx0XHR2YXIgaCA9IFtdLFxuXHRcdFx0XHRwcm9wcyA9IFsgJ25hbWUnLCdzdHJlZXQnLCdob3VzZW51bWJlcicsJ2NpdHknLCdwb3N0Y29kZScsJ3N0YXRlJywnY291bnRyeScgXTtcblx0XHRcdCQuZWFjaChwcm9wcywgZnVuY3Rpb24oaSxwcm9wKSB7XG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0aWYgKCAhISBoaXQucHJvcGVydGllc1twcm9wXSApIHtcblx0XHRcdFx0XHRcdGgucHVzaChoaXQucHJvcGVydGllc1twcm9wXSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGNhdGNoKGVycil7fVxuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gQXJyYXkuZnJvbShuZXcgU2V0KGgpKTtcblx0XHR9LFxuXHRcdG5pY2Vfd29yZHM6IGZ1bmN0aW9uKHN0cikge1xuXHRcdFx0cmV0dXJuIHN0ci5zcGxpdCgvW1xcc19dLykubWFwKGZ1bmN0aW9uKHMpeyByZXR1cm4gc1swXS50b1VwcGVyQ2FzZSgpICsgcy5zdWJzdHJpbmcoMSk7IH0pLmpvaW4oJyAnKTtcblx0XHR9XG5cblx0fSk7XG5cblxuXHRpZiggdHlwZW9mIGFjZi5hZGRfYWN0aW9uICE9PSAndW5kZWZpbmVkJyApIHtcblxuXHRcdC8qXG5cdFx0KiAgcmVhZHkgYXBwZW5kIChBQ0Y1KVxuXHRcdCpcblx0XHQqICBUaGVzZSBhcmUgMiBldmVudHMgd2hpY2ggYXJlIGZpcmVkIGR1cmluZyB0aGUgcGFnZSBsb2FkXG5cdFx0KiAgcmVhZHkgPSBvbiBwYWdlIGxvYWQgc2ltaWxhciB0byAkKGRvY3VtZW50KS5yZWFkeSgpXG5cdFx0KiAgYXBwZW5kID0gb24gbmV3IERPTSBlbGVtZW50cyBhcHBlbmRlZCB2aWEgcmVwZWF0ZXIgZmllbGRcblx0XHQqXG5cdFx0KiAgQHR5cGVcdGV2ZW50XG5cdFx0KiAgQGRhdGVcdDIwLzA3LzEzXG5cdFx0KlxuXHRcdCogIEBwYXJhbVx0JGVsIChqUXVlcnkgc2VsZWN0aW9uKSB0aGUgalF1ZXJ5IGVsZW1lbnQgd2hpY2ggY29udGFpbnMgdGhlIEFDRiBmaWVsZHNcblx0XHQqICBAcmV0dXJuXHRuL2Fcblx0XHQqL1xuXG5cdFx0YWNmLmFkZF9hY3Rpb24oJ3JlYWR5IGFwcGVuZCcsIGZ1bmN0aW9uKCAkZWwgKXtcblxuXHRcdFx0Ly8gc2VhcmNoICRlbCBmb3IgZmllbGRzIG9mIHR5cGUgJ0ZJRUxEX05BTUUnXG5cdFx0XHRhY2YuZ2V0X2ZpZWxkcyh7IHR5cGUgOiAnb3Blbl9zdHJlZXRfbWFwJ30sICRlbCkuZWFjaChmdW5jdGlvbigpe1xuXG5cdFx0XHRcdG5ldyBvc20uZmllbGQoIHsgZWw6IHRoaXMgfSApO1xuXG5cdFx0XHR9KTtcblxuXHRcdH0pO1xuXG5cdH0gZWxzZSB7XG5cblxuXHRcdC8qXG5cdFx0KiAgYWNmL3NldHVwX2ZpZWxkcyAoQUNGNClcblx0XHQqXG5cdFx0KiAgVGhpcyBldmVudCBpcyB0cmlnZ2VyZWQgd2hlbiBBQ0YgYWRkcyBhbnkgbmV3IGVsZW1lbnRzIHRvIHRoZSBET00uXG5cdFx0KlxuXHRcdCogIEB0eXBlXHRmdW5jdGlvblxuXHRcdCogIEBzaW5jZVx0MS4wLjBcblx0XHQqICBAZGF0ZVx0MDEvMDEvMTJcblx0XHQqXG5cdFx0KiAgQHBhcmFtXHRldmVudFx0XHRlOiBhbiBldmVudCBvYmplY3QuIFRoaXMgY2FuIGJlIGlnbm9yZWRcblx0XHQqICBAcGFyYW1cdEVsZW1lbnRcdFx0cG9zdGJveDogQW4gZWxlbWVudCB3aGljaCBjb250YWlucyB0aGUgbmV3IEhUTUxcblx0XHQqXG5cdFx0KiAgQHJldHVyblx0bi9hXG5cdFx0Ki9cblxuXHRcdCQoZG9jdW1lbnQpLm9uKCdhY2Yvc2V0dXBfZmllbGRzJywgZnVuY3Rpb24oZSwgcG9zdGJveCl7XG5cblx0XHRcdCQocG9zdGJveCkuZmluZCgnLmZpZWxkW2RhdGEtZmllbGRfdHlwZT1cIm9wZW5fc3RyZWV0X21hcFwiXScpLmVhY2goZnVuY3Rpb24oKXtcblxuXHRcdFx0XHRuZXcgb3NtLmZpZWxkKCB7IGVsOiB0aGlzIH0gKTtcblxuXHRcdFx0fSk7XG5cblx0XHR9KTtcblxuXG5cdH1cblxuXG59KShqUXVlcnkpO1xuIl19
