!function(e,t){var a=t.options,i={};i.MarkerList=Backbone.View.extend({}),i.MarkerEntry=Backbone.View.extend({tagName:"div",className:"osm-marker",default_state:!0,events:{'click [data-name="locate-marker"]':"locate_marker",'click [data-name="remove-marker"]':"remove_marker",'change [type="text"]':"set_default_state"},is_default_label:function(){var e=this.$el.find('[id$="-marker-default-label"]').val();return!e||this.$el.find('[id$="-marker-label"]').val()===e},initialize:function(e){return this.template=e.template,this.marker=e.marker,this},render:function(){return this.$el.html(this.template(this)),this},update_marker:function(t,a){return this.is_default_label()&&(this.marker.unbindTooltip(),this.marker.bindTooltip(a),this.marker.options.title=a,e(this.marker._icon).attr("title",a),this.$el.find('[id$="-marker-label"]').val(this.marker.options.title)),this.$el.find('[id$="-marker-lat"]').val(t.lat),this.$el.find('[id$="-marker-lng"]').val(t.lng),this.$el.find('[id$="-marker-default-label"]').val(a),this},locate_marker:function(){return this.marker._map.flyTo(this.marker.getLatLng()),e(this.marker._icon).focus(),this},remove_marker:function(e){return e.preventDefault(),this.marker.remove(),this}}),i.field=Backbone.View.extend({map:null,geocoder:null,visible:null,events:{},$parent:function(){return this.$el.closest(".acf-field-settings,.acf-field-open-street-map")},$zoom:function(){return this.$parent().find('input[id$="-zoom"]')},$lat:function(){return this.$parent().find('input[id$="-center_lat"]')},$lng:function(){return this.$parent().find('input[id$="-center_lng"]')},$layerStore:function(){return this.$parent().find(".acf-osm-layers")},$results:function(){return this.$parent().find(".osm-results")},$markers:function(){return this.$parent().find(".osm-markers")},initialize:function(e){return this.map=e.map,this.update_map(),this.init_acf(),this.init_layers(),this.init_markers(),this.update_visible(),this},_get_geocoder_result_label:function(t,a){var i=!1;return t.length?e.each(t,function(e,t){return i=t.html?t.html:t.name,!1}):i=a.lat.toString()+", "+a.lng.toString(),e(i).text().replace(/^(\s+)/g,"").replace(/(\s+)$/g,"")},init_markers:function(){var e=this;this.icon=new L.DivIcon({html:"",className:"osm-marker-icon"}),this.init_geocode(),this.map.on("click",function(t){var a=t.latlng;e.geocoder.options.geocoder.reverse(t.latlng,e.map.getZoom(),function(t){var i=e._get_geocoder_result_label(t,a);e.add_marker(a,i)},e)}),this.map.on("layeradd",function(t){if(t.layer.constructor===L.Marker){var a=e.$markers().find('[data-id="__osm_marker_template__"]').html().split("__osm_marker_template__").join("<%= id %>"),n=new i.MarkerEntry({controller:this,marker:t.layer,id:acf.uniqid(),template:_.template(a)});n.render().$el.prependTo(e.$markers()),t.layer.setIcon(e.icon).on("click",function(e){this.remove()}).on("remove",function(e){n.$el.remove()}).on("dragend",function(t){parseInt(n.default_state)&&e.geocoder.options.geocoder.reverse(this.getLatLng(),e.map.getZoom(),function(t){var a=this.getLatLng(),i=e._get_geocoder_result_label(t,a);n.update_marker(a,i)},this)}).dragging.enable()}})},add_marker:function(e,t){L.marker(e,{title:t,icon:this.icon}).bindTooltip(t).addTo(this.map)},layer_is_overlay:function(e,t){var a;return!!(t.options.opacity&&t.options.opacity<1)||(a=["^(OpenWeatherMap|OpenSeaMap)","OpenMapSurfer.AdminBounds","Stamen.Toner(Hybrid|Lines|Labels)","Acetate.(foreground|labels|roads)","HillShading","Hydda.RoadsAndLabels","^JusticeMap","OpenInfraMap.(Power|Telecom|Petroleum|Water)","OpenPtMap","OpenRailwayMap","OpenFireMap","SafeCast","CartoDB.DarkMatterOnlyLabels","CartoDB.PositronOnlyLabels"],null!==e.match("("+a.join("|")+")"))},init_layers:function(){var t=this,i=[],n={},r={},o={},l=function(e){return null===e},s=function(d,c){var m,u;if(_.isObject(c))return e.each(c,s);l(d)||(o[d]?(m=o[d],t.map.addLayer(m)):(u=a.layer_config[d.split(".")[0]]||{options:{}},m=L.tileLayer.provider(d,u.options),m.providerKey=d),t.layer_is_overlay(d,m)?r[d]=m:n[d]=m,-1!==i.indexOf(d)&&t.map.addLayer(m))};i=this.$el.data().mapLayers,e.each(a.providers,s),this.$layerStore().length&&(this.layersControl=L.control.layers(n,r,{collapsed:!0,hideSingleBase:!0}).addTo(this.map))},init_geocode:function(){var t=this;this.map._controlCorners.above=e('<div class="acf-osm-above"></div>').insertBefore(this.$el).get(0),this.geocoder=L.Control.geocoder({collapsed:!1,position:"above",placeholder:"Search...",errorMessage:"Nothing found...",showResultIcons:!0,suggestMinLength:3,suggestTimeout:250,queryMinLength:3,defaultMarkGeocode:!1}).on("markgeocode",function(e){var a=t._get_geocoder_result_label([e.geocode],e.geocode.center);t.add_marker(e.geocode.center,a),t.map.fitBounds(e.geocode.bbox)}).addTo(this.map),L.DomEvent.addListener(this.geocoder._input,"keydown",function(e){13===e.keyCode&&e.preventDefault()},this.geocoder)},update_visible:function(){return this.visible===this.$el.is(":visible")?this:(this.visible=this.$el.is(":visible"),this.visible?(this.map.invalidateSize(),this.bind_events(),this):(this.unbind_events(),this))},init_acf:function(){var t=this,a=function(){t.update_visible()};acf.addAction("show",a),acf.addAction("hide",a),e(document).on("postbox-toggled",a),this.map.on("zoomend",function(e){t.map_zoomed.apply(t,[e])}),this.map.on("moveend",function(e){t.map_moved.apply(t,[e])}),t.$layerStore().length&&this.map.on("baselayerchange layeradd layerremove",function(e){if(e.layer.providerKey){var a=t.$layerStore(),i=t.$parent().find('[data-id="__osm_layer_template__"]');a.html(""),t.map.eachLayer(function(e){if(e.providerKey){var n=i.clone().removeAttr("data-id");n.val(e.providerKey),t.layer_is_overlay(e.providerKey,e)?a.append(n):a.prepend(n)}})}})},unbind_events:function(){var e=this;e.$lat().off("blur"),e.$lng().off("blur"),e.$zoom().off("blur"),e.$zoom().off("keyup focus")},bind_events:function(){var e=this;e.$lat().on("blur",function(t){e.update_map()}),e.$lng().on("blur",function(t){e.update_map()}),e.$zoom().on("blur",function(t){e.update_map()})},update_map:function(){if(this.$lat().val()&&this.$lng().val()){var e=L.latLng(this.$lat().val(),this.$lng().val());this.map.setView(e,this.$zoom().val())}},map_moved:function(e){var t=this.map.getCenter();this.$lat().val(t.lat),this.$lng().val(t.lng)},map_zoomed:function(e){this.$zoom().val(this.map.getZoom())}}),e(document).on("acf-osm-map-init",function(e,t){e.preventDefault(),new i.field({el:e.target,map:t})})}(jQuery,acf_osm_admin);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1pbnB1dC1vc20uanMiXSwibmFtZXMiOlsiJCIsImFyZyIsIm9wdGlvbnMiLCJvc20iLCJNYXJrZXJMaXN0IiwiQmFja2JvbmUiLCJWaWV3IiwiZXh0ZW5kIiwiTWFya2VyRW50cnkiLCJ0YWdOYW1lIiwiY2xhc3NOYW1lIiwiZGVmYXVsdF9zdGF0ZSIsImV2ZW50cyIsImNsaWNrIFtkYXRhLW5hbWU9XCJsb2NhdGUtbWFya2VyXCJdIiwiY2xpY2sgW2RhdGEtbmFtZT1cInJlbW92ZS1tYXJrZXJcIl0iLCJjaGFuZ2UgW3R5cGU9XCJ0ZXh0XCJdIiwiaXNfZGVmYXVsdF9sYWJlbCIsImRlZmF1bHRfdmFsIiwidGhpcyIsIiRlbCIsImZpbmQiLCJ2YWwiLCJpbml0aWFsaXplIiwib3B0IiwidGVtcGxhdGUiLCJtYXJrZXIiLCJyZW5kZXIiLCJodG1sIiwidXBkYXRlX21hcmtlciIsImxhdGxuZyIsImxhYmVsIiwidW5iaW5kVG9vbHRpcCIsImJpbmRUb29sdGlwIiwidGl0bGUiLCJfaWNvbiIsImF0dHIiLCJsYXQiLCJsbmciLCJsb2NhdGVfbWFya2VyIiwiX21hcCIsImZseVRvIiwiZ2V0TGF0TG5nIiwiZm9jdXMiLCJyZW1vdmVfbWFya2VyIiwiZSIsInByZXZlbnREZWZhdWx0IiwicmVtb3ZlIiwiZmllbGQiLCJtYXAiLCJnZW9jb2RlciIsInZpc2libGUiLCIkcGFyZW50IiwiY2xvc2VzdCIsIiR6b29tIiwiJGxhdCIsIiRsbmciLCIkbGF5ZXJTdG9yZSIsIiRyZXN1bHRzIiwiJG1hcmtlcnMiLCJjb25mIiwidXBkYXRlX21hcCIsImluaXRfYWNmIiwiaW5pdF9sYXllcnMiLCJpbml0X21hcmtlcnMiLCJ1cGRhdGVfdmlzaWJsZSIsIl9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsIiwibGVuZ3RoIiwiZWFjaCIsImkiLCJyZXN1bHQiLCJuYW1lIiwidG9TdHJpbmciLCJ0ZXh0IiwicmVwbGFjZSIsInNlbGYiLCJpY29uIiwiTCIsIkRpdkljb24iLCJpbml0X2dlb2NvZGUiLCJvbiIsInJldmVyc2UiLCJnZXRab29tIiwiYWRkX21hcmtlciIsImxheWVyIiwiY29uc3RydWN0b3IiLCJNYXJrZXIiLCJzcGxpdCIsImpvaW4iLCJlbnRyeSIsImNvbnRyb2xsZXIiLCJpZCIsImFjZiIsInVuaXFpZCIsIl8iLCJwcmVwZW5kVG8iLCJzZXRJY29uIiwicGFyc2VJbnQiLCJkcmFnZ2luZyIsImVuYWJsZSIsImxuZ2xhdCIsImFkZFRvIiwibGF5ZXJfaXNfb3ZlcmxheSIsImtleSIsInBhdHRlcm5zIiwib3BhY2l0eSIsIm1hdGNoIiwic2VsZWN0ZWRMYXllcnMiLCJiYXNlTGF5ZXJzIiwib3ZlcmxheXMiLCJtYXBMYXllcnMiLCJpc19vbWl0dGVkIiwic2V0dXBNYXAiLCJsYXllcl9jb25maWciLCJpc09iamVjdCIsImFkZExheWVyIiwidGlsZUxheWVyIiwicHJvdmlkZXIiLCJwcm92aWRlcktleSIsImluZGV4T2YiLCJkYXRhIiwicHJvdmlkZXJzIiwibGF5ZXJzQ29udHJvbCIsImNvbnRyb2wiLCJsYXllcnMiLCJjb2xsYXBzZWQiLCJoaWRlU2luZ2xlQmFzZSIsIl9jb250cm9sQ29ybmVycyIsImluc2VydEJlZm9yZSIsImdldCIsIkNvbnRyb2wiLCJwb3NpdGlvbiIsInBsYWNlaG9sZGVyIiwiZXJyb3JNZXNzYWdlIiwic2hvd1Jlc3VsdEljb25zIiwic3VnZ2VzdE1pbkxlbmd0aCIsInN1Z2dlc3RUaW1lb3V0IiwicXVlcnlNaW5MZW5ndGgiLCJkZWZhdWx0TWFya0dlb2NvZGUiLCJnZW9jb2RlIiwiY2VudGVyIiwiZml0Qm91bmRzIiwiYmJveCIsIkRvbUV2ZW50IiwiYWRkTGlzdGVuZXIiLCJfaW5wdXQiLCJrZXlDb2RlIiwiaXMiLCJpbnZhbGlkYXRlU2l6ZSIsImJpbmRfZXZlbnRzIiwidW5iaW5kX2V2ZW50cyIsInRvZ2dsZV9jYiIsImFkZEFjdGlvbiIsImRvY3VtZW50IiwibWFwX3pvb21lZCIsImFwcGx5IiwibWFwX21vdmVkIiwiJHRlbXBsYXRlIiwiZWFjaExheWVyIiwiJGxheWVySW5wdXQiLCJjbG9uZSIsInJlbW92ZUF0dHIiLCJhcHBlbmQiLCJwcmVwZW5kIiwib2ZmIiwibGF0TG5nIiwic2V0VmlldyIsImdldENlbnRlciIsImVsIiwidGFyZ2V0IiwialF1ZXJ5IiwiYWNmX29zbV9hZG1pbiJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FDQSxHQUFBQyxHQUFBRCxFQUFBQyxRQU1BQyxJQUdBQSxHQUFBQyxXQUFBQyxTQUFBQyxLQUFBQyxXQUVBSixFQUFBSyxZQUFBSCxTQUFBQyxLQUFBQyxRQUNBRSxRQUFBLE1BQ0FDLFVBQUEsYUFDQUMsZUFBQSxFQUNBQyxRQUNBQyxvQ0FBQSxnQkFDQUMsb0NBQUEsZ0JBQ0FDLHVCQUFBLHFCQUVBQyxpQkFBQSxXQUNBLEdBQUFDLEdBQUFDLEtBQUFDLElBQUFDLEtBQUEsaUNBQUFDLEtBQ0EsUUFBQUosR0FBQUMsS0FBQUMsSUFBQUMsS0FBQSx5QkFBQUMsUUFBQUosR0FFQUssV0FBQSxTQUFBQyxHQUtBLE1BSEFMLE1BQUFNLFNBQUFELEVBQUFDLFNBQ0FOLEtBQUFPLE9BQUFGLEVBQUFFLE9BRUFQLE1BRUFRLE9BQUEsV0FFQSxNQURBUixNQUFBQyxJQUFBUSxLQUFBVCxLQUFBTSxTQUFBTixPQUNBQSxNQUVBVSxjQUFBLFNBQUFDLEVBQUFDLEdBa0JBLE1BaEJBWixNQUFBRixxQkFFQUUsS0FBQU8sT0FBQU0sZ0JBQ0FiLEtBQUFPLE9BQUFPLFlBQUFGLEdBRUFaLEtBQUFPLE9BQUF2QixRQUFBK0IsTUFBQUgsRUFDQTlCLEVBQUFrQixLQUFBTyxPQUFBUyxPQUFBQyxLQUFBLFFBQUFMLEdBR0FaLEtBQUFDLElBQUFDLEtBQUEseUJBQUFDLElBQUFILEtBQUFPLE9BQUF2QixRQUFBK0IsUUFHQWYsS0FBQUMsSUFBQUMsS0FBQSx1QkFBQUMsSUFBQVEsRUFBQU8sS0FDQWxCLEtBQUFDLElBQUFDLEtBQUEsdUJBQUFDLElBQUFRLEVBQUFRLEtBQ0FuQixLQUFBQyxJQUFB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QXdCLEdBQUEsT0FBQSxTQUFBbkMsR0FDQThCLEVBQUFkLGVBRUFjLEVBQUFyQixRQUFBMEIsR0FBQSxPQUFBLFNBQUFuQyxHQUNBOEIsRUFBQWQsZ0JBYUFBLFdBQUEsV0FDQSxHQUFBMUMsS0FBQW9DLE9BQUFqQyxPQUFBSCxLQUFBcUMsT0FBQWxDLE1BQUEsQ0FHQSxHQUFBUSxHQUFBK0MsRUFBQXdGLE9BQUFsSixLQUFBb0MsT0FBQWpDLE1BQUFILEtBQUFxQyxPQUFBbEMsTUFDQUgsTUFBQThCLElBQUFxSCxRQUFBeEksRUFBQVgsS0FBQW1DLFFBQUFoQyxTQUVBc0ksVUFBQSxTQUFBL0csR0FDQSxHQUFBK0YsR0FBQXpILEtBQUE4QixJQUFBc0gsV0FDQXBKLE1BQUFvQyxPQUFBakMsSUFBQXNILEVBQUF2RyxLQUNBbEIsS0FBQXFDLE9BQUFsQyxJQUFBc0gsRUFBQXRHLE1BRUFvSCxXQUFBLFNBQUE3RyxHQUNBMUIsS0FBQW1DLFFBQUFoQyxJQUFBSCxLQUFBOEIsSUFBQWlDLGNBaUJBakYsRUFBQXdKLFVBQUF6RSxHQUFBLG1CQUFBLFNBQUFuQyxFQUFBSSxHQUNBSixFQUFBQyxpQkFDQSxHQUFBMUMsR0FBQTRDLE9BQUF3SCxHQUFBM0gsRUFBQTRILE9BQUF4SCxJQUFBQSxPQUlBeUgsT0FBQUMiLCJmaWxlIjoiYWNmLWlucHV0LW9zbS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oICQsIGFyZyApe1xuXHR2YXIgb3B0aW9ucyA9IGFyZy5vcHRpb25zLFxuXHRcdHJlc3VsdF90cGwgPSAnPGRpdiB0YWJpbmRleD1cIjwlPSBkYXRhLmkgJT5cIiBjbGFzcz1cIm9zbS1yZXN1bHRcIj4nXG5cdFx0XHQrICc8JT0gZGF0YS5yZXN1bHRfdGV4dCAlPidcblx0XHRcdCsgJzxiciAvPjxzbWFsbD48JT0gZGF0YS5wcm9wZXJ0aWVzLm9zbV92YWx1ZSAlPjwvc21hbGw+J1xuXHRcdFx0KyAnPC9kaXY+JztcblxuXHR2YXIgb3NtID0ge1xuXHR9O1xuXG5cdG9zbS5NYXJrZXJMaXN0ID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXHR9KVxuXHRvc20uTWFya2VyRW50cnkgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG5cdFx0dGFnTmFtZTogJ2RpdicsXG5cdFx0Y2xhc3NOYW1lOidvc20tbWFya2VyJyxcblx0XHRkZWZhdWx0X3N0YXRlOiB0cnVlLFxuXHRcdGV2ZW50czoge1xuXHRcdFx0J2NsaWNrIFtkYXRhLW5hbWU9XCJsb2NhdGUtbWFya2VyXCJdJyA6ICdsb2NhdGVfbWFya2VyJyxcblx0XHRcdCdjbGljayBbZGF0YS1uYW1lPVwicmVtb3ZlLW1hcmtlclwiXScgOiAncmVtb3ZlX21hcmtlcicsXG5cdFx0XHQnY2hhbmdlIFt0eXBlPVwidGV4dFwiXScgXHRcdFx0XHQ6ICdzZXRfZGVmYXVsdF9zdGF0ZScsXG5cdFx0fSxcblx0XHRpc19kZWZhdWx0X2xhYmVsOiBmdW5jdGlvbigpe1xuXHRcdFx0dmFyIGRlZmF1bHRfdmFsID0gdGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItZGVmYXVsdC1sYWJlbFwiXScpLnZhbCgpO1xuXHRcdFx0cmV0dXJuICggISBkZWZhdWx0X3ZhbCApIHx8ICggdGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItbGFiZWxcIl0nKS52YWwoKSA9PT0gZGVmYXVsdF92YWwgKTtcblx0XHR9LFxuXHRcdGluaXRpYWxpemU6ZnVuY3Rpb24ob3B0KXtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblx0XHRcdHRoaXMudGVtcGxhdGUgPSBvcHQudGVtcGxhdGU7XG5cdFx0XHR0aGlzLm1hcmtlciA9IG9wdC5tYXJrZXI7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0cmVuZGVyOmZ1bmN0aW9uKCl7XG5cdFx0XHR0aGlzLiRlbC5odG1sKCB0aGlzLnRlbXBsYXRlKCB0aGlzICkgKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0dXBkYXRlX21hcmtlcjpmdW5jdGlvbiggbGF0bG5nLCBsYWJlbCApIHtcblxuXHRcdFx0aWYgKCB0aGlzLmlzX2RlZmF1bHRfbGFiZWwoKSApIHtcblx0XHRcdFx0Ly8gdXBkYXRlIG1hcmtlciBsYWJlbHNcblx0XHRcdFx0dGhpcy5tYXJrZXIudW5iaW5kVG9vbHRpcCgpO1xuXHRcdFx0XHR0aGlzLm1hcmtlci5iaW5kVG9vbHRpcChsYWJlbCk7XG5cblx0XHRcdFx0dGhpcy5tYXJrZXIub3B0aW9ucy50aXRsZSA9IGxhYmVsO1xuXHRcdFx0XHQkKCB0aGlzLm1hcmtlci5faWNvbiApLmF0dHIoICd0aXRsZScsIGxhYmVsICk7XG5cblx0XHRcdFx0Ly8gdXBkYXRlIG1hcmtlciBsYWJlbCBpbnB1dFxuXHRcdFx0XHR0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1sYWJlbFwiXScpLnZhbCggdGhpcy5tYXJrZXIub3B0aW9ucy50aXRsZSApO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1sYXRcIl0nKS52YWwoIGxhdGxuZy5sYXQgKTtcblx0XHRcdHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWxuZ1wiXScpLnZhbCggbGF0bG5nLmxuZyApO1xuXHRcdFx0dGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItZGVmYXVsdC1sYWJlbFwiXScpLnZhbCggbGFiZWwgKTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRsb2NhdGVfbWFya2VyOmZ1bmN0aW9uKCl7XG5cdFx0XHR0aGlzLm1hcmtlci5fbWFwLmZseVRvKCB0aGlzLm1hcmtlci5nZXRMYXRMbmcoKSApO1xuXHRcdFx0JCh0aGlzLm1hcmtlci5faWNvbikuZm9jdXMoKVxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRyZW1vdmVfbWFya2VyOmZ1bmN0aW9uKGUpIHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKVxuXHRcdFx0dGhpcy5tYXJrZXIucmVtb3ZlKCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cdH0pO1xuXG5cdG9zbS5maWVsZCA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcblx0XHQvKlxuXHRcdHRvZG86XG5cdFx0LSBNYXAgTGF5ZXIgc2VsZWN0b3Jcblx0XHQtIHNldCAvIHVuc2V0IG1hcmtlclxuXHRcdCovXG5cblx0XHRtYXA6IG51bGwsXG5cdFx0Z2VvY29kZXI6IG51bGwsXG5cdFx0dmlzaWJsZTogbnVsbCxcblx0XHRldmVudHM6e1xuXHRcdH0sXG5cblx0XHQkcGFyZW50OmZ1bmN0aW9uKCl7XG5cdFx0XHRyZXR1cm4gdGhpcy4kZWwuY2xvc2VzdCgnLmFjZi1maWVsZC1zZXR0aW5ncywuYWNmLWZpZWxkLW9wZW4tc3RyZWV0LW1hcCcpXG5cdFx0fSxcblx0XHQkem9vbSA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJ2lucHV0W2lkJD1cIi16b29tXCJdJyk7XG5cdFx0fSxcblx0XHQkbGF0IDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnaW5wdXRbaWQkPVwiLWNlbnRlcl9sYXRcIl0nKTtcblx0XHR9LFxuXHRcdCRsbmcgOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCdpbnB1dFtpZCQ9XCItY2VudGVyX2xuZ1wiXScpO1xuXHRcdH0sXG5cdFx0JGxheWVyU3RvcmU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJy5hY2Ytb3NtLWxheWVycycpO1xuXHRcdH0sXG5cdFx0JHJlc3VsdHMgOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCcub3NtLXJlc3VsdHMnKTtcblx0XHR9LFxuXHRcdCRtYXJrZXJzOmZ1bmN0aW9uKCl7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnLm9zbS1tYXJrZXJzJyk7XG5cdFx0fSxcblx0XHRpbml0aWFsaXplOmZ1bmN0aW9uKGNvbmYpIHtcblxuXHRcdFx0dGhpcy5tYXBcdFx0PSBjb25mLm1hcDtcblxuXHRcdFx0dGhpcy51cGRhdGVfbWFwKCk7IC8vIHNldCBtYXAgdG8gaW5wdXQgdmFsdWVzXG5cblx0XHRcdHRoaXMuaW5pdF9hY2YoKTtcblxuXHRcdFx0dGhpcy5pbml0X2xheWVycygpO1xuXG5cdFx0XHR0aGlzLmluaXRfbWFya2VycygpO1xuXG5cdFx0XHR0aGlzLnVwZGF0ZV92aXNpYmxlKCk7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0X2dldF9nZW9jb2Rlcl9yZXN1bHRfbGFiZWw6ZnVuY3Rpb24oIGUsIGxhdGxuZyApIHtcblx0XHRcdHZhciBsYWJlbCA9IGZhbHNlO1xuXG5cdFx0XHRpZiAoICEgZS5sZW5ndGggKSB7XG5cdFx0XHRcdGxhYmVsID0gbGF0bG5nLmxhdC50b1N0cmluZygpICsgJywgJyArIGxhdGxuZy5sbmcudG9TdHJpbmcoKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCQuZWFjaCggZSwgZnVuY3Rpb24oIGksIHJlc3VsdCApIHtcblx0XHRcdFx0XHRpZiAoICEhIHJlc3VsdC5odG1sICkge1xuXHRcdFx0XHRcdFx0bGFiZWwgPSByZXN1bHQuaHRtbDtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0bGFiZWwgPSByZXN1bHQubmFtZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRcdHJldHVybiAkKGxhYmVsKS50ZXh0KCkucmVwbGFjZSgvXihcXHMrKS9nLCcnKS5yZXBsYWNlKC8oXFxzKykkL2csJycpO1xuXHRcdH0sXG5cdFx0aW5pdF9tYXJrZXJzOmZ1bmN0aW9uKCl7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0dGhpcy5pY29uID0gbmV3IEwuRGl2SWNvbih7XG5cdFx0XHRcdGh0bWw6ICcnLFxuXHRcdFx0XHRjbGFzc05hbWU6J29zbS1tYXJrZXItaWNvbidcblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLmluaXRfZ2VvY29kZSgpO1xuXG5cdFx0XHR0aGlzLm1hcC5vbignY2xpY2snLCBmdW5jdGlvbihlKXtcblx0XHRcdFx0dmFyIGxhdGxuZyA9IGUubGF0bG5nO1xuXHRcdFx0XHRzZWxmLmdlb2NvZGVyLm9wdGlvbnMuZ2VvY29kZXIucmV2ZXJzZShlLmxhdGxuZyxzZWxmLm1hcC5nZXRab29tKCksZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0dmFyIGxhYmVsID0gc2VsZi5fZ2V0X2dlb2NvZGVyX3Jlc3VsdF9sYWJlbCggZSwgbGF0bG5nICk7XG5cdFx0XHRcdFx0c2VsZi5hZGRfbWFya2VyKCBsYXRsbmcsIGxhYmVsICk7XG5cdFx0XHRcdH0sc2VsZik7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5tYXAub24oICdsYXllcmFkZCcsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRpZiAoIGUubGF5ZXIuY29uc3RydWN0b3IgIT09IEwuTWFya2VyICkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0XHR2YXIgdGVtcGxhdGUgPSBzZWxmLiRtYXJrZXJzKCkuZmluZCgnW2RhdGEtaWQ9XCJfX29zbV9tYXJrZXJfdGVtcGxhdGVfX1wiXScpLmh0bWwoKS5zcGxpdCgnX19vc21fbWFya2VyX3RlbXBsYXRlX18nKS5qb2luKCAnPCU9IGlkICU+JyApLFxuXHRcdFx0XHRcdGVudHJ5ID0gbmV3IG9zbS5NYXJrZXJFbnRyeSh7XG5cdFx0XHRcdFx0XHRjb250cm9sbGVyOiB0aGlzLFxuXHRcdFx0XHRcdFx0bWFya2VyOiBlLmxheWVyLFxuXHRcdFx0XHRcdFx0aWQ6IGFjZi51bmlxaWQoKSwgLy9zZWxmLiRtYXJrZXJzKCkuY2hpbGRyZW4oKS5sZW5ndGgsXG5cdFx0XHRcdFx0XHR0ZW1wbGF0ZTogXy50ZW1wbGF0ZSggdGVtcGxhdGUgKSxcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRlbnRyeS5yZW5kZXIoKS4kZWwucHJlcGVuZFRvKCBzZWxmLiRtYXJrZXJzKCkgKTtcblxuXHRcdFx0XHRlLmxheWVyXG5cdFx0XHRcdFx0LnNldEljb24oIHNlbGYuaWNvbiApXG5cdFx0XHRcdFx0Lm9uKCdjbGljaycsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0XHR0aGlzLnJlbW92ZSgpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0Lm9uKCdyZW1vdmUnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdFx0ZW50cnkuJGVsLnJlbW92ZSgpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0Lm9uKCdkcmFnZW5kJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRcdGlmICggISBwYXJzZUludCggZW50cnkuZGVmYXVsdF9zdGF0ZSApICkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRzZWxmLmdlb2NvZGVyLm9wdGlvbnMuZ2VvY29kZXIucmV2ZXJzZSh0aGlzLmdldExhdExuZygpLHNlbGYubWFwLmdldFpvb20oKSxmdW5jdGlvbihlKXtcblxuXHRcdFx0XHRcdFx0XHR2YXIgbGF0bG5nID0gdGhpcy5nZXRMYXRMbmcoKSxcblx0XHRcdFx0XHRcdFx0XHRsYWJlbCA9IHNlbGYuX2dldF9nZW9jb2Rlcl9yZXN1bHRfbGFiZWwoIGUsIGxhdGxuZyApO1xuXHRcdFx0XHRcdFx0XHRlbnRyeS51cGRhdGVfbWFya2VyKCBsYXRsbmcsIGxhYmVsICk7XG5cblx0XHRcdFx0XHRcdH0sIHRoaXMgKTtcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5kcmFnZ2luZy5lbmFibGUoKTtcblx0XHRcdH0gKTtcblx0XHR9LFxuXHRcdGFkZF9tYXJrZXI6ZnVuY3Rpb24oIGxuZ2xhdCwgbGFiZWwgKXtcblx0XHRcdEwubWFya2VyKGxuZ2xhdCx7XG5cdFx0XHRcdHRpdGxlOiBsYWJlbCxcblx0XHRcdFx0aWNvbjogdGhpcy5pY29uLFxuXHRcdFx0fSlcblx0XHRcdFx0LmJpbmRUb29sdGlwKCBsYWJlbCApXG5cdFx0XHRcdC5hZGRUbyggdGhpcy5tYXAgKTtcblx0XHR9LFxuXHRcdGxheWVyX2lzX292ZXJsYXk6IGZ1bmN0aW9uKCAga2V5LCBsYXllciApIHtcblx0XHRcdHZhciBwYXR0ZXJucztcblxuXHRcdFx0aWYgKCBsYXllci5vcHRpb25zLm9wYWNpdHkgJiYgbGF5ZXIub3B0aW9ucy5vcGFjaXR5IDwgMSApIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0XHRwYXR0ZXJucyA9IFsnXihPcGVuV2VhdGhlck1hcHxPcGVuU2VhTWFwKScsXG5cdFx0XHRcdCdPcGVuTWFwU3VyZmVyLkFkbWluQm91bmRzJyxcblx0XHRcdFx0J1N0YW1lbi5Ub25lcihIeWJyaWR8TGluZXN8TGFiZWxzKScsXG5cdFx0XHRcdCdBY2V0YXRlLihmb3JlZ3JvdW5kfGxhYmVsc3xyb2FkcyknLFxuXHRcdFx0XHQnSGlsbFNoYWRpbmcnLFxuXHRcdFx0XHQnSHlkZGEuUm9hZHNBbmRMYWJlbHMnLFxuXHRcdFx0XHQnXkp1c3RpY2VNYXAnLFxuXHRcdFx0XHQnT3BlbkluZnJhTWFwLihQb3dlcnxUZWxlY29tfFBldHJvbGV1bXxXYXRlciknLFxuXHRcdFx0XHQnT3BlblB0TWFwJyxcblx0XHRcdFx0J09wZW5SYWlsd2F5TWFwJyxcblx0XHRcdFx0J09wZW5GaXJlTWFwJyxcblx0XHRcdFx0J1NhZmVDYXN0Jyxcblx0XHRcdFx0J0NhcnRvREIuRGFya01hdHRlck9ubHlMYWJlbHMnLFxuXHRcdFx0XHQnQ2FydG9EQi5Qb3NpdHJvbk9ubHlMYWJlbHMnXG5cdFx0XHRdO1xuXHRcdFx0cmV0dXJuIGtleS5tYXRjaCgnKCcgKyBwYXR0ZXJucy5qb2luKCd8JykgKyAnKScpICE9PSBudWxsO1xuXHRcdH0sXG5cdFx0aW5pdF9sYXllcnM6ZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdHNlbGVjdGVkTGF5ZXJzID0gW10sXG5cdFx0XHRcdGJhc2VMYXllcnMgPSB7fSxcblx0XHRcdFx0b3ZlcmxheXMgPSB7fSxcblx0XHRcdFx0bWFwTGF5ZXJzID0ge30sXG5cdFx0XHRcdGlzX29taXR0ZWQgPSBmdW5jdGlvbihrZXkpIHtcblxuXHRcdFx0XHRcdHJldHVybiBrZXkgPT09IG51bGw7XG5cdFx0XHRcdH0sXG5cdFx0XHRcdHNldHVwTWFwID0gZnVuY3Rpb24oIGtleSwgdmFsICl7XG5cdFx0XHRcdFx0dmFyIGxheWVyLCBsYXllcl9jb25maWc7XG5cdFx0XHRcdFx0aWYgKCBfLmlzT2JqZWN0KHZhbCkgKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gJC5lYWNoKCB2YWwsIHNldHVwTWFwICk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCBpc19vbWl0dGVkKGtleSkgKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICggISEgbWFwTGF5ZXJzWyBrZXkgXSApIHtcblx0XHRcdFx0XHRcdGxheWVyID0gbWFwTGF5ZXJzWyBrZXkgXTtcblx0XHRcdFx0XHRcdHNlbGYubWFwLmFkZExheWVyKGxheWVyKVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRsYXllcl9jb25maWcgPSBvcHRpb25zLmxheWVyX2NvbmZpZ1sga2V5LnNwbGl0KCcuJylbMF0gXSB8fCB7b3B0aW9uczp7fX07XG5cdFx0XHRcdFx0XHRsYXllciA9IEwudGlsZUxheWVyLnByb3ZpZGVyKCBrZXksIGxheWVyX2NvbmZpZy5vcHRpb25zICk7XG5cdFx0XHRcdFx0XHRsYXllci5wcm92aWRlcktleSA9IGtleTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIHNlbGYubGF5ZXJfaXNfb3ZlcmxheSgga2V5LCBsYXllciApICkge1xuXHRcdFx0XHRcdFx0b3ZlcmxheXNba2V5XSA9IGxheWVyO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRiYXNlTGF5ZXJzW2tleV0gPSBsYXllcjtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIHNlbGVjdGVkTGF5ZXJzLmluZGV4T2YoIGtleSApICE9PSAtMSApIHtcblx0XHRcdFx0XHRcdHNlbGYubWFwLmFkZExheWVyKGxheWVyKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH07XG5cblx0XHRcdHNlbGVjdGVkTGF5ZXJzID0gdGhpcy4kZWwuZGF0YSgpLm1hcExheWVycztcblxuXG5cdFx0XHQkLmVhY2goIG9wdGlvbnMucHJvdmlkZXJzLCBzZXR1cE1hcCApO1xuXG5cdFx0XHQvLyAuLi4gbm8gbGF5ZXIgZWRpdGluZyBhbGxvd2VkXG5cdFx0XHRpZiAoICEgdGhpcy4kbGF5ZXJTdG9yZSgpLmxlbmd0aCApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmxheWVyc0NvbnRyb2wgPSBMLmNvbnRyb2wubGF5ZXJzKCBiYXNlTGF5ZXJzLCBvdmVybGF5cywge1xuXHRcdFx0XHRjb2xsYXBzZWQ6IHRydWUsXG5cdFx0XHRcdGhpZGVTaW5nbGVCYXNlOiB0cnVlLFxuXHRcdFx0fSkuYWRkVG8odGhpcy5tYXApO1xuXG5cdFx0fSxcblx0XHRpbml0X2dlb2NvZGU6ZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0dGhpcy5tYXAuX2NvbnRyb2xDb3JuZXJzWydhYm92ZSddID0gJCgnPGRpdiBjbGFzcz1cImFjZi1vc20tYWJvdmVcIj48L2Rpdj4nKS5pbnNlcnRCZWZvcmUoIHRoaXMuJGVsICkuZ2V0KDApO1xuXG5cdFx0XHR0aGlzLmdlb2NvZGVyID0gTC5Db250cm9sLmdlb2NvZGVyKHtcblx0XHRcdFx0Y29sbGFwc2VkOiBmYWxzZSxcblx0XHRcdFx0cG9zaXRpb246J2Fib3ZlJyxcblx0XHRcdFx0cGxhY2Vob2xkZXI6J1NlYXJjaC4uLicsXG5cdFx0XHRcdGVycm9yTWVzc2FnZTonTm90aGluZyBmb3VuZC4uLicsXG5cdFx0XHRcdHNob3dSZXN1bHRJY29uczp0cnVlLFxuXHRcdFx0XHRzdWdnZXN0TWluTGVuZ3RoOjMsXG5cdFx0XHRcdHN1Z2dlc3RUaW1lb3V0OjI1MCxcblx0XHRcdFx0cXVlcnlNaW5MZW5ndGg6Myxcblx0XHRcdFx0ZGVmYXVsdE1hcmtHZW9jb2RlOmZhbHNlLFxuXHRcdFx0fSlcblx0XHRcdC5vbignbWFya2dlb2NvZGUnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHQvL2NvbnNvbGUubG9nKGUuZ2VvY29kZS5jbmV0ZXIpO3JldHVybjtcblx0XHRcdFx0dmFyIGxhYmVsID0gc2VsZi5fZ2V0X2dlb2NvZGVyX3Jlc3VsdF9sYWJlbCggW2UuZ2VvY29kZV0sIGUuZ2VvY29kZS5jZW50ZXIgKTtcblx0XHRcdFx0c2VsZi5hZGRfbWFya2VyKCBlLmdlb2NvZGUuY2VudGVyLCBsYWJlbCApO1xuXHRcdFx0XHQvKlxuXHRcdFx0XHRzZWxmLm1hcC5mbHlUb0JvdW5kcyhlLmdlb2NvZGUuYmJveCk7XG5cdFx0XHRcdC8qL1xuXHRcdFx0XHRzZWxmLm1hcC5maXRCb3VuZHMoZS5nZW9jb2RlLmJib3gpO1xuXHRcdFx0XHQvLyovXG5cbi8vXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR9KVxuXHRcdFx0LmFkZFRvKCB0aGlzLm1hcCApO1xuXG5cdFx0XHQvLyBwcmV2ZW50IHdwIHBvc3QgZm9ybSBmcm9tIGJlaW5nIHN1Ym1pdHRlZFxuXHRcdFx0TC5Eb21FdmVudC5hZGRMaXN0ZW5lcih0aGlzLmdlb2NvZGVyLl9pbnB1dCwgJ2tleWRvd24nLCBmdW5jdGlvbihlKXtcblx0XHRcdFx0aWYgKCBlLmtleUNvZGUgPT09IDEzICkge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSwgdGhpcy5nZW9jb2RlciApO1xuXHRcdH0sXG5cdFx0dXBkYXRlX3Zpc2libGU6IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRpZiAoIHRoaXMudmlzaWJsZSA9PT0gdGhpcy4kZWwuaXMoJzp2aXNpYmxlJykgKSB7XG5cdFx0XHRcdHJldHVybiB0aGlzO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnZpc2libGUgPSB0aGlzLiRlbC5pcygnOnZpc2libGUnKTtcblxuXHRcdFx0aWYgKCB0aGlzLnZpc2libGUgKSB7XG5cdFx0XHRcdHRoaXMubWFwLmludmFsaWRhdGVTaXplKCk7XG5cdFx0XHRcdHRoaXMuYmluZF9ldmVudHMoKTtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLnVuYmluZF9ldmVudHMoKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0aW5pdF9hY2Y6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHR0b2dnbGVfY2IgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHQvLyBubyBjaGFuZ2Vcblx0XHRcdFx0XHRzZWxmLnVwZGF0ZV92aXNpYmxlKCk7XG5cdFx0XHRcdH07XG5cblx0XHRcdC8vIGV4cGFuZC9jb2xsYXBzZSBhY2Ygc2V0dGluZ1xuXHRcdFx0YWNmLmFkZEFjdGlvbiggJ3Nob3cnLCB0b2dnbGVfY2IgKTtcblx0XHRcdGFjZi5hZGRBY3Rpb24oICdoaWRlJywgdG9nZ2xlX2NiICk7XG5cblxuXG5cdFx0XHQvLyBleHBhbmQgYWNmIHJlcGVhdGVyXG5cdFx0XHQvLyAuLi5cblxuXHRcdFx0Ly8gZXhwYW5kIGFjZiBsYXlvdXRcblx0XHRcdC8vIC4uLlxuXG5cdFx0XHQvLyBleHBhbmQgd3AgbWV0YWJveFxuXHRcdFx0JChkb2N1bWVudCkub24oJ3Bvc3Rib3gtdG9nZ2xlZCcsdG9nZ2xlX2NiKVxuXG5cblx0XHRcdHRoaXMubWFwLm9uKCd6b29tZW5kJywgZnVuY3Rpb24oZSl7IHNlbGYubWFwX3pvb21lZC5hcHBseSggc2VsZiwgW2VdICk7IH0gKTtcblx0XHRcdHRoaXMubWFwLm9uKCdtb3ZlZW5kJywgZnVuY3Rpb24oZSl7IHNlbGYubWFwX21vdmVkLmFwcGx5KCBzZWxmLCBbZV0gKTsgfSApO1xuXHRcdFx0aWYgKCAhIHNlbGYuJGxheWVyU3RvcmUoKS5sZW5ndGggKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5tYXAub24oICdiYXNlbGF5ZXJjaGFuZ2UgbGF5ZXJhZGQgbGF5ZXJyZW1vdmUnLCBmdW5jdGlvbihlKXtcblx0XHRcdFx0aWYgKCAhIGUubGF5ZXIucHJvdmlkZXJLZXkpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdFx0dmFyICRsYXllclN0b3JlID0gc2VsZi4kbGF5ZXJTdG9yZSgpLFxuXHRcdFx0XHRcdCR0ZW1wbGF0ZSA9IHNlbGYuJHBhcmVudCgpLmZpbmQoJ1tkYXRhLWlkPVwiX19vc21fbGF5ZXJfdGVtcGxhdGVfX1wiXScpO1xuXG5cdFx0XHRcdCRsYXllclN0b3JlLmh0bWwoJycpO1xuXG5cdFx0XHRcdHNlbGYubWFwLmVhY2hMYXllcihmdW5jdGlvbihsYXllcikge1xuXHRcdFx0XHRcdGlmICggISBsYXllci5wcm92aWRlcktleSApIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0dmFyICRsYXllcklucHV0ID0gJHRlbXBsYXRlLmNsb25lKCkucmVtb3ZlQXR0cignZGF0YS1pZCcpO1xuXHRcdFx0XHRcdCRsYXllcklucHV0LnZhbCggbGF5ZXIucHJvdmlkZXJLZXkgKTtcblxuXHRcdFx0XHRcdGlmICggc2VsZi5sYXllcl9pc19vdmVybGF5KCBsYXllci5wcm92aWRlcktleSwgbGF5ZXIgKSApIHtcblx0XHRcdFx0XHRcdCRsYXllclN0b3JlLmFwcGVuZCggJGxheWVySW5wdXQgKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0JGxheWVyU3RvcmUucHJlcGVuZCggJGxheWVySW5wdXQgKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHR9ICk7XG5cdFx0fSxcblx0XHR1bmJpbmRfZXZlbnRzOmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0c2VsZi4kbGF0KCkub2ZmKCdibHVyJyk7XG5cdFx0XHRzZWxmLiRsbmcoKS5vZmYoJ2JsdXInKTtcblx0XHRcdHNlbGYuJHpvb20oKS5vZmYoJ2JsdXInKTtcblx0XHRcdHNlbGYuJHpvb20oKS5vZmYoJ2tleXVwIGZvY3VzJyk7XG5cdFx0fSxcblx0XHRiaW5kX2V2ZW50czogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHNlbGYuJGxhdCgpLm9uKCdibHVyJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0c2VsZi51cGRhdGVfbWFwKCk7XG5cdFx0XHR9KTtcblx0XHRcdHNlbGYuJGxuZygpLm9uKCdibHVyJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0c2VsZi51cGRhdGVfbWFwKCk7XG5cdFx0XHR9KTtcblx0XHRcdHNlbGYuJHpvb20oKS5vbignYmx1cicsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHNlbGYudXBkYXRlX21hcCgpO1xuXHRcdFx0fSk7XG5cdFx0XHQvLyBzZWxmLiRhZGRyZXNzKCkub24oJ2tleXVwIGZvY3VzJywgZnVuY3Rpb24oZSl7XG5cdFx0XHQvLyBcdHNlbGYuc2VhcmNoKGUpO1xuXHRcdFx0Ly8gfSApO1xuXG5cbi8vXHRcdFx0dGhpcy5saXN0ZW5UbyggdGhpcy4kYWRkcmVzcywgJ2tleXVwIGZvY3VzJywgdGhpcy5zZWFyY2ggKTtcblxuXHRcdFx0Ly8gdGhpcy4kdGlsZXMub24oJ2NoYW5nZScsIGRvX2xheWVycyApXG5cdFx0XHQvLyBcdC5wcmV2KCdpbnB1dCcpLm9uKCdjaGFuZ2UnLCBkb19sYXllcnMgKTtcblxuXHRcdH0sXG5cdFx0dXBkYXRlX21hcDpmdW5jdGlvbigpIHtcblx0XHRcdGlmICggISB0aGlzLiRsYXQoKS52YWwoKSB8fCAhIHRoaXMuJGxuZygpLnZhbCgpICkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHR2YXIgbGF0bG5nID0gTC5sYXRMbmcoIHRoaXMuJGxhdCgpLnZhbCgpLCB0aGlzLiRsbmcoKS52YWwoKSApO1xuXHRcdFx0dGhpcy5tYXAuc2V0VmlldyggbGF0bG5nLCAgdGhpcy4kem9vbSgpLnZhbCgpICk7XG5cdFx0fSxcblx0XHRtYXBfbW92ZWQ6ZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgY2VudGVyID0gdGhpcy5tYXAuZ2V0Q2VudGVyKCk7XG5cdFx0XHR0aGlzLiRsYXQoKS52YWwoY2VudGVyLmxhdCk7XG5cdFx0XHR0aGlzLiRsbmcoKS52YWwoY2VudGVyLmxuZyk7XG5cdFx0fSxcblx0XHRtYXBfem9vbWVkOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dGhpcy4kem9vbSgpLnZhbCggdGhpcy5tYXAuZ2V0Wm9vbSgpICk7XG5cdFx0fSxcblx0fSk7XG5cblx0Lypcblx0ICogIHJlYWR5IGFwcGVuZCAoQUNGNSlcblx0ICpcblx0ICogIFRoZXNlIGFyZSAyIGV2ZW50cyB3aGljaCBhcmUgZmlyZWQgZHVyaW5nIHRoZSBwYWdlIGxvYWRcblx0ICogIHJlYWR5ID0gb24gcGFnZSBsb2FkIHNpbWlsYXIgdG8gJChkb2N1bWVudCkucmVhZHkoKVxuXHQgKiAgYXBwZW5kID0gb24gbmV3IERPTSBlbGVtZW50cyBhcHBlbmRlZCB2aWEgcmVwZWF0ZXIgZmllbGRcblx0ICpcblx0ICogIEB0eXBlXHRldmVudFxuXHQgKiAgQGRhdGVcdDIwLzA3LzEzXG5cdCAqXG5cdCAqICBAcGFyYW1cdCRlbCAoalF1ZXJ5IHNlbGVjdGlvbikgdGhlIGpRdWVyeSBlbGVtZW50IHdoaWNoIGNvbnRhaW5zIHRoZSBBQ0YgZmllbGRzXG5cdCAqICBAcmV0dXJuXHRuL2Fcblx0ICovXG5cdCQoZG9jdW1lbnQpLm9uKCdhY2Ytb3NtLW1hcC1pbml0JyxmdW5jdGlvbiggZSwgbWFwICkge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRuZXcgb3NtLmZpZWxkKCB7IGVsOiBlLnRhcmdldCwgbWFwOiBtYXAgfSApO1xuXHR9KTtcblxuXG59KSggalF1ZXJ5LCBhY2Zfb3NtX2FkbWluICk7XG4iXX0=
