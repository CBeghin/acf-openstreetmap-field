!function(t){var e=acf_osm.options,s={};s.field=Backbone.View.extend({$map:null,$zoom:null,$lat:null,$lng:null,$address:null,$layers:null,marker:null,icon:null,map:null,layers:[],events:{"change [data-prop]":"update_field",'keyup [data-prop="address"]':"search",'focus [data-prop="address"]':"search",'change [data-prop="leaflet_layers"]':"update_layers",'change [data-prop="osm_layer"]':"update_osm_layer","click .osm-result":"click_result","keyup .osm-result":"keyup_result","focus .osm-result":"focus_result"},initialize:function(){this.$map=this.$el.find(".acf-osm-map"),this.$zoom=this.$el.find('[data-prop="zoom"]'),this.$lat=this.$el.find('[data-prop="center_lat"]'),this.$lng=this.$el.find('[data-prop="center_lng"]'),this.$mlat=this.$el.find('[data-prop="marker_lat"]'),this.$mlng=this.$el.find('[data-prop="marker_lng"]'),this.$layers=this.$el.find('[data-prop="leaflet_layers"]'),this.$address=this.$el.find('[data-prop="address"]'),this.$results=this.$address.next(".osm-results"),this.icon=L.divIcon({className:"osm-marker",html:"",iconSize:0}),this.map=L.map(this.$map.get(0),{scrollWheelZoom:!1,center:[this.$lat.val(),this.$lng.val()],zoom:this.$zoom.val()}),this.marker=L.marker([this.$mlat.val(),this.$mlng.val()],{icon:this.icon,title:this.$address.val()}).addTo(this.map),this.layers=[],this.$layers.is("select")&&acf.select2.init(this.$layers,{multiple:!0,ui:!0,allow_null:!1,ajax:!1},this.$el),this.bind_events(),this.update_layers()},update_field:function(){},bind_events:function(){var t=this;this.map.on("zoomend",function(e){t.map_zoomed.apply(t,[e])}),this.map.on("moveend",function(e){t.map_moved.apply(t,[e])}),this.map.on("click",function(e){t.map_clicked.apply(t,[e])})},map_moved:function(t){var e=this.map.getCenter();this.$lat.val(e.lat),this.$lng.val(e.lng)},map_zoomed:function(t){this.$zoom.val(this.map.getZoom())},map_clicked:function(t){var e=t.latlng;this.fetch_results("https://photon.komoot.de/reverse",{lon:e.lng,lat:e.lat},function(t){var s,a=0,r=t.features.length;for(a;a<r;a++){s=this.format_result(t.features[a]),this.marker.title=s,this.$address.val(s),this.set_marker(e);break}}),this.set_marker(t.latlng)},set_marker:function(e){t(this.marker._icon).attr("title",this.marker.title),this.marker.setLatLng(e),this.$mlat.val(e.lat),this.$mlng.val(e.lng)},update_layers:function(){var s,a,r,i,l=[];if(null!==l){for(this.$layers.each(function(){var e=t(this).val();Array.isArray(l)?l=l.concat(e):l.push(e)});this.layers.length;)this.map.removeLayer(this.layers.pop());for(i=l.length,r=0;r<i;r++)s=l[r],a=e.layer_config[s.split(".")[0]]||{},this.layers.push(L.tileLayer.provider(s,a.options).addTo(this.map))}},update_osm_layer:function(s){this.$('[data-prop="leaflet_layers"]').val(e.osm_layers[t(s.target).val()].provider),this.update_layers()},search:function(t){var e=this,s={};if(void 0!==this._wait_address&&(clearTimeout(this._wait_address),delete this._wait_address),!s.g||s.g!==this.$address.val())return 27==t.originalEvent.keyCode?(t.preventDefault(),this.$results.html(""),this.$address.blur(),!1):void(this._wait_address=setTimeout(function(){s={q:e.$address.val(),limit:5,lon:e.$lng.val(),lat:e.$lat.val()},e.fetch_results("https://photon.komoot.de/api/",s,function(t){delete this._wait_address})},666))},clear_results:function(){this.$results.html("")},build_results:function(e){var s=this,a=e.features.length,r=this.$address.val(),i=e.features;this.clear_results(),a&&t.each(i,function(e,a){var i=t('<div tabindex="'+e+'" class="osm-result"></div>'),l=s.format_result(a),n=l.replace(new RegExp("("+r.split(/[^a-z0-9]/).join("|")+")","gi"),"<strong>$1</strong>");n+="<br /><small>("+s.nice_words(a.properties.osm_value)+")</small>",i.data({text:l,bounds:a.properties.extent,coord:a.geometry.coordinates}).html(n).appendTo(s.$results)})},fetch_results:function(e,s,a){var r=this;t.ajax({url:e,method:"get",data:s,success:function(t){r.build_results(t),"function"==typeof a&&a.apply(r,[t])}})},click_result:function(e){var s=t(e.target).data(),a=L.latLng(s.coord[1],s.coord[0]);s.ext?this.map.fitBounds(L.latLngBounds(L.latLng(s.ext[1],s.ext[0]),L.latLng(s.ext[3],s.ext[2]))):this.map.setView(a,this.map.getZoom()),this.$address.val(s.text),this.clear_results(),this.marker.title=s.text,this.set_marker(a)},keyup_result:function(e){40==e.originalEvent.keyCode?(t(e.target).next(".osm-result").focus(),e.preventDefault()):38==e.originalEvent.keyCode&&(t(e.target).prev(".osm-result").focus(),e.preventDefault())},focus_result:function(e){var s=t(e.target).data();s.ext?this.map.fitBounds(L.latLngBounds(L.latLng(s.ext[1],s.ext[0]),L.latLng(s.ext[3],s.ext[2]))):this.map.setView(L.latLng(s.coord[1],s.coord[0]),this.map.getZoom())},format_result:function(t){return this.get_result_words(t).join(", ")},get_result_words:function(e){var s=[],a=["name","street","housenumber","city","postcode","state","country"];return t.each(a,function(t,a){try{e.properties[a]&&s.push(e.properties[a])}catch(t){}}),Array.from(new Set(s))},nice_words:function(t){return t.split(/[\s_]/).map(function(t){return t[0].toUpperCase()+t.substring(1)}).join(" ")}}),acf.add_action("ready append",function(t){acf.get_fields({type:"open_street_map"},t).each(function(){new s.field({el:this})})})}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1pbnB1dC1vc20uanMiXSwibmFtZXMiOlsiJCIsIm9wdGlvbnMiLCJhY2Zfb3NtIiwib3NtIiwiZmllbGQiLCJCYWNrYm9uZSIsIlZpZXciLCJleHRlbmQiLCIkbWFwIiwiJHpvb20iLCIkbGF0IiwiJGxuZyIsIiRhZGRyZXNzIiwiJGxheWVycyIsIm1hcmtlciIsImljb24iLCJtYXAiLCJsYXllcnMiLCJldmVudHMiLCJjaGFuZ2UgW2RhdGEtcHJvcF0iLCJrZXl1cCBbZGF0YS1wcm9wPVwiYWRkcmVzc1wiXSIsImZvY3VzIFtkYXRhLXByb3A9XCJhZGRyZXNzXCJdIiwiY2hhbmdlIFtkYXRhLXByb3A9XCJsZWFmbGV0X2xheWVyc1wiXSIsImNoYW5nZSBbZGF0YS1wcm9wPVwib3NtX2xheWVyXCJdIiwiY2xpY2sgLm9zbS1yZXN1bHQiLCJrZXl1cCAub3NtLXJlc3VsdCIsImZvY3VzIC5vc20tcmVzdWx0IiwiaW5pdGlhbGl6ZSIsInRoaXMiLCIkZWwiLCJmaW5kIiwiJG1sYXQiLCIkbWxuZyIsIiRyZXN1bHRzIiwibmV4dCIsIkwiLCJkaXZJY29uIiwiY2xhc3NOYW1lIiwiaHRtbCIsImljb25TaXplIiwiZ2V0Iiwic2Nyb2xsV2hlZWxab29tIiwiY2VudGVyIiwidmFsIiwiem9vbSIsInRpdGxlIiwiYWRkVG8iLCJpcyIsImFjZiIsInNlbGVjdDIiLCJpbml0IiwibXVsdGlwbGUiLCJ1aSIsImFsbG93X251bGwiLCJhamF4IiwiYmluZF9ldmVudHMiLCJ1cGRhdGVfbGF5ZXJzIiwidXBkYXRlX2ZpZWxkIiwic2VsZiIsIm9uIiwiZSIsIm1hcF96b29tZWQiLCJhcHBseSIsIm1hcF9tb3ZlZCIsIm1hcF9jbGlja2VkIiwiZ2V0Q2VudGVyIiwibGF0IiwibG5nIiwiZ2V0Wm9vbSIsImNvb3JkIiwibGF0bG5nIiwiZmV0Y2hfcmVzdWx0cyIsImxvbiIsInJlc3BvbnNlIiwiZm10IiwiaSIsImxlbiIsImZlYXR1cmVzIiwibGVuZ3RoIiwiZm9ybWF0X3Jlc3VsdCIsInNldF9tYXJrZXIiLCJfaWNvbiIsImF0dHIiLCJzZXRMYXRMbmciLCJwcm92aWRlciIsImxheWVyX2NvbmZpZyIsImVhY2giLCJ2IiwiQXJyYXkiLCJpc0FycmF5IiwiY29uY2F0IiwicHVzaCIsInJlbW92ZUxheWVyIiwicG9wIiwic3BsaXQiLCJ0aWxlTGF5ZXIiLCJ1cGRhdGVfb3NtX2xheWVyIiwib3NtX2xheWVycyIsInRhcmdldCIsInNlYXJjaCIsImRhdGEiLCJfd2FpdF9hZGRyZXNzIiwiY2xlYXJUaW1lb3V0Iiwib3JpZ2luYWxFdmVudCIsImtleUNvZGUiLCJwcmV2ZW50RGVmYXVsdCIsImJsdXIiLCJzZXRUaW1lb3V0IiwicSIsImxpbWl0IiwiY2xlYXJfcmVzdWx0cyIsImJ1aWxkX3Jlc3VsdHMiLCJmZWF0IiwiZWwiLCIkcmVzIiwicmVwbGFjZSIsIlJlZ0V4cCIsImpvaW4iLCJuaWNlX3dvcmRzIiwicHJvcGVydGllcyIsIm9zbV92YWx1ZSIsInRleHQiLCJib3VuZHMiLCJleHRlbnQiLCJnZW9tZXRyeSIsImNvb3JkaW5hdGVzIiwiYXBwZW5kVG8iLCJ1cmwiLCJjYWxsYmFjayIsIm1ldGhvZCIsInN1Y2Nlc3MiLCJjbGlja19yZXN1bHQiLCJsYXRMbmciLCJleHQiLCJmaXRCb3VuZHMiLCJsYXRMbmdCb3VuZHMiLCJzZXRWaWV3Iiwia2V5dXBfcmVzdWx0IiwiZm9jdXMiLCJwcmV2IiwiZm9jdXNfcmVzdWx0IiwiaGl0IiwiZ2V0X3Jlc3VsdF93b3JkcyIsImgiLCJwcm9wcyIsInByb3AiLCJlcnIiLCJmcm9tIiwiU2V0Iiwic3RyIiwicyIsInRvVXBwZXJDYXNlIiwic3Vic3RyaW5nIiwiYWRkX2FjdGlvbiIsImdldF9maWVsZHMiLCJ0eXBlIiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFVQSxHQUNULEdBQUlDLEdBQVVDLFFBQVFELFFBRWxCRSxJQUVKQSxHQUFJQyxNQUFRQyxTQUFTQyxLQUFLQyxRQUN6QkMsS0FBTSxLQUNOQyxNQUFPLEtBQ1BD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R0FBSWpDLEVBQUtpQyxJQUFJLE1BR2pDekcsS0FBS1osSUFBSXdILFFBQVNyRyxFQUFFaUcsT0FBUWhDLEVBQUsvQixNQUFNLEdBQUkrQixFQUFLL0IsTUFBTSxJQUFNekMsS0FBS1osSUFBSW9ELFlBS3ZFVyxjQUFlLFNBQVU4RCxHQUN4QixNQUFPakgsTUFBS2tILGlCQUFrQkQsR0FBTXhCLEtBQUssT0FHMUN5QixpQkFBa0IsU0FBVUQsR0FFM0IsR0FBSUUsTUFDSEMsR0FBVSxPQUFPLFNBQVMsY0FBYyxPQUFPLFdBQVcsUUFBUSxVQVFuRSxPQVBBaEosR0FBRXNGLEtBQUswRCxFQUFPLFNBQVNyRSxFQUFFc0UsR0FDeEIsSUFDU0osRUFBSXRCLFdBQVcwQixJQUN0QkYsRUFBRXBELEtBQUtrRCxFQUFJdEIsV0FBVzBCLElBRXRCLE1BQU1DLE9BRUYxRCxNQUFNMkQsS0FBSyxHQUFJQyxLQUFJTCxLQUUzQnpCLFdBQVksU0FBUytCLEdBQ3BCLE1BQU9BLEdBQUl2RCxNQUFNLFNBQVM5RSxJQUFJLFNBQVNzSSxHQUFJLE1BQU9BLEdBQUUsR0FBR0MsY0FBZ0JELEVBQUVFLFVBQVUsS0FBT25DLEtBQUssUUFtQmpHckUsSUFBSXlHLFdBQVcsZUFBZ0IsU0FBVTVILEdBR3hDbUIsSUFBSTBHLFlBQWFDLEtBQU8sbUJBQW9COUgsR0FBS3lELEtBQUssV0FFckQsR0FBSW5GLEdBQUlDLE9BQVM2RyxHQUFJckYsWUFRckJnSSIsImZpbGUiOiJhY2YtaW5wdXQtb3NtLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigkKXtcblx0dmFyIG9wdGlvbnMgPSBhY2Zfb3NtLm9wdGlvbnM7XG5cblx0dmFyIG9zbSA9IHtcblx0fTtcblx0b3NtLmZpZWxkID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXHRcdCRtYXA6IG51bGwsXG5cdFx0JHpvb206IG51bGwsXG5cdFx0JGxhdDogbnVsbCxcblx0XHQkbG5nOiBudWxsLFxuXHRcdCRhZGRyZXNzOiBudWxsLFxuXHRcdCRsYXllcnM6IG51bGwsXG5cdFx0bWFya2VyOiBudWxsLFxuXHRcdGljb246bnVsbCxcblx0XHRtYXA6IG51bGwsXG5cdFx0bGF5ZXJzOltdLFxuXHRcdGV2ZW50czp7XG5cdFx0XHQnY2hhbmdlIFtkYXRhLXByb3BdJ1x0OiAndXBkYXRlX2ZpZWxkJyxcblx0XHRcdCdrZXl1cCBbZGF0YS1wcm9wPVwiYWRkcmVzc1wiXScgOiAnc2VhcmNoJyxcblx0XHRcdCdmb2N1cyBbZGF0YS1wcm9wPVwiYWRkcmVzc1wiXScgOiAnc2VhcmNoJyxcblxuXHRcdFx0J2NoYW5nZSBbZGF0YS1wcm9wPVwibGVhZmxldF9sYXllcnNcIl0nIDogJ3VwZGF0ZV9sYXllcnMnLFxuXHRcdFx0J2NoYW5nZSBbZGF0YS1wcm9wPVwib3NtX2xheWVyXCJdJyA6ICd1cGRhdGVfb3NtX2xheWVyJyxcblxuXHRcdFx0J2NsaWNrIC5vc20tcmVzdWx0J1x0OiAnY2xpY2tfcmVzdWx0Jyxcblx0XHRcdCdrZXl1cCAub3NtLXJlc3VsdCdcdDogJ2tleXVwX3Jlc3VsdCcsXG5cdFx0XHQnZm9jdXMgLm9zbS1yZXN1bHQnXHQ6ICdmb2N1c19yZXN1bHQnLFxuXHRcdH0sXG5cdFx0aW5pdGlhbGl6ZTpmdW5jdGlvbigpIHtcblx0XHQvL1x0dGhpcy4kZWxcdFx0PSB0aGlzLmF0dHJpYnV0ZXMuJGVsO1xuXHRcdFx0dGhpcy4kbWFwXHRcdD0gdGhpcy4kZWwuZmluZCgnLmFjZi1vc20tbWFwJyk7XG5cdFx0XHR0aGlzLiR6b29tXHRcdD0gdGhpcy4kZWwuZmluZCgnW2RhdGEtcHJvcD1cInpvb21cIl0nKTtcblx0XHRcdHRoaXMuJGxhdFx0XHQ9IHRoaXMuJGVsLmZpbmQoJ1tkYXRhLXByb3A9XCJjZW50ZXJfbGF0XCJdJyk7XG5cdFx0XHR0aGlzLiRsbmdcdFx0PSB0aGlzLiRlbC5maW5kKCdbZGF0YS1wcm9wPVwiY2VudGVyX2xuZ1wiXScpO1xuXHRcdFx0dGhpcy4kbWxhdFx0XHQ9IHRoaXMuJGVsLmZpbmQoJ1tkYXRhLXByb3A9XCJtYXJrZXJfbGF0XCJdJyk7XG5cdFx0XHR0aGlzLiRtbG5nXHRcdD0gdGhpcy4kZWwuZmluZCgnW2RhdGEtcHJvcD1cIm1hcmtlcl9sbmdcIl0nKTtcblx0XHRcdHRoaXMuJGxheWVyc1x0PSB0aGlzLiRlbC5maW5kKCdbZGF0YS1wcm9wPVwibGVhZmxldF9sYXllcnNcIl0nKTtcblx0XHRcdHRoaXMuJGFkZHJlc3NcdD0gdGhpcy4kZWwuZmluZCgnW2RhdGEtcHJvcD1cImFkZHJlc3NcIl0nKTtcblx0XHRcdHRoaXMuJHJlc3VsdHNcdD0gdGhpcy4kYWRkcmVzcy5uZXh0KCcub3NtLXJlc3VsdHMnKTtcblx0XHRcdHRoaXMuaWNvblx0XHQ9IEwuZGl2SWNvbiggeyBjbGFzc05hbWU6ICdvc20tbWFya2VyJywgaHRtbDonJywgaWNvblNpemU6MCB9ICk7XG5cdFx0XHR0aGlzLm1hcFx0XHQ9IEwubWFwKCB0aGlzLiRtYXAuZ2V0KDApLCB7XG5cdFx0XHRcdHNjcm9sbFdoZWVsWm9vbTogZmFsc2UsXG5cdFx0XHRcdGNlbnRlcjogWyB0aGlzLiRsYXQudmFsKCksIHRoaXMuJGxuZy52YWwoKSBdLFxuXHRcdFx0XHR6b29tOiB0aGlzLiR6b29tLnZhbCgpXG5cdFx0XHR9ICk7XG5cdFx0XHR0aGlzLm1hcmtlclx0XHQ9IEwubWFya2VyKFxuXHRcdFx0XHRbIHRoaXMuJG1sYXQudmFsKCksIHRoaXMuJG1sbmcudmFsKCkgXSxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGljb246dGhpcy5pY29uLFxuXHRcdFx0XHRcdHRpdGxlOnRoaXMuJGFkZHJlc3MudmFsKClcblx0XHRcdFx0fVxuXHRcdFx0KS5hZGRUbyh0aGlzLm1hcCk7XG5cblx0XHRcdHRoaXMubGF5ZXJzXHQ9IFtdO1xuXHRcdFx0aWYgKCB0aGlzLiRsYXllcnMuaXMoJ3NlbGVjdCcpICkge1xuXHRcdFx0XHRhY2Yuc2VsZWN0Mi5pbml0KCB0aGlzLiRsYXllcnMsIHtcblx0XHRcdFx0XHRtdWx0aXBsZTogdHJ1ZSxcblx0XHRcdFx0XHR1aTogdHJ1ZSxcblx0XHRcdFx0XHRhbGxvd19udWxsOiBmYWxzZSxcblx0XHRcdFx0XHRhamF4OmZhbHNlLFxuXHRcdFx0XHR9LCB0aGlzLiRlbCApO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmJpbmRfZXZlbnRzKCk7XG5cblx0XHRcdHRoaXMudXBkYXRlX2xheWVycygpO1xuXHRcdH0sXG5cdFx0dXBkYXRlX2ZpZWxkOmZ1bmN0aW9uKCl7XG5cblx0XHR9LFxuXHRcdGJpbmRfZXZlbnRzOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuLy9cdFx0XHR0aGlzLmxpc3RlblRvKCB0aGlzLiRhZGRyZXNzLCAna2V5dXAgZm9jdXMnLCB0aGlzLnNlYXJjaCApO1xuXG5cdFx0XHR0aGlzLm1hcC5vbignem9vbWVuZCcsIGZ1bmN0aW9uKGUpeyBzZWxmLm1hcF96b29tZWQuYXBwbHkoc2VsZixbZV0pOyB9ICk7XG5cdFx0XHR0aGlzLm1hcC5vbignbW92ZWVuZCcsIGZ1bmN0aW9uKGUpeyBzZWxmLm1hcF9tb3ZlZC5hcHBseShzZWxmLFtlXSk7IH0gICk7XG5cdFx0XHR0aGlzLm1hcC5vbignY2xpY2snLCAgIGZ1bmN0aW9uKGUpeyBzZWxmLm1hcF9jbGlja2VkLmFwcGx5KHNlbGYsW2VdKTsgfSApO1xuXG5cdFx0XHQvLyB0aGlzLiR0aWxlcy5vbignY2hhbmdlJywgZG9fbGF5ZXJzIClcblx0XHRcdC8vIFx0LnByZXYoJ2lucHV0Jykub24oJ2NoYW5nZScsIGRvX2xheWVycyApO1xuXG5cdFx0fSxcblxuXHRcdG1hcF9tb3ZlZDpmdW5jdGlvbihlKXtcblx0XHRcdHZhciBjZW50ZXIgPSB0aGlzLm1hcC5nZXRDZW50ZXIoKTtcblx0XHRcdHRoaXMuJGxhdC52YWwoY2VudGVyLmxhdCk7XG5cdFx0XHR0aGlzLiRsbmcudmFsKGNlbnRlci5sbmcpO1xuXHRcdH0sXG5cdFx0bWFwX3pvb21lZDpmdW5jdGlvbihlKXtcblx0XHRcdHRoaXMuJHpvb20udmFsKCB0aGlzLm1hcC5nZXRab29tKCkgKTtcblx0XHR9LFxuXHRcdG1hcF9jbGlja2VkOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dmFyIGNvb3JkID0gZS5sYXRsbmc7XG5cblx0XHRcdHRoaXMuZmV0Y2hfcmVzdWx0cygnaHR0cHM6Ly9waG90b24ua29tb290LmRlL3JldmVyc2UnLCB7XG5cdFx0XHRcdGxvbjpjb29yZC5sbmcsXG5cdFx0XHRcdGxhdDpjb29yZC5sYXQsXG5cdFx0XHR9LCBmdW5jdGlvbihyZXNwb25zZSl7XG5cdFx0XHRcdHZhciBpPTAsbGVuPXJlc3BvbnNlLmZlYXR1cmVzLmxlbmd0aCxmbXQ7XG5cdFx0XHRcdGZvciAoaTtpPGxlbjtpKyspe1xuXHRcdFx0XHRcdGZtdCA9IHRoaXMuZm9ybWF0X3Jlc3VsdCggcmVzcG9uc2UuZmVhdHVyZXNbaV0gKTtcblx0XHRcdFx0XHR0aGlzLm1hcmtlci50aXRsZSA9IGZtdDtcblx0XHRcdFx0XHR0aGlzLiRhZGRyZXNzLnZhbCggZm10ICk7XG5cdFx0XHRcdFx0Lypcblx0XHRcdFx0XHR0aGlzLnNldF9tYXJrZXIoIEwubGF0TG5nKCByZXNwb25zZS5mZWF0dXJlc1tpXS5nZW9tZXRyeS5jb29yZGluYXRlc1sxXSwgcmVzcG9uc2UuZmVhdHVyZXNbaV0uZ2VvbWV0cnkuY29vcmRpbmF0ZXNbMF0gKSAgKTtcblx0XHRcdFx0XHQvKi9cblx0XHRcdFx0XHR0aGlzLnNldF9tYXJrZXIoIGNvb3JkICk7XG5cdFx0XHRcdFx0Ly8qL1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cdFx0XHR9ICk7XG5cdFx0XHR0aGlzLnNldF9tYXJrZXIoIGUubGF0bG5nICk7XG5cdFx0fSxcblx0XHRzZXRfbWFya2VyOmZ1bmN0aW9uKGNvb3JkKXtcblx0XHRcdCQodGhpcy5tYXJrZXIuX2ljb24pLmF0dHIoICd0aXRsZScsIHRoaXMubWFya2VyLnRpdGxlICk7XG5cdFx0XHR0aGlzLm1hcmtlci5zZXRMYXRMbmcoY29vcmQpO1xuXHRcdFx0dGhpcy4kbWxhdC52YWwoIGNvb3JkLmxhdCApO1xuXHRcdFx0dGhpcy4kbWxuZy52YWwoIGNvb3JkLmxuZyApO1xuXHRcdH0sXG4vKlxuaHR0cHM6Ly9hLnRpbGUub3BlbnN0cmVldG1hcC5vcmcvXG5odHRwczovL2EudGlsZS50aHVuZGVyZm9yZXN0LmNvbS9jeWNsZS9cbmh0dHBzOi8vYS50aWxlLnRodW5kZXJmb3Jlc3QuY29tL3RyYW5zcG9ydC9cbmh0dHBzOi8vdGlsZS1hLm9wZW5zdHJlZXRtYXAuZnIvaG90L1xuKi9cblx0XHR1cGRhdGVfbGF5ZXJzOiBmdW5jdGlvbigpe1xuXHRcdFx0dmFyIHZhbCA9IFtdLFxuXHRcdFx0XHRwcm92aWRlciwgbGF5ZXJfY29uZmlnLCBpLCBsZW47XG5cblx0XHRcdGlmICggbnVsbCA9PT0gdmFsICkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHR0aGlzLiRsYXllcnMuZWFjaChmdW5jdGlvbigpe1xuXHRcdFx0XHR2YXIgdiA9ICQodGhpcykudmFsKCk7XG5cdFx0XHRcdGlmICggQXJyYXkuaXNBcnJheSh2YWwpICkge1xuXHRcdFx0XHRcdHZhbCA9IHZhbC5jb25jYXQodilcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR2YWwucHVzaCh2KVxuXHRcdFx0XHR9XG5cblx0XHRcdH0pO1xuXG5cdFx0XHQvLyByZW1vdmUgbGF5ZXJzXG5cdFx0XHR3aGlsZSAoIHRoaXMubGF5ZXJzLmxlbmd0aCApIHtcblx0XHRcdFx0dGhpcy5tYXAucmVtb3ZlTGF5ZXIoIHRoaXMubGF5ZXJzLnBvcCgpICk7XG5cdFx0XHR9XG5cblx0XHRcdGxlbiA9IHZhbC5sZW5ndGg7XG5cdFx0XHRmb3IgKCBpPTA7aTxsZW47aSsrICkge1xuXHRcdFx0XHRwcm92aWRlciA9IHZhbFtpXTtcblx0XHRcdFx0bGF5ZXJfY29uZmlnID0gb3B0aW9ucy5sYXllcl9jb25maWdbIHByb3ZpZGVyLnNwbGl0KCcuJylbMF0gXSB8fCB7fTtcblx0XHRcdFx0dGhpcy5sYXllcnMucHVzaCggTC50aWxlTGF5ZXIucHJvdmlkZXIoIHByb3ZpZGVyLCBsYXllcl9jb25maWcub3B0aW9ucyApLmFkZFRvKHRoaXMubWFwKSApO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0dXBkYXRlX29zbV9sYXllcjogZnVuY3Rpb24oZSkge1xuXHRcdFx0dGhpcy4kKCdbZGF0YS1wcm9wPVwibGVhZmxldF9sYXllcnNcIl0nKS52YWwoIG9wdGlvbnMub3NtX2xheWVyc1skKGUudGFyZ2V0KS52YWwoKV0ucHJvdmlkZXIgKTtcblx0XHRcdHRoaXMudXBkYXRlX2xheWVycygpO1xuXHRcdH0sXG5cdFx0c2VhcmNoOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRkYXRhID0ge307XG5cdFx0XHRpZiAoICd1bmRlZmluZWQnICE9PSB0eXBlb2YgdGhpcy5fd2FpdF9hZGRyZXNzICkge1xuXHRcdFx0XHRjbGVhclRpbWVvdXQodGhpcy5fd2FpdF9hZGRyZXNzKTtcblx0XHRcdFx0ZGVsZXRlIHRoaXMuX3dhaXRfYWRkcmVzcztcblx0XHRcdH1cblxuXHRcdFx0aWYgKCEhIGRhdGFbJ2cnXSAmJiBkYXRhWydnJ10gPT09IHRoaXMuJGFkZHJlc3MudmFsKCkgKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCAyNyA9PSBlLm9yaWdpbmFsRXZlbnQua2V5Q29kZSApIHsgLy8gZXNjXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0dGhpcy4kcmVzdWx0cy5odG1sKCcnKTtcblx0XHRcdFx0dGhpcy4kYWRkcmVzcy5ibHVyKCk7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHRcdHRoaXMuX3dhaXRfYWRkcmVzcyA9IHNldFRpbWVvdXQoIGZ1bmN0aW9uKCl7XG5cdFx0XHRcdGRhdGEgPSB7XG5cdFx0XHRcdFx0cTpzZWxmLiRhZGRyZXNzLnZhbCgpLFxuLy9cdFx0XHRcdFx0XHRsYW5nOidkZScsIC3CtC8vIC0+IFdQLUxhbmchXG5cdFx0XHRcdFx0bGltaXQ6NSxcblx0XHRcdFx0XHRsb246c2VsZi4kbG5nLnZhbCgpLFxuXHRcdFx0XHRcdGxhdDpzZWxmLiRsYXQudmFsKCksXG5cdFx0XHRcdH07XG5cdFx0XHRcdHNlbGYuZmV0Y2hfcmVzdWx0cygnaHR0cHM6Ly9waG90b24ua29tb290LmRlL2FwaS8nLGRhdGEsIGZ1bmN0aW9uKHJlc3BvbnNlKXtcblx0XHRcdFx0XHRkZWxldGUgdGhpcy5fd2FpdF9hZGRyZXNzO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0sIDY2NiApO1xuXG5cdFx0fSxcblx0XHRjbGVhcl9yZXN1bHRzOmZ1bmN0aW9uKCl7XG5cdFx0XHR0aGlzLiRyZXN1bHRzLmh0bWwoJycpO1xuXHRcdH0sXG5cdFx0YnVpbGRfcmVzdWx0czpmdW5jdGlvbihyZXNwb25zZSl7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdGk9MCwgbGVuID0gcmVzcG9uc2UuZmVhdHVyZXMubGVuZ3RoLFxuXHRcdFx0XHRxID0gdGhpcy4kYWRkcmVzcy52YWwoKSxcblx0XHRcdFx0ZmVhdCA9IHJlc3BvbnNlLmZlYXR1cmVzOy8vc29ydF9mdXp6eSggcmVzcG9uc2UuZmVhdHVyZXMsIHEgKTtcblxuXHRcdFx0dGhpcy5jbGVhcl9yZXN1bHRzKCk7XG5cblx0XHRcdGlmICggbGVuICkge1xuXHRcdFx0XHQkLmVhY2goIGZlYXQsIGZ1bmN0aW9uKGksZWwpe1xuXHRcdFx0XHRcdHZhciAkcmVzID0gJCgnPGRpdiB0YWJpbmRleD1cIicraSsnXCIgY2xhc3M9XCJvc20tcmVzdWx0XCI+PC9kaXY+JyksXG5cdFx0XHRcdFx0XHQvLyBjb29yZCA9IGVsLmdlb21ldHJ5LmNvb3JkaW5hdGVzLFxuXHRcdFx0XHRcdFx0Ly8gZXh0ID0gZWwucHJvcGVydGllcy5leHRlbnQsXG5cdFx0XHRcdFx0XHRmbXQgPSBzZWxmLmZvcm1hdF9yZXN1bHQoIGVsICksXG5cdFx0XHRcdFx0XHRodG1sID0gZm10LnJlcGxhY2UoIG5ldyBSZWdFeHAoXCIoXCIrcS5zcGxpdCgvW15hLXowLTldLykuam9pbignfCcpK1wiKVwiLCdnaScpLFwiPHN0cm9uZz4kMTwvc3Ryb25nPlwiKTtcblx0XHRcdFx0XHRodG1sICs9ICc8YnIgLz48c21hbGw+KCcgKyBzZWxmLm5pY2Vfd29yZHMoIGVsLnByb3BlcnRpZXMub3NtX3ZhbHVlICkgKyAnKTwvc21hbGw+JztcblxuXHRcdFx0XHRcdCRyZXMuZGF0YSh7XG5cdFx0XHRcdFx0XHR0ZXh0OmZtdCxcblx0XHRcdFx0XHRcdGJvdW5kczplbC5wcm9wZXJ0aWVzLmV4dGVudCxcblx0XHRcdFx0XHRcdGNvb3JkOmVsLmdlb21ldHJ5LmNvb3JkaW5hdGVzLFxuXHRcdFx0XHRcdH0pLmh0bWwoIGh0bWwgKS5hcHBlbmRUbyhzZWxmLiRyZXN1bHRzKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHR9LFxuXHRcdGZldGNoX3Jlc3VsdHM6IGZ1bmN0aW9uKHVybCxkYXRhLCBjYWxsYmFjaykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0JC5hamF4KHtcblx0XHRcdFx0dXJsOnVybCxcblx0XHRcdFx0bWV0aG9kOidnZXQnLFxuXHRcdFx0XHRkYXRhOmRhdGEsXG5cdFx0XHRcdHN1Y2Nlc3M6ZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdFx0XHRzZWxmLmJ1aWxkX3Jlc3VsdHMocmVzcG9uc2UpO1xuXHRcdFx0XHRcdCdmdW5jdGlvbicgPT09IHR5cGVvZiBjYWxsYmFjayAmJiBjYWxsYmFjay5hcHBseShzZWxmLFtyZXNwb25zZV0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdH0sXG5cblx0XHRjbGlja19yZXN1bHQ6ZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgZGF0YSA9ICQoZS50YXJnZXQpLmRhdGEoKSxcblx0XHRcdFx0bGF0bG5nID0gTC5sYXRMbmcoIGRhdGEuY29vcmRbMV0sIGRhdGEuY29vcmRbMF0gKTtcblxuXHRcdFx0aWYgKCBkYXRhLmV4dCApIHtcblxuXHRcdFx0XHR0aGlzLm1hcC5maXRCb3VuZHMoIEwubGF0TG5nQm91bmRzKFxuXHRcdFx0XHRcdEwubGF0TG5nKCBkYXRhLmV4dFsxXSwgZGF0YS5leHRbMF0gKSxcblx0XHRcdFx0XHRMLmxhdExuZyggZGF0YS5leHRbM10sIGRhdGEuZXh0WzJdIClcblx0XHRcdFx0KSApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5tYXAuc2V0VmlldyggbGF0bG5nLCB0aGlzLm1hcC5nZXRab29tKCkgKTtcblx0XHRcdH1cblx0XHRcdHRoaXMuJGFkZHJlc3MudmFsKCBkYXRhLnRleHQgKTtcblx0XHRcdHRoaXMuY2xlYXJfcmVzdWx0cygpO1xuXG5cdFx0XHR0aGlzLm1hcmtlci50aXRsZSA9IGRhdGEudGV4dDtcblx0XHRcdHRoaXMuc2V0X21hcmtlciggbGF0bG5nICk7XG5cdFx0fSxcblxuXHRcdGtleXVwX3Jlc3VsdDpmdW5jdGlvbihlKXtcblx0XHRcdGlmIChlLm9yaWdpbmFsRXZlbnQua2V5Q29kZSA9PSA0MCkgeyAvLyBkb3duXG5cdFx0XHRcdCQoIGUudGFyZ2V0ICkubmV4dCgnLm9zbS1yZXN1bHQnKS5mb2N1cygpO1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KClcblx0XHRcdH0gZWxzZSBpZiAoZS5vcmlnaW5hbEV2ZW50LmtleUNvZGUgPT0gMzgpIHtcblx0XHRcdFx0JCggZS50YXJnZXQgKS5wcmV2KCcub3NtLXJlc3VsdCcpLmZvY3VzKCk7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKVxuXHRcdFx0fVxuXG5cdFx0fSxcblx0XHRmb2N1c19yZXN1bHQ6ZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgZGF0YSA9ICQoZS50YXJnZXQpLmRhdGEoKTtcblxuXHRcdFx0aWYgKCBkYXRhLmV4dCApIHtcblx0XHRcdFx0dGhpcy5tYXAuZml0Qm91bmRzKCBMLmxhdExuZ0JvdW5kcyhcblx0XHRcdFx0XHRMLmxhdExuZyggZGF0YS5leHRbMV0sIGRhdGEuZXh0WzBdICksXG5cdFx0XHRcdFx0TC5sYXRMbmcoIGRhdGEuZXh0WzNdLCBkYXRhLmV4dFsyXSApXG5cdFx0XHRcdCkgKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMubWFwLnNldFZpZXcoIEwubGF0TG5nKCBkYXRhLmNvb3JkWzFdLCBkYXRhLmNvb3JkWzBdICksIHRoaXMubWFwLmdldFpvb20oKSApO1xuXHRcdFx0fVxuXG5cdFx0fSxcblxuXHRcdGZvcm1hdF9yZXN1bHQ6IGZ1bmN0aW9uKCBoaXQgKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5nZXRfcmVzdWx0X3dvcmRzKCBoaXQgKS5qb2luKCcsICcpO1xuXHRcdH0sXG5cblx0XHRnZXRfcmVzdWx0X3dvcmRzOiBmdW5jdGlvbiggaGl0ICkge1xuXG5cdFx0XHR2YXIgaCA9IFtdLFxuXHRcdFx0XHRwcm9wcyA9IFsgJ25hbWUnLCdzdHJlZXQnLCdob3VzZW51bWJlcicsJ2NpdHknLCdwb3N0Y29kZScsJ3N0YXRlJywnY291bnRyeScgXTtcblx0XHRcdCQuZWFjaChwcm9wcywgZnVuY3Rpb24oaSxwcm9wKSB7XG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0aWYgKCAhISBoaXQucHJvcGVydGllc1twcm9wXSApIHtcblx0XHRcdFx0XHRcdGgucHVzaChoaXQucHJvcGVydGllc1twcm9wXSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGNhdGNoKGVycil7fVxuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gQXJyYXkuZnJvbShuZXcgU2V0KGgpKTtcblx0XHR9LFxuXHRcdG5pY2Vfd29yZHM6IGZ1bmN0aW9uKHN0cikge1xuXHRcdFx0cmV0dXJuIHN0ci5zcGxpdCgvW1xcc19dLykubWFwKGZ1bmN0aW9uKHMpeyByZXR1cm4gc1swXS50b1VwcGVyQ2FzZSgpICsgcy5zdWJzdHJpbmcoMSk7IH0pLmpvaW4oJyAnKTtcblx0XHR9XG5cblx0fSk7XG5cblx0Lypcblx0ICogIHJlYWR5IGFwcGVuZCAoQUNGNSlcblx0ICpcblx0ICogIFRoZXNlIGFyZSAyIGV2ZW50cyB3aGljaCBhcmUgZmlyZWQgZHVyaW5nIHRoZSBwYWdlIGxvYWRcblx0ICogIHJlYWR5ID0gb24gcGFnZSBsb2FkIHNpbWlsYXIgdG8gJChkb2N1bWVudCkucmVhZHkoKVxuXHQgKiAgYXBwZW5kID0gb24gbmV3IERPTSBlbGVtZW50cyBhcHBlbmRlZCB2aWEgcmVwZWF0ZXIgZmllbGRcblx0ICpcblx0ICogIEB0eXBlXHRldmVudFxuXHQgKiAgQGRhdGVcdDIwLzA3LzEzXG5cdCAqXG5cdCAqICBAcGFyYW1cdCRlbCAoalF1ZXJ5IHNlbGVjdGlvbikgdGhlIGpRdWVyeSBlbGVtZW50IHdoaWNoIGNvbnRhaW5zIHRoZSBBQ0YgZmllbGRzXG5cdCAqICBAcmV0dXJuXHRuL2Fcblx0ICovXG5cblx0YWNmLmFkZF9hY3Rpb24oJ3JlYWR5IGFwcGVuZCcsIGZ1bmN0aW9uKCAkZWwgKXtcblxuXHRcdC8vIHNlYXJjaCAkZWwgZm9yIGZpZWxkcyBvZiB0eXBlICdGSUVMRF9OQU1FJ1xuXHRcdGFjZi5nZXRfZmllbGRzKHsgdHlwZSA6ICdvcGVuX3N0cmVldF9tYXAnfSwgJGVsKS5lYWNoKGZ1bmN0aW9uKCl7XG5cblx0XHRcdG5ldyBvc20uZmllbGQoIHsgZWw6IHRoaXMgfSApO1xuXG5cdFx0fSk7XG5cblx0fSk7XG5cblxuXG59KShqUXVlcnkpO1xuIl19
