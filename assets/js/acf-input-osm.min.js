!function(t){var e=acf_osm.options;console.log("input js");var s={};s.field=Backbone.View.extend({$map:null,$zoom:null,$lat:null,$lng:null,$address:null,$layers:null,marker:null,icon:null,map:null,layers:[],events:{'keyup [data-prop="address"]':"search",'focus [data-prop="address"]':"search","click .osm-result":"click_result","keyup .osm-result":"keyup_result","focus .osm-result":"focus_result"},initialize:function(){this.$map=this.$el.find(".acf-osm-map"),this.$zoom=this.$el.find('[data-prop="zoom"]'),this.$lat=this.$el.find('[data-prop="center_lat"]'),this.$lng=this.$el.find('[data-prop="center_lng"]'),this.$layers=this.$el.find('[data-prop="leaflet_layers"]'),this.$address=this.$el.find('[data-prop="address"]'),this.$results=this.$address.next(".osm-results"),this.icon=L.divIcon({className:"osm-marker",html:"",iconSize:0}),this.map=L.map(this.$map.get(0),{scrollWheelZoom:!1,center:[this.$lat.val(),this.$lng.val()],zoom:this.$zoom.val()}),this.marker=L.marker([this.$lat.val(),this.$lng.val()],{icon:this.icon,title:this.$address.val()}).addTo(this.map),this.layers=[],this.$layers.is("select")&&acf.select2.init(this.$layers,{multiple:!0,ui:!0,allow_null:!1,ajax:!1},this.$el),this.bind_events(),this.update_layers()},bind_events:function(){var t=this;this.listenTo(this.$layers,"change",this.update_layers),this.map.on("zoomend",function(e){t.map_zoomed.apply(t,[e])}),this.map.on("moveend",function(e){t.map_moved.apply(t,[e])}),this.map.on("click",function(e){t.map_clicked.apply(t,[e])})},map_moved:function(t){var e=this.map.getCenter();this.$lat.val(e.lat),this.$lng.val(e.lng)},map_zoomed:function(t){this.$zoom.val(this.map.getZoom())},map_clicked:function(t){var e=t.latlng;this.fetch_results("https://photon.komoot.de/reverse",{lon:e.lng,lat:e.lat},function(t){var s,a=0,i=t.features.length;for(a;a<i;a++){s=this.format_result(t.features[a]),this.marker.title=s,this.set_marker(e);break}}),this.set_marker(t.latlng)},set_marker:function(e){t(this.marker._icon).attr("title",this.marker.title),this.marker.setLatLng(e)},update_layers:function(){var s,a,i,r,l=[];if(null!==l){for(this.$layers.each(function(){var e=t(this).val();Array.isArray(l)?l=l.concat(e):l.push(e)});this.layers.length;)this.map.removeLayer(this.layers.pop());for(r=l.length,i=0;i<r;i++)s=l[i],a=e.layer_config[s.split(".")[0]]||{},console.log(a),this.layers.push(L.tileLayer.provider(s,a.options).addTo(this.map))}},search:function(t){var e=this,s={};if(void 0!==this._wait_address&&(clearTimeout(this._wait_address),delete this._wait_address),!s.g||s.g!==this.$address.val())return 27==t.originalEvent.keyCode?(t.preventDefault(),this.$results.html(""),this.$address.blur(),!1):void(this._wait_address=setTimeout(function(){s={q:e.$address.val(),limit:5,lon:e.$lng.val(),lat:e.$lat.val()},e.fetch_results("https://photon.komoot.de/api/",s,function(t){delete this._wait_address})},666))},clear_results:function(){this.$results.html("")},build_results:function(e){var s=this,a=e.features.length,i=this.$address.val(),r=e.features;this.clear_results(),a&&t.each(r,function(e,a){var r=t('<div tabindex="'+e+'" class="osm-result"></div>'),l=s.format_result(a),n=l.replace(new RegExp("("+i.split(/[^a-z0-9]/).join("|")+")","gi"),"<strong>$1</strong>");n+="<br /><small>("+s.nice_words(a.properties.osm_value)+")</small>",r.data({text:l,bounds:a.properties.extent,coord:a.geometry.coordinates}).html(n).appendTo(s.$results)})},fetch_results:function(e,s,a){var i=this;t.ajax({url:e,method:"get",data:s,success:function(t){i.build_results(t),"function"==typeof a&&a.apply(i,[t])}})},click_result:function(e){var s=t(e.target).data(),a=L.latLng(s.coord[1],s.coord[0]);s.ext?this.map.fitBounds(L.latLngBounds(L.latLng(s.ext[1],s.ext[0]),L.latLng(s.ext[3],s.ext[2]))):this.map.setView(a,this.map.getZoom()),this.$address.val(s.text),this.clear_results(),this.marker.title=s.text,this.set_marker(a)},keyup_result:function(e){40==e.originalEvent.keyCode?(t(e.target).next(".osm-result").focus(),e.preventDefault()):38==e.originalEvent.keyCode&&(t(e.target).prev(".osm-result").focus(),e.preventDefault())},focus_result:function(e){var s=t(e.target).data();s.ext?this.map.fitBounds(L.latLngBounds(L.latLng(s.ext[1],s.ext[0]),L.latLng(s.ext[3],s.ext[2]))):this.map.setView(L.latLng(s.coord[1],s.coord[0]),this.map.getZoom())},format_result:function(t){return this.get_result_words(t).join(", ")},get_result_words:function(e){var s=[],a=["name","street","housenumber","city","postcode","state","country"];return t.each(a,function(t,a){try{e.properties[a]&&s.push(e.properties[a])}catch(t){}}),Array.from(new Set(s))},nice_words:function(t){return t.split(/[\s_]/).map(function(t){return t[0].toUpperCase()+t.substring(1)}).join(" ")}}),void 0!==acf.add_action?acf.add_action("ready append",function(t){acf.get_fields({type:"open_street_map"},t).each(function(){new s.field({el:this})})}):t(document).on("acf/setup_fields",function(e,a){t(a).find('.field[data-field_type="open_street_map"]').each(function(){new s.field({el:this})})})}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1pbnB1dC1vc20uanMiXSwibmFtZXMiOlsiJCIsIm9wdGlvbnMiLCJhY2Zfb3NtIiwiY29uc29sZSIsImxvZyIsIm9zbSIsImZpZWxkIiwiQmFja2JvbmUiLCJWaWV3IiwiZXh0ZW5kIiwiJG1hcCIsIiR6b29tIiwiJGxhdCIsIiRsbmciLCIkYWRkcmVzcyIsIiRsYXllcnMiLCJtYXJrZXIiLCJpY29uIiwibWFwIiwibGF5ZXJzIiwiZXZlbnRzIiwia2V5dXAgW2RhdGEtcHJvcD1cImFkZHJlc3NcIl0iLCJmb2N1cyBbZGF0YS1wcm9wPVwiYWRkcmVzc1wiXSIsImNsaWNrIC5vc20tcmVzdWx0Iiwia2V5dXAgLm9zbS1yZXN1bHQiLCJmb2N1cyAub3NtLXJlc3VsdCIsImluaXRpYWxpemUiLCJ0aGlzIiwiJGVsIiwiZmluZCIsIiRyZXN1bHRzIiwibmV4dCIsIkwiLCJkaXZJY29uIiwiY2xhc3NOYW1lIiwiaHRtbCIsImljb25TaXplIiwiZ2V0Iiwic2Nyb2xsV2hlZWxab29tIiwiY2VudGVyIiwidmFsIiwiem9vbSIsInRpdGxlIiwiYWRkVG8iLCJpcyIsImFjZiIsInNlbGVjdDIiLCJpbml0IiwibXVsdGlwbGUiLCJ1aSIsImFsbG93X251bGwiLCJhamF4IiwiYmluZF9ldmVudHMiLCJ1cGRhdGVfbGF5ZXJzIiwic2VsZiIsImxpc3RlblRvIiwib24iLCJlIiwibWFwX3pvb21lZCIsImFwcGx5IiwibWFwX21vdmVkIiwibWFwX2NsaWNrZWQiLCJnZXRDZW50ZXIiLCJsYXQiLCJsbmciLCJnZXRab29tIiwiY29vcmQiLCJsYXRsbmciLCJmZXRjaF9yZXN1bHRzIiwibG9uIiwicmVzcG9uc2UiLCJmbXQiLCJpIiwibGVuIiwiZmVhdHVyZXMiLCJsZW5ndGgiLCJmb3JtYXRfcmVzdWx0Iiwic2V0X21hcmtlciIsIl9pY29uIiwiYXR0ciIsInNldExhdExuZyIsInByb3ZpZGVyIiwibGF5ZXJfY29uZmlnIiwiZWFjaCIsInYiLCJBcnJheSIsImlzQXJyYXkiLCJjb25jYXQiLCJwdXNoIiwicmVtb3ZlTGF5ZXIiLCJwb3AiLCJzcGxpdCIsInRpbGVMYXllciIsInNlYXJjaCIsImRhdGEiLCJfd2FpdF9hZGRyZXNzIiwiY2xlYXJUaW1lb3V0Iiwib3JpZ2luYWxFdmVudCIsImtleUNvZGUiLCJwcmV2ZW50RGVmYXVsdCIsImJsdXIiLCJzZXRUaW1lb3V0IiwicSIsImxpbWl0IiwiY2xlYXJfcmVzdWx0cyIsImJ1aWxkX3Jlc3VsdHMiLCJmZWF0IiwiZWwiLCIkcmVzIiwicmVwbGFjZSIsIlJlZ0V4cCIsImpvaW4iLCJuaWNlX3dvcmRzIiwicHJvcGVydGllcyIsIm9zbV92YWx1ZSIsInRleHQiLCJib3VuZHMiLCJleHRlbnQiLCJnZW9tZXRyeSIsImNvb3JkaW5hdGVzIiwiYXBwZW5kVG8iLCJ1cmwiLCJjYWxsYmFjayIsIm1ldGhvZCIsInN1Y2Nlc3MiLCJjbGlja19yZXN1bHQiLCJ0YXJnZXQiLCJsYXRMbmciLCJleHQiLCJmaXRCb3VuZHMiLCJsYXRMbmdCb3VuZHMiLCJzZXRWaWV3Iiwia2V5dXBfcmVzdWx0IiwiZm9jdXMiLCJwcmV2IiwiZm9jdXNfcmVzdWx0IiwiaGl0IiwiZ2V0X3Jlc3VsdF93b3JkcyIsImgiLCJwcm9wcyIsInByb3AiLCJlcnIiLCJmcm9tIiwiU2V0Iiwic3RyIiwicyIsInRvVXBwZXJDYXNlIiwic3Vic3RyaW5nIiwiYWRkX2FjdGlvbiIsImdldF9maWVsZHMiLCJ0eXBlIiwiZG9jdW1lbnQiLCJwb3N0Ym94IiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFVQSxHQUNULEdBQUlDLEdBQVVDLFFBQVFELE9BQ3RCRSxTQUFRQyxJQUFJLFdBRVosSUFBSUMsS0FFSkEsR0FBSUMsTUFBUUMsU0FBU0MsS0FBS0MsUUFDekJDLEtBQU0sS0FDTkMsTUFBTyxLQUNQQyxLQUFNLEtBQ05DLEtBQU0sS0FDTkMsU0FBVSxLQUNWQyxRQUFTLEtBQ1RDLE9BQVEsS0FDUkMsS0FBSyxLQUNMQyxJQUFLLEtBQ0xDLFVBQ0FDLFFBQ0ND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S0FBSyxHQUFJQyxLQUFJTCxLQUUzQjFCLFdBQVksU0FBU2dDLEdBQ3BCLE1BQU9BLEdBQUlyRCxNQUFNLFNBQVN6RSxJQUFJLFNBQVMrSCxHQUFJLE1BQU9BLEdBQUUsR0FBR0MsY0FBZ0JELEVBQUVFLFVBQVUsS0FBT3BDLEtBQUssWUFNbkUsS0FBbkJsRSxJQUFJdUcsV0FnQmR2RyxJQUFJdUcsV0FBVyxlQUFnQixTQUFVeEgsR0FHeENpQixJQUFJd0csWUFBYUMsS0FBTyxtQkFBb0IxSCxHQUFLdUQsS0FBSyxXQUVyRCxHQUFJOUUsR0FBSUMsT0FBU3FHLEdBQUloRixXQXdCdkIzQixFQUFFdUosVUFBVS9GLEdBQUcsbUJBQW9CLFNBQVNDLEVBQUcrRixHQUU5Q3hKLEVBQUV3SixHQUFTM0gsS0FBSyw2Q0FBNkNzRCxLQUFLLFdBRWpFLEdBQUk5RSxHQUFJQyxPQUFTcUcsR0FBSWhGLFlBVXRCOEgiLCJmaWxlIjoiYWNmLWlucHV0LW9zbS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oJCl7XG5cdHZhciBvcHRpb25zID0gYWNmX29zbS5vcHRpb25zO1xuXHRjb25zb2xlLmxvZygnaW5wdXQganMnKVxuXG5cdHZhciBvc20gPSB7XG5cdH07XG5cdG9zbS5maWVsZCA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcblx0XHQkbWFwOiBudWxsLFxuXHRcdCR6b29tOiBudWxsLFxuXHRcdCRsYXQ6IG51bGwsXG5cdFx0JGxuZzogbnVsbCxcblx0XHQkYWRkcmVzczogbnVsbCxcblx0XHQkbGF5ZXJzOiBudWxsLFxuXHRcdG1hcmtlcjogbnVsbCxcblx0XHRpY29uOm51bGwsXG5cdFx0bWFwOiBudWxsLFxuXHRcdGxheWVyczpbXSxcblx0XHRldmVudHM6e1xuXHRcdFx0J2tleXVwIFtkYXRhLXByb3A9XCJhZGRyZXNzXCJdJyA6ICdzZWFyY2gnLFxuXHRcdFx0J2ZvY3VzIFtkYXRhLXByb3A9XCJhZGRyZXNzXCJdJyA6ICdzZWFyY2gnLFxuXG5cdFx0XHQnY2xpY2sgLm9zbS1yZXN1bHQnXHQ6ICdjbGlja19yZXN1bHQnLFxuXHRcdFx0J2tleXVwIC5vc20tcmVzdWx0J1x0OiAna2V5dXBfcmVzdWx0Jyxcblx0XHRcdCdmb2N1cyAub3NtLXJlc3VsdCdcdDogJ2ZvY3VzX3Jlc3VsdCcsXG5cdFx0fSxcblx0XHRpbml0aWFsaXplOmZ1bmN0aW9uKCkge1xuXHRcdC8vXHR0aGlzLiRlbFx0XHQ9IHRoaXMuYXR0cmlidXRlcy4kZWw7XG5cdFx0XHR0aGlzLiRtYXBcdFx0PSB0aGlzLiRlbC5maW5kKCcuYWNmLW9zbS1tYXAnKTtcblx0XHRcdHRoaXMuJHpvb21cdFx0PSB0aGlzLiRlbC5maW5kKCdbZGF0YS1wcm9wPVwiem9vbVwiXScpO1xuXHRcdFx0dGhpcy4kbGF0XHRcdD0gdGhpcy4kZWwuZmluZCgnW2RhdGEtcHJvcD1cImNlbnRlcl9sYXRcIl0nKTtcblx0XHRcdHRoaXMuJGxuZ1x0XHQ9IHRoaXMuJGVsLmZpbmQoJ1tkYXRhLXByb3A9XCJjZW50ZXJfbG5nXCJdJyk7XG5cdFx0XHR0aGlzLiRsYXllcnNcdD0gdGhpcy4kZWwuZmluZCgnW2RhdGEtcHJvcD1cImxlYWZsZXRfbGF5ZXJzXCJdJyk7XG5cdFx0XHR0aGlzLiRhZGRyZXNzXHQ9IHRoaXMuJGVsLmZpbmQoJ1tkYXRhLXByb3A9XCJhZGRyZXNzXCJdJyk7XG5cdFx0XHR0aGlzLiRyZXN1bHRzXHQ9IHRoaXMuJGFkZHJlc3MubmV4dCgnLm9zbS1yZXN1bHRzJyk7XG5cdFx0XHR0aGlzLmljb25cdFx0PSBMLmRpdkljb24oIHsgY2xhc3NOYW1lOiAnb3NtLW1hcmtlcicsIGh0bWw6JycsIGljb25TaXplOjAgfSApO1xuXHRcdFx0dGhpcy5tYXBcdFx0PSBMLm1hcCggdGhpcy4kbWFwLmdldCgwKSwge1xuXHRcdFx0XHRzY3JvbGxXaGVlbFpvb206IGZhbHNlLFxuXHRcdFx0XHRjZW50ZXI6IFsgdGhpcy4kbGF0LnZhbCgpLCB0aGlzLiRsbmcudmFsKCkgXSxcblx0XHRcdFx0em9vbTogdGhpcy4kem9vbS52YWwoKVxuXHRcdFx0fSApO1xuXHRcdFx0dGhpcy5tYXJrZXJcdFx0PSBMLm1hcmtlcihcblx0XHRcdFx0WyB0aGlzLiRsYXQudmFsKCksIHRoaXMuJGxuZy52YWwoKSBdLFxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0aWNvbjp0aGlzLmljb24sXG5cdFx0XHRcdFx0dGl0bGU6dGhpcy4kYWRkcmVzcy52YWwoKVxuXHRcdFx0XHR9XG5cdFx0XHQpLmFkZFRvKHRoaXMubWFwKTtcblxuXHRcdFx0dGhpcy5sYXllcnNcdD0gW107XG5cdFx0XHRpZiAoIHRoaXMuJGxheWVycy5pcygnc2VsZWN0JykgKSB7XG5cdFx0XHRcdGFjZi5zZWxlY3QyLmluaXQoIHRoaXMuJGxheWVycywge1xuXHRcdFx0XHRcdG11bHRpcGxlOiB0cnVlLFxuXHRcdFx0XHRcdHVpOiB0cnVlLFxuXHRcdFx0XHRcdGFsbG93X251bGw6IGZhbHNlLFxuXHRcdFx0XHRcdGFqYXg6ZmFsc2UsXG5cdFx0XHRcdH0sIHRoaXMuJGVsICk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuYmluZF9ldmVudHMoKTtcblxuXHRcdFx0dGhpcy51cGRhdGVfbGF5ZXJzKCk7XG5cdFx0fSxcblx0XHRiaW5kX2V2ZW50czogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cbi8vXHRcdFx0dGhpcy5saXN0ZW5UbyggdGhpcy4kYWRkcmVzcywgJ2tleXVwIGZvY3VzJywgdGhpcy5zZWFyY2ggKTtcblxuXHRcdFx0dGhpcy5saXN0ZW5UbyggdGhpcy4kbGF5ZXJzLCAnY2hhbmdlJywgdGhpcy51cGRhdGVfbGF5ZXJzICk7XG5cblx0XHRcdHRoaXMubWFwLm9uKCd6b29tZW5kJywgZnVuY3Rpb24oZSl7IHNlbGYubWFwX3pvb21lZC5hcHBseShzZWxmLFtlXSk7IH0gKTtcblx0XHRcdHRoaXMubWFwLm9uKCdtb3ZlZW5kJywgZnVuY3Rpb24oZSl7IHNlbGYubWFwX21vdmVkLmFwcGx5KHNlbGYsW2VdKTsgfSAgKTtcblx0XHRcdHRoaXMubWFwLm9uKCdjbGljaycsICAgZnVuY3Rpb24oZSl7IHNlbGYubWFwX2NsaWNrZWQuYXBwbHkoc2VsZixbZV0pOyB9ICk7XG5cblx0XHRcdC8vIHRoaXMuJHRpbGVzLm9uKCdjaGFuZ2UnLCBkb19sYXllcnMgKVxuXHRcdFx0Ly8gXHQucHJldignaW5wdXQnKS5vbignY2hhbmdlJywgZG9fbGF5ZXJzICk7XG5cblx0XHR9LFxuXG5cdFx0bWFwX21vdmVkOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dmFyIGNlbnRlciA9IHRoaXMubWFwLmdldENlbnRlcigpO1xuXHRcdFx0dGhpcy4kbGF0LnZhbChjZW50ZXIubGF0KTtcblx0XHRcdHRoaXMuJGxuZy52YWwoY2VudGVyLmxuZyk7XG5cdFx0fSxcblx0XHRtYXBfem9vbWVkOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dGhpcy4kem9vbS52YWwoIHRoaXMubWFwLmdldFpvb20oKSApO1xuXHRcdH0sXG5cdFx0bWFwX2NsaWNrZWQ6ZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgY29vcmQgPSBlLmxhdGxuZztcblxuXHRcdFx0dGhpcy5mZXRjaF9yZXN1bHRzKCdodHRwczovL3Bob3Rvbi5rb21vb3QuZGUvcmV2ZXJzZScsIHtcblx0XHRcdFx0bG9uOmNvb3JkLmxuZyxcblx0XHRcdFx0bGF0OmNvb3JkLmxhdCxcblx0XHRcdH0sIGZ1bmN0aW9uKHJlc3BvbnNlKXtcblx0XHRcdFx0dmFyIGk9MCxsZW49cmVzcG9uc2UuZmVhdHVyZXMubGVuZ3RoLGZtdDtcblx0XHRcdFx0Zm9yIChpO2k8bGVuO2krKyl7XG5cdFx0XHRcdFx0Zm10ID0gdGhpcy5mb3JtYXRfcmVzdWx0KCByZXNwb25zZS5mZWF0dXJlc1tpXSApO1xuXHRcdFx0XHRcdHRoaXMubWFya2VyLnRpdGxlID0gZm10O1xuXHRcdFx0XHRcdC8qXG5cdFx0XHRcdFx0dGhpcy5zZXRfbWFya2VyKCBMLmxhdExuZyggcmVzcG9uc2UuZmVhdHVyZXNbaV0uZ2VvbWV0cnkuY29vcmRpbmF0ZXNbMV0sIHJlc3BvbnNlLmZlYXR1cmVzW2ldLmdlb21ldHJ5LmNvb3JkaW5hdGVzWzBdICkgICk7XG5cdFx0XHRcdFx0LyovXG5cdFx0XHRcdFx0dGhpcy5zZXRfbWFya2VyKCBjb29yZCApO1xuXHRcdFx0XHRcdC8vKi9cblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0fSApO1xuXHRcdFx0dGhpcy5zZXRfbWFya2VyKCBlLmxhdGxuZyApO1xuXHRcdH0sXG5cdFx0c2V0X21hcmtlcjpmdW5jdGlvbihjb29yZCl7XG5cblx0XHRcdCQodGhpcy5tYXJrZXIuX2ljb24pLmF0dHIoICd0aXRsZScsIHRoaXMubWFya2VyLnRpdGxlICk7XG5cdFx0XHR0aGlzLm1hcmtlci5zZXRMYXRMbmcoY29vcmQpO1xuXHRcdH0sXG5cblx0XHR1cGRhdGVfbGF5ZXJzOiBmdW5jdGlvbigpe1xuXHRcdFx0dmFyIHZhbCA9IFtdLFxuXHRcdFx0XHRwcm92aWRlciwgbGF5ZXJfY29uZmlnLCBpLCBsZW47XG5cblx0XHRcdGlmICggbnVsbCA9PT0gdmFsICkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHR0aGlzLiRsYXllcnMuZWFjaChmdW5jdGlvbigpe1xuXHRcdFx0XHR2YXIgdiA9ICQodGhpcykudmFsKCk7XG5cdFx0XHRcdGlmICggQXJyYXkuaXNBcnJheSh2YWwpICkge1xuXHRcdFx0XHRcdHZhbCA9IHZhbC5jb25jYXQodilcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR2YWwucHVzaCh2KVxuXHRcdFx0XHR9XG5cblx0XHRcdH0pO1xuXG5cdFx0XHQvLyByZW1vdmUgbGF5ZXJzXG5cdFx0XHR3aGlsZSAoIHRoaXMubGF5ZXJzLmxlbmd0aCApIHtcblx0XHRcdFx0dGhpcy5tYXAucmVtb3ZlTGF5ZXIoIHRoaXMubGF5ZXJzLnBvcCgpICk7XG5cdFx0XHR9XG5cblx0XHRcdGxlbiA9IHZhbC5sZW5ndGg7XG5cdFx0XHRmb3IgKCBpPTA7aTxsZW47aSsrICkge1xuXHRcdFx0XHRwcm92aWRlciA9IHZhbFtpXTtcblx0XHRcdFx0bGF5ZXJfY29uZmlnID0gb3B0aW9ucy5sYXllcl9jb25maWdbIHByb3ZpZGVyLnNwbGl0KCcuJylbMF0gXSB8fCB7fTtcblx0XHRcdFx0Y29uc29sZS5sb2cobGF5ZXJfY29uZmlnKTtcblx0XHRcdFx0dGhpcy5sYXllcnMucHVzaCggTC50aWxlTGF5ZXIucHJvdmlkZXIoIHByb3ZpZGVyLCBsYXllcl9jb25maWcub3B0aW9ucyApLmFkZFRvKHRoaXMubWFwKSApO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRzZWFyY2g6ZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdGRhdGEgPSB7fTtcblx0XHRcdGlmICggJ3VuZGVmaW5lZCcgIT09IHR5cGVvZiB0aGlzLl93YWl0X2FkZHJlc3MgKSB7XG5cdFx0XHRcdGNsZWFyVGltZW91dCh0aGlzLl93YWl0X2FkZHJlc3MpO1xuXHRcdFx0XHRkZWxldGUgdGhpcy5fd2FpdF9hZGRyZXNzO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoISEgZGF0YVsnZyddICYmIGRhdGFbJ2cnXSA9PT0gdGhpcy4kYWRkcmVzcy52YWwoKSApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIDI3ID09IGUub3JpZ2luYWxFdmVudC5rZXlDb2RlICkgeyAvLyBlc2Ncblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR0aGlzLiRyZXN1bHRzLmh0bWwoJycpO1xuXHRcdFx0XHR0aGlzLiRhZGRyZXNzLmJsdXIoKTtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5fd2FpdF9hZGRyZXNzID0gc2V0VGltZW91dCggZnVuY3Rpb24oKXtcblx0XHRcdFx0ZGF0YSA9IHtcblx0XHRcdFx0XHRxOnNlbGYuJGFkZHJlc3MudmFsKCksXG4vL1x0XHRcdFx0XHRcdGxhbmc6J2RlJywgLcK0Ly8gLT4gV1AtTGFuZyFcblx0XHRcdFx0XHRsaW1pdDo1LFxuXHRcdFx0XHRcdGxvbjpzZWxmLiRsbmcudmFsKCksXG5cdFx0XHRcdFx0bGF0OnNlbGYuJGxhdC52YWwoKSxcblx0XHRcdFx0fTtcblx0XHRcdFx0c2VsZi5mZXRjaF9yZXN1bHRzKCdodHRwczovL3Bob3Rvbi5rb21vb3QuZGUvYXBpLycsZGF0YSwgZnVuY3Rpb24ocmVzcG9uc2Upe1xuXHRcdFx0XHRcdGRlbGV0ZSB0aGlzLl93YWl0X2FkZHJlc3M7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSwgNjY2ICk7XG5cblx0XHR9LFxuXHRcdGNsZWFyX3Jlc3VsdHM6ZnVuY3Rpb24oKXtcblx0XHRcdHRoaXMuJHJlc3VsdHMuaHRtbCgnJyk7XG5cdFx0fSxcblx0XHRidWlsZF9yZXN1bHRzOmZ1bmN0aW9uKHJlc3BvbnNlKXtcblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0aT0wLCBsZW4gPSByZXNwb25zZS5mZWF0dXJlcy5sZW5ndGgsXG5cdFx0XHRcdHEgPSB0aGlzLiRhZGRyZXNzLnZhbCgpLFxuXHRcdFx0XHRmZWF0ID0gcmVzcG9uc2UuZmVhdHVyZXM7Ly9zb3J0X2Z1enp5KCByZXNwb25zZS5mZWF0dXJlcywgcSApO1xuXG5cdFx0XHR0aGlzLmNsZWFyX3Jlc3VsdHMoKTtcblxuXHRcdFx0aWYgKCBsZW4gKSB7XG5cdFx0XHRcdCQuZWFjaCggZmVhdCwgZnVuY3Rpb24oaSxlbCl7XG5cdFx0XHRcdFx0dmFyICRyZXMgPSAkKCc8ZGl2IHRhYmluZGV4PVwiJytpKydcIiBjbGFzcz1cIm9zbS1yZXN1bHRcIj48L2Rpdj4nKSxcblx0XHRcdFx0XHRcdC8vIGNvb3JkID0gZWwuZ2VvbWV0cnkuY29vcmRpbmF0ZXMsXG5cdFx0XHRcdFx0XHQvLyBleHQgPSBlbC5wcm9wZXJ0aWVzLmV4dGVudCxcblx0XHRcdFx0XHRcdGZtdCA9IHNlbGYuZm9ybWF0X3Jlc3VsdCggZWwgKSxcblx0XHRcdFx0XHRcdGh0bWwgPSBmbXQucmVwbGFjZSggbmV3IFJlZ0V4cChcIihcIitxLnNwbGl0KC9bXmEtejAtOV0vKS5qb2luKCd8JykrXCIpXCIsJ2dpJyksXCI8c3Ryb25nPiQxPC9zdHJvbmc+XCIpO1xuXHRcdFx0XHRcdGh0bWwgKz0gJzxiciAvPjxzbWFsbD4oJyArIHNlbGYubmljZV93b3JkcyggZWwucHJvcGVydGllcy5vc21fdmFsdWUgKSArICcpPC9zbWFsbD4nO1xuXG5cdFx0XHRcdFx0JHJlcy5kYXRhKHtcblx0XHRcdFx0XHRcdHRleHQ6Zm10LFxuXHRcdFx0XHRcdFx0Ym91bmRzOmVsLnByb3BlcnRpZXMuZXh0ZW50LFxuXHRcdFx0XHRcdFx0Y29vcmQ6ZWwuZ2VvbWV0cnkuY29vcmRpbmF0ZXMsXG5cdFx0XHRcdFx0fSkuaHRtbCggaHRtbCApLmFwcGVuZFRvKHNlbGYuJHJlc3VsdHMpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdH0sXG5cdFx0ZmV0Y2hfcmVzdWx0czogZnVuY3Rpb24odXJsLGRhdGEsIGNhbGxiYWNrKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cdFx0XHQkLmFqYXgoe1xuXHRcdFx0XHR1cmw6dXJsLFxuXHRcdFx0XHRtZXRob2Q6J2dldCcsXG5cdFx0XHRcdGRhdGE6ZGF0YSxcblx0XHRcdFx0c3VjY2VzczpmdW5jdGlvbihyZXNwb25zZSkge1xuXHRcdFx0XHRcdHNlbGYuYnVpbGRfcmVzdWx0cyhyZXNwb25zZSk7XG5cdFx0XHRcdFx0J2Z1bmN0aW9uJyA9PT0gdHlwZW9mIGNhbGxiYWNrICYmIGNhbGxiYWNrLmFwcGx5KHNlbGYsW3Jlc3BvbnNlXSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0fSxcblxuXHRcdGNsaWNrX3Jlc3VsdDpmdW5jdGlvbihlKXtcblx0XHRcdHZhciBkYXRhID0gJChlLnRhcmdldCkuZGF0YSgpLFxuXHRcdFx0XHRsYXRsbmcgPSBMLmxhdExuZyggZGF0YS5jb29yZFsxXSwgZGF0YS5jb29yZFswXSApO1xuXG5cdFx0XHRpZiAoIGRhdGEuZXh0ICkge1xuXG5cdFx0XHRcdHRoaXMubWFwLmZpdEJvdW5kcyggTC5sYXRMbmdCb3VuZHMoXG5cdFx0XHRcdFx0TC5sYXRMbmcoIGRhdGEuZXh0WzFdLCBkYXRhLmV4dFswXSApLFxuXHRcdFx0XHRcdEwubGF0TG5nKCBkYXRhLmV4dFszXSwgZGF0YS5leHRbMl0gKVxuXHRcdFx0XHQpICk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLm1hcC5zZXRWaWV3KCBsYXRsbmcsIHRoaXMubWFwLmdldFpvb20oKSApO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy4kYWRkcmVzcy52YWwoIGRhdGEudGV4dCApO1xuXHRcdFx0dGhpcy5jbGVhcl9yZXN1bHRzKCk7XG5cblx0XHRcdHRoaXMubWFya2VyLnRpdGxlID0gZGF0YS50ZXh0O1xuXHRcdFx0dGhpcy5zZXRfbWFya2VyKCBsYXRsbmcgKTtcblx0XHR9LFxuXG5cdFx0a2V5dXBfcmVzdWx0OmZ1bmN0aW9uKGUpe1xuXHRcdFx0aWYgKGUub3JpZ2luYWxFdmVudC5rZXlDb2RlID09IDQwKSB7IC8vIGRvd25cblx0XHRcdFx0JCggZS50YXJnZXQgKS5uZXh0KCcub3NtLXJlc3VsdCcpLmZvY3VzKCk7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKVxuXHRcdFx0fSBlbHNlIGlmIChlLm9yaWdpbmFsRXZlbnQua2V5Q29kZSA9PSAzOCkge1xuXHRcdFx0XHQkKCBlLnRhcmdldCApLnByZXYoJy5vc20tcmVzdWx0JykuZm9jdXMoKTtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpXG5cdFx0XHR9XG5cblx0XHR9LFxuXHRcdGZvY3VzX3Jlc3VsdDpmdW5jdGlvbihlKXtcblx0XHRcdHZhciBkYXRhID0gJChlLnRhcmdldCkuZGF0YSgpO1xuXG5cdFx0XHRpZiAoIGRhdGEuZXh0ICkge1xuXHRcdFx0XHR0aGlzLm1hcC5maXRCb3VuZHMoIEwubGF0TG5nQm91bmRzKFxuXHRcdFx0XHRcdEwubGF0TG5nKCBkYXRhLmV4dFsxXSwgZGF0YS5leHRbMF0gKSxcblx0XHRcdFx0XHRMLmxhdExuZyggZGF0YS5leHRbM10sIGRhdGEuZXh0WzJdIClcblx0XHRcdFx0KSApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5tYXAuc2V0VmlldyggTC5sYXRMbmcoIGRhdGEuY29vcmRbMV0sIGRhdGEuY29vcmRbMF0gKSwgdGhpcy5tYXAuZ2V0Wm9vbSgpICk7XG5cdFx0XHR9XG5cblx0XHR9LFxuXG5cdFx0Zm9ybWF0X3Jlc3VsdDogZnVuY3Rpb24oIGhpdCApIHtcblx0XHRcdHJldHVybiB0aGlzLmdldF9yZXN1bHRfd29yZHMoIGhpdCApLmpvaW4oJywgJyk7XG5cdFx0fSxcblxuXHRcdGdldF9yZXN1bHRfd29yZHM6IGZ1bmN0aW9uKCBoaXQgKSB7XG5cblx0XHRcdHZhciBoID0gW10sXG5cdFx0XHRcdHByb3BzID0gWyAnbmFtZScsJ3N0cmVldCcsJ2hvdXNlbnVtYmVyJywnY2l0eScsJ3Bvc3Rjb2RlJywnc3RhdGUnLCdjb3VudHJ5JyBdO1xuXHRcdFx0JC5lYWNoKHByb3BzLCBmdW5jdGlvbihpLHByb3ApIHtcblx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRpZiAoICEhIGhpdC5wcm9wZXJ0aWVzW3Byb3BdICkge1xuXHRcdFx0XHRcdFx0aC5wdXNoKGhpdC5wcm9wZXJ0aWVzW3Byb3BdKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gY2F0Y2goZXJyKXt9XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiBBcnJheS5mcm9tKG5ldyBTZXQoaCkpO1xuXHRcdH0sXG5cdFx0bmljZV93b3JkczogZnVuY3Rpb24oc3RyKSB7XG5cdFx0XHRyZXR1cm4gc3RyLnNwbGl0KC9bXFxzX10vKS5tYXAoZnVuY3Rpb24ocyl7IHJldHVybiBzWzBdLnRvVXBwZXJDYXNlKCkgKyBzLnN1YnN0cmluZygxKTsgfSkuam9pbignICcpO1xuXHRcdH1cblxuXHR9KTtcblxuXG5cdGlmKCB0eXBlb2YgYWNmLmFkZF9hY3Rpb24gIT09ICd1bmRlZmluZWQnICkge1xuXG5cdFx0Lypcblx0XHQqICByZWFkeSBhcHBlbmQgKEFDRjUpXG5cdFx0KlxuXHRcdCogIFRoZXNlIGFyZSAyIGV2ZW50cyB3aGljaCBhcmUgZmlyZWQgZHVyaW5nIHRoZSBwYWdlIGxvYWRcblx0XHQqICByZWFkeSA9IG9uIHBhZ2UgbG9hZCBzaW1pbGFyIHRvICQoZG9jdW1lbnQpLnJlYWR5KClcblx0XHQqICBhcHBlbmQgPSBvbiBuZXcgRE9NIGVsZW1lbnRzIGFwcGVuZGVkIHZpYSByZXBlYXRlciBmaWVsZFxuXHRcdCpcblx0XHQqICBAdHlwZVx0ZXZlbnRcblx0XHQqICBAZGF0ZVx0MjAvMDcvMTNcblx0XHQqXG5cdFx0KiAgQHBhcmFtXHQkZWwgKGpRdWVyeSBzZWxlY3Rpb24pIHRoZSBqUXVlcnkgZWxlbWVudCB3aGljaCBjb250YWlucyB0aGUgQUNGIGZpZWxkc1xuXHRcdCogIEByZXR1cm5cdG4vYVxuXHRcdCovXG5cblx0XHRhY2YuYWRkX2FjdGlvbigncmVhZHkgYXBwZW5kJywgZnVuY3Rpb24oICRlbCApe1xuXG5cdFx0XHQvLyBzZWFyY2ggJGVsIGZvciBmaWVsZHMgb2YgdHlwZSAnRklFTERfTkFNRSdcblx0XHRcdGFjZi5nZXRfZmllbGRzKHsgdHlwZSA6ICdvcGVuX3N0cmVldF9tYXAnfSwgJGVsKS5lYWNoKGZ1bmN0aW9uKCl7XG5cblx0XHRcdFx0bmV3IG9zbS5maWVsZCggeyBlbDogdGhpcyB9ICk7XG5cblx0XHRcdH0pO1xuXG5cdFx0fSk7XG5cblx0fSBlbHNlIHtcblxuXG5cdFx0Lypcblx0XHQqICBhY2Yvc2V0dXBfZmllbGRzIChBQ0Y0KVxuXHRcdCpcblx0XHQqICBUaGlzIGV2ZW50IGlzIHRyaWdnZXJlZCB3aGVuIEFDRiBhZGRzIGFueSBuZXcgZWxlbWVudHMgdG8gdGhlIERPTS5cblx0XHQqXG5cdFx0KiAgQHR5cGVcdGZ1bmN0aW9uXG5cdFx0KiAgQHNpbmNlXHQxLjAuMFxuXHRcdCogIEBkYXRlXHQwMS8wMS8xMlxuXHRcdCpcblx0XHQqICBAcGFyYW1cdGV2ZW50XHRcdGU6IGFuIGV2ZW50IG9iamVjdC4gVGhpcyBjYW4gYmUgaWdub3JlZFxuXHRcdCogIEBwYXJhbVx0RWxlbWVudFx0XHRwb3N0Ym94OiBBbiBlbGVtZW50IHdoaWNoIGNvbnRhaW5zIHRoZSBuZXcgSFRNTFxuXHRcdCpcblx0XHQqICBAcmV0dXJuXHRuL2Fcblx0XHQqL1xuXG5cdFx0JChkb2N1bWVudCkub24oJ2FjZi9zZXR1cF9maWVsZHMnLCBmdW5jdGlvbihlLCBwb3N0Ym94KXtcblxuXHRcdFx0JChwb3N0Ym94KS5maW5kKCcuZmllbGRbZGF0YS1maWVsZF90eXBlPVwib3Blbl9zdHJlZXRfbWFwXCJdJykuZWFjaChmdW5jdGlvbigpe1xuXG5cdFx0XHRcdG5ldyBvc20uZmllbGQoIHsgZWw6IHRoaXMgfSApO1xuXG5cdFx0XHR9KTtcblxuXHRcdH0pO1xuXG5cblx0fVxuXG5cbn0pKGpRdWVyeSk7XG4iXX0=
