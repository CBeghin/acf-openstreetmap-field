!function(c,i){i.options;var n={};n.MarkerList=Backbone.View.extend({}),n.MarkerEntry=Backbone.View.extend({tagName:"div",className:"osm-marker",events:{'click [data-name="locate-marker"]':"locate_marker",'click [data-name="remove-marker"]':"remove_marker",'change [id$="-marker-label"]':"update_marker_label"},get_label:function(){return this.$el.find('[id$="-marker-label"]').val()},get_default_label:function(){return this.$el.find('[id$="-marker-geocode"]').val()},is_default_label:function(){return this.get_default_label()===this.get_label()},initialize:function(e){return this.template=e.template,this.marker=e.marker,this.marker.osm_controller=this},render:function(){var t=this;return this.$el.html(this.template(this)),this._update_values_from_marker(),this.$el.height(this.$el.data("height")),this.$el.find('[id$="-marker-label"]').on("focus",function(e){t.hilite_marker()}).on("blur",function(e){t.lolite_marker()}),c(this.marker._icon).on("focus",function(e){t.hilite_marker()}).on("blur",function(e){t.lolite_marker()}),this},update_marker_label:function(e){var t=this.get_label();return""===t&&(t=this.get_default_label()),c(e.target).val(t),this.set_marker_label(t)},set_marker_label:function(e){return this.marker.unbindTooltip(),this.marker.bindTooltip(e),this.marker.options.title=e,c(this.marker._icon).attr("title",e),this},update_marker_geocode:function(e){return this.is_default_label()&&this.set_marker_label(e),this.$el.find('[id$="-marker-geocode"]').val(e),this._update_values_from_marker(),this},_update_values_from_marker:function(){var e=this.marker.getLatLng();return this.$el.find('[id$="-marker-lat"]').val(e.lat),this.$el.find('[id$="-marker-lng"]').val(e.lng),this.$el.find('[id$="-marker-label"]').val(this.marker.options.title),this},hilite_marker:function(e){this.$el.addClass("focus"),c(this.marker._icon).addClass("focus")},lolite_marker:function(e){this.$el.removeClass("focus"),c(this.marker._icon).removeClass("focus")},locate_marker:function(){return this.marker._map.flyTo(this.marker.getLatLng()),this},remove_marker:function(e){return e.preventDefault(),this.marker.remove(),this}}),n.field=Backbone.View.extend({map:null,geocoder:null,visible:null,events:{},$parent:function(){return this.$el.closest(".acf-field-settings,.acf-field-open-street-map")},$zoom:function(){return this.$parent().find('input[id$="-zoom"]')},$lat:function(){return this.$parent().find('input[id$="-center_lat"]')},$lng:function(){return this.$parent().find('input[id$="-center_lng"]')},$layerStore:function(){return this.$parent().find(".acf-osm-layers")},$results:function(){return this.$parent().find(".osm-results")},$markers:function(){return this.$parent().find(".osm-markers")},initialize:function(e){return this.map=e.map,this.update_map(),this.init_acf(),this.init_layers(),this.init_markers(),this.update_visible(),this},_get_geocoder_result_label:function(e,t){var r=!1;return e.length?c.each(e,function(e,t){return r=t.html?t.html:t.name,!1}):r=t.lat.toString()+", "+t.lng.toString(),c("<p>"+r+"</p>").text().replace(/^(\s+)/g,"").replace(/(\s+)$/g,"").replace(/(\s+)/g," ")},init_markers:function(){var a=this,i=this.$el.data().editorConfig;this.init_geocode(),0!==i.max_markers&&(this.icon=new L.DivIcon({html:"",className:"osm-marker-icon"}),this.map.on("click",function(e){var r=e.latlng,t=a.$markers().children().not("[data-id]").length;!1!==i.max_markers&&t>=i.max_markers||a.geocoder.options.geocoder.reverse(e.latlng,a.map.getZoom(),function(e){var t=a._get_geocoder_result_label(e,r);a.add_marker(r,t)},a)}),this.map.on("layeradd",function(e){if(e.layer.constructor===L.Marker){var t=a.$markers().find('[data-id="__osm_marker_template__"]').html().split("__osm_marker_template__").join("<%= id %>"),r=new n.MarkerEntry({controller:this,marker:e.layer,id:acf.uniqid(),template:_.template(t)});r.render().$el.appendTo(a.$markers()),a.geocode_marker(r),e.layer.setIcon(a.icon).on("click",function(e){this.remove()}).on("remove",function(e){r.$el.remove(),a.$el.trigger("change")}).on("dragend",function(e){a.geocode_marker(r),a.$el.trigger("change")}).dragging.enable()}}),this.map.on("layerremove",function(e){e.layer.constructor===L.Marker&&a.$el.trigger("change")}),c.each(this.$el.data().mapMarkers,function(e,t){L.marker(L.latLng(1*t.lat,1*t.lng),{title:t.label}).bindTooltip(t.label).addTo(a.map)}))},geocode_marker:function(e){var r=this,a=e,i=a.marker.getLatLng();r.geocoder.options.geocoder.reverse(i,r.map.getZoom(),function(e){var t=r._get_geocoder_result_label(e,i);a.update_marker_geocode(t)},this)},add_marker:function(e,t){L.marker(e,{title:t,icon:this.icon}).bindTooltip(t).addTo(this.map),this.$el.trigger("change")},layer_is_overlay:function(e,t){var r;return!!(t.options.opacity&&t.options.opacity<1)||(r=["^(OpenWeatherMap|OpenSeaMap)","OpenMapSurfer.AdminBounds","Stamen.Toner(Hybrid|Lines|Labels)","Acetate.(foreground|labels|roads)","HillShading","Hydda.RoadsAndLabels","^JusticeMap","OpenInfraMap.(Power|Telecom|Petroleum|Water)","OpenPtMap","OpenRailwayMap","OpenFireMap","SafeCast","CartoDB.DarkMatterOnlyLabels","CartoDB.PositronOnlyLabels"],null!==e.match("("+r.join("|")+")"))},reset_layers:function(){this.map.eachLayer(function(e){e.constructor===L.TileLayer.Provider&&e.remove()}),this.$layerStore().remove(),this.layersControl&&this.layersControl.remove()},init_layers:function(){var a=this,i=[],n={},o={},s={},l=this.$el.data().editorConfig,d=function(e,t){var r;if(_.isObject(e))return c.each(e,d);if(!function(e){return null===e||!!l.restrict_providers&&-1===l.restrict_providers.indexOf(e)}(t)){if(s[t])r=s[t],a.map.addLayer(r);else{try{r=L.tileLayer.provider(t)}catch(e){return}r.providerKey=t}a.layer_is_overlay(t,r)?o[t]=r:n[t]=r,-1!==i.indexOf(t)&&a.map.addLayer(r)}};i=this.$el.data().mapLayers,!1!==l.restrict_providers&&_.isArray(l.restrict_providers)&&(i=i.filter(function(e){return-1!==l.restrict_providers.indexOf(e)})),i.length||(i=Object.keys(l.restrict_providers).slice(0,1)),l.allow_providers&&(c('<div class="acf-osm-layers"></div>').insertAfter(this.$el),this.map.on("baselayerchange layeradd layerremove",function(e){if(e.layer.providerKey){var r=a.$layerStore();a.$parent().find('[data-id="__osm_layer_template__"]');r.html(""),a.map.eachLayer(function(e){var t;e.providerKey&&((t=c('<input type="hidden" name="'+l.name_prefix+'[layers][]" />')).val(e.providerKey),a.layer_is_overlay(e.providerKey,e)?r.append(t):r.prepend(t))}),a.$el.trigger("change")}})),c.each(l.restrict_providers,d),this.$layerStore().length&&(this.layersControl=L.control.layers(n,o,{collapsed:!0,hideSingleBase:!0}).addTo(this.map))},init_geocode:function(){var n=this;this.$el.data().editorConfig;this.map._controlCorners.above=c('<div class="acf-osm-above"></div>').insertBefore(this.$el).get(0),this.geocoder=L.Control.geocoder({collapsed:!1,position:"above",placeholder:"Search...",errorMessage:"Nothing found...",showResultIcons:!0,suggestMinLength:3,suggestTimeout:250,queryMinLength:3,defaultMarkGeocode:!1}).on("markgeocode",function(e){var t=e.geocode.center,r=n.$el.data().editorConfig,a=n.$markers().children().not("[data-id]").length,i=n._get_geocoder_result_label([e.geocode],t);(!1===a||a<r.max_markers)&&n.add_marker(t,i),1===r.max_markers&&1===a&&(marker=n.get_first_marker(),marker&&(entry=marker.osm_controller,marker.setLatLng(t),entry.update_marker_geocode(i))),0===r.max_markers?n.map.fitBounds(e.geocode.bbox):n.map.setView(t,n.map.getZoom())}).addTo(this.map),L.DomEvent.addListener(this.geocoder._input,"keydown",function(e){13===e.keyCode&&e.preventDefault()},this.geocoder)},get_first_marker:function(){var t=!1;return this.map.eachLayer(function(e){if(e.constructor===L.Marker)return t=e,!1}),t},update_visible:function(){return this.visible===this.$el.is(":visible")?this:(this.visible=this.$el.is(":visible"),this.visible?(this.map.invalidateSize(),this.bind_events()):this.unbind_events(),this)},init_acf:function(){function e(){t.update_visible()}var t=this;acf.addAction("show",e),acf.addAction("hide",e),acf.addAction("disable_field",function(){t.unbind_events()}),c(document).on("postbox-toggled",e),c(document).on("click",".widget-top *",e)},unbind_events:function(){this.$lat().off("blur"),this.$lng().off("blur"),this.$zoom().off("blur"),this.$zoom().off("keyup focus"),this.map.off("zoomend",this.map_zoomed,this),this.map.off("moveend",this.map_moved,this)},bind_events:function(){var t=this;t.$lat().on("blur",function(e){t.update_map()}),t.$lng().on("blur",function(e){t.update_map()}),t.$zoom().on("blur",function(e){t.update_map()}),this.map.on("zoomend",this.map_zoomed,this),this.map.on("moveend",this.map_moved,this)},update_map:function(){if(this.$lat().val()&&this.$lng().val()){var e=L.latLng(this.$lat().val(),this.$lng().val());this.map.setView(e,this.$zoom().val())}},map_moved:function(e){var t=this.map.getCenter();this.$lat().val(t.lat),this.$lng().val(t.lng),this.$el.trigger("change")},map_zoomed:function(e){this.$zoom().val(this.map.getZoom()),this.$el.trigger("change")}}),c(document).on("acf-osm-map-init",function(e,t){c(e.target).is("[data-editor-config]")&&(e.preventDefault(),c(e.target).data("_map_editor",new n.field({el:e.target,map:t})))}).on("change",'[data-type="open_street_map"] [data-name="return_format"] input',function(e){c('[data-name="return_format"] input:checked').val();var t=c(this).closest(".acf-field-object").find("[data-editor-config]"),r=t.data("_map_editor"),a=t.data("editor-config");r.reset_layers(),"osm"===c(this).val()?a.restrict_providers=Object.values(i.options.osm_layers):a.restrict_providers=Object.values(i.options.leaflet_layers),t.data("editor-config",a),r.init_layers()}),acf.addAction("append",function(){c.acf_leaflet()}),acf.addAction("show_field/type=open_street_map",function(e){e.$el.find("[data-editor-config]").data("_map_editor").update_visible()})}(jQuery,acf_osm_admin);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjZi1pbnB1dC1vc20uanMiXSwibmFtZXMiOlsiJCIsImFyZyIsIm9wdGlvbnMiLCJvc20iLCJNYXJrZXJMaXN0IiwiQmFja2JvbmUiLCJWaWV3IiwiZXh0ZW5kIiwiTWFya2VyRW50cnkiLCJ0YWdOYW1lIiwiY2xhc3NOYW1lIiwiZXZlbnRzIiwiY2xpY2sgW2RhdGEtbmFtZT1cImxvY2F0ZS1tYXJrZXJcIl0iLCJjbGljayBbZGF0YS1uYW1lPVwicmVtb3ZlLW1hcmtlclwiXSIsImNoYW5nZSBbaWQkPVwiLW1hcmtlci1sYWJlbFwiXSIsImdldF9sYWJlbCIsInRoaXMiLCIkZWwiLCJmaW5kIiwidmFsIiwiZ2V0X2RlZmF1bHRfbGFiZWwiLCJpc19kZWZhdWx0X2xhYmVsIiwiaW5pdGlhbGl6ZSIsIm9wdCIsInRlbXBsYXRlIiwibWFya2VyIiwib3NtX2NvbnRyb2xsZXIiLCJyZW5kZXIiLCJzZWxmIiwiaHRtbCIsIl91cGRhdGVfdmFsdWVzX2Zyb21fbWFya2VyIiwiaGVpZ2h0IiwiZGF0YSIsIm9uIiwiZSIsImhpbGl0ZV9tYXJrZXIiLCJsb2xpdGVfbWFya2VyIiwiX2ljb24iLCJ1cGRhdGVfbWFya2VyX2xhYmVsIiwibGFiZWwiLCJ0YXJnZXQiLCJzZXRfbWFya2VyX2xhYmVsIiwidW5iaW5kVG9vbHRpcCIsImJpbmRUb29sdGlwIiwidGl0bGUiLCJhdHRyIiwidXBkYXRlX21hcmtlcl9nZW9jb2RlIiwibGF0bG5nIiwiZ2V0TGF0TG5nIiwibGF0IiwibG5nIiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyIsImxvY2F0ZV9tYXJrZXIiLCJfbWFwIiwiZmx5VG8iLCJyZW1vdmVfbWFya2VyIiwicHJldmVudERlZmF1bHQiLCJyZW1vdmUiLCJmaWVsZCIsIm1hcCIsImdlb2NvZGVyIiwidmlzaWJsZSIsIiRwYXJlbnQiLCJjbG9zZXN0IiwiJHpvb20iLCIkbGF0IiwiJGxuZyIsIiRsYXllclN0b3JlIiwiJHJlc3VsdHMiLCIkbWFya2VycyIsImNvbmYiLCJ1cGRhdGVfbWFwIiwiaW5pdF9hY2YiLCJpbml0X2xheWVycyIsImluaXRfbWFya2VycyIsInVwZGF0ZV92aXNpYmxlIiwiX2dldF9nZW9jb2Rlcl9yZXN1bHRfbGFiZWwiLCJsZW5ndGgiLCJlYWNoIiwiaSIsInJlc3VsdCIsIm5hbWUiLCJ0b1N0cmluZyIsInRleHQiLCJyZXBsYWNlIiwiZWRpdG9yX2NvbmZpZyIsImVkaXRvckNvbmZpZyIsImluaXRfZ2VvY29kZSIsIm1heF9tYXJrZXJzIiwiaWNvbiIsIkwiLCJEaXZJY29uIiwiY291bnRfbWFya2VycyIsImNoaWxkcmVuIiwibm90IiwicmV2ZXJzZSIsImdldFpvb20iLCJhZGRfbWFya2VyIiwibGF5ZXIiLCJjb25zdHJ1Y3RvciIsIk1hcmtlciIsInNwbGl0Iiwiam9pbiIsImVudHJ5IiwiY29udHJvbGxlciIsImlkIiwiYWNmIiwidW5pcWlkIiwiXyIsImFwcGVuZFRvIiwiZ2VvY29kZV9tYXJrZXIiLCJzZXRJY29uIiwidHJpZ2dlciIsImRyYWdnaW5nIiwiZW5hYmxlIiwibWFwTWFya2VycyIsIm1hcmtlckRhdGEiLCJsYXRMbmciLCJhZGRUbyIsIm1hcmtlcl9lbnRyeSIsImxuZ2xhdCIsImxheWVyX2lzX292ZXJsYXkiLCJrZXkiLCJwYXR0ZXJucyIsIm9wYWNpdHkiLCJtYXRjaCIsInJlc2V0X2xheWVycyIsImVhY2hMYXllciIsIlRpbGVMYXllciIsIlByb3ZpZGVyIiwibGF5ZXJzQ29udHJvbCIsInNlbGVjdGVkTGF5ZXJzIiwiYmFzZUxheWVycyIsIm92ZXJsYXlzIiwibWFwTGF5ZXJzIiwic2V0dXBNYXAiLCJpc09iamVjdCIsInJlc3RyaWN0X3Byb3ZpZGVycyIsImluZGV4T2YiLCJpc19vbWl0dGVkIiwiYWRkTGF5ZXIiLCJ0aWxlTGF5ZXIiLCJwcm92aWRlciIsImV4IiwicHJvdmlkZXJLZXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiZWwiLCJPYmplY3QiLCJrZXlzIiwic2xpY2UiLCJhbGxvd19wcm92aWRlcnMiLCJpbnNlcnRBZnRlciIsIiRsYXllcklucHV0IiwibmFtZV9wcmVmaXgiLCJhcHBlbmQiLCJwcmVwZW5kIiwiY29udHJvbCIsImxheWVycyIsImNvbGxhcHNlZCIsImhpZGVTaW5nbGVCYXNlIiwiX2NvbnRyb2xDb3JuZXJzIiwiaW5zZXJ0QmVmb3JlIiwiZ2V0IiwiQ29udHJvbCIsInBvc2l0aW9uIiwicGxhY2Vob2xkZXIiLCJlcnJvck1lc3NhZ2UiLCJzaG93UmVzdWx0SWNvbnMiLCJzdWdnZXN0TWluTGVuZ3RoIiwic3VnZ2VzdFRpbWVvdXQiLCJxdWVyeU1pbkxlbmd0aCIsImRlZmF1bHRNYXJrR2VvY29kZSIsImdlb2NvZGUiLCJjZW50ZXIiLCJnZXRfZmlyc3RfbWFya2VyIiwic2V0TGF0TG5nIiwiZml0Qm91bmRzIiwiYmJveCIsInNldFZpZXciLCJEb21FdmVudCIsImFkZExpc3RlbmVyIiwiX2lucHV0Iiwia2V5Q29kZSIsImlzIiwiaW52YWxpZGF0ZVNpemUiLCJiaW5kX2V2ZW50cyIsInVuYmluZF9ldmVudHMiLCJ0b2dnbGVfY2IiLCJhZGRBY3Rpb24iLCJkb2N1bWVudCIsIm9mZiIsIm1hcF96b29tZWQiLCJtYXBfbW92ZWQiLCJnZXRDZW50ZXIiLCIkbWFwIiwiZWRpdG9yIiwidmFsdWVzIiwib3NtX2xheWVycyIsImxlYWZsZXRfbGF5ZXJzIiwiYWNmX2xlYWZsZXQiLCJqUXVlcnkiLCJhY2Zfb3NtX2FkbWluIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFBQSxFQUFBQyxHQUNBQSxFQUFBQyxRQUFBLElBTUFDLEVBQUEsR0FHQUEsRUFBQUMsV0FBQUMsU0FBQUMsS0FBQUMsT0FBQSxJQUVBSixFQUFBSyxZQUFBSCxTQUFBQyxLQUFBQyxPQUFBLENBQ0FFLFFBQUEsTUFDQUMsVUFBQSxhQUNBQyxPQUFBLENBQ0FDLG9DQUFBLGdCQUNBQyxvQ0FBQSxnQkFDQUMsK0JBQUEsdUJBR0FDLFVBQUEsV0FDQSxPQUFBQyxLQUFBQyxJQUFBQyxLQUFBLHlCQUFBQyxPQUVBQyxrQkFBQSxXQUNBLE9BQUFK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RUFBQTZILEVBQUFwSyxLQUFBLGlCQUVBcUssRUFBQXRFLGVBQ0EsUUFBQS9ILEVBQUFnQixNQUFBRyxNQUVBb0QsRUFBQW1FLG1CQUFBVyxPQUFBaUQsT0FBQXJNLEVBQUFDLFFBQUFxTSxZQUdBaEksRUFBQW1FLG1CQUFBVyxPQUFBaUQsT0FBQXJNLEVBQUFDLFFBQUFzTSxnQkFFQUosRUFBQXBLLEtBQUEsZ0JBQUF1QyxHQUNBOEgsRUFBQTNILGdCQUlBaUMsSUFBQW1GLFVBQUEsU0FBQSxXQUNBOUwsRUFBQXlNLGdCQUVBOUYsSUFBQW1GLFVBQUEsa0NBQUEsU0FBQW5JLEdBQ0FBLEVBQUExQyxJQUFBQyxLQUFBLHdCQUFBYyxLQUFBLGVBQ0E0QyxtQkF4bUJBLENBMG1CQThILE9BQUFDIiwiZmlsZSI6ImFjZi1pbnB1dC1vc20ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCAkLCBhcmcgKXtcblx0dmFyIG9wdGlvbnMgPSBhcmcub3B0aW9ucyxcblx0XHRyZXN1bHRfdHBsID0gJzxkaXYgdGFiaW5kZXg9XCI8JT0gZGF0YS5pICU+XCIgY2xhc3M9XCJvc20tcmVzdWx0XCI+J1xuXHRcdFx0KyAnPCU9IGRhdGEucmVzdWx0X3RleHQgJT4nXG5cdFx0XHQrICc8YnIgLz48c21hbGw+PCU9IGRhdGEucHJvcGVydGllcy5vc21fdmFsdWUgJT48L3NtYWxsPidcblx0XHRcdCsgJzwvZGl2Pic7XG5cblx0dmFyIG9zbSA9IHtcblx0fTtcblxuXHRvc20uTWFya2VyTGlzdCA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcblx0fSlcblx0b3NtLk1hcmtlckVudHJ5ID0gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuXHRcdHRhZ05hbWU6ICdkaXYnLFxuXHRcdGNsYXNzTmFtZTonb3NtLW1hcmtlcicsXG5cdFx0ZXZlbnRzOiB7XG5cdFx0XHQnY2xpY2sgW2RhdGEtbmFtZT1cImxvY2F0ZS1tYXJrZXJcIl0nIDogJ2xvY2F0ZV9tYXJrZXInLFxuXHRcdFx0J2NsaWNrIFtkYXRhLW5hbWU9XCJyZW1vdmUtbWFya2VyXCJdJyA6ICdyZW1vdmVfbWFya2VyJyxcblx0XHRcdCdjaGFuZ2UgW2lkJD1cIi1tYXJrZXItbGFiZWxcIl0nXHRcdDogJ3VwZGF0ZV9tYXJrZXJfbGFiZWwnLFxuLy9cdFx0XHQnZm9jdXMgW3R5cGU9XCJ0ZXh0XCJdJ1x0XHRcdFx0OiAnaGlsaXRlX21hcmtlcidcblx0XHR9LFxuXHRcdGdldF9sYWJlbDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItbGFiZWxcIl0nKS52YWwoKTtcblx0XHR9LFxuXHRcdGdldF9kZWZhdWx0X2xhYmVsOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1nZW9jb2RlXCJdJykudmFsKCk7XG5cdFx0fSxcblx0XHRpc19kZWZhdWx0X2xhYmVsOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLmdldF9kZWZhdWx0X2xhYmVsKCkgPT09IHRoaXMuZ2V0X2xhYmVsKCk7XG5cdFx0fSxcblx0XHRpbml0aWFsaXplOmZ1bmN0aW9uKG9wdCl7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cdFx0XHR0aGlzLnRlbXBsYXRlID0gb3B0LnRlbXBsYXRlO1xuXHRcdFx0dGhpcy5tYXJrZXIgPSBvcHQubWFya2VyO1xuXHRcdFx0dGhpcy5tYXJrZXIub3NtX2NvbnRyb2xsZXIgPSB0aGlzO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHJlbmRlcjpmdW5jdGlvbigpe1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHR0aGlzLiRlbC5odG1sKCB0aGlzLnRlbXBsYXRlKCB0aGlzICkgKTtcblx0XHRcdHRoaXMuX3VwZGF0ZV92YWx1ZXNfZnJvbV9tYXJrZXIoKTtcblxuXHRcdFx0dGhpcy4kZWwuaGVpZ2h0KCB0aGlzLiRlbC5kYXRhKCdoZWlnaHQnKSApO1xuXG5cdFx0XHR0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1sYWJlbFwiXScpXG5cdFx0XHRcdC5vbignZm9jdXMnLGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHRzZWxmLmhpbGl0ZV9tYXJrZXIoKTtcblx0XHRcdFx0fSlcblx0XHRcdFx0Lm9uKCdibHVyJyxmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0c2VsZi5sb2xpdGVfbWFya2VyKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0JCh0aGlzLm1hcmtlci5faWNvbilcblx0XHRcdFx0Lm9uKCdmb2N1cycsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0c2VsZi5oaWxpdGVfbWFya2VyKCk7XG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5vbignYmx1cicsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0c2VsZi5sb2xpdGVfbWFya2VyKCk7XG5cdFx0XHRcdH0pXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHVwZGF0ZV9tYXJrZXJfbGFiZWw6ZnVuY3Rpb24oZSkge1xuXHRcdFx0dmFyIGxhYmVsID0gdGhpcy5nZXRfbGFiZWwoKTtcblxuXHRcdFx0aWYgKCBsYWJlbCA9PT0gJycgKSB7XG5cdFx0XHRcdGxhYmVsID0gdGhpcy5nZXRfZGVmYXVsdF9sYWJlbCgpO1xuXHRcdFx0fVxuXHRcdFx0Ly8gcmVzdG9yZSBnZW9jb2RlIGRlZmF1bHRcblx0XHRcdCQoZS50YXJnZXQpLnZhbChsYWJlbCk7XG5cblx0XHRcdHJldHVybiB0aGlzLnNldF9tYXJrZXJfbGFiZWwoIGxhYmVsICk7XG5cdFx0fSxcblx0XHRzZXRfbWFya2VyX2xhYmVsOmZ1bmN0aW9uKGxhYmVsKSB7XG5cdFx0XHR0aGlzLm1hcmtlci51bmJpbmRUb29sdGlwKCk7XG5cdFx0XHR0aGlzLm1hcmtlci5iaW5kVG9vbHRpcChsYWJlbCk7XG5cblx0XHRcdHRoaXMubWFya2VyLm9wdGlvbnMudGl0bGUgPSBsYWJlbDtcblx0XHRcdCQoIHRoaXMubWFya2VyLl9pY29uICkuYXR0ciggJ3RpdGxlJywgbGFiZWwgKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0dXBkYXRlX21hcmtlcl9nZW9jb2RlOmZ1bmN0aW9uKCBsYWJlbCApIHtcblxuXHRcdFx0aWYgKCB0aGlzLmlzX2RlZmF1bHRfbGFiZWwoKSApIHtcblx0XHRcdFx0Ly8gdXBkYXRlIG1hcmtlciBsYWJlbHNcblx0XHRcdFx0dGhpcy5zZXRfbWFya2VyX2xhYmVsKCBsYWJlbCApO1xuXHRcdFx0XHQvLyB1cGRhdGUgbWFya2VyIGxhYmVsIGlucHV0XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWdlb2NvZGVcIl0nKS52YWwoIGxhYmVsICk7XG5cblx0XHRcdHRoaXMuX3VwZGF0ZV92YWx1ZXNfZnJvbV9tYXJrZXIoKTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRfdXBkYXRlX3ZhbHVlc19mcm9tX21hcmtlcjogZnVuY3Rpb24oICkge1xuXHRcdFx0dmFyIGxhdGxuZyA9IHRoaXMubWFya2VyLmdldExhdExuZygpO1xuXHRcdFx0dGhpcy4kZWwuZmluZCgnW2lkJD1cIi1tYXJrZXItbGF0XCJdJykudmFsKCBsYXRsbmcubGF0ICk7XG5cdFx0XHR0aGlzLiRlbC5maW5kKCdbaWQkPVwiLW1hcmtlci1sbmdcIl0nKS52YWwoIGxhdGxuZy5sbmcgKTtcblx0XHRcdHRoaXMuJGVsLmZpbmQoJ1tpZCQ9XCItbWFya2VyLWxhYmVsXCJdJykudmFsKCB0aGlzLm1hcmtlci5vcHRpb25zLnRpdGxlICk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdGhpbGl0ZV9tYXJrZXI6ZnVuY3Rpb24oZSkge1xuXHRcdFx0dGhpcy4kZWwuYWRkQ2xhc3MoJ2ZvY3VzJyk7XG5cdFx0XHQkKCB0aGlzLm1hcmtlci5faWNvbiApLmFkZENsYXNzKCdmb2N1cycpXG5cdFx0fSxcblx0XHRsb2xpdGVfbWFya2VyOmZ1bmN0aW9uKGUpIHtcblx0XHRcdHRoaXMuJGVsLnJlbW92ZUNsYXNzKCdmb2N1cycpO1xuXHRcdFx0JCggdGhpcy5tYXJrZXIuX2ljb24gKS5yZW1vdmVDbGFzcygnZm9jdXMnKVxuXHRcdH0sXG5cdFx0bG9jYXRlX21hcmtlcjpmdW5jdGlvbigpe1xuXHRcdFx0dGhpcy5tYXJrZXIuX21hcC5mbHlUbyggdGhpcy5tYXJrZXIuZ2V0TGF0TG5nKCkgKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0cmVtb3ZlX21hcmtlcjpmdW5jdGlvbihlKSB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KClcblx0XHRcdHRoaXMubWFya2VyLnJlbW92ZSgpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXHR9KTtcblxuXHRvc20uZmllbGQgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG5cblx0XHRtYXA6IG51bGwsXG5cdFx0Z2VvY29kZXI6IG51bGwsXG5cdFx0dmlzaWJsZTogbnVsbCxcblx0XHRldmVudHM6e1xuXHRcdH0sXG5cblx0XHQkcGFyZW50OmZ1bmN0aW9uKCl7XG5cdFx0XHRyZXR1cm4gdGhpcy4kZWwuY2xvc2VzdCgnLmFjZi1maWVsZC1zZXR0aW5ncywuYWNmLWZpZWxkLW9wZW4tc3RyZWV0LW1hcCcpXG5cdFx0fSxcblx0XHQkem9vbSA6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJ2lucHV0W2lkJD1cIi16b29tXCJdJyk7XG5cdFx0fSxcblx0XHQkbGF0IDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnaW5wdXRbaWQkPVwiLWNlbnRlcl9sYXRcIl0nKTtcblx0XHR9LFxuXHRcdCRsbmcgOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCdpbnB1dFtpZCQ9XCItY2VudGVyX2xuZ1wiXScpO1xuXHRcdH0sXG5cdFx0JGxheWVyU3RvcmU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuJHBhcmVudCgpLmZpbmQoJy5hY2Ytb3NtLWxheWVycycpO1xuXHRcdH0sXG5cdFx0JHJlc3VsdHMgOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwYXJlbnQoKS5maW5kKCcub3NtLXJlc3VsdHMnKTtcblx0XHR9LFxuXHRcdCRtYXJrZXJzOmZ1bmN0aW9uKCl7XG5cdFx0XHRyZXR1cm4gdGhpcy4kcGFyZW50KCkuZmluZCgnLm9zbS1tYXJrZXJzJyk7XG5cdFx0fSxcblx0XHRpbml0aWFsaXplOmZ1bmN0aW9uKGNvbmYpIHtcblxuXHRcdFx0dGhpcy5tYXBcdFx0PSBjb25mLm1hcDtcblxuXHRcdFx0dGhpcy51cGRhdGVfbWFwKCk7IC8vIHNldCBtYXAgdG8gaW5wdXQgdmFsdWVzXG5cblx0XHRcdHRoaXMuaW5pdF9hY2YoKTtcblxuXHRcdFx0dGhpcy5pbml0X2xheWVycygpO1xuXG5cdFx0XHR0aGlzLmluaXRfbWFya2VycygpO1xuXG5cdFx0XHR0aGlzLnVwZGF0ZV92aXNpYmxlKCk7XG5cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0X2dldF9nZW9jb2Rlcl9yZXN1bHRfbGFiZWw6ZnVuY3Rpb24oIGUsIGxhdGxuZyApIHtcblx0XHRcdHZhciBsYWJlbCA9IGZhbHNlO1xuXG5cdFx0XHRpZiAoICEgZS5sZW5ndGggKSB7XG5cdFx0XHRcdGxhYmVsID0gbGF0bG5nLmxhdC50b1N0cmluZygpICsgJywgJyArIGxhdGxuZy5sbmcudG9TdHJpbmcoKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCQuZWFjaCggZSwgZnVuY3Rpb24oIGksIHJlc3VsdCApIHtcblx0XHRcdFx0XHRpZiAoICEhIHJlc3VsdC5odG1sICkge1xuXHRcdFx0XHRcdFx0bGFiZWwgPSByZXN1bHQuaHRtbDtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0bGFiZWwgPSByZXN1bHQubmFtZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRcdHJldHVybiAkKCc8cD4nK2xhYmVsKyc8L3A+JykudGV4dCgpLnJlcGxhY2UoL14oXFxzKykvZywnJykucmVwbGFjZSgvKFxccyspJC9nLCcnKS5yZXBsYWNlKC8oXFxzKykvZywnICcpO1xuXHRcdH0sXG5cdFx0aW5pdF9tYXJrZXJzOmZ1bmN0aW9uKCl7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0ZWRpdG9yX2NvbmZpZyA9IHRoaXMuJGVsLmRhdGEoKS5lZGl0b3JDb25maWc7XG5cblx0XHRcdHRoaXMuaW5pdF9nZW9jb2RlKCk7XG5cblx0XHRcdC8vIG5vIG1hcmtlcnMgYWxsb3dlZCFcblx0XHRcdGlmICggZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyA9PT0gMCApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmljb24gPSBuZXcgTC5EaXZJY29uKHtcblx0XHRcdFx0aHRtbDogJycsXG5cdFx0XHRcdGNsYXNzTmFtZTonb3NtLW1hcmtlci1pY29uJ1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMubWFwLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHR2YXIgbGF0bG5nID0gZS5sYXRsbmcsXG5cdFx0XHRcdFx0Y291bnRfbWFya2VycyA9IHNlbGYuJG1hcmtlcnMoKS5jaGlsZHJlbigpLm5vdCgnW2RhdGEtaWRdJykubGVuZ3RoO1xuXG5cdFx0XHRcdC8vIG5vIG1vcmUgbWFya2Vyc1xuXHRcdFx0XHRpZiAoIGVkaXRvcl9jb25maWcubWF4X21hcmtlcnMgIT09IGZhbHNlICYmIGNvdW50X21hcmtlcnMgPj0gZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyApIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRzZWxmLmdlb2NvZGVyLm9wdGlvbnMuZ2VvY29kZXIucmV2ZXJzZShlLmxhdGxuZyxzZWxmLm1hcC5nZXRab29tKCksZnVuY3Rpb24oZSl7XG5cblx0XHRcdFx0XHR2YXIgbGFiZWwgPSBzZWxmLl9nZXRfZ2VvY29kZXJfcmVzdWx0X2xhYmVsKCBlLCBsYXRsbmcgKTtcblxuXHRcdFx0XHRcdHNlbGYuYWRkX21hcmtlciggbGF0bG5nLCBsYWJlbCApO1xuXG5cdFx0XHRcdH0sc2VsZik7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5tYXAub24oICdsYXllcmFkZCcsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRpZiAoIGUubGF5ZXIuY29uc3RydWN0b3IgIT09IEwuTWFya2VyICkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0XHQvLyBtYXJrZXIgYWRkZWRcblx0XHRcdFx0dmFyIHRlbXBsYXRlID0gc2VsZi4kbWFya2VycygpLmZpbmQoJ1tkYXRhLWlkPVwiX19vc21fbWFya2VyX3RlbXBsYXRlX19cIl0nKS5odG1sKCkuc3BsaXQoJ19fb3NtX21hcmtlcl90ZW1wbGF0ZV9fJykuam9pbiggJzwlPSBpZCAlPicgKSxcblx0XHRcdFx0XHRlbnRyeSA9IG5ldyBvc20uTWFya2VyRW50cnkoe1xuXHRcdFx0XHRcdFx0Y29udHJvbGxlcjogdGhpcyxcblx0XHRcdFx0XHRcdG1hcmtlcjogZS5sYXllcixcblx0XHRcdFx0XHRcdGlkOiBhY2YudW5pcWlkKCksIC8vc2VsZi4kbWFya2VycygpLmNoaWxkcmVuKCkubGVuZ3RoLFxuXHRcdFx0XHRcdFx0dGVtcGxhdGU6IF8udGVtcGxhdGUoIHRlbXBsYXRlICksXG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0ZW50cnkucmVuZGVyKCkuJGVsLmFwcGVuZFRvKCBzZWxmLiRtYXJrZXJzKCkgKTtcblxuXHRcdFx0XHRzZWxmLmdlb2NvZGVfbWFya2VyKCBlbnRyeSApO1xuXG5cdFx0XHRcdGUubGF5ZXJcblx0XHRcdFx0XHQuc2V0SWNvbiggc2VsZi5pY29uIClcblx0XHRcdFx0XHQub24oJ2NsaWNrJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0XHRcdHRoaXMucmVtb3ZlKCk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQub24oJ3JlbW92ZScsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0XHRlbnRyeS4kZWwucmVtb3ZlKCk7XG5cdFx0XHRcdFx0XHRzZWxmLiRlbC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5vbignZHJhZ2VuZCcsZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0XHRzZWxmLmdlb2NvZGVfbWFya2VyKCBlbnRyeSApO1xuXHRcdFx0XHRcdFx0c2VsZi4kZWwudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQuZHJhZ2dpbmcuZW5hYmxlKCk7XG5cdFx0XHR9ICk7XG5cdFx0XHR0aGlzLm1hcC5vbiggJ2xheWVycmVtb3ZlJywgZnVuY3Rpb24oZSl7XG5cdFx0XHRcdGlmICggZS5sYXllci5jb25zdHJ1Y3RvciAhPT0gTC5NYXJrZXIgKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHNlbGYuJGVsLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0fSApO1xuXHRcdFx0Ly8gYWRkIG1hcmtlcnNcblx0XHRcdCQuZWFjaCggdGhpcy4kZWwuZGF0YSgpLm1hcE1hcmtlcnMsZnVuY3Rpb24oIGksIG1hcmtlckRhdGEgKSB7XG5cdFx0XHRcdC8vIGFkZCBtYXJrZXJzXG5cdFx0XHRcdHZhciBtYXJrZXIgPSBMLm1hcmtlciggTC5sYXRMbmcoIG1hcmtlckRhdGEubGF0ICogMSwgbWFya2VyRGF0YS5sbmcgKiAxICksIHtcblx0XHRcdFx0XHRcdHRpdGxlOiBtYXJrZXJEYXRhLmxhYmVsXG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQuYmluZFRvb2x0aXAoIG1hcmtlckRhdGEubGFiZWwgKVxuXHRcdFx0XHRcdC5hZGRUbyggc2VsZi5tYXAgKTtcblxuXHRcdFx0fSk7XG5cblx0XHR9LFxuXHRcdGdlb2NvZGVfbWFya2VyOmZ1bmN0aW9uKCBtYXJrZXJfZW50cnkgKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdGVudHJ5ID0gbWFya2VyX2VudHJ5LFxuXHRcdFx0XHRsYXRsbmcgPSBlbnRyeS5tYXJrZXIuZ2V0TGF0TG5nKCk7XG5cblx0XHRcdHNlbGYuZ2VvY29kZXIub3B0aW9ucy5nZW9jb2Rlci5yZXZlcnNlKCBsYXRsbmcsIHNlbGYubWFwLmdldFpvb20oKSwgZnVuY3Rpb24oZSl7XG5cblx0XHRcdFx0dmFyIGxhYmVsID0gc2VsZi5fZ2V0X2dlb2NvZGVyX3Jlc3VsdF9sYWJlbCggZSwgbGF0bG5nICk7XG5cblx0XHRcdFx0ZW50cnkudXBkYXRlX21hcmtlcl9nZW9jb2RlKCBsYWJlbCApO1xuXG5cdFx0XHR9LCB0aGlzICk7XG5cblx0XHR9LFxuXHRcdGFkZF9tYXJrZXI6ZnVuY3Rpb24oIGxuZ2xhdCwgbGFiZWwgKXtcblx0XHRcdEwubWFya2VyKGxuZ2xhdCx7XG5cdFx0XHRcdHRpdGxlOiBsYWJlbCxcblx0XHRcdFx0aWNvbjogdGhpcy5pY29uLFxuXHRcdFx0fSlcblx0XHRcdC5iaW5kVG9vbHRpcCggbGFiZWwgKVxuXHRcdFx0LmFkZFRvKCB0aGlzLm1hcCApO1xuXG5cdFx0XHR0aGlzLiRlbC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHR9LFxuXHRcdGxheWVyX2lzX292ZXJsYXk6IGZ1bmN0aW9uKCAga2V5LCBsYXllciApIHtcblx0XHRcdHZhciBwYXR0ZXJucztcblxuXHRcdFx0aWYgKCBsYXllci5vcHRpb25zLm9wYWNpdHkgJiYgbGF5ZXIub3B0aW9ucy5vcGFjaXR5IDwgMSApIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0XHRwYXR0ZXJucyA9IFsnXihPcGVuV2VhdGhlck1hcHxPcGVuU2VhTWFwKScsXG5cdFx0XHRcdCdPcGVuTWFwU3VyZmVyLkFkbWluQm91bmRzJyxcblx0XHRcdFx0J1N0YW1lbi5Ub25lcihIeWJyaWR8TGluZXN8TGFiZWxzKScsXG5cdFx0XHRcdCdBY2V0YXRlLihmb3JlZ3JvdW5kfGxhYmVsc3xyb2FkcyknLFxuXHRcdFx0XHQnSGlsbFNoYWRpbmcnLFxuXHRcdFx0XHQnSHlkZGEuUm9hZHNBbmRMYWJlbHMnLFxuXHRcdFx0XHQnXkp1c3RpY2VNYXAnLFxuXHRcdFx0XHQnT3BlbkluZnJhTWFwLihQb3dlcnxUZWxlY29tfFBldHJvbGV1bXxXYXRlciknLFxuXHRcdFx0XHQnT3BlblB0TWFwJyxcblx0XHRcdFx0J09wZW5SYWlsd2F5TWFwJyxcblx0XHRcdFx0J09wZW5GaXJlTWFwJyxcblx0XHRcdFx0J1NhZmVDYXN0Jyxcblx0XHRcdFx0J0NhcnRvREIuRGFya01hdHRlck9ubHlMYWJlbHMnLFxuXHRcdFx0XHQnQ2FydG9EQi5Qb3NpdHJvbk9ubHlMYWJlbHMnXG5cdFx0XHRdO1xuXHRcdFx0cmV0dXJuIGtleS5tYXRjaCgnKCcgKyBwYXR0ZXJucy5qb2luKCd8JykgKyAnKScpICE9PSBudWxsO1xuXHRcdH0sXG5cdFx0cmVzZXRfbGF5ZXJzOmZ1bmN0aW9uKCkge1xuXHRcdFx0Ly8gc2V0IHRoaXMuJGVsLmRhdGEoKS5tYXBMYXllcnMgc28gaXQgZml0c1xuXHRcdFx0Ly8gcmVtb3ZlIGFsbCBtYXAgbGF5ZXJzXG5cdFx0XHR0aGlzLm1hcC5lYWNoTGF5ZXIoZnVuY3Rpb24obGF5ZXIpe1xuXHRcdFx0XHRpZiAoIGxheWVyLmNvbnN0cnVjdG9yID09PSBMLlRpbGVMYXllci5Qcm92aWRlciApIHtcblx0XHRcdFx0XHRsYXllci5yZW1vdmUoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSlcblx0XHRcdC8vIHJlbW92ZSBsYXllciBzdG9yZVxuXHRcdFx0dGhpcy4kbGF5ZXJTdG9yZSgpLnJlbW92ZSgpO1xuXG5cdFx0XHQvLyByZW1vdmUgbGF5ZXIgY29udHJvbFxuXHRcdFx0ISEgdGhpcy5sYXllcnNDb250cm9sICYmIHRoaXMubGF5ZXJzQ29udHJvbC5yZW1vdmUoKVxuXHRcdH0sXG5cdFx0aW5pdF9sYXllcnM6ZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdHNlbGVjdGVkTGF5ZXJzID0gW10sXG5cdFx0XHRcdGJhc2VMYXllcnMgPSB7fSxcblx0XHRcdFx0b3ZlcmxheXMgPSB7fSxcblx0XHRcdFx0bWFwTGF5ZXJzID0ge30sXG5cdFx0XHRcdGVkaXRvcl9jb25maWcgPSB0aGlzLiRlbC5kYXRhKCkuZWRpdG9yQ29uZmlnLFxuXHRcdFx0XHRpc19vbWl0dGVkID0gZnVuY3Rpb24oa2V5KSB7XG5cblx0XHRcdFx0XHRyZXR1cm4ga2V5ID09PSBudWxsIHx8ICggISEgZWRpdG9yX2NvbmZpZy5yZXN0cmljdF9wcm92aWRlcnMgJiYgZWRpdG9yX2NvbmZpZy5yZXN0cmljdF9wcm92aWRlcnMuaW5kZXhPZigga2V5ICkgPT09IC0xICk7XG5cdFx0XHRcdH0sXG5cdFx0XHRcdHNldHVwTWFwID0gZnVuY3Rpb24oIHZhbCwga2V5ICl7XG5cdFx0XHRcdFx0dmFyIGxheWVyLCBsYXllcl9jb25maWc7XG5cdFx0XHRcdFx0aWYgKCBfLmlzT2JqZWN0KHZhbCkgKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gJC5lYWNoKCB2YWwsIHNldHVwTWFwICk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCBpc19vbWl0dGVkKGtleSkgKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICggISEgbWFwTGF5ZXJzWyBrZXkgXSApIHtcblx0XHRcdFx0XHRcdGxheWVyID0gbWFwTGF5ZXJzWyBrZXkgXTtcblx0XHRcdFx0XHRcdHNlbGYubWFwLmFkZExheWVyKGxheWVyKVxuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0XHRsYXllciA9IEwudGlsZUxheWVyLnByb3ZpZGVyKCBrZXkgLyosIGxheWVyX2NvbmZpZy5vcHRpb25zKi8gKTtcblx0XHRcdFx0XHRcdH0gY2F0Y2goZXgpIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0bGF5ZXIucHJvdmlkZXJLZXkgPSBrZXk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCBzZWxmLmxheWVyX2lzX292ZXJsYXkoIGtleSwgbGF5ZXIgKSApIHtcblx0XHRcdFx0XHRcdG92ZXJsYXlzW2tleV0gPSBsYXllcjtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0YmFzZUxheWVyc1trZXldID0gbGF5ZXI7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCBzZWxlY3RlZExheWVycy5pbmRleE9mKCBrZXkgKSAhPT0gLTEgKSB7XG5cdFx0XHRcdFx0XHRzZWxmLm1hcC5hZGRMYXllcihsYXllcik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9O1xuXG5cdFx0XHRzZWxlY3RlZExheWVycyA9IHRoaXMuJGVsLmRhdGEoKS5tYXBMYXllcnM7IC8vIHNob3VsZCBiZSBsYXllciBzdG9yZSB2YWx1ZVxuXG5cdFx0XHQvLyBmaWx0ZXIgYXZhaWFsYmxlIGxheWVycyBpbiBmaWVsZCB2YWx1ZVxuXHRcdFx0aWYgKCBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycyAhPT0gZmFsc2UgJiYgXy5pc0FycmF5KCBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycyApICkge1xuXHRcdFx0XHRzZWxlY3RlZExheWVycyA9IHNlbGVjdGVkTGF5ZXJzLmZpbHRlciggZnVuY3Rpb24oZWwpIHtcblx0XHRcdFx0XHRyZXR1cm4gZWRpdG9yX2NvbmZpZy5yZXN0cmljdF9wcm92aWRlcnMuaW5kZXhPZiggZWwgKSAhPT0gLTE7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBzZXQgZGVmYXVsdCBsYXllclxuXHRcdFx0aWYgKCAhIHNlbGVjdGVkTGF5ZXJzLmxlbmd0aCApIHtcblxuXHRcdFx0XHRzZWxlY3RlZExheWVycyA9IE9iamVjdC5rZXlzKCBlZGl0b3JfY29uZmlnLnJlc3RyaWN0X3Byb3ZpZGVycyApLnNsaWNlKCAwLCAxICk7XG5cblx0XHRcdH1cblxuXHRcdFx0Ly8gZWRpdGFibGUgbGF5ZXJzIVxuXHRcdFx0aWYgKCBlZGl0b3JfY29uZmlnLmFsbG93X3Byb3ZpZGVycyApIHtcblxuXHRcdFx0XHQkKCc8ZGl2IGNsYXNzPVwiYWNmLW9zbS1sYXllcnNcIj48L2Rpdj4nKS5pbnNlcnRBZnRlciggdGhpcy4kZWwgKTtcblxuXHRcdFx0XHR0aGlzLm1hcC5vbiggJ2Jhc2VsYXllcmNoYW5nZSBsYXllcmFkZCBsYXllcnJlbW92ZScsIGZ1bmN0aW9uKGUpe1xuXG5cdFx0XHRcdFx0aWYgKCAhIGUubGF5ZXIucHJvdmlkZXJLZXkpIHtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0dmFyICRsYXllclN0b3JlID0gc2VsZi4kbGF5ZXJTdG9yZSgpLFxuXHRcdFx0XHRcdFx0JHRlbXBsYXRlID0gc2VsZi4kcGFyZW50KCkuZmluZCgnW2RhdGEtaWQ9XCJfX29zbV9sYXllcl90ZW1wbGF0ZV9fXCJdJyk7XG5cblx0XHRcdFx0XHQkbGF5ZXJTdG9yZS5odG1sKCcnKTtcblxuXHRcdFx0XHRcdHNlbGYubWFwLmVhY2hMYXllcihmdW5jdGlvbihsYXllcikge1xuXHRcdFx0XHRcdFx0dmFyICRsYXllcklucHV0O1xuXHRcdFx0XHRcdFx0aWYgKCAhIGxheWVyLnByb3ZpZGVyS2V5ICkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHQvKlxuXHRcdFx0XHRcdFx0JGxheWVySW5wdXQgPSAkdGVtcGxhdGUuY2xvbmUoKS5yZW1vdmVBdHRyKCdkYXRhLWlkJyk7XG5cdFx0XHRcdFx0XHQvKi9cblx0XHRcdFx0XHRcdCRsYXllcklucHV0ID0gJCgnPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBuYW1lPVwiJyArIGVkaXRvcl9jb25maWcubmFtZV9wcmVmaXggKyAnW2xheWVyc11bXVwiIC8+Jyk7XG5cdFx0XHRcdFx0XHQvLyovXG5cdFx0XHRcdFx0XHQkbGF5ZXJJbnB1dC52YWwoIGxheWVyLnByb3ZpZGVyS2V5ICk7XG5cblx0XHRcdFx0XHRcdGlmICggc2VsZi5sYXllcl9pc19vdmVybGF5KCBsYXllci5wcm92aWRlcktleSwgbGF5ZXIgKSApIHtcblx0XHRcdFx0XHRcdFx0JGxheWVyU3RvcmUuYXBwZW5kKCAkbGF5ZXJJbnB1dCApO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0JGxheWVyU3RvcmUucHJlcGVuZCggJGxheWVySW5wdXQgKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRzZWxmLiRlbC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdFx0fSApO1xuXHRcdFx0fVxuXG5cblx0XHRcdCQuZWFjaCggZWRpdG9yX2NvbmZpZy5yZXN0cmljdF9wcm92aWRlcnMsIHNldHVwTWFwICk7XG5cblx0XHRcdC8vIC4uLiBubyBsYXllciBlZGl0aW5nIGFsbG93ZWRcblx0XHRcdGlmICggdGhpcy4kbGF5ZXJTdG9yZSgpLmxlbmd0aCApIHtcblx0XHRcdFx0dGhpcy5sYXllcnNDb250cm9sID0gTC5jb250cm9sLmxheWVycyggYmFzZUxheWVycywgb3ZlcmxheXMsIHtcblx0XHRcdFx0XHRjb2xsYXBzZWQ6IHRydWUsXG5cdFx0XHRcdFx0aGlkZVNpbmdsZUJhc2U6IHRydWUsXG5cdFx0XHRcdH0pLmFkZFRvKHRoaXMubWFwKTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdGluaXRfZ2VvY29kZTpmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRlZGl0b3JfY29uZmlnID0gdGhpcy4kZWwuZGF0YSgpLmVkaXRvckNvbmZpZztcblxuXHRcdFx0dGhpcy5tYXAuX2NvbnRyb2xDb3JuZXJzWydhYm92ZSddID0gJCgnPGRpdiBjbGFzcz1cImFjZi1vc20tYWJvdmVcIj48L2Rpdj4nKS5pbnNlcnRCZWZvcmUoIHRoaXMuJGVsICkuZ2V0KDApO1xuXG5cdFx0XHR0aGlzLmdlb2NvZGVyID0gTC5Db250cm9sLmdlb2NvZGVyKHtcblx0XHRcdFx0Y29sbGFwc2VkOiBmYWxzZSxcblx0XHRcdFx0cG9zaXRpb246J2Fib3ZlJyxcblx0XHRcdFx0cGxhY2Vob2xkZXI6J1NlYXJjaC4uLicsXG5cdFx0XHRcdGVycm9yTWVzc2FnZTonTm90aGluZyBmb3VuZC4uLicsXG5cdFx0XHRcdHNob3dSZXN1bHRJY29uczp0cnVlLFxuXHRcdFx0XHRzdWdnZXN0TWluTGVuZ3RoOjMsXG5cdFx0XHRcdHN1Z2dlc3RUaW1lb3V0OjI1MCxcblx0XHRcdFx0cXVlcnlNaW5MZW5ndGg6Myxcblx0XHRcdFx0ZGVmYXVsdE1hcmtHZW9jb2RlOmZhbHNlLFxuXHRcdFx0fSlcblx0XHRcdC5vbignbWFya2dlb2NvZGUnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHR2YXIgbGF0bG5nID0gIGUuZ2VvY29kZS5jZW50ZXIsXG5cdFx0XHRcdFx0ZWRpdG9yX2NvbmZpZyA9IHNlbGYuJGVsLmRhdGEoKS5lZGl0b3JDb25maWcsXG5cdFx0XHRcdFx0Y291bnRfbWFya2VycyA9IHNlbGYuJG1hcmtlcnMoKS5jaGlsZHJlbigpLm5vdCgnW2RhdGEtaWRdJykubGVuZ3RoLFxuXHRcdFx0XHRcdGxhYmVsID0gc2VsZi5fZ2V0X2dlb2NvZGVyX3Jlc3VsdF9sYWJlbCggWyBlLmdlb2NvZGUgXSwgbGF0bG5nICk7XG5cblx0XHRcdFx0aWYgKCBjb3VudF9tYXJrZXJzID09PSBmYWxzZSB8fCBjb3VudF9tYXJrZXJzIDwgZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyApIHtcblx0XHRcdFx0XHQvLyBhZGQgbWFya2VyIGlmIG5vIHJlc3RyaWN0aW9uIG9yIG1heCBtYXJrZXJzIG5vdCBleGNlZWRlZFxuXHRcdFx0XHRcdHNlbGYuYWRkX21hcmtlciggbGF0bG5nLCBsYWJlbCApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmICggZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyA9PT0gMSAmJiBjb3VudF9tYXJrZXJzID09PSAxICkge1xuXHRcdFx0XHRcdC8vIHVwZGF0ZSBzaW5nbGUgbWFya2VyXG5cdFx0XHRcdFx0bWFya2VyID0gc2VsZi5nZXRfZmlyc3RfbWFya2VyKCk7XG5cdFx0XHRcdFx0aWYgKCAhISBtYXJrZXIgKSB7XG5cdFx0XHRcdFx0XHRlbnRyeSA9IG1hcmtlci5vc21fY29udHJvbGxlcjtcblx0XHRcdFx0XHRcdG1hcmtlci5zZXRMYXRMbmcoIGxhdGxuZyApO1xuXHRcdFx0XHRcdFx0ZW50cnkudXBkYXRlX21hcmtlcl9nZW9jb2RlKCBsYWJlbCApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICggZWRpdG9yX2NvbmZpZy5tYXhfbWFya2VycyA9PT0gMCApIHtcblx0XHRcdFx0XHRzZWxmLm1hcC5maXRCb3VuZHMoIGUuZ2VvY29kZS5iYm94ICk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c2VsZi5tYXAuc2V0VmlldyggbGF0bG5nLCBzZWxmLm1hcC5nZXRab29tKCkgKTsgLy8ga2VlcCB6b29tLCBtaWdodCBiZSBjb25mdXNpbmcgZWxzZVxuXHRcdFx0XHR9XG5cblx0XHRcdH0pXG5cdFx0XHQuYWRkVG8oIHRoaXMubWFwICk7XG5cblx0XHRcdC8vIHByZXZlbnQgd3AgcG9zdCBmb3JtIGZyb20gYmVpbmcgc3VibWl0dGVkXG5cdFx0XHRMLkRvbUV2ZW50LmFkZExpc3RlbmVyKHRoaXMuZ2VvY29kZXIuX2lucHV0LCAna2V5ZG93bicsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRpZiAoIGUua2V5Q29kZSA9PT0gMTMgKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCB0aGlzLmdlb2NvZGVyICk7XG5cdFx0fSxcblx0XHRnZXRfZmlyc3RfbWFya2VyOmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIG1hcmtlciA9IGZhbHNlO1xuXHRcdFx0dGhpcy5tYXAuZWFjaExheWVyKGZ1bmN0aW9uKGxheWVyKXtcblx0XHRcdFx0aWYgKCBsYXllci5jb25zdHJ1Y3RvciA9PT0gTC5NYXJrZXIgKSB7XG5cdFx0XHRcdFx0bWFya2VyID0gbGF5ZXI7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiBtYXJrZXI7XG5cdFx0fSxcblx0XHR1cGRhdGVfdmlzaWJsZTogZnVuY3Rpb24oKSB7XG5cblx0XHRcdGlmICggdGhpcy52aXNpYmxlID09PSB0aGlzLiRlbC5pcygnOnZpc2libGUnKSApIHtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudmlzaWJsZSA9IHRoaXMuJGVsLmlzKCc6dmlzaWJsZScpO1xuXG5cdFx0XHRpZiAoIHRoaXMudmlzaWJsZSApIHtcblx0XHRcdFx0dGhpcy5tYXAuaW52YWxpZGF0ZVNpemUoKTtcblx0XHRcdFx0dGhpcy5iaW5kX2V2ZW50cygpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcztcblx0XHRcdH1cblx0XHRcdHRoaXMudW5iaW5kX2V2ZW50cygpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRpbml0X2FjZjogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdHRvZ2dsZV9jYiA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdC8vIG5vIGNoYW5nZVxuXHRcdFx0XHRcdHNlbGYudXBkYXRlX3Zpc2libGUoKTtcblx0XHRcdFx0fTtcblxuXHRcdFx0Ly8gZXhwYW5kL2NvbGxhcHNlIGFjZiBzZXR0aW5nXG5cdFx0XHRhY2YuYWRkQWN0aW9uKCAnc2hvdycsIHRvZ2dsZV9jYiApO1xuXHRcdFx0YWNmLmFkZEFjdGlvbiggJ2hpZGUnLCB0b2dnbGVfY2IgKTtcblx0XHRcdGFjZi5hZGRBY3Rpb24oICdkaXNhYmxlX2ZpZWxkJywgZnVuY3Rpb24oKXtcblx0XHRcdFx0c2VsZi51bmJpbmRfZXZlbnRzKCk7XG5cdFx0XHR9ICk7XG5cblx0XHRcdC8vIGV4cGFuZCB3cCBtZXRhYm94XG5cdFx0XHQkKGRvY3VtZW50KS5vbigncG9zdGJveC10b2dnbGVkJywgdG9nZ2xlX2NiICk7XG5cdFx0XHQkKGRvY3VtZW50KS5vbignY2xpY2snLCcud2lkZ2V0LXRvcCAqJywgdG9nZ2xlX2NiICk7XG5cblxuXG5cdFx0fSxcblx0XHR1bmJpbmRfZXZlbnRzOmZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXHRcdFx0c2VsZi4kbGF0KCkub2ZmKCdibHVyJyk7XG5cdFx0XHRzZWxmLiRsbmcoKS5vZmYoJ2JsdXInKTtcblx0XHRcdHNlbGYuJHpvb20oKS5vZmYoJ2JsdXInKTtcblx0XHRcdHNlbGYuJHpvb20oKS5vZmYoJ2tleXVwIGZvY3VzJyk7XG5cblx0XHRcdHRoaXMubWFwLm9mZignem9vbWVuZCcsIHRoaXMubWFwX3pvb21lZCwgdGhpcyApO1xuXHRcdFx0dGhpcy5tYXAub2ZmKCdtb3ZlZW5kJywgdGhpcy5tYXBfbW92ZWQsIHRoaXMgKTtcblx0XHR9LFxuXHRcdGJpbmRfZXZlbnRzOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi4kbGF0KCkub24oJ2JsdXInLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRzZWxmLnVwZGF0ZV9tYXAoKTtcblx0XHRcdH0pO1xuXHRcdFx0c2VsZi4kbG5nKCkub24oJ2JsdXInLGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRzZWxmLnVwZGF0ZV9tYXAoKTtcblx0XHRcdH0pO1xuXHRcdFx0c2VsZi4kem9vbSgpLm9uKCdibHVyJyxmdW5jdGlvbihlKXtcblx0XHRcdFx0c2VsZi51cGRhdGVfbWFwKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5tYXAub24oJ3pvb21lbmQnLCB0aGlzLm1hcF96b29tZWQsIHRoaXMgKTtcblx0XHRcdHRoaXMubWFwLm9uKCdtb3ZlZW5kJywgdGhpcy5tYXBfbW92ZWQsIHRoaXMgKTtcblx0XHR9LFxuXHRcdHVwZGF0ZV9tYXA6ZnVuY3Rpb24oKSB7XG5cdFx0XHRpZiAoICEgdGhpcy4kbGF0KCkudmFsKCkgfHwgISB0aGlzLiRsbmcoKS52YWwoKSApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0dmFyIGxhdGxuZyA9IEwubGF0TG5nKCB0aGlzLiRsYXQoKS52YWwoKSwgdGhpcy4kbG5nKCkudmFsKCkgKTtcblx0XHRcdHRoaXMubWFwLnNldFZpZXcoIGxhdGxuZywgIHRoaXMuJHpvb20oKS52YWwoKSApO1xuXHRcdH0sXG5cdFx0bWFwX21vdmVkOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dmFyIGNlbnRlciA9IHRoaXMubWFwLmdldENlbnRlcigpO1xuXHRcdFx0dGhpcy4kbGF0KCkudmFsKGNlbnRlci5sYXQpO1xuXHRcdFx0dGhpcy4kbG5nKCkudmFsKGNlbnRlci5sbmcpO1xuXHRcdFx0dGhpcy4kZWwudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0fSxcblx0XHRtYXBfem9vbWVkOmZ1bmN0aW9uKGUpe1xuXHRcdFx0dGhpcy4kem9vbSgpLnZhbCggdGhpcy5tYXAuZ2V0Wm9vbSgpICk7XG5cdFx0XHR0aGlzLiRlbC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHR9XG5cdH0pO1xuXG5cblx0JChkb2N1bWVudClcblx0XHQub24oJ2FjZi1vc20tbWFwLWluaXQnLGZ1bmN0aW9uKCBlLCBtYXAgKSB7XG5cdFx0XHRpZiAoICQoZS50YXJnZXQpLmlzKCdbZGF0YS1lZGl0b3ItY29uZmlnXScpICkge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdCQoZS50YXJnZXQpLmRhdGEoICdfbWFwX2VkaXRvcicsIG5ldyBvc20uZmllbGQoIHsgZWw6IGUudGFyZ2V0LCBtYXA6IG1hcCB9ICkgKTtcblx0XHRcdH1cblx0XHR9KVxuXHRcdC8vIGZpZWxkIHNldHRpbmdzXG5cdFx0Lm9uKCdjaGFuZ2UnLCdbZGF0YS10eXBlPVwib3Blbl9zdHJlZXRfbWFwXCJdIFtkYXRhLW5hbWU9XCJyZXR1cm5fZm9ybWF0XCJdIGlucHV0JyxmdW5jdGlvbihlKXtcblx0XHRcdC8vIGZpbmQgbWFwIGZpZWxkXG5cdFx0XHQkKCdbZGF0YS1uYW1lPVwicmV0dXJuX2Zvcm1hdFwiXSBpbnB1dDpjaGVja2VkJykudmFsKClcblx0XHRcdHZhciAkbWFwID0gJCh0aGlzKS5jbG9zZXN0KCcuYWNmLWZpZWxkLW9iamVjdCcpLmZpbmQoJ1tkYXRhLWVkaXRvci1jb25maWddJyksXG5cdFx0XHRcdGVkaXRvciA9ICRtYXAuZGF0YSggJ19tYXBfZWRpdG9yJyApLFxuXHRcdFx0XHRjb25mID0gJG1hcC5kYXRhKCdlZGl0b3ItY29uZmlnJyk7XG5cdFx0XHQvLyBtYXBcblx0XHRcdGVkaXRvci5yZXNldF9sYXllcnMoKTtcblx0XHRcdGlmICggJCh0aGlzKS52YWwoKSA9PT0gJ29zbScgKSB7XG5cdFx0XHRcdC8vIHNldCBwcm92aWRlciByZXN0cmljdGlvbiB0byBvc20gcHJvdmlkZXJzXG5cdFx0XHRcdGNvbmYucmVzdHJpY3RfcHJvdmlkZXJzID0gT2JqZWN0LnZhbHVlcyggYXJnLm9wdGlvbnMub3NtX2xheWVycyApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gc2V0IHByb3ZpZGVyIHJlc3RyaWN0aW9uIHRvIG9zbSBwcm92aWRlcnNcblx0XHRcdFx0Y29uZi5yZXN0cmljdF9wcm92aWRlcnMgPSBPYmplY3QudmFsdWVzKCBhcmcub3B0aW9ucy5sZWFmbGV0X2xheWVycyApO1xuXHRcdFx0fVxuXHRcdFx0JG1hcC5kYXRhKCAnZWRpdG9yLWNvbmZpZycsIGNvbmYgKTtcblx0XHRcdGVkaXRvci5pbml0X2xheWVycygpO1xuXHRcdH0pO1xuXG5cdC8vIHdoZW4gZmllbGRzIGdldCBsb2FkZWQgLi4uXG5cdGFjZi5hZGRBY3Rpb24oICdhcHBlbmQnLCBmdW5jdGlvbigpe1xuXHRcdCQuYWNmX2xlYWZsZXQoKTtcblx0fSk7XG5cdGFjZi5hZGRBY3Rpb24oICdzaG93X2ZpZWxkL3R5cGU9b3Blbl9zdHJlZXRfbWFwJywgZnVuY3Rpb24oIGZpZWxkICl7XG5cdCAgICB2YXIgZWRpdG9yID0gZmllbGQuJGVsLmZpbmQoJ1tkYXRhLWVkaXRvci1jb25maWddJykuZGF0YSggJ19tYXBfZWRpdG9yJyApO1xuXHQgICAgZWRpdG9yLnVwZGF0ZV92aXNpYmxlKCk7XG5cdH0pO1xufSkoIGpRdWVyeSwgYWNmX29zbV9hZG1pbiApO1xuIl19
